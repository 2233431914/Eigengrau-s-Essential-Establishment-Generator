<!DOCTYPE html>
<html data-init="no-js">
<head>
<meta charset="UTF-8" />
<title>Eigengrau&#39;s Essential Establishment Generator</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<!--

SugarCube (v2.23.5): A free (gratis and libre) story format.

Copyright © 2013–2018 Thomas Michael Edwards <thomasmedwards@gmail.com>.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

1. Redistributions of source code must retain the above copyright notice, this
   list of conditions and the following disclaimer.
2. Redistributions in binary form must reproduce the above copyright notice,
   this list of conditions and the following disclaimer in the documentation
   and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

-->
<script id="script-libraries" type="text/javascript">
if(document.head&&document.addEventListener&&document.querySelector&&Object.create&&Object.freeze&&JSON){document.documentElement.setAttribute("data-init", "loading");
/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js */
if("document" in self){if(!("classList" in document.createElement("_"))){(function(j){"use strict";if(!("Element" in j)){return}var a="classList",f="prototype",m=j.Element[f],b=Object,k=String[f].trim||function(){return this.replace(/^\s+|\s+$/g,"")},c=Array[f].indexOf||function(q){var p=0,o=this.length;for(;p<o;p++){if(p in this&&this[p]===q){return p}}return -1},n=function(o,p){this.name=o;this.code=DOMException[o];this.message=p},g=function(p,o){if(o===""){throw new n("SYNTAX_ERR","An invalid or illegal string was specified")}if(/\s/.test(o)){throw new n("INVALID_CHARACTER_ERR","String contains an invalid character")}return c.call(p,o)},d=function(s){var r=k.call(s.getAttribute("class")||""),q=r?r.split(/\s+/):[],p=0,o=q.length;for(;p<o;p++){this.push(q[p])}this._updateClassName=function(){s.setAttribute("class",this.toString())}},e=d[f]=[],i=function(){return new d(this)};n[f]=Error[f];e.item=function(o){return this[o]||null};e.contains=function(o){o+="";return g(this,o)!==-1};e.add=function(){var s=arguments,r=0,p=s.length,q,o=false;do{q=s[r]+"";if(g(this,q)===-1){this.push(q);o=true}}while(++r<p);if(o){this._updateClassName()}};e.remove=function(){var t=arguments,s=0,p=t.length,r,o=false,q;do{r=t[s]+"";q=g(this,r);while(q!==-1){this.splice(q,1);o=true;q=g(this,r)}}while(++s<p);if(o){this._updateClassName()}};e.toggle=function(p,q){p+="";var o=this.contains(p),r=o?q!==true&&"remove":q!==false&&"add";if(r){this[r](p)}if(q===true||q===false){return q}else{return !o}};e.toString=function(){return this.join(" ")};if(b.defineProperty){var l={get:i,enumerable:true,configurable:true};try{b.defineProperty(m,a,l)}catch(h){if(h.number===-2146823252){l.enumerable=false;b.defineProperty(m,a,l)}}}else{if(b[f].__defineGetter__){m.__defineGetter__(a,i)}}}(self))}else{(function(){var b=document.createElement("_");b.classList.add("c1","c2");if(!b.classList.contains("c2")){var c=function(e){var d=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(h){var g,f=arguments.length;for(g=0;g<f;g++){h=arguments[g];d.call(this,h)}}};c("add");c("remove")}b.classList.toggle("c3",false);if(b.classList.contains("c3")){var a=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(d,e){if(1 in arguments&&!this.contains(d)===!e){return e}else{return a.call(this,d)}}}b=null}())}};
/*!
 * https://github.com/es-shims/es5-shim
 * @license es5-shim Copyright 2009-2015 by contributors, MIT License
 * see https://github.com/es-shims/es5-shim/blob/v4.5.9/LICENSE
 */
(function(t,r){"use strict";if(typeof define==="function"&&define.amd){define(r)}else if(typeof exports==="object"){module.exports=r()}else{t.returnExports=r()}})(this,function(){var t=Array;var r=t.prototype;var e=Object;var n=e.prototype;var i=Function;var a=i.prototype;var o=String;var f=o.prototype;var u=Number;var l=u.prototype;var s=r.slice;var c=r.splice;var v=r.push;var h=r.unshift;var p=r.concat;var y=r.join;var d=a.call;var g=a.apply;var w=Math.max;var b=Math.min;var T=n.toString;var m=typeof Symbol==="function"&&typeof Symbol.toStringTag==="symbol";var D;var S=Function.prototype.toString,x=/^\s*class /,O=function isES6ClassFn(t){try{var r=S.call(t);var e=r.replace(/\/\/.*\n/g,"");var n=e.replace(/\/\*[.\s\S]*\*\//g,"");var i=n.replace(/\n/gm," ").replace(/ {2}/g," ");return x.test(i)}catch(a){return false}},j=function tryFunctionObject(t){try{if(O(t)){return false}S.call(t);return true}catch(r){return false}},E="[object Function]",I="[object GeneratorFunction]",D=function isCallable(t){if(!t){return false}if(typeof t!=="function"&&typeof t!=="object"){return false}if(m){return j(t)}if(O(t)){return false}var r=T.call(t);return r===E||r===I};var M;var U=RegExp.prototype.exec,F=function tryRegexExec(t){try{U.call(t);return true}catch(r){return false}},N="[object RegExp]";M=function isRegex(t){if(typeof t!=="object"){return false}return m?F(t):T.call(t)===N};var C;var k=String.prototype.valueOf,A=function tryStringObject(t){try{k.call(t);return true}catch(r){return false}},R="[object String]";C=function isString(t){if(typeof t==="string"){return true}if(typeof t!=="object"){return false}return m?A(t):T.call(t)===R};var P=e.defineProperty&&function(){try{var t={};e.defineProperty(t,"x",{enumerable:false,value:t});for(var r in t){return false}return t.x===t}catch(n){return false}}();var $=function(t){var r;if(P){r=function(t,r,n,i){if(!i&&r in t){return}e.defineProperty(t,r,{configurable:true,enumerable:false,writable:true,value:n})}}else{r=function(t,r,e,n){if(!n&&r in t){return}t[r]=e}}return function defineProperties(e,n,i){for(var a in n){if(t.call(n,a)){r(e,a,n[a],i)}}}}(n.hasOwnProperty);var J=function isPrimitive(t){var r=typeof t;return t===null||r!=="object"&&r!=="function"};var Y=u.isNaN||function isActualNaN(t){return t!==t};var Z={ToInteger:function ToInteger(t){var r=+t;if(Y(r)){r=0}else if(r!==0&&r!==1/0&&r!==-(1/0)){r=(r>0||-1)*Math.floor(Math.abs(r))}return r},ToPrimitive:function ToPrimitive(t){var r,e,n;if(J(t)){return t}e=t.valueOf;if(D(e)){r=e.call(t);if(J(r)){return r}}n=t.toString;if(D(n)){r=n.call(t);if(J(r)){return r}}throw new TypeError},ToObject:function(t){if(t==null){throw new TypeError("can't convert "+t+" to object")}return e(t)},ToUint32:function ToUint32(t){return t>>>0}};var z=function Empty(){};$(a,{bind:function bind(t){var r=this;if(!D(r)){throw new TypeError("Function.prototype.bind called on incompatible "+r)}var n=s.call(arguments,1);var a;var o=function(){if(this instanceof a){var i=g.call(r,this,p.call(n,s.call(arguments)));if(e(i)===i){return i}return this}else{return g.call(r,t,p.call(n,s.call(arguments)))}};var f=w(0,r.length-n.length);var u=[];for(var l=0;l<f;l++){v.call(u,"$"+l)}a=i("binder","return function ("+y.call(u,",")+"){ return binder.apply(this, arguments); }")(o);if(r.prototype){z.prototype=r.prototype;a.prototype=new z;z.prototype=null}return a}});var G=d.bind(n.hasOwnProperty);var B=d.bind(n.toString);var H=d.bind(s);var W=g.bind(s);var L=d.bind(f.slice);var X=d.bind(f.split);var q=d.bind(f.indexOf);var K=d.bind(v);var Q=d.bind(n.propertyIsEnumerable);var V=d.bind(r.sort);var _=t.isArray||function isArray(t){return B(t)==="[object Array]"};var tt=[].unshift(0)!==1;$(r,{unshift:function(){h.apply(this,arguments);return this.length}},tt);$(t,{isArray:_});var rt=e("a");var et=rt[0]!=="a"||!(0 in rt);var nt=function properlyBoxed(t){var r=true;var e=true;var n=false;if(t){try{t.call("foo",function(t,e,n){if(typeof n!=="object"){r=false}});t.call([1],function(){"use strict";e=typeof this==="string"},"x")}catch(i){n=true}}return!!t&&!n&&r&&e};$(r,{forEach:function forEach(t){var r=Z.ToObject(this);var e=et&&C(this)?X(this,""):r;var n=-1;var i=Z.ToUint32(e.length);var a;if(arguments.length>1){a=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.forEach callback must be a function")}while(++n<i){if(n in e){if(typeof a==="undefined"){t(e[n],n,r)}else{t.call(a,e[n],n,r)}}}}},!nt(r.forEach));$(r,{map:function map(r){var e=Z.ToObject(this);var n=et&&C(this)?X(this,""):e;var i=Z.ToUint32(n.length);var a=t(i);var o;if(arguments.length>1){o=arguments[1]}if(!D(r)){throw new TypeError("Array.prototype.map callback must be a function")}for(var f=0;f<i;f++){if(f in n){if(typeof o==="undefined"){a[f]=r(n[f],f,e)}else{a[f]=r.call(o,n[f],f,e)}}}return a}},!nt(r.map));$(r,{filter:function filter(t){var r=Z.ToObject(this);var e=et&&C(this)?X(this,""):r;var n=Z.ToUint32(e.length);var i=[];var a;var o;if(arguments.length>1){o=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.filter callback must be a function")}for(var f=0;f<n;f++){if(f in e){a=e[f];if(typeof o==="undefined"?t(a,f,r):t.call(o,a,f,r)){K(i,a)}}}return i}},!nt(r.filter));$(r,{every:function every(t){var r=Z.ToObject(this);var e=et&&C(this)?X(this,""):r;var n=Z.ToUint32(e.length);var i;if(arguments.length>1){i=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.every callback must be a function")}for(var a=0;a<n;a++){if(a in e&&!(typeof i==="undefined"?t(e[a],a,r):t.call(i,e[a],a,r))){return false}}return true}},!nt(r.every));$(r,{some:function some(t){var r=Z.ToObject(this);var e=et&&C(this)?X(this,""):r;var n=Z.ToUint32(e.length);var i;if(arguments.length>1){i=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.some callback must be a function")}for(var a=0;a<n;a++){if(a in e&&(typeof i==="undefined"?t(e[a],a,r):t.call(i,e[a],a,r))){return true}}return false}},!nt(r.some));var it=false;if(r.reduce){it=typeof r.reduce.call("es5",function(t,r,e,n){return n})==="object"}$(r,{reduce:function reduce(t){var r=Z.ToObject(this);var e=et&&C(this)?X(this,""):r;var n=Z.ToUint32(e.length);if(!D(t)){throw new TypeError("Array.prototype.reduce callback must be a function")}if(n===0&&arguments.length===1){throw new TypeError("reduce of empty array with no initial value")}var i=0;var a;if(arguments.length>=2){a=arguments[1]}else{do{if(i in e){a=e[i++];break}if(++i>=n){throw new TypeError("reduce of empty array with no initial value")}}while(true)}for(;i<n;i++){if(i in e){a=t(a,e[i],i,r)}}return a}},!it);var at=false;if(r.reduceRight){at=typeof r.reduceRight.call("es5",function(t,r,e,n){return n})==="object"}$(r,{reduceRight:function reduceRight(t){var r=Z.ToObject(this);var e=et&&C(this)?X(this,""):r;var n=Z.ToUint32(e.length);if(!D(t)){throw new TypeError("Array.prototype.reduceRight callback must be a function")}if(n===0&&arguments.length===1){throw new TypeError("reduceRight of empty array with no initial value")}var i;var a=n-1;if(arguments.length>=2){i=arguments[1]}else{do{if(a in e){i=e[a--];break}if(--a<0){throw new TypeError("reduceRight of empty array with no initial value")}}while(true)}if(a<0){return i}do{if(a in e){i=t(i,e[a],a,r)}}while(a--);return i}},!at);var ot=r.indexOf&&[0,1].indexOf(1,2)!==-1;$(r,{indexOf:function indexOf(t){var r=et&&C(this)?X(this,""):Z.ToObject(this);var e=Z.ToUint32(r.length);if(e===0){return-1}var n=0;if(arguments.length>1){n=Z.ToInteger(arguments[1])}n=n>=0?n:w(0,e+n);for(;n<e;n++){if(n in r&&r[n]===t){return n}}return-1}},ot);var ft=r.lastIndexOf&&[0,1].lastIndexOf(0,-3)!==-1;$(r,{lastIndexOf:function lastIndexOf(t){var r=et&&C(this)?X(this,""):Z.ToObject(this);var e=Z.ToUint32(r.length);if(e===0){return-1}var n=e-1;if(arguments.length>1){n=b(n,Z.ToInteger(arguments[1]))}n=n>=0?n:e-Math.abs(n);for(;n>=0;n--){if(n in r&&t===r[n]){return n}}return-1}},ft);var ut=function(){var t=[1,2];var r=t.splice();return t.length===2&&_(r)&&r.length===0}();$(r,{splice:function splice(t,r){if(arguments.length===0){return[]}else{return c.apply(this,arguments)}}},!ut);var lt=function(){var t={};r.splice.call(t,0,0,1);return t.length===1}();$(r,{splice:function splice(t,r){if(arguments.length===0){return[]}var e=arguments;this.length=w(Z.ToInteger(this.length),0);if(arguments.length>0&&typeof r!=="number"){e=H(arguments);if(e.length<2){K(e,this.length-t)}else{e[1]=Z.ToInteger(r)}}return c.apply(this,e)}},!lt);var st=function(){var r=new t(1e5);r[8]="x";r.splice(1,1);return r.indexOf("x")===7}();var ct=function(){var t=256;var r=[];r[t]="a";r.splice(t+1,0,"b");return r[t]==="a"}();$(r,{splice:function splice(t,r){var e=Z.ToObject(this);var n=[];var i=Z.ToUint32(e.length);var a=Z.ToInteger(t);var f=a<0?w(i+a,0):b(a,i);var u=b(w(Z.ToInteger(r),0),i-f);var l=0;var s;while(l<u){s=o(f+l);if(G(e,s)){n[l]=e[s]}l+=1}var c=H(arguments,2);var v=c.length;var h;if(v<u){l=f;var p=i-u;while(l<p){s=o(l+u);h=o(l+v);if(G(e,s)){e[h]=e[s]}else{delete e[h]}l+=1}l=i;var y=i-u+v;while(l>y){delete e[l-1];l-=1}}else if(v>u){l=i-u;while(l>f){s=o(l+u-1);h=o(l+v-1);if(G(e,s)){e[h]=e[s]}else{delete e[h]}l-=1}}l=f;for(var d=0;d<c.length;++d){e[l]=c[d];l+=1}e.length=i-u+v;return n}},!st||!ct);var vt=r.join;var ht;try{ht=Array.prototype.join.call("123",",")!=="1,2,3"}catch(pt){ht=true}if(ht){$(r,{join:function join(t){var r=typeof t==="undefined"?",":t;return vt.call(C(this)?X(this,""):this,r)}},ht)}var yt=[1,2].join(undefined)!=="1,2";if(yt){$(r,{join:function join(t){var r=typeof t==="undefined"?",":t;return vt.call(this,r)}},yt)}var dt=function push(t){var r=Z.ToObject(this);var e=Z.ToUint32(r.length);var n=0;while(n<arguments.length){r[e+n]=arguments[n];n+=1}r.length=e+n;return e+n};var gt=function(){var t={};var r=Array.prototype.push.call(t,undefined);return r!==1||t.length!==1||typeof t[0]!=="undefined"||!G(t,0)}();$(r,{push:function push(t){if(_(this)){return v.apply(this,arguments)}return dt.apply(this,arguments)}},gt);var wt=function(){var t=[];var r=t.push(undefined);return r!==1||t.length!==1||typeof t[0]!=="undefined"||!G(t,0)}();$(r,{push:dt},wt);$(r,{slice:function(t,r){var e=C(this)?X(this,""):this;return W(e,arguments)}},et);var bt=function(){try{[1,2].sort(null);[1,2].sort({});return true}catch(t){}return false}();var Tt=function(){try{[1,2].sort(/a/);return false}catch(t){}return true}();var mt=function(){try{[1,2].sort(undefined);return true}catch(t){}return false}();$(r,{sort:function sort(t){if(typeof t==="undefined"){return V(this)}if(!D(t)){throw new TypeError("Array.prototype.sort callback must be a function")}return V(this,t)}},bt||!mt||!Tt);var Dt=!Q({toString:null},"toString");var St=Q(function(){},"prototype");var xt=!G("x","0");var Ot=function(t){var r=t.constructor;return r&&r.prototype===t};var jt={$window:true,$console:true,$parent:true,$self:true,$frame:true,$frames:true,$frameElement:true,$webkitIndexedDB:true,$webkitStorageInfo:true,$external:true};var Et=function(){if(typeof window==="undefined"){return false}for(var t in window){try{if(!jt["$"+t]&&G(window,t)&&window[t]!==null&&typeof window[t]==="object"){Ot(window[t])}}catch(r){return true}}return false}();var It=function(t){if(typeof window==="undefined"||!Et){return Ot(t)}try{return Ot(t)}catch(r){return false}};var Mt=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];var Ut=Mt.length;var Ft=function isArguments(t){return B(t)==="[object Arguments]"};var Nt=function isArguments(t){return t!==null&&typeof t==="object"&&typeof t.length==="number"&&t.length>=0&&!_(t)&&D(t.callee)};var Ct=Ft(arguments)?Ft:Nt;$(e,{keys:function keys(t){var r=D(t);var e=Ct(t);var n=t!==null&&typeof t==="object";var i=n&&C(t);if(!n&&!r&&!e){throw new TypeError("Object.keys called on a non-object")}var a=[];var f=St&&r;if(i&&xt||e){for(var u=0;u<t.length;++u){K(a,o(u))}}if(!e){for(var l in t){if(!(f&&l==="prototype")&&G(t,l)){K(a,o(l))}}}if(Dt){var s=It(t);for(var c=0;c<Ut;c++){var v=Mt[c];if(!(s&&v==="constructor")&&G(t,v)){K(a,v)}}}return a}});var kt=e.keys&&function(){return e.keys(arguments).length===2}(1,2);var At=e.keys&&function(){var t=e.keys(arguments);return arguments.length!==1||t.length!==1||t[0]!==1}(1);var Rt=e.keys;$(e,{keys:function keys(t){if(Ct(t)){return Rt(H(t))}else{return Rt(t)}}},!kt||At);var Pt=new Date(-0xc782b5b342b24).getUTCMonth()!==0;var $t=new Date(-0x55d318d56a724);var Jt=new Date(14496624e5);var Yt=$t.toUTCString()!=="Mon, 01 Jan -45875 11:59:59 GMT";var Zt;var zt;var Gt=$t.getTimezoneOffset();if(Gt<-720){Zt=$t.toDateString()!=="Tue Jan 02 -45875";zt=!/^Thu Dec 10 2015 \d\d:\d\d:\d\d GMT[-\+]\d\d\d\d(?: |$)/.test(Jt.toString())}else{Zt=$t.toDateString()!=="Mon Jan 01 -45875";zt=!/^Wed Dec 09 2015 \d\d:\d\d:\d\d GMT[-\+]\d\d\d\d(?: |$)/.test(Jt.toString())}var Bt=d.bind(Date.prototype.getFullYear);var Ht=d.bind(Date.prototype.getMonth);var Wt=d.bind(Date.prototype.getDate);var Lt=d.bind(Date.prototype.getUTCFullYear);var Xt=d.bind(Date.prototype.getUTCMonth);var qt=d.bind(Date.prototype.getUTCDate);var Kt=d.bind(Date.prototype.getUTCDay);var Qt=d.bind(Date.prototype.getUTCHours);var Vt=d.bind(Date.prototype.getUTCMinutes);var _t=d.bind(Date.prototype.getUTCSeconds);var tr=d.bind(Date.prototype.getUTCMilliseconds);var rr=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var er=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var nr=function daysInMonth(t,r){return Wt(new Date(r,t,0))};$(Date.prototype,{getFullYear:function getFullYear(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Bt(this);if(t<0&&Ht(this)>11){return t+1}return t},getMonth:function getMonth(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Bt(this);var r=Ht(this);if(t<0&&r>11){return 0}return r},getDate:function getDate(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Bt(this);var r=Ht(this);var e=Wt(this);if(t<0&&r>11){if(r===12){return e}var n=nr(0,t+1);return n-e+1}return e},getUTCFullYear:function getUTCFullYear(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Lt(this);if(t<0&&Xt(this)>11){return t+1}return t},getUTCMonth:function getUTCMonth(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Lt(this);var r=Xt(this);if(t<0&&r>11){return 0}return r},getUTCDate:function getUTCDate(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Lt(this);var r=Xt(this);var e=qt(this);if(t<0&&r>11){if(r===12){return e}var n=nr(0,t+1);return n-e+1}return e}},Pt);$(Date.prototype,{toUTCString:function toUTCString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Kt(this);var r=qt(this);var e=Xt(this);var n=Lt(this);var i=Qt(this);var a=Vt(this);var o=_t(this);return rr[t]+", "+(r<10?"0"+r:r)+" "+er[e]+" "+n+" "+(i<10?"0"+i:i)+":"+(a<10?"0"+a:a)+":"+(o<10?"0"+o:o)+" GMT"}},Pt||Yt);$(Date.prototype,{toDateString:function toDateString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=this.getDay();var r=this.getDate();var e=this.getMonth();var n=this.getFullYear();return rr[t]+" "+er[e]+" "+(r<10?"0"+r:r)+" "+n}},Pt||Zt);if(Pt||zt){Date.prototype.toString=function toString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=this.getDay();var r=this.getDate();var e=this.getMonth();var n=this.getFullYear();var i=this.getHours();var a=this.getMinutes();var o=this.getSeconds();var f=this.getTimezoneOffset();var u=Math.floor(Math.abs(f)/60);var l=Math.floor(Math.abs(f)%60);return rr[t]+" "+er[e]+" "+(r<10?"0"+r:r)+" "+n+" "+(i<10?"0"+i:i)+":"+(a<10?"0"+a:a)+":"+(o<10?"0"+o:o)+" GMT"+(f>0?"-":"+")+(u<10?"0"+u:u)+(l<10?"0"+l:l)};if(P){e.defineProperty(Date.prototype,"toString",{configurable:true,enumerable:false,writable:true})}}var ir=-621987552e5;var ar="-000001";var or=Date.prototype.toISOString&&new Date(ir).toISOString().indexOf(ar)===-1;var fr=Date.prototype.toISOString&&new Date(-1).toISOString()!=="1969-12-31T23:59:59.999Z";var ur=d.bind(Date.prototype.getTime);$(Date.prototype,{toISOString:function toISOString(){if(!isFinite(this)||!isFinite(ur(this))){throw new RangeError("Date.prototype.toISOString called on non-finite value.")}var t=Lt(this);var r=Xt(this);t+=Math.floor(r/12);r=(r%12+12)%12;var e=[r+1,qt(this),Qt(this),Vt(this),_t(this)];t=(t<0?"-":t>9999?"+":"")+L("00000"+Math.abs(t),0<=t&&t<=9999?-4:-6);for(var n=0;n<e.length;++n){e[n]=L("00"+e[n],-2)}return t+"-"+H(e,0,2).join("-")+"T"+H(e,2).join(":")+"."+L("000"+tr(this),-3)+"Z"}},or||fr);var lr=function(){try{return Date.prototype.toJSON&&new Date(NaN).toJSON()===null&&new Date(ir).toJSON().indexOf(ar)!==-1&&Date.prototype.toJSON.call({toISOString:function(){return true}})}catch(t){return false}}();if(!lr){Date.prototype.toJSON=function toJSON(t){var r=e(this);var n=Z.ToPrimitive(r);if(typeof n==="number"&&!isFinite(n)){return null}var i=r.toISOString;if(!D(i)){throw new TypeError("toISOString property is not callable")}return i.call(r)}}var sr=Date.parse("+033658-09-27T01:46:40.000Z")===1e15;var cr=!isNaN(Date.parse("2012-04-04T24:00:00.500Z"))||!isNaN(Date.parse("2012-11-31T23:59:59.000Z"))||!isNaN(Date.parse("2012-12-31T23:59:60.000Z"));var vr=isNaN(Date.parse("2000-01-01T00:00:00.000Z"));if(vr||cr||!sr){var hr=Math.pow(2,31)-1;var pr=Y(new Date(1970,0,1,0,0,0,hr+1).getTime());Date=function(t){var r=function Date(e,n,i,a,f,u,l){var s=arguments.length;var c;if(this instanceof t){var v=u;var h=l;if(pr&&s>=7&&l>hr){var p=Math.floor(l/hr)*hr;var y=Math.floor(p/1e3);v+=y;h-=y*1e3}c=s===1&&o(e)===e?new t(r.parse(e)):s>=7?new t(e,n,i,a,f,v,h):s>=6?new t(e,n,i,a,f,v):s>=5?new t(e,n,i,a,f):s>=4?new t(e,n,i,a):s>=3?new t(e,n,i):s>=2?new t(e,n):s>=1?new t(e instanceof t?+e:e):new t}else{c=t.apply(this,arguments)}if(!J(c)){$(c,{constructor:r},true)}return c};var e=new RegExp("^"+"(\\d{4}|[+-]\\d{6})"+"(?:-(\\d{2})"+"(?:-(\\d{2})"+"(?:"+"T(\\d{2})"+":(\\d{2})"+"(?:"+":(\\d{2})"+"(?:(\\.\\d{1,}))?"+")?"+"("+"Z|"+"(?:"+"([-+])"+"(\\d{2})"+":(\\d{2})"+")"+")?)?)?)?"+"$");var n=[0,31,59,90,120,151,181,212,243,273,304,334,365];var i=function dayFromMonth(t,r){var e=r>1?1:0;return n[r]+Math.floor((t-1969+e)/4)-Math.floor((t-1901+e)/100)+Math.floor((t-1601+e)/400)+365*(t-1970)};var a=function toUTC(r){var e=0;var n=r;if(pr&&n>hr){var i=Math.floor(n/hr)*hr;var a=Math.floor(i/1e3);e+=a;n-=a*1e3}return u(new t(1970,0,1,0,0,e,n))};for(var f in t){if(G(t,f)){r[f]=t[f]}}$(r,{now:t.now,UTC:t.UTC},true);r.prototype=t.prototype;$(r.prototype,{constructor:r},true);var l=function parse(r){var n=e.exec(r);if(n){var o=u(n[1]),f=u(n[2]||1)-1,l=u(n[3]||1)-1,s=u(n[4]||0),c=u(n[5]||0),v=u(n[6]||0),h=Math.floor(u(n[7]||0)*1e3),p=Boolean(n[4]&&!n[8]),y=n[9]==="-"?1:-1,d=u(n[10]||0),g=u(n[11]||0),w;var b=c>0||v>0||h>0;if(s<(b?24:25)&&c<60&&v<60&&h<1e3&&f>-1&&f<12&&d<24&&g<60&&l>-1&&l<i(o,f+1)-i(o,f)){w=((i(o,f)+l)*24+s+d*y)*60;w=((w+c+g*y)*60+v)*1e3+h;if(p){w=a(w)}if(-864e13<=w&&w<=864e13){return w}}return NaN}return t.parse.apply(this,arguments)};$(r,{parse:l});return r}(Date)}if(!Date.now){Date.now=function now(){return(new Date).getTime()}}var yr=l.toFixed&&(8e-5.toFixed(3)!=="0.000"||.9.toFixed(0)!=="1"||1.255.toFixed(2)!=="1.25"||0xde0b6b3a7640080.toFixed(0)!=="1000000000000000128");var dr={base:1e7,size:6,data:[0,0,0,0,0,0],multiply:function multiply(t,r){var e=-1;var n=r;while(++e<dr.size){n+=t*dr.data[e];dr.data[e]=n%dr.base;n=Math.floor(n/dr.base)}},divide:function divide(t){var r=dr.size;var e=0;while(--r>=0){e+=dr.data[r];dr.data[r]=Math.floor(e/t);e=e%t*dr.base}},numToString:function numToString(){var t=dr.size;var r="";while(--t>=0){if(r!==""||t===0||dr.data[t]!==0){var e=o(dr.data[t]);if(r===""){r=e}else{r+=L("0000000",0,7-e.length)+e}}}return r},pow:function pow(t,r,e){return r===0?e:r%2===1?pow(t,r-1,e*t):pow(t*t,r/2,e)},log:function log(t){var r=0;var e=t;while(e>=4096){r+=12;e/=4096}while(e>=2){r+=1;e/=2}return r}};var gr=function toFixed(t){var r,e,n,i,a,f,l,s;r=u(t);r=Y(r)?0:Math.floor(r);if(r<0||r>20){throw new RangeError("Number.toFixed called with invalid number of decimals")}e=u(this);if(Y(e)){return"NaN"}if(e<=-1e21||e>=1e21){return o(e)}n="";if(e<0){n="-";e=-e}i="0";if(e>1e-21){a=dr.log(e*dr.pow(2,69,1))-69;f=a<0?e*dr.pow(2,-a,1):e/dr.pow(2,a,1);f*=4503599627370496;a=52-a;if(a>0){dr.multiply(0,f);l=r;while(l>=7){dr.multiply(1e7,0);l-=7}dr.multiply(dr.pow(10,l,1),0);l=a-1;while(l>=23){dr.divide(1<<23);l-=23}dr.divide(1<<l);dr.multiply(1,1);dr.divide(2);i=dr.numToString()}else{dr.multiply(0,f);dr.multiply(1<<-a,0);i=dr.numToString()+L("0.00000000000000000000",2,2+r)}}if(r>0){s=i.length;if(s<=r){i=n+L("0.0000000000000000000",0,r-s+2)+i}else{i=n+L(i,0,s-r)+"."+L(i,s-r)}}else{i=n+i}return i};$(l,{toFixed:gr},yr);var wr=function(){try{return 1..toPrecision(undefined)==="1"}catch(t){return true}}();var br=l.toPrecision;$(l,{toPrecision:function toPrecision(t){return typeof t==="undefined"?br.call(this):br.call(this,t)}},wr);if("ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1){(function(){var t=typeof/()??/.exec("")[1]==="undefined";var r=Math.pow(2,32)-1;f.split=function(e,n){var i=String(this);if(typeof e==="undefined"&&n===0){return[]}if(!M(e)){return X(this,e,n)}var a=[];var o=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),f=0,u,l,s,c;var h=new RegExp(e.source,o+"g");if(!t){u=new RegExp("^"+h.source+"$(?!\\s)",o)}var p=typeof n==="undefined"?r:Z.ToUint32(n);l=h.exec(i);while(l){s=l.index+l[0].length;if(s>f){K(a,L(i,f,l.index));if(!t&&l.length>1){l[0].replace(u,function(){for(var t=1;t<arguments.length-2;t++){if(typeof arguments[t]==="undefined"){l[t]=void 0}}})}if(l.length>1&&l.index<i.length){v.apply(a,H(l,1))}c=l[0].length;f=s;if(a.length>=p){break}}if(h.lastIndex===l.index){h.lastIndex++}l=h.exec(i)}if(f===i.length){if(c||!h.test("")){K(a,"")}}else{K(a,L(i,f))}return a.length>p?H(a,0,p):a}})()}else if("0".split(void 0,0).length){f.split=function split(t,r){if(typeof t==="undefined"&&r===0){return[]}return X(this,t,r)}}var Tr=f.replace;var mr=function(){var t=[];"x".replace(/x(.)?/g,function(r,e){K(t,e)});return t.length===1&&typeof t[0]==="undefined"}();if(!mr){f.replace=function replace(t,r){var e=D(r);var n=M(t)&&/\)[*?]/.test(t.source);if(!e||!n){return Tr.call(this,t,r)}else{var i=function(e){var n=arguments.length;var i=t.lastIndex;t.lastIndex=0;var a=t.exec(e)||[];t.lastIndex=i;K(a,arguments[n-2],arguments[n-1]);return r.apply(this,a)};return Tr.call(this,t,i)}}}var Dr=f.substr;var Sr="".substr&&"0b".substr(-1)!=="b";$(f,{substr:function substr(t,r){var e=t;if(t<0){e=w(this.length+t,0)}return Dr.call(this,e,r)}},Sr);var xr="	\n\x0B\f\r \xa0\u1680\u180e\u2000\u2001\u2002\u2003"+"\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028"+"\u2029\ufeff";var Or="\u200b";var jr="["+xr+"]";var Er=new RegExp("^"+jr+jr+"*");var Ir=new RegExp(jr+jr+"*$");var Mr=f.trim&&(xr.trim()||!Or.trim());$(f,{trim:function trim(){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}return o(this).replace(Er,"").replace(Ir,"")}},Mr);var Ur=d.bind(String.prototype.trim);var Fr=f.lastIndexOf&&"abc\u3042\u3044".lastIndexOf("\u3042\u3044",2)!==-1;$(f,{lastIndexOf:function lastIndexOf(t){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}var r=o(this);var e=o(t);var n=arguments.length>1?u(arguments[1]):NaN;var i=Y(n)?Infinity:Z.ToInteger(n);var a=b(w(i,0),r.length);var f=e.length;var l=a+f;while(l>0){l=w(0,l-f);var s=q(L(r,l,a+f),e);if(s!==-1){return l+s}}return-1}},Fr);var Nr=f.lastIndexOf;$(f,{lastIndexOf:function lastIndexOf(t){return Nr.apply(this,arguments)}},f.lastIndexOf.length!==1);if(parseInt(xr+"08")!==8||parseInt(xr+"0x16")!==22){parseInt=function(t){var r=/^[\-+]?0[xX]/;return function parseInt(e,n){var i=Ur(String(e));var a=u(n)||(r.test(i)?16:10);return t(i,a)}}(parseInt)}if(1/parseFloat("-0")!==-Infinity){parseFloat=function(t){return function parseFloat(r){var e=Ur(String(r));var n=t(e);return n===0&&L(e,0,1)==="-"?-0:n}}(parseFloat)}if(String(new RangeError("test"))!=="RangeError: test"){var Cr=function toString(){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}var t=this.name;if(typeof t==="undefined"){t="Error"}else if(typeof t!=="string"){t=o(t)}var r=this.message;if(typeof r==="undefined"){r=""}else if(typeof r!=="string"){r=o(r)}if(!t){return r}if(!r){return t}return t+": "+r};Error.prototype.toString=Cr}if(P){var kr=function(t,r){if(Q(t,r)){var e=Object.getOwnPropertyDescriptor(t,r);if(e.configurable){e.enumerable=false;Object.defineProperty(t,r,e)}}};kr(Error.prototype,"message");if(Error.prototype.message!==""){Error.prototype.message=""}kr(Error.prototype,"name")}if(String(/a/gim)!=="/a/gim"){var Ar=function toString(){var t="/"+this.source+"/";if(this.global){t+="g"}if(this.ignoreCase){t+="i"}if(this.multiline){t+="m"}return t};RegExp.prototype.toString=Ar}});
//# sourceMappingURL=es5-shim.map
/*!
  * https://github.com/paulmillr/es6-shim
  * @license es6-shim Copyright 2013-2016 by Paul Miller (http://paulmillr.com)
  *   and contributors,  MIT License
  * es6-shim: v0.35.3
  * see https://github.com/paulmillr/es6-shim/blob/0.35.1/LICENSE
  * Details and documentation:
  * https://github.com/paulmillr/es6-shim/
  */
(function(e,t){if(typeof define==="function"&&define.amd){define(t)}else if(typeof exports==="object"){module.exports=t()}else{e.returnExports=t()}})(this,function(){"use strict";var e=Function.call.bind(Function.apply);var t=Function.call.bind(Function.call);var r=Array.isArray;var n=Object.keys;var o=function notThunker(t){return function notThunk(){return!e(t,this,arguments)}};var i=function(e){try{e();return false}catch(e){return true}};var a=function valueOrFalseIfThrows(e){try{return e()}catch(e){return false}};var u=o(i);var f=function(){return!i(function(){Object.defineProperty({},"x",{get:function(){}})})};var s=!!Object.defineProperty&&f();var c=function foo(){}.name==="foo";var l=Function.call.bind(Array.prototype.forEach);var p=Function.call.bind(Array.prototype.reduce);var v=Function.call.bind(Array.prototype.filter);var y=Function.call.bind(Array.prototype.some);var h=function(e,t,r,n){if(!n&&t in e){return}if(s){Object.defineProperty(e,t,{configurable:true,enumerable:false,writable:true,value:r})}else{e[t]=r}};var b=function(e,t,r){l(n(t),function(n){var o=t[n];h(e,n,o,!!r)})};var g=Function.call.bind(Object.prototype.toString);var d=typeof/abc/==="function"?function IsCallableSlow(e){return typeof e==="function"&&g(e)==="[object Function]"}:function IsCallableFast(e){return typeof e==="function"};var m={getter:function(e,t,r){if(!s){throw new TypeError("getters require true ES5 support")}Object.defineProperty(e,t,{configurable:true,enumerable:false,get:r})},proxy:function(e,t,r){if(!s){throw new TypeError("getters require true ES5 support")}var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,{configurable:n.configurable,enumerable:n.enumerable,get:function getKey(){return e[t]},set:function setKey(r){e[t]=r}})},redefine:function(e,t,r){if(s){var n=Object.getOwnPropertyDescriptor(e,t);n.value=r;Object.defineProperty(e,t,n)}else{e[t]=r}},defineByDescriptor:function(e,t,r){if(s){Object.defineProperty(e,t,r)}else if("value"in r){e[t]=r.value}},preserveToString:function(e,t){if(t&&d(t.toString)){h(e,"toString",t.toString.bind(t),true)}}};var O=Object.create||function(e,t){var r=function Prototype(){};r.prototype=e;var o=new r;if(typeof t!=="undefined"){n(t).forEach(function(e){m.defineByDescriptor(o,e,t[e])})}return o};var w=function(e,t){if(!Object.setPrototypeOf){return false}return a(function(){var r=function Subclass(t){var r=new e(t);Object.setPrototypeOf(r,Subclass.prototype);return r};Object.setPrototypeOf(r,e);r.prototype=O(e.prototype,{constructor:{value:r}});return t(r)})};var j=function(){if(typeof self!=="undefined"){return self}if(typeof window!=="undefined"){return window}if(typeof global!=="undefined"){return global}throw new Error("unable to locate global object")};var S=j();var T=S.isFinite;var I=Function.call.bind(String.prototype.indexOf);var E=Function.apply.bind(Array.prototype.indexOf);var P=Function.call.bind(Array.prototype.concat);var C=Function.call.bind(String.prototype.slice);var M=Function.call.bind(Array.prototype.push);var x=Function.apply.bind(Array.prototype.push);var N=Function.call.bind(Array.prototype.shift);var A=Math.max;var R=Math.min;var _=Math.floor;var k=Math.abs;var F=Math.exp;var L=Math.log;var D=Math.sqrt;var z=Function.call.bind(Object.prototype.hasOwnProperty);var q;var W=function(){};var G=S.Map;var H=G&&G.prototype["delete"];var V=G&&G.prototype.get;var B=G&&G.prototype.has;var U=G&&G.prototype.set;var $=S.Symbol||{};var J=$.species||"@@species";var X=Number.isNaN||function isNaN(e){return e!==e};var K=Number.isFinite||function isFinite(e){return typeof e==="number"&&T(e)};var Z=d(Math.sign)?Math.sign:function sign(e){var t=Number(e);if(t===0){return t}if(X(t)){return t}return t<0?-1:1};var Y=function isArguments(e){return g(e)==="[object Arguments]"};var Q=function isArguments(e){return e!==null&&typeof e==="object"&&typeof e.length==="number"&&e.length>=0&&g(e)!=="[object Array]"&&g(e.callee)==="[object Function]"};var ee=Y(arguments)?Y:Q;var te={primitive:function(e){return e===null||typeof e!=="function"&&typeof e!=="object"},string:function(e){return g(e)==="[object String]"},regex:function(e){return g(e)==="[object RegExp]"},symbol:function(e){return typeof S.Symbol==="function"&&typeof e==="symbol"}};var re=function overrideNative(e,t,r){var n=e[t];h(e,t,r,true);m.preserveToString(e[t],n)};var ne=typeof $==="function"&&typeof $["for"]==="function"&&te.symbol($());var oe=te.symbol($.iterator)?$.iterator:"_es6-shim iterator_";if(S.Set&&typeof(new S.Set)["@@iterator"]==="function"){oe="@@iterator"}if(!S.Reflect){h(S,"Reflect",{},true)}var ie=S.Reflect;var ae=String;var ue=typeof document==="undefined"||!document?null:document.all;var fe=ue==null?function isNullOrUndefined(e){return e==null}:function isNullOrUndefinedAndNotDocumentAll(e){return e==null&&e!==ue};var se={Call:function Call(t,r){var n=arguments.length>2?arguments[2]:[];if(!se.IsCallable(t)){throw new TypeError(t+" is not a function")}return e(t,r,n)},RequireObjectCoercible:function(e,t){if(fe(e)){throw new TypeError(t||"Cannot call method on "+e)}return e},TypeIsObject:function(e){if(e===void 0||e===null||e===true||e===false){return false}return typeof e==="function"||typeof e==="object"||e===ue},ToObject:function(e,t){return Object(se.RequireObjectCoercible(e,t))},IsCallable:d,IsConstructor:function(e){return se.IsCallable(e)},ToInt32:function(e){return se.ToNumber(e)>>0},ToUint32:function(e){return se.ToNumber(e)>>>0},ToNumber:function(e){if(g(e)==="[object Symbol]"){throw new TypeError("Cannot convert a Symbol value to a number")}return+e},ToInteger:function(e){var t=se.ToNumber(e);if(X(t)){return 0}if(t===0||!K(t)){return t}return(t>0?1:-1)*_(k(t))},ToLength:function(e){var t=se.ToInteger(e);if(t<=0){return 0}if(t>Number.MAX_SAFE_INTEGER){return Number.MAX_SAFE_INTEGER}return t},SameValue:function(e,t){if(e===t){if(e===0){return 1/e===1/t}return true}return X(e)&&X(t)},SameValueZero:function(e,t){return e===t||X(e)&&X(t)},IsIterable:function(e){return se.TypeIsObject(e)&&(typeof e[oe]!=="undefined"||ee(e))},GetIterator:function(e){if(ee(e)){return new q(e,"value")}var t=se.GetMethod(e,oe);if(!se.IsCallable(t)){throw new TypeError("value is not an iterable")}var r=se.Call(t,e);if(!se.TypeIsObject(r)){throw new TypeError("bad iterator")}return r},GetMethod:function(e,t){var r=se.ToObject(e)[t];if(fe(r)){return void 0}if(!se.IsCallable(r)){throw new TypeError("Method not callable: "+t)}return r},IteratorComplete:function(e){return!!e.done},IteratorClose:function(e,t){var r=se.GetMethod(e,"return");if(r===void 0){return}var n,o;try{n=se.Call(r,e)}catch(e){o=e}if(t){return}if(o){throw o}if(!se.TypeIsObject(n)){throw new TypeError("Iterator's return method returned a non-object.")}},IteratorNext:function(e){var t=arguments.length>1?e.next(arguments[1]):e.next();if(!se.TypeIsObject(t)){throw new TypeError("bad iterator")}return t},IteratorStep:function(e){var t=se.IteratorNext(e);var r=se.IteratorComplete(t);return r?false:t},Construct:function(e,t,r,n){var o=typeof r==="undefined"?e:r;if(!n&&ie.construct){return ie.construct(e,t,o)}var i=o.prototype;if(!se.TypeIsObject(i)){i=Object.prototype}var a=O(i);var u=se.Call(e,a,t);return se.TypeIsObject(u)?u:a},SpeciesConstructor:function(e,t){var r=e.constructor;if(r===void 0){return t}if(!se.TypeIsObject(r)){throw new TypeError("Bad constructor")}var n=r[J];if(fe(n)){return t}if(!se.IsConstructor(n)){throw new TypeError("Bad @@species")}return n},CreateHTML:function(e,t,r,n){var o=se.ToString(e);var i="<"+t;if(r!==""){var a=se.ToString(n);var u=a.replace(/"/g,"&quot;");i+=" "+r+'="'+u+'"'}var f=i+">";var s=f+o;return s+"</"+t+">"},IsRegExp:function IsRegExp(e){if(!se.TypeIsObject(e)){return false}var t=e[$.match];if(typeof t!=="undefined"){return!!t}return te.regex(e)},ToString:function ToString(e){return ae(e)}};if(s&&ne){var ce=function defineWellKnownSymbol(e){if(te.symbol($[e])){return $[e]}var t=$["for"]("Symbol."+e);Object.defineProperty($,e,{configurable:false,enumerable:false,writable:false,value:t});return t};if(!te.symbol($.search)){var le=ce("search");var pe=String.prototype.search;h(RegExp.prototype,le,function search(e){return se.Call(pe,e,[this])});var ve=function search(e){var t=se.RequireObjectCoercible(this);if(!fe(e)){var r=se.GetMethod(e,le);if(typeof r!=="undefined"){return se.Call(r,e,[t])}}return se.Call(pe,t,[se.ToString(e)])};re(String.prototype,"search",ve)}if(!te.symbol($.replace)){var ye=ce("replace");var he=String.prototype.replace;h(RegExp.prototype,ye,function replace(e,t){return se.Call(he,e,[this,t])});var be=function replace(e,t){var r=se.RequireObjectCoercible(this);if(!fe(e)){var n=se.GetMethod(e,ye);if(typeof n!=="undefined"){return se.Call(n,e,[r,t])}}return se.Call(he,r,[se.ToString(e),t])};re(String.prototype,"replace",be)}if(!te.symbol($.split)){var ge=ce("split");var de=String.prototype.split;h(RegExp.prototype,ge,function split(e,t){return se.Call(de,e,[this,t])});var me=function split(e,t){var r=se.RequireObjectCoercible(this);if(!fe(e)){var n=se.GetMethod(e,ge);if(typeof n!=="undefined"){return se.Call(n,e,[r,t])}}return se.Call(de,r,[se.ToString(e),t])};re(String.prototype,"split",me)}var Oe=te.symbol($.match);var we=Oe&&function(){var e={};e[$.match]=function(){return 42};return"a".match(e)!==42}();if(!Oe||we){var je=ce("match");var Se=String.prototype.match;h(RegExp.prototype,je,function match(e){return se.Call(Se,e,[this])});var Te=function match(e){var t=se.RequireObjectCoercible(this);if(!fe(e)){var r=se.GetMethod(e,je);if(typeof r!=="undefined"){return se.Call(r,e,[t])}}return se.Call(Se,t,[se.ToString(e)])};re(String.prototype,"match",Te)}}var Ie=function wrapConstructor(e,t,r){m.preserveToString(t,e);if(Object.setPrototypeOf){Object.setPrototypeOf(e,t)}if(s){l(Object.getOwnPropertyNames(e),function(n){if(n in W||r[n]){return}m.proxy(e,n,t)})}else{l(Object.keys(e),function(n){if(n in W||r[n]){return}t[n]=e[n]})}t.prototype=e.prototype;m.redefine(e.prototype,"constructor",t)};var Ee=function(){return this};var Pe=function(e){if(s&&!z(e,J)){m.getter(e,J,Ee)}};var Ce=function(e,t){var r=t||function iterator(){return this};h(e,oe,r);if(!e[oe]&&te.symbol(oe)){e[oe]=r}};var Me=function createDataProperty(e,t,r){if(s){Object.defineProperty(e,t,{configurable:true,enumerable:true,writable:true,value:r})}else{e[t]=r}};var xe=function createDataPropertyOrThrow(e,t,r){Me(e,t,r);if(!se.SameValue(e[t],r)){throw new TypeError("property is nonconfigurable")}};var Ne=function(e,t,r,n){if(!se.TypeIsObject(e)){throw new TypeError("Constructor requires `new`: "+t.name)}var o=t.prototype;if(!se.TypeIsObject(o)){o=r}var i=O(o);for(var a in n){if(z(n,a)){var u=n[a];h(i,a,u,true)}}return i};if(String.fromCodePoint&&String.fromCodePoint.length!==1){var Ae=String.fromCodePoint;re(String,"fromCodePoint",function fromCodePoint(e){return se.Call(Ae,this,arguments)})}var Re={fromCodePoint:function fromCodePoint(e){var t=[];var r;for(var n=0,o=arguments.length;n<o;n++){r=Number(arguments[n]);if(!se.SameValue(r,se.ToInteger(r))||r<0||r>1114111){throw new RangeError("Invalid code point "+r)}if(r<65536){M(t,String.fromCharCode(r))}else{r-=65536;M(t,String.fromCharCode((r>>10)+55296));M(t,String.fromCharCode(r%1024+56320))}}return t.join("")},raw:function raw(e){var t=se.ToObject(e,"bad callSite");var r=se.ToObject(t.raw,"bad raw value");var n=r.length;var o=se.ToLength(n);if(o<=0){return""}var i=[];var a=0;var u,f,s,c;while(a<o){u=se.ToString(a);s=se.ToString(r[u]);M(i,s);if(a+1>=o){break}f=a+1<arguments.length?arguments[a+1]:"";c=se.ToString(f);M(i,c);a+=1}return i.join("")}};if(String.raw&&String.raw({raw:{0:"x",1:"y",length:2}})!=="xy"){re(String,"raw",Re.raw)}b(String,Re);var _e=function repeat(e,t){if(t<1){return""}if(t%2){return repeat(e,t-1)+e}var r=repeat(e,t/2);return r+r};var ke=Infinity;var Fe={repeat:function repeat(e){var t=se.ToString(se.RequireObjectCoercible(this));var r=se.ToInteger(e);if(r<0||r>=ke){throw new RangeError("repeat count must be less than infinity and not overflow maximum string size")}return _e(t,r)},startsWith:function startsWith(e){var t=se.ToString(se.RequireObjectCoercible(this));if(se.IsRegExp(e)){throw new TypeError('Cannot call method "startsWith" with a regex')}var r=se.ToString(e);var n;if(arguments.length>1){n=arguments[1]}var o=A(se.ToInteger(n),0);return C(t,o,o+r.length)===r},endsWith:function endsWith(e){var t=se.ToString(se.RequireObjectCoercible(this));if(se.IsRegExp(e)){throw new TypeError('Cannot call method "endsWith" with a regex')}var r=se.ToString(e);var n=t.length;var o;if(arguments.length>1){o=arguments[1]}var i=typeof o==="undefined"?n:se.ToInteger(o);var a=R(A(i,0),n);return C(t,a-r.length,a)===r},includes:function includes(e){if(se.IsRegExp(e)){throw new TypeError('"includes" does not accept a RegExp')}var t=se.ToString(e);var r;if(arguments.length>1){r=arguments[1]}return I(this,t,r)!==-1},codePointAt:function codePointAt(e){var t=se.ToString(se.RequireObjectCoercible(this));var r=se.ToInteger(e);var n=t.length;if(r>=0&&r<n){var o=t.charCodeAt(r);var i=r+1===n;if(o<55296||o>56319||i){return o}var a=t.charCodeAt(r+1);if(a<56320||a>57343){return o}return(o-55296)*1024+(a-56320)+65536}}};if(String.prototype.includes&&"a".includes("a",Infinity)!==false){re(String.prototype,"includes",Fe.includes)}if(String.prototype.startsWith&&String.prototype.endsWith){var Le=i(function(){"/a/".startsWith(/a/)});var De=a(function(){return"abc".startsWith("a",Infinity)===false});if(!Le||!De){re(String.prototype,"startsWith",Fe.startsWith);re(String.prototype,"endsWith",Fe.endsWith)}}if(ne){var ze=a(function(){var e=/a/;e[$.match]=false;return"/a/".startsWith(e)});if(!ze){re(String.prototype,"startsWith",Fe.startsWith)}var qe=a(function(){var e=/a/;e[$.match]=false;return"/a/".endsWith(e)});if(!qe){re(String.prototype,"endsWith",Fe.endsWith)}var We=a(function(){var e=/a/;e[$.match]=false;return"/a/".includes(e)});if(!We){re(String.prototype,"includes",Fe.includes)}}b(String.prototype,Fe);var Ge=["\t\n\v\f\r \xa0\u1680\u180e\u2000\u2001\u2002\u2003","\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028","\u2029\ufeff"].join("");var He=new RegExp("(^["+Ge+"]+)|(["+Ge+"]+$)","g");var Ve=function trim(){return se.ToString(se.RequireObjectCoercible(this)).replace(He,"")};var Be=["\x85","\u200b","\ufffe"].join("");var Ue=new RegExp("["+Be+"]","g");var $e=/^[-+]0x[0-9a-f]+$/i;var Je=Be.trim().length!==Be.length;h(String.prototype,"trim",Ve,Je);var Xe=function(e){return{value:e,done:arguments.length===0}};var Ke=function(e){se.RequireObjectCoercible(e);this._s=se.ToString(e);this._i=0};Ke.prototype.next=function(){var e=this._s;var t=this._i;if(typeof e==="undefined"||t>=e.length){this._s=void 0;return Xe()}var r=e.charCodeAt(t);var n,o;if(r<55296||r>56319||t+1===e.length){o=1}else{n=e.charCodeAt(t+1);o=n<56320||n>57343?1:2}this._i=t+o;return Xe(e.substr(t,o))};Ce(Ke.prototype);Ce(String.prototype,function(){return new Ke(this)});var Ze={from:function from(e){var r=this;var n;if(arguments.length>1){n=arguments[1]}var o,i;if(typeof n==="undefined"){o=false}else{if(!se.IsCallable(n)){throw new TypeError("Array.from: when provided, the second argument must be a function")}if(arguments.length>2){i=arguments[2]}o=true}var a=typeof(ee(e)||se.GetMethod(e,oe))!=="undefined";var u,f,s;if(a){f=se.IsConstructor(r)?Object(new r):[];var c=se.GetIterator(e);var l,p;s=0;while(true){l=se.IteratorStep(c);if(l===false){break}p=l.value;try{if(o){p=typeof i==="undefined"?n(p,s):t(n,i,p,s)}f[s]=p}catch(e){se.IteratorClose(c,true);throw e}s+=1}u=s}else{var v=se.ToObject(e);u=se.ToLength(v.length);f=se.IsConstructor(r)?Object(new r(u)):new Array(u);var y;for(s=0;s<u;++s){y=v[s];if(o){y=typeof i==="undefined"?n(y,s):t(n,i,y,s)}xe(f,s,y)}}f.length=u;return f},of:function of(){var e=arguments.length;var t=this;var n=r(t)||!se.IsCallable(t)?new Array(e):se.Construct(t,[e]);for(var o=0;o<e;++o){xe(n,o,arguments[o])}n.length=e;return n}};b(Array,Ze);Pe(Array);q=function(e,t){this.i=0;this.array=e;this.kind=t};b(q.prototype,{next:function(){var e=this.i;var t=this.array;if(!(this instanceof q)){throw new TypeError("Not an ArrayIterator")}if(typeof t!=="undefined"){var r=se.ToLength(t.length);for(;e<r;e++){var n=this.kind;var o;if(n==="key"){o=e}else if(n==="value"){o=t[e]}else if(n==="entry"){o=[e,t[e]]}this.i=e+1;return Xe(o)}}this.array=void 0;return Xe()}});Ce(q.prototype);var Ye=Array.of===Ze.of||function(){var e=function Foo(e){this.length=e};e.prototype=[];var t=Array.of.apply(e,[1,2]);return t instanceof e&&t.length===2}();if(!Ye){re(Array,"of",Ze.of)}var Qe={copyWithin:function copyWithin(e,t){var r=se.ToObject(this);var n=se.ToLength(r.length);var o=se.ToInteger(e);var i=se.ToInteger(t);var a=o<0?A(n+o,0):R(o,n);var u=i<0?A(n+i,0):R(i,n);var f;if(arguments.length>2){f=arguments[2]}var s=typeof f==="undefined"?n:se.ToInteger(f);var c=s<0?A(n+s,0):R(s,n);var l=R(c-u,n-a);var p=1;if(u<a&&a<u+l){p=-1;u+=l-1;a+=l-1}while(l>0){if(u in r){r[a]=r[u]}else{delete r[a]}u+=p;a+=p;l-=1}return r},fill:function fill(e){var t;if(arguments.length>1){t=arguments[1]}var r;if(arguments.length>2){r=arguments[2]}var n=se.ToObject(this);var o=se.ToLength(n.length);t=se.ToInteger(typeof t==="undefined"?0:t);r=se.ToInteger(typeof r==="undefined"?o:r);var i=t<0?A(o+t,0):R(t,o);var a=r<0?o+r:r;for(var u=i;u<o&&u<a;++u){n[u]=e}return n},find:function find(e){var r=se.ToObject(this);var n=se.ToLength(r.length);if(!se.IsCallable(e)){throw new TypeError("Array#find: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var i=0,a;i<n;i++){a=r[i];if(o){if(t(e,o,a,i,r)){return a}}else if(e(a,i,r)){return a}}},findIndex:function findIndex(e){var r=se.ToObject(this);var n=se.ToLength(r.length);if(!se.IsCallable(e)){throw new TypeError("Array#findIndex: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var i=0;i<n;i++){if(o){if(t(e,o,r[i],i,r)){return i}}else if(e(r[i],i,r)){return i}}return-1},keys:function keys(){return new q(this,"key")},values:function values(){return new q(this,"value")},entries:function entries(){return new q(this,"entry")}};if(Array.prototype.keys&&!se.IsCallable([1].keys().next)){delete Array.prototype.keys}if(Array.prototype.entries&&!se.IsCallable([1].entries().next)){delete Array.prototype.entries}if(Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[oe]){b(Array.prototype,{values:Array.prototype[oe]});if(te.symbol($.unscopables)){Array.prototype[$.unscopables].values=true}}if(c&&Array.prototype.values&&Array.prototype.values.name!=="values"){var et=Array.prototype.values;re(Array.prototype,"values",function values(){return se.Call(et,this,arguments)});h(Array.prototype,oe,Array.prototype.values,true)}b(Array.prototype,Qe);if(1/[true].indexOf(true,-0)<0){h(Array.prototype,"indexOf",function indexOf(e){var t=E(this,arguments);if(t===0&&1/t<0){return 0}return t},true)}Ce(Array.prototype,function(){return this.values()});if(Object.getPrototypeOf){Ce(Object.getPrototypeOf([].values()))}var tt=function(){return a(function(){return Array.from({length:-1}).length===0})}();var rt=function(){var e=Array.from([0].entries());return e.length===1&&r(e[0])&&e[0][0]===0&&e[0][1]===0}();if(!tt||!rt){re(Array,"from",Ze.from)}var nt=function(){return a(function(){return Array.from([0],void 0)})}();if(!nt){var ot=Array.from;re(Array,"from",function from(e){if(arguments.length>1&&typeof arguments[1]!=="undefined"){return se.Call(ot,this,arguments)}else{return t(ot,this,e)}})}var it=-(Math.pow(2,32)-1);var at=function(e,r){var n={length:it};n[r?(n.length>>>0)-1:0]=true;return a(function(){t(e,n,function(){throw new RangeError("should not reach here")},[]);return true})};if(!at(Array.prototype.forEach)){var ut=Array.prototype.forEach;re(Array.prototype,"forEach",function forEach(e){return se.Call(ut,this.length>=0?this:[],arguments)},true)}if(!at(Array.prototype.map)){var ft=Array.prototype.map;re(Array.prototype,"map",function map(e){return se.Call(ft,this.length>=0?this:[],arguments)},true)}if(!at(Array.prototype.filter)){var st=Array.prototype.filter;re(Array.prototype,"filter",function filter(e){return se.Call(st,this.length>=0?this:[],arguments)},true)}if(!at(Array.prototype.some)){var ct=Array.prototype.some;re(Array.prototype,"some",function some(e){return se.Call(ct,this.length>=0?this:[],arguments)},true)}if(!at(Array.prototype.every)){var lt=Array.prototype.every;re(Array.prototype,"every",function every(e){return se.Call(lt,this.length>=0?this:[],arguments)},true)}if(!at(Array.prototype.reduce)){var pt=Array.prototype.reduce;re(Array.prototype,"reduce",function reduce(e){return se.Call(pt,this.length>=0?this:[],arguments)},true)}if(!at(Array.prototype.reduceRight,true)){var vt=Array.prototype.reduceRight;re(Array.prototype,"reduceRight",function reduceRight(e){return se.Call(vt,this.length>=0?this:[],arguments)},true)}var yt=Number("0o10")!==8;var ht=Number("0b10")!==2;var bt=y(Be,function(e){return Number(e+0+e)===0});if(yt||ht||bt){var gt=Number;var dt=/^0b[01]+$/i;var mt=/^0o[0-7]+$/i;var Ot=dt.test.bind(dt);var wt=mt.test.bind(mt);var jt=function(e){var t;if(typeof e.valueOf==="function"){t=e.valueOf();if(te.primitive(t)){return t}}if(typeof e.toString==="function"){t=e.toString();if(te.primitive(t)){return t}}throw new TypeError("No default value")};var St=Ue.test.bind(Ue);var Tt=$e.test.bind($e);var It=function(){var e=function Number(t){var r;if(arguments.length>0){r=te.primitive(t)?t:jt(t,"number")}else{r=0}if(typeof r==="string"){r=se.Call(Ve,r);if(Ot(r)){r=parseInt(C(r,2),2)}else if(wt(r)){r=parseInt(C(r,2),8)}else if(St(r)||Tt(r)){r=NaN}}var n=this;var o=a(function(){gt.prototype.valueOf.call(n);return true});if(n instanceof e&&!o){return new gt(r)}return gt(r)};return e}();Ie(gt,It,{});b(It,{NaN:gt.NaN,MAX_VALUE:gt.MAX_VALUE,MIN_VALUE:gt.MIN_VALUE,NEGATIVE_INFINITY:gt.NEGATIVE_INFINITY,POSITIVE_INFINITY:gt.POSITIVE_INFINITY});Number=It;m.redefine(S,"Number",It)}var Et=Math.pow(2,53)-1;b(Number,{MAX_SAFE_INTEGER:Et,MIN_SAFE_INTEGER:-Et,EPSILON:2.220446049250313e-16,parseInt:S.parseInt,parseFloat:S.parseFloat,isFinite:K,isInteger:function isInteger(e){return K(e)&&se.ToInteger(e)===e},isSafeInteger:function isSafeInteger(e){return Number.isInteger(e)&&k(e)<=Number.MAX_SAFE_INTEGER},isNaN:X});h(Number,"parseInt",S.parseInt,Number.parseInt!==S.parseInt);if([,1].find(function(){return true})===1){re(Array.prototype,"find",Qe.find)}if([,1].findIndex(function(){return true})!==0){re(Array.prototype,"findIndex",Qe.findIndex)}var Pt=Function.bind.call(Function.bind,Object.prototype.propertyIsEnumerable);var Ct=function ensureEnumerable(e,t){if(s&&Pt(e,t)){Object.defineProperty(e,t,{enumerable:false})}};var Mt=function sliceArgs(){var e=Number(this);var t=arguments.length;var r=t-e;var n=new Array(r<0?0:r);for(var o=e;o<t;++o){n[o-e]=arguments[o]}return n};var xt=function assignTo(e){return function assignToSource(t,r){t[r]=e[r];return t}};var Nt=function(e,t){var r=n(Object(t));var o;if(se.IsCallable(Object.getOwnPropertySymbols)){o=v(Object.getOwnPropertySymbols(Object(t)),Pt(t))}return p(P(r,o||[]),xt(t),e)};var At={assign:function(e,t){var r=se.ToObject(e,"Cannot convert undefined or null to object");return p(se.Call(Mt,1,arguments),Nt,r)},is:function is(e,t){return se.SameValue(e,t)}};var Rt=Object.assign&&Object.preventExtensions&&function(){var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch(t){return e[1]==="y"}}();if(Rt){re(Object,"assign",At.assign)}b(Object,At);if(s){var _t={setPrototypeOf:function(e,r){var n;var o=function(e,t){if(!se.TypeIsObject(e)){throw new TypeError("cannot set prototype on a non-object")}if(!(t===null||se.TypeIsObject(t))){throw new TypeError("can only set prototype to an object or null"+t)}};var i=function(e,r){o(e,r);t(n,e,r);return e};try{n=e.getOwnPropertyDescriptor(e.prototype,r).set;t(n,{},null)}catch(t){if(e.prototype!=={}[r]){return}n=function(e){this[r]=e};i.polyfill=i(i({},null),e.prototype)instanceof e}return i}(Object,"__proto__")};b(Object,_t)}if(Object.setPrototypeOf&&Object.getPrototypeOf&&Object.getPrototypeOf(Object.setPrototypeOf({},null))!==null&&Object.getPrototypeOf(Object.create(null))===null){(function(){var e=Object.create(null);var t=Object.getPrototypeOf;var r=Object.setPrototypeOf;Object.getPrototypeOf=function(r){var n=t(r);return n===e?null:n};Object.setPrototypeOf=function(t,n){var o=n===null?e:n;return r(t,o)};Object.setPrototypeOf.polyfill=false})()}var kt=!i(function(){Object.keys("foo")});if(!kt){var Ft=Object.keys;re(Object,"keys",function keys(e){return Ft(se.ToObject(e))});n=Object.keys}var Lt=i(function(){Object.keys(/a/g)});if(Lt){var Dt=Object.keys;re(Object,"keys",function keys(e){if(te.regex(e)){var t=[];for(var r in e){if(z(e,r)){M(t,r)}}return t}return Dt(e)});n=Object.keys}if(Object.getOwnPropertyNames){var zt=!i(function(){Object.getOwnPropertyNames("foo")});if(!zt){var qt=typeof window==="object"?Object.getOwnPropertyNames(window):[];var Wt=Object.getOwnPropertyNames;re(Object,"getOwnPropertyNames",function getOwnPropertyNames(e){var t=se.ToObject(e);if(g(t)==="[object Window]"){try{return Wt(t)}catch(e){return P([],qt)}}return Wt(t)})}}if(Object.getOwnPropertyDescriptor){var Gt=!i(function(){Object.getOwnPropertyDescriptor("foo","bar")});if(!Gt){var Ht=Object.getOwnPropertyDescriptor;re(Object,"getOwnPropertyDescriptor",function getOwnPropertyDescriptor(e,t){return Ht(se.ToObject(e),t)})}}if(Object.seal){var Vt=!i(function(){Object.seal("foo")});if(!Vt){var Bt=Object.seal;re(Object,"seal",function seal(e){if(!se.TypeIsObject(e)){return e}return Bt(e)})}}if(Object.isSealed){var Ut=!i(function(){Object.isSealed("foo")});if(!Ut){var $t=Object.isSealed;re(Object,"isSealed",function isSealed(e){if(!se.TypeIsObject(e)){return true}return $t(e)})}}if(Object.freeze){var Jt=!i(function(){Object.freeze("foo")});if(!Jt){var Xt=Object.freeze;re(Object,"freeze",function freeze(e){if(!se.TypeIsObject(e)){return e}return Xt(e)})}}if(Object.isFrozen){var Kt=!i(function(){Object.isFrozen("foo")});if(!Kt){var Zt=Object.isFrozen;re(Object,"isFrozen",function isFrozen(e){if(!se.TypeIsObject(e)){return true}return Zt(e)})}}if(Object.preventExtensions){var Yt=!i(function(){Object.preventExtensions("foo")});if(!Yt){var Qt=Object.preventExtensions;re(Object,"preventExtensions",function preventExtensions(e){if(!se.TypeIsObject(e)){return e}return Qt(e)})}}if(Object.isExtensible){var er=!i(function(){Object.isExtensible("foo")});if(!er){var tr=Object.isExtensible;re(Object,"isExtensible",function isExtensible(e){if(!se.TypeIsObject(e)){return false}return tr(e)})}}if(Object.getPrototypeOf){var rr=!i(function(){Object.getPrototypeOf("foo")});if(!rr){var nr=Object.getPrototypeOf;re(Object,"getPrototypeOf",function getPrototypeOf(e){return nr(se.ToObject(e))})}}var or=s&&function(){var e=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags");return e&&se.IsCallable(e.get)}();if(s&&!or){var ir=function flags(){if(!se.TypeIsObject(this)){throw new TypeError("Method called on incompatible type: must be an object.")}var e="";if(this.global){e+="g"}if(this.ignoreCase){e+="i"}if(this.multiline){e+="m"}if(this.unicode){e+="u"}if(this.sticky){e+="y"}return e};m.getter(RegExp.prototype,"flags",ir)}var ar=s&&a(function(){return String(new RegExp(/a/g,"i"))==="/a/i"});var ur=ne&&s&&function(){var e=/./;e[$.match]=false;return RegExp(e)===e}();var fr=a(function(){return RegExp.prototype.toString.call({source:"abc"})==="/abc/"});var sr=fr&&a(function(){return RegExp.prototype.toString.call({source:"a",flags:"b"})==="/a/b"});if(!fr||!sr){var cr=RegExp.prototype.toString;h(RegExp.prototype,"toString",function toString(){var e=se.RequireObjectCoercible(this);if(te.regex(e)){return t(cr,e)}var r=ae(e.source);var n=ae(e.flags);return"/"+r+"/"+n},true);m.preserveToString(RegExp.prototype.toString,cr)}if(s&&(!ar||ur)){var lr=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags").get;var pr=Object.getOwnPropertyDescriptor(RegExp.prototype,"source")||{};var vr=function(){return this.source};var yr=se.IsCallable(pr.get)?pr.get:vr;var hr=RegExp;var br=function(){return function RegExp(e,t){var r=se.IsRegExp(e);var n=this instanceof RegExp;if(!n&&r&&typeof t==="undefined"&&e.constructor===RegExp){return e}var o=e;var i=t;if(te.regex(e)){o=se.Call(yr,e);i=typeof t==="undefined"?se.Call(lr,e):t;return new RegExp(o,i)}else if(r){o=e.source;i=typeof t==="undefined"?e.flags:t}return new hr(e,t)}}();Ie(hr,br,{$input:true});RegExp=br;m.redefine(S,"RegExp",br)}if(s){var gr={input:"$_",lastMatch:"$&",lastParen:"$+",leftContext:"$`",rightContext:"$'"};l(n(gr),function(e){if(e in RegExp&&!(gr[e]in RegExp)){m.getter(RegExp,gr[e],function get(){return RegExp[e]})}})}Pe(RegExp);var dr=1/Number.EPSILON;var mr=function roundTiesToEven(e){return e+dr-dr};var Or=Math.pow(2,-23);var wr=Math.pow(2,127)*(2-Or);var jr=Math.pow(2,-126);var Sr=Math.E;var Tr=Math.LOG2E;var Ir=Math.LOG10E;var Er=Number.prototype.clz;delete Number.prototype.clz;var Pr={acosh:function acosh(e){var t=Number(e);if(X(t)||e<1){return NaN}if(t===1){return 0}if(t===Infinity){return t}return L(t/Sr+D(t+1)*D(t-1)/Sr)+1},asinh:function asinh(e){var t=Number(e);if(t===0||!T(t)){return t}return t<0?-asinh(-t):L(t+D(t*t+1))},atanh:function atanh(e){var t=Number(e);if(X(t)||t<-1||t>1){return NaN}if(t===-1){return-Infinity}if(t===1){return Infinity}if(t===0){return t}return.5*L((1+t)/(1-t))},cbrt:function cbrt(e){var t=Number(e);if(t===0){return t}var r=t<0;var n;if(r){t=-t}if(t===Infinity){n=Infinity}else{n=F(L(t)/3);n=(t/(n*n)+2*n)/3}return r?-n:n},clz32:function clz32(e){var t=Number(e);var r=se.ToUint32(t);if(r===0){return 32}return Er?se.Call(Er,r):31-_(L(r+.5)*Tr)},cosh:function cosh(e){var t=Number(e);if(t===0){return 1}if(X(t)){return NaN}if(!T(t)){return Infinity}if(t<0){t=-t}if(t>21){return F(t)/2}return(F(t)+F(-t))/2},expm1:function expm1(e){var t=Number(e);if(t===-Infinity){return-1}if(!T(t)||t===0){return t}if(k(t)>.5){return F(t)-1}var r=t;var n=0;var o=1;while(n+r!==n){n+=r;o+=1;r*=t/o}return n},hypot:function hypot(e,t){var r=0;var n=0;for(var o=0;o<arguments.length;++o){var i=k(Number(arguments[o]));if(n<i){r*=n/i*(n/i);r+=1;n=i}else{r+=i>0?i/n*(i/n):i}}return n===Infinity?Infinity:n*D(r)},log2:function log2(e){return L(e)*Tr},log10:function log10(e){return L(e)*Ir},log1p:function log1p(e){var t=Number(e);if(t<-1||X(t)){return NaN}if(t===0||t===Infinity){return t}if(t===-1){return-Infinity}return 1+t-1===0?t:t*(L(1+t)/(1+t-1))},sign:Z,sinh:function sinh(e){var t=Number(e);if(!T(t)||t===0){return t}if(k(t)<1){return(Math.expm1(t)-Math.expm1(-t))/2}return(F(t-1)-F(-t-1))*Sr/2},tanh:function tanh(e){var t=Number(e);if(X(t)||t===0){return t}if(t>=20){return 1}if(t<=-20){return-1}return(Math.expm1(t)-Math.expm1(-t))/(F(t)+F(-t))},trunc:function trunc(e){var t=Number(e);return t<0?-_(-t):_(t)},imul:function imul(e,t){var r=se.ToUint32(e);var n=se.ToUint32(t);var o=r>>>16&65535;var i=r&65535;var a=n>>>16&65535;var u=n&65535;return i*u+(o*u+i*a<<16>>>0)|0},fround:function fround(e){var t=Number(e);if(t===0||t===Infinity||t===-Infinity||X(t)){return t}var r=Z(t);var n=k(t);if(n<jr){return r*mr(n/jr/Or)*jr*Or}var o=(1+Or/Number.EPSILON)*n;var i=o-(o-n);if(i>wr||X(i)){return r*Infinity}return r*i}};b(Math,Pr);h(Math,"log1p",Pr.log1p,Math.log1p(-1e-17)!==-1e-17);h(Math,"asinh",Pr.asinh,Math.asinh(-1e7)!==-Math.asinh(1e7));h(Math,"tanh",Pr.tanh,Math.tanh(-2e-17)!==-2e-17);h(Math,"acosh",Pr.acosh,Math.acosh(Number.MAX_VALUE)===Infinity);h(Math,"cbrt",Pr.cbrt,Math.abs(1-Math.cbrt(1e-300)/1e-100)/Number.EPSILON>8);h(Math,"sinh",Pr.sinh,Math.sinh(-2e-17)!==-2e-17);var Cr=Math.expm1(10);h(Math,"expm1",Pr.expm1,Cr>22025.465794806718||Cr<22025.465794806718);var Mr=Math.round;var xr=Math.round(.5-Number.EPSILON/4)===0&&Math.round(-.5+Number.EPSILON/3.99)===1;var Nr=dr+1;var Ar=2*dr-1;var Rr=[Nr,Ar].every(function(e){return Math.round(e)===e});h(Math,"round",function round(e){var t=_(e);var r=t===-1?-0:t+1;
return e-t<.5?t:r},!xr||!Rr);m.preserveToString(Math.round,Mr);var _r=Math.imul;if(Math.imul(4294967295,5)!==-5){Math.imul=Pr.imul;m.preserveToString(Math.imul,_r)}if(Math.imul.length!==2){re(Math,"imul",function imul(e,t){return se.Call(_r,Math,arguments)})}var kr=function(){var e=S.setTimeout;if(typeof e!=="function"&&typeof e!=="object"){return}se.IsPromise=function(e){if(!se.TypeIsObject(e)){return false}if(typeof e._promise==="undefined"){return false}return true};var r=function(e){if(!se.IsConstructor(e)){throw new TypeError("Bad promise constructor")}var t=this;var r=function(e,r){if(t.resolve!==void 0||t.reject!==void 0){throw new TypeError("Bad Promise implementation!")}t.resolve=e;t.reject=r};t.resolve=void 0;t.reject=void 0;t.promise=new e(r);if(!(se.IsCallable(t.resolve)&&se.IsCallable(t.reject))){throw new TypeError("Bad promise constructor")}};var n;if(typeof window!=="undefined"&&se.IsCallable(window.postMessage)){n=function(){var e=[];var t="zero-timeout-message";var r=function(r){M(e,r);window.postMessage(t,"*")};var n=function(r){if(r.source===window&&r.data===t){r.stopPropagation();if(e.length===0){return}var n=N(e);n()}};window.addEventListener("message",n,true);return r}}var o=function(){var e=S.Promise;var t=e&&e.resolve&&e.resolve();return t&&function(e){return t.then(e)}};var i=se.IsCallable(S.setImmediate)?S.setImmediate:typeof process==="object"&&process.nextTick?process.nextTick:o()||(se.IsCallable(n)?n():function(t){e(t,0)});var a=function(e){return e};var u=function(e){throw e};var f=0;var s=1;var c=2;var l=0;var p=1;var v=2;var y={};var h=function(e,t,r){i(function(){g(e,t,r)})};var g=function(e,t,r){var n,o;if(t===y){return e(r)}try{n=e(r);o=t.resolve}catch(e){n=e;o=t.reject}o(n)};var d=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.fulfillReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+l],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=s;r.reactionLength=0};var m=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.rejectReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+p],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=c;r.reactionLength=0};var O=function(e){var t=false;var r=function(r){var n;if(t){return}t=true;if(r===e){return m(e,new TypeError("Self resolution"))}if(!se.TypeIsObject(r)){return d(e,r)}try{n=r.then}catch(t){return m(e,t)}if(!se.IsCallable(n)){return d(e,r)}i(function(){j(e,r,n)})};var n=function(r){if(t){return}t=true;return m(e,r)};return{resolve:r,reject:n}};var w=function(e,r,n,o){if(e===I){t(e,r,n,o,y)}else{t(e,r,n,o)}};var j=function(e,t,r){var n=O(e);var o=n.resolve;var i=n.reject;try{w(r,t,o,i)}catch(e){i(e)}};var T,I;var E=function(){var e=function Promise(t){if(!(this instanceof e)){throw new TypeError('Constructor Promise requires "new"')}if(this&&this._promise){throw new TypeError("Bad construction")}if(!se.IsCallable(t)){throw new TypeError("not a valid resolver")}var r=Ne(this,e,T,{_promise:{result:void 0,state:f,reactionLength:0,fulfillReactionHandler0:void 0,rejectReactionHandler0:void 0,reactionCapability0:void 0}});var n=O(r);var o=n.reject;try{t(n.resolve,o)}catch(e){o(e)}return r};return e}();T=E.prototype;var P=function(e,t,r,n){var o=false;return function(i){if(o){return}o=true;t[e]=i;if(--n.count===0){var a=r.resolve;a(t)}}};var C=function(e,t,r){var n=e.iterator;var o=[];var i={count:1};var a,u;var f=0;while(true){try{a=se.IteratorStep(n);if(a===false){e.done=true;break}u=a.value}catch(t){e.done=true;throw t}o[f]=void 0;var s=t.resolve(u);var c=P(f,o,r,i);i.count+=1;w(s.then,s,c,r.reject);f+=1}if(--i.count===0){var l=r.resolve;l(o)}return r.promise};var x=function(e,t,r){var n=e.iterator;var o,i,a;while(true){try{o=se.IteratorStep(n);if(o===false){e.done=true;break}i=o.value}catch(t){e.done=true;throw t}a=t.resolve(i);w(a.then,a,r.resolve,r.reject)}return r.promise};b(E,{all:function all(e){var t=this;if(!se.TypeIsObject(t)){throw new TypeError("Promise is not object")}var n=new r(t);var o,i;try{o=se.GetIterator(e);i={iterator:o,done:false};return C(i,t,n)}catch(e){var a=e;if(i&&!i.done){try{se.IteratorClose(o,true)}catch(e){a=e}}var u=n.reject;u(a);return n.promise}},race:function race(e){var t=this;if(!se.TypeIsObject(t)){throw new TypeError("Promise is not object")}var n=new r(t);var o,i;try{o=se.GetIterator(e);i={iterator:o,done:false};return x(i,t,n)}catch(e){var a=e;if(i&&!i.done){try{se.IteratorClose(o,true)}catch(e){a=e}}var u=n.reject;u(a);return n.promise}},reject:function reject(e){var t=this;if(!se.TypeIsObject(t)){throw new TypeError("Bad promise constructor")}var n=new r(t);var o=n.reject;o(e);return n.promise},resolve:function resolve(e){var t=this;if(!se.TypeIsObject(t)){throw new TypeError("Bad promise constructor")}if(se.IsPromise(e)){var n=e.constructor;if(n===t){return e}}var o=new r(t);var i=o.resolve;i(e);return o.promise}});b(T,{catch:function(e){return this.then(null,e)},then:function then(e,t){var n=this;if(!se.IsPromise(n)){throw new TypeError("not a promise")}var o=se.SpeciesConstructor(n,E);var i;var b=arguments.length>2&&arguments[2]===y;if(b&&o===E){i=y}else{i=new r(o)}var g=se.IsCallable(e)?e:a;var d=se.IsCallable(t)?t:u;var m=n._promise;var O;if(m.state===f){if(m.reactionLength===0){m.fulfillReactionHandler0=g;m.rejectReactionHandler0=d;m.reactionCapability0=i}else{var w=3*(m.reactionLength-1);m[w+l]=g;m[w+p]=d;m[w+v]=i}m.reactionLength+=1}else if(m.state===s){O=m.result;h(g,i,O)}else if(m.state===c){O=m.result;h(d,i,O)}else{throw new TypeError("unexpected Promise state")}return i.promise}});y=new r(E);I=T.then;return E}();if(S.Promise){delete S.Promise.accept;delete S.Promise.defer;delete S.Promise.prototype.chain}if(typeof kr==="function"){b(S,{Promise:kr});var Fr=w(S.Promise,function(e){return e.resolve(42).then(function(){})instanceof e});var Lr=!i(function(){S.Promise.reject(42).then(null,5).then(null,W)});var Dr=i(function(){S.Promise.call(3,W)});var zr=function(e){var t=e.resolve(5);t.constructor={};var r=e.resolve(t);try{r.then(null,W).then(null,W)}catch(e){return true}return t===r}(S.Promise);var qr=s&&function(){var e=0;var t=Object.defineProperty({},"then",{get:function(){e+=1}});Promise.resolve(t);return e===1}();var Wr=function BadResolverPromise(e){var t=new Promise(e);e(3,function(){});this.then=t.then;this.constructor=BadResolverPromise};Wr.prototype=Promise.prototype;Wr.all=Promise.all;var Gr=a(function(){return!!Wr.all([1,2])});if(!Fr||!Lr||!Dr||zr||!qr||Gr){Promise=kr;re(S,"Promise",kr)}if(Promise.all.length!==1){var Hr=Promise.all;re(Promise,"all",function all(e){return se.Call(Hr,this,arguments)})}if(Promise.race.length!==1){var Vr=Promise.race;re(Promise,"race",function race(e){return se.Call(Vr,this,arguments)})}if(Promise.resolve.length!==1){var Br=Promise.resolve;re(Promise,"resolve",function resolve(e){return se.Call(Br,this,arguments)})}if(Promise.reject.length!==1){var Ur=Promise.reject;re(Promise,"reject",function reject(e){return se.Call(Ur,this,arguments)})}Ct(Promise,"all");Ct(Promise,"race");Ct(Promise,"resolve");Ct(Promise,"reject");Pe(Promise)}var $r=function(e){var t=n(p(e,function(e,t){e[t]=true;return e},{}));return e.join(":")===t.join(":")};var Jr=$r(["z","a","bb"]);var Xr=$r(["z",1,"a","3",2]);if(s){var Kr=function fastkey(e,t){if(!t&&!Jr){return null}if(fe(e)){return"^"+se.ToString(e)}else if(typeof e==="string"){return"$"+e}else if(typeof e==="number"){if(!Xr){return"n"+e}return e}else if(typeof e==="boolean"){return"b"+e}return null};var Zr=function emptyObject(){return Object.create?Object.create(null):{}};var Yr=function addIterableToMap(e,n,o){if(r(o)||te.string(o)){l(o,function(e){if(!se.TypeIsObject(e)){throw new TypeError("Iterator value "+e+" is not an entry object")}n.set(e[0],e[1])})}else if(o instanceof e){t(e.prototype.forEach,o,function(e,t){n.set(t,e)})}else{var i,a;if(!fe(o)){a=n.set;if(!se.IsCallable(a)){throw new TypeError("bad map")}i=se.GetIterator(o)}if(typeof i!=="undefined"){while(true){var u=se.IteratorStep(i);if(u===false){break}var f=u.value;try{if(!se.TypeIsObject(f)){throw new TypeError("Iterator value "+f+" is not an entry object")}t(a,n,f[0],f[1])}catch(e){se.IteratorClose(i,true);throw e}}}}};var Qr=function addIterableToSet(e,n,o){if(r(o)||te.string(o)){l(o,function(e){n.add(e)})}else if(o instanceof e){t(e.prototype.forEach,o,function(e){n.add(e)})}else{var i,a;if(!fe(o)){a=n.add;if(!se.IsCallable(a)){throw new TypeError("bad set")}i=se.GetIterator(o)}if(typeof i!=="undefined"){while(true){var u=se.IteratorStep(i);if(u===false){break}var f=u.value;try{t(a,n,f)}catch(e){se.IteratorClose(i,true);throw e}}}}};var en={Map:function(){var e={};var r=function MapEntry(e,t){this.key=e;this.value=t;this.next=null;this.prev=null};r.prototype.isRemoved=function isRemoved(){return this.key===e};var n=function isMap(e){return!!e._es6map};var o=function requireMapSlot(e,t){if(!se.TypeIsObject(e)||!n(e)){throw new TypeError("Method Map.prototype."+t+" called on incompatible receiver "+se.ToString(e))}};var i=function MapIterator(e,t){o(e,"[[MapIterator]]");this.head=e._head;this.i=this.head;this.kind=t};i.prototype={next:function next(){var e=this.i;var t=this.kind;var r=this.head;if(typeof this.i==="undefined"){return Xe()}while(e.isRemoved()&&e!==r){e=e.prev}var n;while(e.next!==r){e=e.next;if(!e.isRemoved()){if(t==="key"){n=e.key}else if(t==="value"){n=e.value}else{n=[e.key,e.value]}this.i=e;return Xe(n)}}this.i=void 0;return Xe()}};Ce(i.prototype);var a;var u=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}if(this&&this._es6map){throw new TypeError("Bad construction")}var e=Ne(this,Map,a,{_es6map:true,_head:null,_map:G?new G:null,_size:0,_storage:Zr()});var t=new r(null,null);t.next=t.prev=t;e._head=t;if(arguments.length>0){Yr(Map,e,arguments[0])}return e};a=u.prototype;m.getter(a,"size",function(){if(typeof this._size==="undefined"){throw new TypeError("size method called on incompatible Map")}return this._size});b(a,{get:function get(e){o(this,"get");var t;var r=Kr(e,true);if(r!==null){t=this._storage[r];if(t){return t.value}else{return}}if(this._map){t=V.call(this._map,e);if(t){return t.value}else{return}}var n=this._head;var i=n;while((i=i.next)!==n){if(se.SameValueZero(i.key,e)){return i.value}}},has:function has(e){o(this,"has");var t=Kr(e,true);if(t!==null){return typeof this._storage[t]!=="undefined"}if(this._map){return B.call(this._map,e)}var r=this._head;var n=r;while((n=n.next)!==r){if(se.SameValueZero(n.key,e)){return true}}return false},set:function set(e,t){o(this,"set");var n=this._head;var i=n;var a;var u=Kr(e,true);if(u!==null){if(typeof this._storage[u]!=="undefined"){this._storage[u].value=t;return this}else{a=this._storage[u]=new r(e,t);i=n.prev}}else if(this._map){if(B.call(this._map,e)){V.call(this._map,e).value=t}else{a=new r(e,t);U.call(this._map,e,a);i=n.prev}}while((i=i.next)!==n){if(se.SameValueZero(i.key,e)){i.value=t;return this}}a=a||new r(e,t);if(se.SameValue(-0,e)){a.key=+0}a.next=this._head;a.prev=this._head.prev;a.prev.next=a;a.next.prev=a;this._size+=1;return this},delete:function(t){o(this,"delete");var r=this._head;var n=r;var i=Kr(t,true);if(i!==null){if(typeof this._storage[i]==="undefined"){return false}n=this._storage[i].prev;delete this._storage[i]}else if(this._map){if(!B.call(this._map,t)){return false}n=V.call(this._map,t).prev;H.call(this._map,t)}while((n=n.next)!==r){if(se.SameValueZero(n.key,t)){n.key=e;n.value=e;n.prev.next=n.next;n.next.prev=n.prev;this._size-=1;return true}}return false},clear:function clear(){o(this,"clear");this._map=G?new G:null;this._size=0;this._storage=Zr();var t=this._head;var r=t;var n=r.next;while((r=n)!==t){r.key=e;r.value=e;n=r.next;r.next=r.prev=t}t.next=t.prev=t},keys:function keys(){o(this,"keys");return new i(this,"key")},values:function values(){o(this,"values");return new i(this,"value")},entries:function entries(){o(this,"entries");return new i(this,"key+value")},forEach:function forEach(e){o(this,"forEach");var r=arguments.length>1?arguments[1]:null;var n=this.entries();for(var i=n.next();!i.done;i=n.next()){if(r){t(e,r,i.value[1],i.value[0],this)}else{e(i.value[1],i.value[0],this)}}}});Ce(a,a.entries);return u}(),Set:function(){var e=function isSet(e){return e._es6set&&typeof e._storage!=="undefined"};var r=function requireSetSlot(t,r){if(!se.TypeIsObject(t)||!e(t)){throw new TypeError("Set.prototype."+r+" called on incompatible receiver "+se.ToString(t))}};var o;var i=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires "new"')}if(this&&this._es6set){throw new TypeError("Bad construction")}var e=Ne(this,Set,o,{_es6set:true,"[[SetData]]":null,_storage:Zr()});if(!e._es6set){throw new TypeError("bad set")}if(arguments.length>0){Qr(Set,e,arguments[0])}return e};o=i.prototype;var a=function(e){var t=e;if(t==="^null"){return null}else if(t==="^undefined"){return void 0}else{var r=t.charAt(0);if(r==="$"){return C(t,1)}else if(r==="n"){return+C(t,1)}else if(r==="b"){return t==="btrue"}}return+t};var u=function ensureMap(e){if(!e["[[SetData]]"]){var t=new en.Map;e["[[SetData]]"]=t;l(n(e._storage),function(e){var r=a(e);t.set(r,r)});e["[[SetData]]"]=t}e._storage=null};m.getter(i.prototype,"size",function(){r(this,"size");if(this._storage){return n(this._storage).length}u(this);return this["[[SetData]]"].size});b(i.prototype,{has:function has(e){r(this,"has");var t;if(this._storage&&(t=Kr(e))!==null){return!!this._storage[t]}u(this);return this["[[SetData]]"].has(e)},add:function add(e){r(this,"add");var t;if(this._storage&&(t=Kr(e))!==null){this._storage[t]=true;return this}u(this);this["[[SetData]]"].set(e,e);return this},delete:function(e){r(this,"delete");var t;if(this._storage&&(t=Kr(e))!==null){var n=z(this._storage,t);return delete this._storage[t]&&n}u(this);return this["[[SetData]]"]["delete"](e)},clear:function clear(){r(this,"clear");if(this._storage){this._storage=Zr()}if(this["[[SetData]]"]){this["[[SetData]]"].clear()}},values:function values(){r(this,"values");u(this);return this["[[SetData]]"].values()},entries:function entries(){r(this,"entries");u(this);return this["[[SetData]]"].entries()},forEach:function forEach(e){r(this,"forEach");var n=arguments.length>1?arguments[1]:null;var o=this;u(o);this["[[SetData]]"].forEach(function(r,i){if(n){t(e,n,i,i,o)}else{e(i,i,o)}})}});h(i.prototype,"keys",i.prototype.values,true);Ce(i.prototype,i.prototype.values);return i}()};if(S.Map||S.Set){var tn=a(function(){return new Map([[1,2]]).get(1)===2});if(!tn){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}var e=new G;if(arguments.length>0){Yr(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,S.Map.prototype);return e};S.Map.prototype=O(G.prototype);h(S.Map.prototype,"constructor",S.Map,true);m.preserveToString(S.Map,G)}var rn=new Map;var nn=function(){var e=new Map([[1,0],[2,0],[3,0],[4,0]]);e.set(-0,e);return e.get(0)===e&&e.get(-0)===e&&e.has(0)&&e.has(-0)}();var on=rn.set(1,2)===rn;if(!nn||!on){re(Map.prototype,"set",function set(e,r){t(U,this,e===0?0:e,r);return this})}if(!nn){b(Map.prototype,{get:function get(e){return t(V,this,e===0?0:e)},has:function has(e){return t(B,this,e===0?0:e)}},true);m.preserveToString(Map.prototype.get,V);m.preserveToString(Map.prototype.has,B)}var an=new Set;var un=function(e){e["delete"](0);e.add(-0);return!e.has(0)}(an);var fn=an.add(1)===an;if(!un||!fn){var sn=Set.prototype.add;Set.prototype.add=function add(e){t(sn,this,e===0?0:e);return this};m.preserveToString(Set.prototype.add,sn)}if(!un){var cn=Set.prototype.has;Set.prototype.has=function has(e){return t(cn,this,e===0?0:e)};m.preserveToString(Set.prototype.has,cn);var ln=Set.prototype["delete"];Set.prototype["delete"]=function SetDelete(e){return t(ln,this,e===0?0:e)};m.preserveToString(Set.prototype["delete"],ln)}var pn=w(S.Map,function(e){var t=new e([]);t.set(42,42);return t instanceof e});var vn=Object.setPrototypeOf&&!pn;var yn=function(){try{return!(S.Map()instanceof S.Map)}catch(e){return e instanceof TypeError}}();if(S.Map.length!==0||vn||!yn){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}var e=new G;if(arguments.length>0){Yr(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Map.prototype);return e};S.Map.prototype=G.prototype;h(S.Map.prototype,"constructor",S.Map,true);m.preserveToString(S.Map,G)}var hn=w(S.Set,function(e){var t=new e([]);t.add(42,42);return t instanceof e});var bn=Object.setPrototypeOf&&!hn;var gn=function(){try{return!(S.Set()instanceof S.Set)}catch(e){return e instanceof TypeError}}();if(S.Set.length!==0||bn||!gn){var dn=S.Set;S.Set=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires "new"')}var e=new dn;if(arguments.length>0){Qr(Set,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Set.prototype);return e};S.Set.prototype=dn.prototype;h(S.Set.prototype,"constructor",S.Set,true);m.preserveToString(S.Set,dn)}var mn=new S.Map;var On=!a(function(){return mn.keys().next().done});if(typeof S.Map.prototype.clear!=="function"||(new S.Set).size!==0||mn.size!==0||typeof S.Map.prototype.keys!=="function"||typeof S.Set.prototype.keys!=="function"||typeof S.Map.prototype.forEach!=="function"||typeof S.Set.prototype.forEach!=="function"||u(S.Map)||u(S.Set)||typeof mn.keys().next!=="function"||On||!pn){b(S,{Map:en.Map,Set:en.Set},true)}if(S.Set.prototype.keys!==S.Set.prototype.values){h(S.Set.prototype,"keys",S.Set.prototype.values,true)}Ce(Object.getPrototypeOf((new S.Map).keys()));Ce(Object.getPrototypeOf((new S.Set).keys()));if(c&&S.Set.prototype.has.name!=="has"){var wn=S.Set.prototype.has;re(S.Set.prototype,"has",function has(e){return t(wn,this,e)})}}b(S,en);Pe(S.Map);Pe(S.Set)}var jn=function throwUnlessTargetIsObject(e){if(!se.TypeIsObject(e)){throw new TypeError("target must be an object")}};var Sn={apply:function apply(){return se.Call(se.Call,null,arguments)},construct:function construct(e,t){if(!se.IsConstructor(e)){throw new TypeError("First argument must be a constructor.")}var r=arguments.length>2?arguments[2]:e;if(!se.IsConstructor(r)){throw new TypeError("new.target must be a constructor.")}return se.Construct(e,t,r,"internal")},deleteProperty:function deleteProperty(e,t){jn(e);if(s){var r=Object.getOwnPropertyDescriptor(e,t);if(r&&!r.configurable){return false}}return delete e[t]},has:function has(e,t){jn(e);return t in e}};if(Object.getOwnPropertyNames){Object.assign(Sn,{ownKeys:function ownKeys(e){jn(e);var t=Object.getOwnPropertyNames(e);if(se.IsCallable(Object.getOwnPropertySymbols)){x(t,Object.getOwnPropertySymbols(e))}return t}})}var Tn=function ConvertExceptionToBoolean(e){return!i(e)};if(Object.preventExtensions){Object.assign(Sn,{isExtensible:function isExtensible(e){jn(e);return Object.isExtensible(e)},preventExtensions:function preventExtensions(e){jn(e);return Tn(function(){Object.preventExtensions(e)})}})}if(s){var In=function get(e,t,r){var n=Object.getOwnPropertyDescriptor(e,t);if(!n){var o=Object.getPrototypeOf(e);if(o===null){return void 0}return In(o,t,r)}if("value"in n){return n.value}if(n.get){return se.Call(n.get,r)}return void 0};var En=function set(e,r,n,o){var i=Object.getOwnPropertyDescriptor(e,r);if(!i){var a=Object.getPrototypeOf(e);if(a!==null){return En(a,r,n,o)}i={value:void 0,writable:true,enumerable:true,configurable:true}}if("value"in i){if(!i.writable){return false}if(!se.TypeIsObject(o)){return false}var u=Object.getOwnPropertyDescriptor(o,r);if(u){return ie.defineProperty(o,r,{value:n})}else{return ie.defineProperty(o,r,{value:n,writable:true,enumerable:true,configurable:true})}}if(i.set){t(i.set,o,n);return true}return false};Object.assign(Sn,{defineProperty:function defineProperty(e,t,r){jn(e);return Tn(function(){Object.defineProperty(e,t,r)})},getOwnPropertyDescriptor:function getOwnPropertyDescriptor(e,t){jn(e);return Object.getOwnPropertyDescriptor(e,t)},get:function get(e,t){jn(e);var r=arguments.length>2?arguments[2]:e;return In(e,t,r)},set:function set(e,t,r){jn(e);var n=arguments.length>3?arguments[3]:e;return En(e,t,r,n)}})}if(Object.getPrototypeOf){var Pn=Object.getPrototypeOf;Sn.getPrototypeOf=function getPrototypeOf(e){jn(e);return Pn(e)}}if(Object.setPrototypeOf&&Sn.getPrototypeOf){var Cn=function(e,t){var r=t;while(r){if(e===r){return true}r=Sn.getPrototypeOf(r)}return false};Object.assign(Sn,{setPrototypeOf:function setPrototypeOf(e,t){jn(e);if(t!==null&&!se.TypeIsObject(t)){throw new TypeError("proto must be an object or null")}if(t===ie.getPrototypeOf(e)){return true}if(ie.isExtensible&&!ie.isExtensible(e)){return false}if(Cn(e,t)){return false}Object.setPrototypeOf(e,t);return true}})}var Mn=function(e,t){if(!se.IsCallable(S.Reflect[e])){h(S.Reflect,e,t)}else{var r=a(function(){S.Reflect[e](1);S.Reflect[e](NaN);S.Reflect[e](true);return true});if(r){re(S.Reflect,e,t)}}};Object.keys(Sn).forEach(function(e){Mn(e,Sn[e])});var xn=S.Reflect.getPrototypeOf;if(c&&xn&&xn.name!=="getPrototypeOf"){re(S.Reflect,"getPrototypeOf",function getPrototypeOf(e){return t(xn,S.Reflect,e)})}if(S.Reflect.setPrototypeOf){if(a(function(){S.Reflect.setPrototypeOf(1,{});return true})){re(S.Reflect,"setPrototypeOf",Sn.setPrototypeOf)}}if(S.Reflect.defineProperty){if(!a(function(){var e=!S.Reflect.defineProperty(1,"test",{value:1});var t=typeof Object.preventExtensions!=="function"||!S.Reflect.defineProperty(Object.preventExtensions({}),"test",{});return e&&t})){re(S.Reflect,"defineProperty",Sn.defineProperty)}}if(S.Reflect.construct){if(!a(function(){var e=function F(){};return S.Reflect.construct(function(){},[],e)instanceof e})){re(S.Reflect,"construct",Sn.construct)}}if(String(new Date(NaN))!=="Invalid Date"){var Nn=Date.prototype.toString;var An=function toString(){var e=+this;if(e!==e){return"Invalid Date"}return se.Call(Nn,this)};re(Date.prototype,"toString",An)}var Rn={anchor:function anchor(e){return se.CreateHTML(this,"a","name",e)},big:function big(){return se.CreateHTML(this,"big","","")},blink:function blink(){return se.CreateHTML(this,"blink","","")},bold:function bold(){return se.CreateHTML(this,"b","","")},fixed:function fixed(){return se.CreateHTML(this,"tt","","")},fontcolor:function fontcolor(e){return se.CreateHTML(this,"font","color",e)},fontsize:function fontsize(e){return se.CreateHTML(this,"font","size",e)},italics:function italics(){return se.CreateHTML(this,"i","","")},link:function link(e){return se.CreateHTML(this,"a","href",e)},small:function small(){return se.CreateHTML(this,"small","","")},strike:function strike(){return se.CreateHTML(this,"strike","","")},sub:function sub(){return se.CreateHTML(this,"sub","","")},sup:function sub(){return se.CreateHTML(this,"sup","","")}};l(Object.keys(Rn),function(e){var r=String.prototype[e];var n=false;if(se.IsCallable(r)){var o=t(r,"",' " ');var i=P([],o.match(/"/g)).length;n=o!==o.toLowerCase()||i>2}else{n=true}if(n){re(String.prototype,e,Rn[e])}});var _n=function(){if(!ne){return false}var e=typeof JSON==="object"&&typeof JSON.stringify==="function"?JSON.stringify:null;if(!e){return false}if(typeof e($())!=="undefined"){return true}if(e([$()])!=="[null]"){return true}var t={a:$()};t[$()]=true;if(e(t)!=="{}"){return true}return false}();var kn=a(function(){if(!ne){return true}return JSON.stringify(Object($()))==="{}"&&JSON.stringify([Object($())])==="[{}]"});if(_n||!kn){var Fn=JSON.stringify;re(JSON,"stringify",function stringify(e){if(typeof e==="symbol"){return}var n;if(arguments.length>1){n=arguments[1]}var o=[e];if(!r(n)){var i=se.IsCallable(n)?n:null;var a=function(e,r){var n=i?t(i,this,e,r):r;if(typeof n!=="symbol"){if(te.symbol(n)){return xt({})(n)}else{return n}}};o.push(a)}else{o.push(n)}if(arguments.length>2){o.push(arguments[2])}return Fn.apply(this,o)})}return S});
//# sourceMappingURL=es6-shim.map
/*! jQuery v3.1.1 | (c) jQuery Foundation | jquery.org/license */
!function(a,b){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){"use strict";var c=[],d=a.document,e=Object.getPrototypeOf,f=c.slice,g=c.concat,h=c.push,i=c.indexOf,j={},k=j.toString,l=j.hasOwnProperty,m=l.toString,n=m.call(Object),o={};function p(a,b){b=b||d;var c=b.createElement("script");c.text=a,b.head.appendChild(c).parentNode.removeChild(c)}var q="3.1.1",r=function(a,b){return new r.fn.init(a,b)},s=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,t=/^-ms-/,u=/-([a-z])/g,v=function(a,b){return b.toUpperCase()};r.fn=r.prototype={jquery:q,constructor:r,length:0,toArray:function(){return f.call(this)},get:function(a){return null==a?f.call(this):a<0?this[a+this.length]:this[a]},pushStack:function(a){var b=r.merge(this.constructor(),a);return b.prevObject=this,b},each:function(a){return r.each(this,a)},map:function(a){return this.pushStack(r.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(f.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(a<0?b:0);return this.pushStack(c>=0&&c<b?[this[c]]:[])},end:function(){return this.prevObject||this.constructor()},push:h,sort:c.sort,splice:c.splice},r.extend=r.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||r.isFunction(g)||(g={}),h===i&&(g=this,h--);h<i;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(r.isPlainObject(d)||(e=r.isArray(d)))?(e?(e=!1,f=c&&r.isArray(c)?c:[]):f=c&&r.isPlainObject(c)?c:{},g[b]=r.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},r.extend({expando:"jQuery"+(q+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===r.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){var b=r.type(a);return("number"===b||"string"===b)&&!isNaN(a-parseFloat(a))},isPlainObject:function(a){var b,c;return!(!a||"[object Object]"!==k.call(a))&&(!(b=e(a))||(c=l.call(b,"constructor")&&b.constructor,"function"==typeof c&&m.call(c)===n))},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?j[k.call(a)]||"object":typeof a},globalEval:function(a){p(a)},camelCase:function(a){return a.replace(t,"ms-").replace(u,v)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b){var c,d=0;if(w(a)){for(c=a.length;d<c;d++)if(b.call(a[d],d,a[d])===!1)break}else for(d in a)if(b.call(a[d],d,a[d])===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(s,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(w(Object(a))?r.merge(c,"string"==typeof a?[a]:a):h.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:i.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;d<c;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;f<g;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,e,f=0,h=[];if(w(a))for(d=a.length;f<d;f++)e=b(a[f],f,c),null!=e&&h.push(e);else for(f in a)e=b(a[f],f,c),null!=e&&h.push(e);return g.apply([],h)},guid:1,proxy:function(a,b){var c,d,e;if("string"==typeof b&&(c=a[b],b=a,a=c),r.isFunction(a))return d=f.call(arguments,2),e=function(){return a.apply(b||this,d.concat(f.call(arguments)))},e.guid=a.guid=a.guid||r.guid++,e},now:Date.now,support:o}),"function"==typeof Symbol&&(r.fn[Symbol.iterator]=c[Symbol.iterator]),r.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(a,b){j["[object "+b+"]"]=b.toLowerCase()});function w(a){var b=!!a&&"length"in a&&a.length,c=r.type(a);return"function"!==c&&!r.isWindow(a)&&("array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a)}var x=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+1*new Date,v=a.document,w=0,x=0,y=ha(),z=ha(),A=ha(),B=function(a,b){return a===b&&(l=!0),0},C={}.hasOwnProperty,D=[],E=D.pop,F=D.push,G=D.push,H=D.slice,I=function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},J="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",K="[\\x20\\t\\r\\n\\f]",L="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",M="\\["+K+"*("+L+")(?:"+K+"*([*^$|!~]?=)"+K+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+L+"))|)"+K+"*\\]",N=":("+L+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+M+")*)|.*)\\)|)",O=new RegExp(K+"+","g"),P=new RegExp("^"+K+"+|((?:^|[^\\\\])(?:\\\\.)*)"+K+"+$","g"),Q=new RegExp("^"+K+"*,"+K+"*"),R=new RegExp("^"+K+"*([>+~]|"+K+")"+K+"*"),S=new RegExp("="+K+"*([^\\]'\"]*?)"+K+"*\\]","g"),T=new RegExp(N),U=new RegExp("^"+L+"$"),V={ID:new RegExp("^#("+L+")"),CLASS:new RegExp("^\\.("+L+")"),TAG:new RegExp("^("+L+"|[*])"),ATTR:new RegExp("^"+M),PSEUDO:new RegExp("^"+N),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+K+"*(even|odd|(([+-]|)(\\d*)n|)"+K+"*(?:([+-]|)"+K+"*(\\d+)|))"+K+"*\\)|)","i"),bool:new RegExp("^(?:"+J+")$","i"),needsContext:new RegExp("^"+K+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+K+"*((?:-\\d)?\\d*)"+K+"*\\)|)(?=[^-]|$)","i")},W=/^(?:input|select|textarea|button)$/i,X=/^h\d$/i,Y=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,$=/[+~]/,_=new RegExp("\\\\([\\da-f]{1,6}"+K+"?|("+K+")|.)","ig"),aa=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:d<0?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},ba=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ca=function(a,b){return b?"\0"===a?"\ufffd":a.slice(0,-1)+"\\"+a.charCodeAt(a.length-1).toString(16)+" ":"\\"+a},da=function(){m()},ea=ta(function(a){return a.disabled===!0&&("form"in a||"label"in a)},{dir:"parentNode",next:"legend"});try{G.apply(D=H.call(v.childNodes),v.childNodes),D[v.childNodes.length].nodeType}catch(fa){G={apply:D.length?function(a,b){F.apply(a,H.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function ga(a,b,d,e){var f,h,j,k,l,o,r,s=b&&b.ownerDocument,w=b?b.nodeType:9;if(d=d||[],"string"!=typeof a||!a||1!==w&&9!==w&&11!==w)return d;if(!e&&((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,p)){if(11!==w&&(l=Z.exec(a)))if(f=l[1]){if(9===w){if(!(j=b.getElementById(f)))return d;if(j.id===f)return d.push(j),d}else if(s&&(j=s.getElementById(f))&&t(b,j)&&j.id===f)return d.push(j),d}else{if(l[2])return G.apply(d,b.getElementsByTagName(a)),d;if((f=l[3])&&c.getElementsByClassName&&b.getElementsByClassName)return G.apply(d,b.getElementsByClassName(f)),d}if(c.qsa&&!A[a+" "]&&(!q||!q.test(a))){if(1!==w)s=b,r=a;else if("object"!==b.nodeName.toLowerCase()){(k=b.getAttribute("id"))?k=k.replace(ba,ca):b.setAttribute("id",k=u),o=g(a),h=o.length;while(h--)o[h]="#"+k+" "+sa(o[h]);r=o.join(","),s=$.test(a)&&qa(b.parentNode)||b}if(r)try{return G.apply(d,s.querySelectorAll(r)),d}catch(x){}finally{k===u&&b.removeAttribute("id")}}}return i(a.replace(P,"$1"),b,d,e)}function ha(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function ia(a){return a[u]=!0,a}function ja(a){var b=n.createElement("fieldset");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function ka(a,b){var c=a.split("|"),e=c.length;while(e--)d.attrHandle[c[e]]=b}function la(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&a.sourceIndex-b.sourceIndex;if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function ma(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function na(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function oa(a){return function(b){return"form"in b?b.parentNode&&b.disabled===!1?"label"in b?"label"in b.parentNode?b.parentNode.disabled===a:b.disabled===a:b.isDisabled===a||b.isDisabled!==!a&&ea(b)===a:b.disabled===a:"label"in b&&b.disabled===a}}function pa(a){return ia(function(b){return b=+b,ia(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function qa(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}c=ga.support={},f=ga.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return!!b&&"HTML"!==b.nodeName},m=ga.setDocument=function(a){var b,e,g=a?a.ownerDocument||a:v;return g!==n&&9===g.nodeType&&g.documentElement?(n=g,o=n.documentElement,p=!f(n),v!==n&&(e=n.defaultView)&&e.top!==e&&(e.addEventListener?e.addEventListener("unload",da,!1):e.attachEvent&&e.attachEvent("onunload",da)),c.attributes=ja(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=ja(function(a){return a.appendChild(n.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=Y.test(n.getElementsByClassName),c.getById=ja(function(a){return o.appendChild(a).id=u,!n.getElementsByName||!n.getElementsByName(u).length}),c.getById?(d.filter.ID=function(a){var b=a.replace(_,aa);return function(a){return a.getAttribute("id")===b}},d.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&p){var c=b.getElementById(a);return c?[c]:[]}}):(d.filter.ID=function(a){var b=a.replace(_,aa);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}},d.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&p){var c,d,e,f=b.getElementById(a);if(f){if(c=f.getAttributeNode("id"),c&&c.value===a)return[f];e=b.getElementsByName(a),d=0;while(f=e[d++])if(c=f.getAttributeNode("id"),c&&c.value===a)return[f]}return[]}}),d.find.TAG=c.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):c.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){if("undefined"!=typeof b.getElementsByClassName&&p)return b.getElementsByClassName(a)},r=[],q=[],(c.qsa=Y.test(n.querySelectorAll))&&(ja(function(a){o.appendChild(a).innerHTML="<a id='"+u+"'></a><select id='"+u+"-\r\\' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&q.push("[*^$]="+K+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+K+"*(?:value|"+J+")"),a.querySelectorAll("[id~="+u+"-]").length||q.push("~="),a.querySelectorAll(":checked").length||q.push(":checked"),a.querySelectorAll("a#"+u+"+*").length||q.push(".#.+[+~]")}),ja(function(a){a.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var b=n.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+K+"*[*^$|!~]?="),2!==a.querySelectorAll(":enabled").length&&q.push(":enabled",":disabled"),o.appendChild(a).disabled=!0,2!==a.querySelectorAll(":disabled").length&&q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=Y.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ja(function(a){c.disconnectedMatch=s.call(a,"*"),s.call(a,"[s!='']:x"),r.push("!=",N)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=Y.test(o.compareDocumentPosition),t=b||Y.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===n||a.ownerDocument===v&&t(v,a)?-1:b===n||b.ownerDocument===v&&t(v,b)?1:k?I(k,a)-I(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,g=[a],h=[b];if(!e||!f)return a===n?-1:b===n?1:e?-1:f?1:k?I(k,a)-I(k,b):0;if(e===f)return la(a,b);c=a;while(c=c.parentNode)g.unshift(c);c=b;while(c=c.parentNode)h.unshift(c);while(g[d]===h[d])d++;return d?la(g[d],h[d]):g[d]===v?-1:h[d]===v?1:0},n):n},ga.matches=function(a,b){return ga(a,null,null,b)},ga.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(S,"='$1']"),c.matchesSelector&&p&&!A[b+" "]&&(!r||!r.test(b))&&(!q||!q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return ga(b,n,null,[a]).length>0},ga.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},ga.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&C.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},ga.escape=function(a){return(a+"").replace(ba,ca)},ga.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},ga.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return k=null,a},e=ga.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=ga.selectors={cacheLength:50,createPseudo:ia,match:V,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(_,aa),a[3]=(a[3]||a[4]||a[5]||"").replace(_,aa),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||ga.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&ga.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return V.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&T.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(_,aa).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+K+")"+a+"("+K+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=ga.attr(d,a);return null==e?"!="===b:!b||(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e.replace(O," ")+" ").indexOf(c)>-1:"|="===b&&(e===c||e.slice(0,c.length+1)===c+"-"))}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h,t=!1;if(q){if(f){while(p){m=b;while(m=m[p])if(h?m.nodeName.toLowerCase()===r:1===m.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){m=q,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n&&j[2],m=n&&q.childNodes[n];while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if(1===m.nodeType&&++t&&m===b){k[a]=[w,n,t];break}}else if(s&&(m=b,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n),t===!1)while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if((h?m.nodeName.toLowerCase()===r:1===m.nodeType)&&++t&&(s&&(l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),k[a]=[w,t]),m===b))break;return t-=e,t===d||t%d===0&&t/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||ga.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?ia(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=I(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:ia(function(a){var b=[],c=[],d=h(a.replace(P,"$1"));return d[u]?ia(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),b[0]=null,!c.pop()}}),has:ia(function(a){return function(b){return ga(a,b).length>0}}),contains:ia(function(a){return a=a.replace(_,aa),function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:ia(function(a){return U.test(a||"")||ga.error("unsupported lang: "+a),a=a.replace(_,aa).toLowerCase(),function(b){var c;do if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:oa(!1),disabled:oa(!0),checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return X.test(a.nodeName)},input:function(a){return W.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:pa(function(){return[0]}),last:pa(function(a,b){return[b-1]}),eq:pa(function(a,b,c){return[c<0?c+b:c]}),even:pa(function(a,b){for(var c=0;c<b;c+=2)a.push(c);return a}),odd:pa(function(a,b){for(var c=1;c<b;c+=2)a.push(c);return a}),lt:pa(function(a,b,c){for(var d=c<0?c+b:c;--d>=0;)a.push(d);return a}),gt:pa(function(a,b,c){for(var d=c<0?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=ma(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=na(b);function ra(){}ra.prototype=d.filters=d.pseudos,d.setFilters=new ra,g=ga.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){c&&!(e=Q.exec(h))||(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=R.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(P," ")}),h=h.slice(c.length));for(g in d.filter)!(e=V[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?ga.error(a):z(a,i).slice(0)};function sa(a){for(var b=0,c=a.length,d="";b<c;b++)d+=a[b].value;return d}function ta(a,b,c){var d=b.dir,e=b.next,f=e||d,g=c&&"parentNode"===f,h=x++;return b.first?function(b,c,e){while(b=b[d])if(1===b.nodeType||g)return a(b,c,e);return!1}:function(b,c,i){var j,k,l,m=[w,h];if(i){while(b=b[d])if((1===b.nodeType||g)&&a(b,c,i))return!0}else while(b=b[d])if(1===b.nodeType||g)if(l=b[u]||(b[u]={}),k=l[b.uniqueID]||(l[b.uniqueID]={}),e&&e===b.nodeName.toLowerCase())b=b[d]||b;else{if((j=k[f])&&j[0]===w&&j[1]===h)return m[2]=j[2];if(k[f]=m,m[2]=a(b,c,i))return!0}return!1}}function ua(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function va(a,b,c){for(var d=0,e=b.length;d<e;d++)ga(a,b[d],c);return c}function wa(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;h<i;h++)(f=a[h])&&(c&&!c(f,d,e)||(g.push(f),j&&b.push(h)));return g}function xa(a,b,c,d,e,f){return d&&!d[u]&&(d=xa(d)),e&&!e[u]&&(e=xa(e,f)),ia(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||va(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:wa(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=wa(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?I(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=wa(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):G.apply(g,r)})}function ya(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=ta(function(a){return a===b},h,!0),l=ta(function(a){return I(b,a)>-1},h,!0),m=[function(a,c,d){var e=!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d));return b=null,e}];i<f;i++)if(c=d.relative[a[i].type])m=[ta(ua(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;e<f;e++)if(d.relative[a[e].type])break;return xa(i>1&&ua(m),i>1&&sa(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(P,"$1"),c,i<e&&ya(a.slice(i,e)),e<f&&ya(a=a.slice(e)),e<f&&sa(a))}m.push(c)}return ua(m)}function za(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,o,q,r=0,s="0",t=f&&[],u=[],v=j,x=f||e&&d.find.TAG("*",k),y=w+=null==v?1:Math.random()||.1,z=x.length;for(k&&(j=g===n||g||k);s!==z&&null!=(l=x[s]);s++){if(e&&l){o=0,g||l.ownerDocument===n||(m(l),h=!p);while(q=a[o++])if(q(l,g||n,h)){i.push(l);break}k&&(w=y)}c&&((l=!q&&l)&&r--,f&&t.push(l))}if(r+=s,c&&s!==r){o=0;while(q=b[o++])q(t,u,g,h);if(f){if(r>0)while(s--)t[s]||u[s]||(u[s]=E.call(i));u=wa(u)}G.apply(i,u),k&&!f&&u.length>0&&r+b.length>1&&ga.uniqueSort(i)}return k&&(w=y,j=v),t};return c?ia(f):f}return h=ga.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){b||(b=g(a)),c=b.length;while(c--)f=ya(b[c]),f[u]?d.push(f):e.push(f);f=A(a,za(e,d)),f.selector=a}return f},i=ga.select=function(a,b,c,e){var f,i,j,k,l,m="function"==typeof a&&a,n=!e&&g(a=m.selector||a);if(c=c||[],1===n.length){if(i=n[0]=n[0].slice(0),i.length>2&&"ID"===(j=i[0]).type&&9===b.nodeType&&p&&d.relative[i[1].type]){if(b=(d.find.ID(j.matches[0].replace(_,aa),b)||[])[0],!b)return c;m&&(b=b.parentNode),a=a.slice(i.shift().value.length)}f=V.needsContext.test(a)?0:i.length;while(f--){if(j=i[f],d.relative[k=j.type])break;if((l=d.find[k])&&(e=l(j.matches[0].replace(_,aa),$.test(i[0].type)&&qa(b.parentNode)||b))){if(i.splice(f,1),a=e.length&&sa(i),!a)return G.apply(c,e),c;break}}}return(m||h(a,n))(e,b,!p,c,!b||$.test(a)&&qa(b.parentNode)||b),c},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ja(function(a){return 1&a.compareDocumentPosition(n.createElement("fieldset"))}),ja(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||ka("type|href|height|width",function(a,b,c){if(!c)return a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ja(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||ka("value",function(a,b,c){if(!c&&"input"===a.nodeName.toLowerCase())return a.defaultValue}),ja(function(a){return null==a.getAttribute("disabled")})||ka(J,function(a,b,c){var d;if(!c)return a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),ga}(a);r.find=x,r.expr=x.selectors,r.expr[":"]=r.expr.pseudos,r.uniqueSort=r.unique=x.uniqueSort,r.text=x.getText,r.isXMLDoc=x.isXML,r.contains=x.contains,r.escapeSelector=x.escape;var y=function(a,b,c){var d=[],e=void 0!==c;while((a=a[b])&&9!==a.nodeType)if(1===a.nodeType){if(e&&r(a).is(c))break;d.push(a)}return d},z=function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c},A=r.expr.match.needsContext,B=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,C=/^.[^:#\[\.,]*$/;function D(a,b,c){return r.isFunction(b)?r.grep(a,function(a,d){return!!b.call(a,d,a)!==c}):b.nodeType?r.grep(a,function(a){return a===b!==c}):"string"!=typeof b?r.grep(a,function(a){return i.call(b,a)>-1!==c}):C.test(b)?r.filter(b,a,c):(b=r.filter(b,a),r.grep(a,function(a){return i.call(b,a)>-1!==c&&1===a.nodeType}))}r.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?r.find.matchesSelector(d,a)?[d]:[]:r.find.matches(a,r.grep(b,function(a){return 1===a.nodeType}))},r.fn.extend({find:function(a){var b,c,d=this.length,e=this;if("string"!=typeof a)return this.pushStack(r(a).filter(function(){for(b=0;b<d;b++)if(r.contains(e[b],this))return!0}));for(c=this.pushStack([]),b=0;b<d;b++)r.find(a,e[b],c);return d>1?r.uniqueSort(c):c},filter:function(a){return this.pushStack(D(this,a||[],!1))},not:function(a){return this.pushStack(D(this,a||[],!0))},is:function(a){return!!D(this,"string"==typeof a&&A.test(a)?r(a):a||[],!1).length}});var E,F=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,G=r.fn.init=function(a,b,c){var e,f;if(!a)return this;if(c=c||E,"string"==typeof a){if(e="<"===a[0]&&">"===a[a.length-1]&&a.length>=3?[null,a,null]:F.exec(a),!e||!e[1]&&b)return!b||b.jquery?(b||c).find(a):this.constructor(b).find(a);if(e[1]){if(b=b instanceof r?b[0]:b,r.merge(this,r.parseHTML(e[1],b&&b.nodeType?b.ownerDocument||b:d,!0)),B.test(e[1])&&r.isPlainObject(b))for(e in b)r.isFunction(this[e])?this[e](b[e]):this.attr(e,b[e]);return this}return f=d.getElementById(e[2]),f&&(this[0]=f,this.length=1),this}return a.nodeType?(this[0]=a,this.length=1,this):r.isFunction(a)?void 0!==c.ready?c.ready(a):a(r):r.makeArray(a,this)};G.prototype=r.fn,E=r(d);var H=/^(?:parents|prev(?:Until|All))/,I={children:!0,contents:!0,next:!0,prev:!0};r.fn.extend({has:function(a){var b=r(a,this),c=b.length;return this.filter(function(){for(var a=0;a<c;a++)if(r.contains(this,b[a]))return!0})},closest:function(a,b){var c,d=0,e=this.length,f=[],g="string"!=typeof a&&r(a);if(!A.test(a))for(;d<e;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&r.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?r.uniqueSort(f):f)},index:function(a){return a?"string"==typeof a?i.call(r(a),this[0]):i.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(r.uniqueSort(r.merge(this.get(),r(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function J(a,b){while((a=a[b])&&1!==a.nodeType);return a}r.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return y(a,"parentNode")},parentsUntil:function(a,b,c){return y(a,"parentNode",c)},next:function(a){return J(a,"nextSibling")},prev:function(a){return J(a,"previousSibling")},nextAll:function(a){return y(a,"nextSibling")},prevAll:function(a){return y(a,"previousSibling")},nextUntil:function(a,b,c){return y(a,"nextSibling",c)},prevUntil:function(a,b,c){return y(a,"previousSibling",c)},siblings:function(a){return z((a.parentNode||{}).firstChild,a)},children:function(a){return z(a.firstChild)},contents:function(a){return a.contentDocument||r.merge([],a.childNodes)}},function(a,b){r.fn[a]=function(c,d){var e=r.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=r.filter(d,e)),this.length>1&&(I[a]||r.uniqueSort(e),H.test(a)&&e.reverse()),this.pushStack(e)}});var K=/[^\x20\t\r\n\f]+/g;function L(a){var b={};return r.each(a.match(K)||[],function(a,c){b[c]=!0}),b}r.Callbacks=function(a){a="string"==typeof a?L(a):r.extend({},a);var b,c,d,e,f=[],g=[],h=-1,i=function(){for(e=a.once,d=b=!0;g.length;h=-1){c=g.shift();while(++h<f.length)f[h].apply(c[0],c[1])===!1&&a.stopOnFalse&&(h=f.length,c=!1)}a.memory||(c=!1),b=!1,e&&(f=c?[]:"")},j={add:function(){return f&&(c&&!b&&(h=f.length-1,g.push(c)),function d(b){r.each(b,function(b,c){r.isFunction(c)?a.unique&&j.has(c)||f.push(c):c&&c.length&&"string"!==r.type(c)&&d(c)})}(arguments),c&&!b&&i()),this},remove:function(){return r.each(arguments,function(a,b){var c;while((c=r.inArray(b,f,c))>-1)f.splice(c,1),c<=h&&h--}),this},has:function(a){return a?r.inArray(a,f)>-1:f.length>0},empty:function(){return f&&(f=[]),this},disable:function(){return e=g=[],f=c="",this},disabled:function(){return!f},lock:function(){return e=g=[],c||b||(f=c=""),this},locked:function(){return!!e},fireWith:function(a,c){return e||(c=c||[],c=[a,c.slice?c.slice():c],g.push(c),b||i()),this},fire:function(){return j.fireWith(this,arguments),this},fired:function(){return!!d}};return j};function M(a){return a}function N(a){throw a}function O(a,b,c){var d;try{a&&r.isFunction(d=a.promise)?d.call(a).done(b).fail(c):a&&r.isFunction(d=a.then)?d.call(a,b,c):b.call(void 0,a)}catch(a){c.call(void 0,a)}}r.extend({Deferred:function(b){var c=[["notify","progress",r.Callbacks("memory"),r.Callbacks("memory"),2],["resolve","done",r.Callbacks("once memory"),r.Callbacks("once memory"),0,"resolved"],["reject","fail",r.Callbacks("once memory"),r.Callbacks("once memory"),1,"rejected"]],d="pending",e={state:function(){return d},always:function(){return f.done(arguments).fail(arguments),this},"catch":function(a){return e.then(null,a)},pipe:function(){var a=arguments;return r.Deferred(function(b){r.each(c,function(c,d){var e=r.isFunction(a[d[4]])&&a[d[4]];f[d[1]](function(){var a=e&&e.apply(this,arguments);a&&r.isFunction(a.promise)?a.promise().progress(b.notify).done(b.resolve).fail(b.reject):b[d[0]+"With"](this,e?[a]:arguments)})}),a=null}).promise()},then:function(b,d,e){var f=0;function g(b,c,d,e){return function(){var h=this,i=arguments,j=function(){var a,j;if(!(b<f)){if(a=d.apply(h,i),a===c.promise())throw new TypeError("Thenable self-resolution");j=a&&("object"==typeof a||"function"==typeof a)&&a.then,r.isFunction(j)?e?j.call(a,g(f,c,M,e),g(f,c,N,e)):(f++,j.call(a,g(f,c,M,e),g(f,c,N,e),g(f,c,M,c.notifyWith))):(d!==M&&(h=void 0,i=[a]),(e||c.resolveWith)(h,i))}},k=e?j:function(){try{j()}catch(a){r.Deferred.exceptionHook&&r.Deferred.exceptionHook(a,k.stackTrace),b+1>=f&&(d!==N&&(h=void 0,i=[a]),c.rejectWith(h,i))}};b?k():(r.Deferred.getStackHook&&(k.stackTrace=r.Deferred.getStackHook()),a.setTimeout(k))}}return r.Deferred(function(a){c[0][3].add(g(0,a,r.isFunction(e)?e:M,a.notifyWith)),c[1][3].add(g(0,a,r.isFunction(b)?b:M)),c[2][3].add(g(0,a,r.isFunction(d)?d:N))}).promise()},promise:function(a){return null!=a?r.extend(a,e):e}},f={};return r.each(c,function(a,b){var g=b[2],h=b[5];e[b[1]]=g.add,h&&g.add(function(){d=h},c[3-a][2].disable,c[0][2].lock),g.add(b[3].fire),f[b[0]]=function(){return f[b[0]+"With"](this===f?void 0:this,arguments),this},f[b[0]+"With"]=g.fireWith}),e.promise(f),b&&b.call(f,f),f},when:function(a){var b=arguments.length,c=b,d=Array(c),e=f.call(arguments),g=r.Deferred(),h=function(a){return function(c){d[a]=this,e[a]=arguments.length>1?f.call(arguments):c,--b||g.resolveWith(d,e)}};if(b<=1&&(O(a,g.done(h(c)).resolve,g.reject),"pending"===g.state()||r.isFunction(e[c]&&e[c].then)))return g.then();while(c--)O(e[c],h(c),g.reject);return g.promise()}});var P=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;r.Deferred.exceptionHook=function(b,c){a.console&&a.console.warn&&b&&P.test(b.name)&&a.console.warn("jQuery.Deferred exception: "+b.message,b.stack,c)},r.readyException=function(b){a.setTimeout(function(){throw b})};var Q=r.Deferred();r.fn.ready=function(a){return Q.then(a)["catch"](function(a){r.readyException(a)}),this},r.extend({isReady:!1,readyWait:1,holdReady:function(a){a?r.readyWait++:r.ready(!0)},ready:function(a){(a===!0?--r.readyWait:r.isReady)||(r.isReady=!0,a!==!0&&--r.readyWait>0||Q.resolveWith(d,[r]))}}),r.ready.then=Q.then;function R(){d.removeEventListener("DOMContentLoaded",R),
a.removeEventListener("load",R),r.ready()}"complete"===d.readyState||"loading"!==d.readyState&&!d.documentElement.doScroll?a.setTimeout(r.ready):(d.addEventListener("DOMContentLoaded",R),a.addEventListener("load",R));var S=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===r.type(c)){e=!0;for(h in c)S(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,r.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(r(a),c)})),b))for(;h<i;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},T=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType};function U(){this.expando=r.expando+U.uid++}U.uid=1,U.prototype={cache:function(a){var b=a[this.expando];return b||(b={},T(a)&&(a.nodeType?a[this.expando]=b:Object.defineProperty(a,this.expando,{value:b,configurable:!0}))),b},set:function(a,b,c){var d,e=this.cache(a);if("string"==typeof b)e[r.camelCase(b)]=c;else for(d in b)e[r.camelCase(d)]=b[d];return e},get:function(a,b){return void 0===b?this.cache(a):a[this.expando]&&a[this.expando][r.camelCase(b)]},access:function(a,b,c){return void 0===b||b&&"string"==typeof b&&void 0===c?this.get(a,b):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d=a[this.expando];if(void 0!==d){if(void 0!==b){r.isArray(b)?b=b.map(r.camelCase):(b=r.camelCase(b),b=b in d?[b]:b.match(K)||[]),c=b.length;while(c--)delete d[b[c]]}(void 0===b||r.isEmptyObject(d))&&(a.nodeType?a[this.expando]=void 0:delete a[this.expando])}},hasData:function(a){var b=a[this.expando];return void 0!==b&&!r.isEmptyObject(b)}};var V=new U,W=new U,X=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Y=/[A-Z]/g;function Z(a){return"true"===a||"false"!==a&&("null"===a?null:a===+a+""?+a:X.test(a)?JSON.parse(a):a)}function $(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(Y,"-$&").toLowerCase(),c=a.getAttribute(d),"string"==typeof c){try{c=Z(c)}catch(e){}W.set(a,b,c)}else c=void 0;return c}r.extend({hasData:function(a){return W.hasData(a)||V.hasData(a)},data:function(a,b,c){return W.access(a,b,c)},removeData:function(a,b){W.remove(a,b)},_data:function(a,b,c){return V.access(a,b,c)},_removeData:function(a,b){V.remove(a,b)}}),r.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=W.get(f),1===f.nodeType&&!V.get(f,"hasDataAttrs"))){c=g.length;while(c--)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=r.camelCase(d.slice(5)),$(f,d,e[d])));V.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){W.set(this,a)}):S(this,function(b){var c;if(f&&void 0===b){if(c=W.get(f,a),void 0!==c)return c;if(c=$(f,a),void 0!==c)return c}else this.each(function(){W.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){W.remove(this,a)})}}),r.extend({queue:function(a,b,c){var d;if(a)return b=(b||"fx")+"queue",d=V.get(a,b),c&&(!d||r.isArray(c)?d=V.access(a,b,r.makeArray(c)):d.push(c)),d||[]},dequeue:function(a,b){b=b||"fx";var c=r.queue(a,b),d=c.length,e=c.shift(),f=r._queueHooks(a,b),g=function(){r.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return V.get(a,c)||V.access(a,c,{empty:r.Callbacks("once memory").add(function(){V.remove(a,[b+"queue",c])})})}}),r.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?r.queue(this[0],a):void 0===b?this:this.each(function(){var c=r.queue(this,a,b);r._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&r.dequeue(this,a)})},dequeue:function(a){return this.each(function(){r.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=r.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=V.get(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var _=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,aa=new RegExp("^(?:([+-])=|)("+_+")([a-z%]*)$","i"),ba=["Top","Right","Bottom","Left"],ca=function(a,b){return a=b||a,"none"===a.style.display||""===a.style.display&&r.contains(a.ownerDocument,a)&&"none"===r.css(a,"display")},da=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};function ea(a,b,c,d){var e,f=1,g=20,h=d?function(){return d.cur()}:function(){return r.css(a,b,"")},i=h(),j=c&&c[3]||(r.cssNumber[b]?"":"px"),k=(r.cssNumber[b]||"px"!==j&&+i)&&aa.exec(r.css(a,b));if(k&&k[3]!==j){j=j||k[3],c=c||[],k=+i||1;do f=f||".5",k/=f,r.style(a,b,k+j);while(f!==(f=h()/i)&&1!==f&&--g)}return c&&(k=+k||+i||0,e=c[1]?k+(c[1]+1)*c[2]:+c[2],d&&(d.unit=j,d.start=k,d.end=e)),e}var fa={};function ga(a){var b,c=a.ownerDocument,d=a.nodeName,e=fa[d];return e?e:(b=c.body.appendChild(c.createElement(d)),e=r.css(b,"display"),b.parentNode.removeChild(b),"none"===e&&(e="block"),fa[d]=e,e)}function ha(a,b){for(var c,d,e=[],f=0,g=a.length;f<g;f++)d=a[f],d.style&&(c=d.style.display,b?("none"===c&&(e[f]=V.get(d,"display")||null,e[f]||(d.style.display="")),""===d.style.display&&ca(d)&&(e[f]=ga(d))):"none"!==c&&(e[f]="none",V.set(d,"display",c)));for(f=0;f<g;f++)null!=e[f]&&(a[f].style.display=e[f]);return a}r.fn.extend({show:function(){return ha(this,!0)},hide:function(){return ha(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){ca(this)?r(this).show():r(this).hide()})}});var ia=/^(?:checkbox|radio)$/i,ja=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,ka=/^$|\/(?:java|ecma)script/i,la={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};la.optgroup=la.option,la.tbody=la.tfoot=la.colgroup=la.caption=la.thead,la.th=la.td;function ma(a,b){var c;return c="undefined"!=typeof a.getElementsByTagName?a.getElementsByTagName(b||"*"):"undefined"!=typeof a.querySelectorAll?a.querySelectorAll(b||"*"):[],void 0===b||b&&r.nodeName(a,b)?r.merge([a],c):c}function na(a,b){for(var c=0,d=a.length;c<d;c++)V.set(a[c],"globalEval",!b||V.get(b[c],"globalEval"))}var oa=/<|&#?\w+;/;function pa(a,b,c,d,e){for(var f,g,h,i,j,k,l=b.createDocumentFragment(),m=[],n=0,o=a.length;n<o;n++)if(f=a[n],f||0===f)if("object"===r.type(f))r.merge(m,f.nodeType?[f]:f);else if(oa.test(f)){g=g||l.appendChild(b.createElement("div")),h=(ja.exec(f)||["",""])[1].toLowerCase(),i=la[h]||la._default,g.innerHTML=i[1]+r.htmlPrefilter(f)+i[2],k=i[0];while(k--)g=g.lastChild;r.merge(m,g.childNodes),g=l.firstChild,g.textContent=""}else m.push(b.createTextNode(f));l.textContent="",n=0;while(f=m[n++])if(d&&r.inArray(f,d)>-1)e&&e.push(f);else if(j=r.contains(f.ownerDocument,f),g=ma(l.appendChild(f),"script"),j&&na(g),c){k=0;while(f=g[k++])ka.test(f.type||"")&&c.push(f)}return l}!function(){var a=d.createDocumentFragment(),b=a.appendChild(d.createElement("div")),c=d.createElement("input");c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),b.appendChild(c),o.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",o.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var qa=d.documentElement,ra=/^key/,sa=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,ta=/^([^.]*)(?:\.(.+)|)/;function ua(){return!0}function va(){return!1}function wa(){try{return d.activeElement}catch(a){}}function xa(a,b,c,d,e,f){var g,h;if("object"==typeof b){"string"!=typeof c&&(d=d||c,c=void 0);for(h in b)xa(a,h,c,d,b[h],f);return a}if(null==d&&null==e?(e=c,d=c=void 0):null==e&&("string"==typeof c?(e=d,d=void 0):(e=d,d=c,c=void 0)),e===!1)e=va;else if(!e)return a;return 1===f&&(g=e,e=function(a){return r().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=r.guid++)),a.each(function(){r.event.add(this,b,e,d,c)})}r.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=V.get(a);if(q){c.handler&&(f=c,c=f.handler,e=f.selector),e&&r.find.matchesSelector(qa,e),c.guid||(c.guid=r.guid++),(i=q.events)||(i=q.events={}),(g=q.handle)||(g=q.handle=function(b){return"undefined"!=typeof r&&r.event.triggered!==b.type?r.event.dispatch.apply(a,arguments):void 0}),b=(b||"").match(K)||[""],j=b.length;while(j--)h=ta.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n&&(l=r.event.special[n]||{},n=(e?l.delegateType:l.bindType)||n,l=r.event.special[n]||{},k=r.extend({type:n,origType:p,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&r.expr.match.needsContext.test(e),namespace:o.join(".")},f),(m=i[n])||(m=i[n]=[],m.delegateCount=0,l.setup&&l.setup.call(a,d,o,g)!==!1||a.addEventListener&&a.addEventListener(n,g)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),r.event.global[n]=!0)}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=V.hasData(a)&&V.get(a);if(q&&(i=q.events)){b=(b||"").match(K)||[""],j=b.length;while(j--)if(h=ta.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n){l=r.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=i[n]||[],h=h[2]&&new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;while(f--)k=m[f],!e&&p!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,o,q.handle)!==!1||r.removeEvent(a,n,q.handle),delete i[n])}else for(n in i)r.event.remove(a,n+b[j],c,d,!0);r.isEmptyObject(i)&&V.remove(a,"handle events")}},dispatch:function(a){var b=r.event.fix(a),c,d,e,f,g,h,i=new Array(arguments.length),j=(V.get(this,"events")||{})[b.type]||[],k=r.event.special[b.type]||{};for(i[0]=b,c=1;c<arguments.length;c++)i[c]=arguments[c];if(b.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,b)!==!1){h=r.event.handlers.call(this,b,j),c=0;while((f=h[c++])&&!b.isPropagationStopped()){b.currentTarget=f.elem,d=0;while((g=f.handlers[d++])&&!b.isImmediatePropagationStopped())b.rnamespace&&!b.rnamespace.test(g.namespace)||(b.handleObj=g,b.data=g.data,e=((r.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),void 0!==e&&(b.result=e)===!1&&(b.preventDefault(),b.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,b),b.result}},handlers:function(a,b){var c,d,e,f,g,h=[],i=b.delegateCount,j=a.target;if(i&&j.nodeType&&!("click"===a.type&&a.button>=1))for(;j!==this;j=j.parentNode||this)if(1===j.nodeType&&("click"!==a.type||j.disabled!==!0)){for(f=[],g={},c=0;c<i;c++)d=b[c],e=d.selector+" ",void 0===g[e]&&(g[e]=d.needsContext?r(e,this).index(j)>-1:r.find(e,this,null,[j]).length),g[e]&&f.push(d);f.length&&h.push({elem:j,handlers:f})}return j=this,i<b.length&&h.push({elem:j,handlers:b.slice(i)}),h},addProp:function(a,b){Object.defineProperty(r.Event.prototype,a,{enumerable:!0,configurable:!0,get:r.isFunction(b)?function(){if(this.originalEvent)return b(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[a]},set:function(b){Object.defineProperty(this,a,{enumerable:!0,configurable:!0,writable:!0,value:b})}})},fix:function(a){return a[r.expando]?a:new r.Event(a)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==wa()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===wa()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&r.nodeName(this,"input"))return this.click(),!1},_default:function(a){return r.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}}},r.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c)},r.Event=function(a,b){return this instanceof r.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?ua:va,this.target=a.target&&3===a.target.nodeType?a.target.parentNode:a.target,this.currentTarget=a.currentTarget,this.relatedTarget=a.relatedTarget):this.type=a,b&&r.extend(this,b),this.timeStamp=a&&a.timeStamp||r.now(),void(this[r.expando]=!0)):new r.Event(a,b)},r.Event.prototype={constructor:r.Event,isDefaultPrevented:va,isPropagationStopped:va,isImmediatePropagationStopped:va,isSimulated:!1,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=ua,a&&!this.isSimulated&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=ua,a&&!this.isSimulated&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=ua,a&&!this.isSimulated&&a.stopImmediatePropagation(),this.stopPropagation()}},r.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(a){var b=a.button;return null==a.which&&ra.test(a.type)?null!=a.charCode?a.charCode:a.keyCode:!a.which&&void 0!==b&&sa.test(a.type)?1&b?1:2&b?3:4&b?2:0:a.which}},r.event.addProp),r.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){r.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return e&&(e===d||r.contains(d,e))||(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),r.fn.extend({on:function(a,b,c,d){return xa(this,a,b,c,d)},one:function(a,b,c,d){return xa(this,a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,r(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return b!==!1&&"function"!=typeof b||(c=b,b=void 0),c===!1&&(c=va),this.each(function(){r.event.remove(this,a,c,b)})}});var ya=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,za=/<script|<style|<link/i,Aa=/checked\s*(?:[^=]|=\s*.checked.)/i,Ba=/^true\/(.*)/,Ca=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Da(a,b){return r.nodeName(a,"table")&&r.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a:a}function Ea(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function Fa(a){var b=Ba.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function Ga(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(V.hasData(a)&&(f=V.access(a),g=V.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;c<d;c++)r.event.add(b,e,j[e][c])}W.hasData(a)&&(h=W.access(a),i=r.extend({},h),W.set(b,i))}}function Ha(a,b){var c=b.nodeName.toLowerCase();"input"===c&&ia.test(a.type)?b.checked=a.checked:"input"!==c&&"textarea"!==c||(b.defaultValue=a.defaultValue)}function Ia(a,b,c,d){b=g.apply([],b);var e,f,h,i,j,k,l=0,m=a.length,n=m-1,q=b[0],s=r.isFunction(q);if(s||m>1&&"string"==typeof q&&!o.checkClone&&Aa.test(q))return a.each(function(e){var f=a.eq(e);s&&(b[0]=q.call(this,e,f.html())),Ia(f,b,c,d)});if(m&&(e=pa(b,a[0].ownerDocument,!1,a,d),f=e.firstChild,1===e.childNodes.length&&(e=f),f||d)){for(h=r.map(ma(e,"script"),Ea),i=h.length;l<m;l++)j=e,l!==n&&(j=r.clone(j,!0,!0),i&&r.merge(h,ma(j,"script"))),c.call(a[l],j,l);if(i)for(k=h[h.length-1].ownerDocument,r.map(h,Fa),l=0;l<i;l++)j=h[l],ka.test(j.type||"")&&!V.access(j,"globalEval")&&r.contains(k,j)&&(j.src?r._evalUrl&&r._evalUrl(j.src):p(j.textContent.replace(Ca,""),k))}return a}function Ja(a,b,c){for(var d,e=b?r.filter(b,a):a,f=0;null!=(d=e[f]);f++)c||1!==d.nodeType||r.cleanData(ma(d)),d.parentNode&&(c&&r.contains(d.ownerDocument,d)&&na(ma(d,"script")),d.parentNode.removeChild(d));return a}r.extend({htmlPrefilter:function(a){return a.replace(ya,"<$1></$2>")},clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=r.contains(a.ownerDocument,a);if(!(o.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||r.isXMLDoc(a)))for(g=ma(h),f=ma(a),d=0,e=f.length;d<e;d++)Ha(f[d],g[d]);if(b)if(c)for(f=f||ma(a),g=g||ma(h),d=0,e=f.length;d<e;d++)Ga(f[d],g[d]);else Ga(a,h);return g=ma(h,"script"),g.length>0&&na(g,!i&&ma(a,"script")),h},cleanData:function(a){for(var b,c,d,e=r.event.special,f=0;void 0!==(c=a[f]);f++)if(T(c)){if(b=c[V.expando]){if(b.events)for(d in b.events)e[d]?r.event.remove(c,d):r.removeEvent(c,d,b.handle);c[V.expando]=void 0}c[W.expando]&&(c[W.expando]=void 0)}}}),r.fn.extend({detach:function(a){return Ja(this,a,!0)},remove:function(a){return Ja(this,a)},text:function(a){return S(this,function(a){return void 0===a?r.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=a)})},null,a,arguments.length)},append:function(){return Ia(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=Da(this,a);b.appendChild(a)}})},prepend:function(){return Ia(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=Da(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return Ia(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return Ia(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(r.cleanData(ma(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null!=a&&a,b=null==b?a:b,this.map(function(){return r.clone(this,a,b)})},html:function(a){return S(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!za.test(a)&&!la[(ja.exec(a)||["",""])[1].toLowerCase()]){a=r.htmlPrefilter(a);try{for(;c<d;c++)b=this[c]||{},1===b.nodeType&&(r.cleanData(ma(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=[];return Ia(this,arguments,function(b){var c=this.parentNode;r.inArray(this,a)<0&&(r.cleanData(ma(this)),c&&c.replaceChild(b,this))},a)}}),r.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){r.fn[a]=function(a){for(var c,d=[],e=r(a),f=e.length-1,g=0;g<=f;g++)c=g===f?this:this.clone(!0),r(e[g])[b](c),h.apply(d,c.get());return this.pushStack(d)}});var Ka=/^margin/,La=new RegExp("^("+_+")(?!px)[a-z%]+$","i"),Ma=function(b){var c=b.ownerDocument.defaultView;return c&&c.opener||(c=a),c.getComputedStyle(b)};!function(){function b(){if(i){i.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",i.innerHTML="",qa.appendChild(h);var b=a.getComputedStyle(i);c="1%"!==b.top,g="2px"===b.marginLeft,e="4px"===b.width,i.style.marginRight="50%",f="4px"===b.marginRight,qa.removeChild(h),i=null}}var c,e,f,g,h=d.createElement("div"),i=d.createElement("div");i.style&&(i.style.backgroundClip="content-box",i.cloneNode(!0).style.backgroundClip="",o.clearCloneStyle="content-box"===i.style.backgroundClip,h.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",h.appendChild(i),r.extend(o,{pixelPosition:function(){return b(),c},boxSizingReliable:function(){return b(),e},pixelMarginRight:function(){return b(),f},reliableMarginLeft:function(){return b(),g}}))}();function Na(a,b,c){var d,e,f,g,h=a.style;return c=c||Ma(a),c&&(g=c.getPropertyValue(b)||c[b],""!==g||r.contains(a.ownerDocument,a)||(g=r.style(a,b)),!o.pixelMarginRight()&&La.test(g)&&Ka.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0!==g?g+"":g}function Oa(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}var Pa=/^(none|table(?!-c[ea]).+)/,Qa={position:"absolute",visibility:"hidden",display:"block"},Ra={letterSpacing:"0",fontWeight:"400"},Sa=["Webkit","Moz","ms"],Ta=d.createElement("div").style;function Ua(a){if(a in Ta)return a;var b=a[0].toUpperCase()+a.slice(1),c=Sa.length;while(c--)if(a=Sa[c]+b,a in Ta)return a}function Va(a,b,c){var d=aa.exec(b);return d?Math.max(0,d[2]-(c||0))+(d[3]||"px"):b}function Wa(a,b,c,d,e){var f,g=0;for(f=c===(d?"border":"content")?4:"width"===b?1:0;f<4;f+=2)"margin"===c&&(g+=r.css(a,c+ba[f],!0,e)),d?("content"===c&&(g-=r.css(a,"padding"+ba[f],!0,e)),"margin"!==c&&(g-=r.css(a,"border"+ba[f]+"Width",!0,e))):(g+=r.css(a,"padding"+ba[f],!0,e),"padding"!==c&&(g+=r.css(a,"border"+ba[f]+"Width",!0,e)));return g}function Xa(a,b,c){var d,e=!0,f=Ma(a),g="border-box"===r.css(a,"boxSizing",!1,f);if(a.getClientRects().length&&(d=a.getBoundingClientRect()[b]),d<=0||null==d){if(d=Na(a,b,f),(d<0||null==d)&&(d=a.style[b]),La.test(d))return d;e=g&&(o.boxSizingReliable()||d===a.style[b]),d=parseFloat(d)||0}return d+Wa(a,b,c||(g?"border":"content"),e,f)+"px"}r.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Na(a,"opacity");return""===c?"1":c}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=r.camelCase(b),i=a.style;return b=r.cssProps[h]||(r.cssProps[h]=Ua(h)||h),g=r.cssHooks[b]||r.cssHooks[h],void 0===c?g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b]:(f=typeof c,"string"===f&&(e=aa.exec(c))&&e[1]&&(c=ea(a,b,e),f="number"),null!=c&&c===c&&("number"===f&&(c+=e&&e[3]||(r.cssNumber[h]?"":"px")),o.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i[b]=c)),void 0)}},css:function(a,b,c,d){var e,f,g,h=r.camelCase(b);return b=r.cssProps[h]||(r.cssProps[h]=Ua(h)||h),g=r.cssHooks[b]||r.cssHooks[h],g&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=Na(a,b,d)),"normal"===e&&b in Ra&&(e=Ra[b]),""===c||c?(f=parseFloat(e),c===!0||isFinite(f)?f||0:e):e}}),r.each(["height","width"],function(a,b){r.cssHooks[b]={get:function(a,c,d){if(c)return!Pa.test(r.css(a,"display"))||a.getClientRects().length&&a.getBoundingClientRect().width?Xa(a,b,d):da(a,Qa,function(){return Xa(a,b,d)})},set:function(a,c,d){var e,f=d&&Ma(a),g=d&&Wa(a,b,d,"border-box"===r.css(a,"boxSizing",!1,f),f);return g&&(e=aa.exec(c))&&"px"!==(e[3]||"px")&&(a.style[b]=c,c=r.css(a,b)),Va(a,c,g)}}}),r.cssHooks.marginLeft=Oa(o.reliableMarginLeft,function(a,b){if(b)return(parseFloat(Na(a,"marginLeft"))||a.getBoundingClientRect().left-da(a,{marginLeft:0},function(){return a.getBoundingClientRect().left}))+"px"}),r.each({margin:"",padding:"",border:"Width"},function(a,b){r.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];d<4;d++)e[a+ba[d]+b]=f[d]||f[d-2]||f[0];return e}},Ka.test(a)||(r.cssHooks[a+b].set=Va)}),r.fn.extend({css:function(a,b){return S(this,function(a,b,c){var d,e,f={},g=0;if(r.isArray(b)){for(d=Ma(a),e=b.length;g<e;g++)f[b[g]]=r.css(a,b[g],!1,d);return f}return void 0!==c?r.style(a,b,c):r.css(a,b)},a,b,arguments.length>1)}});function Ya(a,b,c,d,e){return new Ya.prototype.init(a,b,c,d,e)}r.Tween=Ya,Ya.prototype={constructor:Ya,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||r.easing._default,this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(r.cssNumber[c]?"":"px")},cur:function(){var a=Ya.propHooks[this.prop];return a&&a.get?a.get(this):Ya.propHooks._default.get(this)},run:function(a){var b,c=Ya.propHooks[this.prop];return this.options.duration?this.pos=b=r.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Ya.propHooks._default.set(this),this}},Ya.prototype.init.prototype=Ya.prototype,Ya.propHooks={_default:{get:function(a){var b;return 1!==a.elem.nodeType||null!=a.elem[a.prop]&&null==a.elem.style[a.prop]?a.elem[a.prop]:(b=r.css(a.elem,a.prop,""),b&&"auto"!==b?b:0)},set:function(a){r.fx.step[a.prop]?r.fx.step[a.prop](a):1!==a.elem.nodeType||null==a.elem.style[r.cssProps[a.prop]]&&!r.cssHooks[a.prop]?a.elem[a.prop]=a.now:r.style(a.elem,a.prop,a.now+a.unit)}}},Ya.propHooks.scrollTop=Ya.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},r.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2},_default:"swing"},r.fx=Ya.prototype.init,r.fx.step={};var Za,$a,_a=/^(?:toggle|show|hide)$/,ab=/queueHooks$/;function bb(){$a&&(a.requestAnimationFrame(bb),r.fx.tick())}function cb(){return a.setTimeout(function(){Za=void 0}),Za=r.now()}function db(a,b){var c,d=0,e={height:a};for(b=b?1:0;d<4;d+=2-b)c=ba[d],e["margin"+c]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function eb(a,b,c){for(var d,e=(hb.tweeners[b]||[]).concat(hb.tweeners["*"]),f=0,g=e.length;f<g;f++)if(d=e[f].call(c,b,a))return d}function fb(a,b,c){var d,e,f,g,h,i,j,k,l="width"in b||"height"in b,m=this,n={},o=a.style,p=a.nodeType&&ca(a),q=V.get(a,"fxshow");c.queue||(g=r._queueHooks(a,"fx"),null==g.unqueued&&(g.unqueued=0,h=g.empty.fire,g.empty.fire=function(){g.unqueued||h()}),g.unqueued++,m.always(function(){m.always(function(){g.unqueued--,r.queue(a,"fx").length||g.empty.fire()})}));for(d in b)if(e=b[d],_a.test(e)){if(delete b[d],f=f||"toggle"===e,e===(p?"hide":"show")){if("show"!==e||!q||void 0===q[d])continue;p=!0}n[d]=q&&q[d]||r.style(a,d)}if(i=!r.isEmptyObject(b),i||!r.isEmptyObject(n)){l&&1===a.nodeType&&(c.overflow=[o.overflow,o.overflowX,o.overflowY],j=q&&q.display,null==j&&(j=V.get(a,"display")),k=r.css(a,"display"),"none"===k&&(j?k=j:(ha([a],!0),j=a.style.display||j,k=r.css(a,"display"),ha([a]))),("inline"===k||"inline-block"===k&&null!=j)&&"none"===r.css(a,"float")&&(i||(m.done(function(){o.display=j}),null==j&&(k=o.display,j="none"===k?"":k)),o.display="inline-block")),c.overflow&&(o.overflow="hidden",m.always(function(){o.overflow=c.overflow[0],o.overflowX=c.overflow[1],o.overflowY=c.overflow[2]})),i=!1;for(d in n)i||(q?"hidden"in q&&(p=q.hidden):q=V.access(a,"fxshow",{display:j}),f&&(q.hidden=!p),p&&ha([a],!0),m.done(function(){p||ha([a]),V.remove(a,"fxshow");for(d in n)r.style(a,d,n[d])})),i=eb(p?q[d]:0,d,m),d in q||(q[d]=i.start,p&&(i.end=i.start,i.start=0))}}function gb(a,b){var c,d,e,f,g;for(c in a)if(d=r.camelCase(c),e=b[d],f=a[c],r.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=r.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function hb(a,b,c){var d,e,f=0,g=hb.prefilters.length,h=r.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=Za||cb(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;g<i;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),f<1&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:r.extend({},b),opts:r.extend(!0,{specialEasing:{},easing:r.easing._default},c),originalProperties:b,originalOptions:c,startTime:Za||cb(),duration:c.duration,tweens:[],createTween:function(b,c){var d=r.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;c<d;c++)j.tweens[c].run(1);return b?(h.notifyWith(a,[j,1,0]),h.resolveWith(a,[j,b])):h.rejectWith(a,[j,b]),this}}),k=j.props;for(gb(k,j.opts.specialEasing);f<g;f++)if(d=hb.prefilters[f].call(j,a,k,j.opts))return r.isFunction(d.stop)&&(r._queueHooks(j.elem,j.opts.queue).stop=r.proxy(d.stop,d)),d;return r.map(k,eb,j),r.isFunction(j.opts.start)&&j.opts.start.call(a,j),r.fx.timer(r.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}r.Animation=r.extend(hb,{tweeners:{"*":[function(a,b){var c=this.createTween(a,b);return ea(c.elem,a,aa.exec(b),c),c}]},tweener:function(a,b){r.isFunction(a)?(b=a,a=["*"]):a=a.match(K);for(var c,d=0,e=a.length;d<e;d++)c=a[d],hb.tweeners[c]=hb.tweeners[c]||[],hb.tweeners[c].unshift(b)},prefilters:[fb],prefilter:function(a,b){b?hb.prefilters.unshift(a):hb.prefilters.push(a)}}),r.speed=function(a,b,c){var e=a&&"object"==typeof a?r.extend({},a):{complete:c||!c&&b||r.isFunction(a)&&a,duration:a,easing:c&&b||b&&!r.isFunction(b)&&b};return r.fx.off||d.hidden?e.duration=0:"number"!=typeof e.duration&&(e.duration in r.fx.speeds?e.duration=r.fx.speeds[e.duration]:e.duration=r.fx.speeds._default),null!=e.queue&&e.queue!==!0||(e.queue="fx"),e.old=e.complete,e.complete=function(){r.isFunction(e.old)&&e.old.call(this),e.queue&&r.dequeue(this,e.queue)},e},r.fn.extend({fadeTo:function(a,b,c,d){return this.filter(ca).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=r.isEmptyObject(a),f=r.speed(b,c,d),g=function(){var b=hb(this,r.extend({},a),f);(e||V.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=r.timers,g=V.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&ab.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));!b&&c||r.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=V.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=r.timers,g=d?d.length:0;for(c.finish=!0,r.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;b<g;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),r.each(["toggle","show","hide"],function(a,b){var c=r.fn[b];r.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(db(b,!0),a,d,e)}}),r.each({slideDown:db("show"),slideUp:db("hide"),slideToggle:db("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){r.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),r.timers=[],r.fx.tick=function(){var a,b=0,c=r.timers;for(Za=r.now();b<c.length;b++)a=c[b],a()||c[b]!==a||c.splice(b--,1);c.length||r.fx.stop(),Za=void 0},r.fx.timer=function(a){r.timers.push(a),a()?r.fx.start():r.timers.pop()},r.fx.interval=13,r.fx.start=function(){$a||($a=a.requestAnimationFrame?a.requestAnimationFrame(bb):a.setInterval(r.fx.tick,r.fx.interval))},r.fx.stop=function(){a.cancelAnimationFrame?a.cancelAnimationFrame($a):a.clearInterval($a),$a=null},r.fx.speeds={slow:600,fast:200,_default:400},r.fn.delay=function(b,c){return b=r.fx?r.fx.speeds[b]||b:b,c=c||"fx",this.queue(c,function(c,d){var e=a.setTimeout(c,b);d.stop=function(){a.clearTimeout(e)}})},function(){var a=d.createElement("input"),b=d.createElement("select"),c=b.appendChild(d.createElement("option"));a.type="checkbox",o.checkOn=""!==a.value,o.optSelected=c.selected,a=d.createElement("input"),a.value="t",a.type="radio",o.radioValue="t"===a.value}();var ib,jb=r.expr.attrHandle;r.fn.extend({attr:function(a,b){return S(this,r.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){r.removeAttr(this,a)})}}),r.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return"undefined"==typeof a.getAttribute?r.prop(a,b,c):(1===f&&r.isXMLDoc(a)||(e=r.attrHooks[b.toLowerCase()]||(r.expr.match.bool.test(b)?ib:void 0)),
void 0!==c?null===c?void r.removeAttr(a,b):e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:(a.setAttribute(b,c+""),c):e&&"get"in e&&null!==(d=e.get(a,b))?d:(d=r.find.attr(a,b),null==d?void 0:d))},attrHooks:{type:{set:function(a,b){if(!o.radioValue&&"radio"===b&&r.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},removeAttr:function(a,b){var c,d=0,e=b&&b.match(K);if(e&&1===a.nodeType)while(c=e[d++])a.removeAttribute(c)}}),ib={set:function(a,b,c){return b===!1?r.removeAttr(a,c):a.setAttribute(c,c),c}},r.each(r.expr.match.bool.source.match(/\w+/g),function(a,b){var c=jb[b]||r.find.attr;jb[b]=function(a,b,d){var e,f,g=b.toLowerCase();return d||(f=jb[g],jb[g]=e,e=null!=c(a,b,d)?g:null,jb[g]=f),e}});var kb=/^(?:input|select|textarea|button)$/i,lb=/^(?:a|area)$/i;r.fn.extend({prop:function(a,b){return S(this,r.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[r.propFix[a]||a]})}}),r.extend({prop:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return 1===f&&r.isXMLDoc(a)||(b=r.propFix[b]||b,e=r.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=r.find.attr(a,"tabindex");return b?parseInt(b,10):kb.test(a.nodeName)||lb.test(a.nodeName)&&a.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),o.optSelected||(r.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null},set:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex)}}),r.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){r.propFix[this.toLowerCase()]=this});function mb(a){var b=a.match(K)||[];return b.join(" ")}function nb(a){return a.getAttribute&&a.getAttribute("class")||""}r.fn.extend({addClass:function(a){var b,c,d,e,f,g,h,i=0;if(r.isFunction(a))return this.each(function(b){r(this).addClass(a.call(this,b,nb(this)))});if("string"==typeof a&&a){b=a.match(K)||[];while(c=this[i++])if(e=nb(c),d=1===c.nodeType&&" "+mb(e)+" "){g=0;while(f=b[g++])d.indexOf(" "+f+" ")<0&&(d+=f+" ");h=mb(d),e!==h&&c.setAttribute("class",h)}}return this},removeClass:function(a){var b,c,d,e,f,g,h,i=0;if(r.isFunction(a))return this.each(function(b){r(this).removeClass(a.call(this,b,nb(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof a&&a){b=a.match(K)||[];while(c=this[i++])if(e=nb(c),d=1===c.nodeType&&" "+mb(e)+" "){g=0;while(f=b[g++])while(d.indexOf(" "+f+" ")>-1)d=d.replace(" "+f+" "," ");h=mb(d),e!==h&&c.setAttribute("class",h)}}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):r.isFunction(a)?this.each(function(c){r(this).toggleClass(a.call(this,c,nb(this),b),b)}):this.each(function(){var b,d,e,f;if("string"===c){d=0,e=r(this),f=a.match(K)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else void 0!==a&&"boolean"!==c||(b=nb(this),b&&V.set(this,"__className__",b),this.setAttribute&&this.setAttribute("class",b||a===!1?"":V.get(this,"__className__")||""))})},hasClass:function(a){var b,c,d=0;b=" "+a+" ";while(c=this[d++])if(1===c.nodeType&&(" "+mb(nb(c))+" ").indexOf(b)>-1)return!0;return!1}});var ob=/\r/g;r.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=r.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,r(this).val()):a,null==e?e="":"number"==typeof e?e+="":r.isArray(e)&&(e=r.map(e,function(a){return null==a?"":a+""})),b=r.valHooks[this.type]||r.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=r.valHooks[e.type]||r.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(ob,""):null==c?"":c)}}}),r.extend({valHooks:{option:{get:function(a){var b=r.find.attr(a,"value");return null!=b?b:mb(r.text(a))}},select:{get:function(a){var b,c,d,e=a.options,f=a.selectedIndex,g="select-one"===a.type,h=g?null:[],i=g?f+1:e.length;for(d=f<0?i:g?f:0;d<i;d++)if(c=e[d],(c.selected||d===f)&&!c.disabled&&(!c.parentNode.disabled||!r.nodeName(c.parentNode,"optgroup"))){if(b=r(c).val(),g)return b;h.push(b)}return h},set:function(a,b){var c,d,e=a.options,f=r.makeArray(b),g=e.length;while(g--)d=e[g],(d.selected=r.inArray(r.valHooks.option.get(d),f)>-1)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),r.each(["radio","checkbox"],function(){r.valHooks[this]={set:function(a,b){if(r.isArray(b))return a.checked=r.inArray(r(a).val(),b)>-1}},o.checkOn||(r.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var pb=/^(?:focusinfocus|focusoutblur)$/;r.extend(r.event,{trigger:function(b,c,e,f){var g,h,i,j,k,m,n,o=[e||d],p=l.call(b,"type")?b.type:b,q=l.call(b,"namespace")?b.namespace.split("."):[];if(h=i=e=e||d,3!==e.nodeType&&8!==e.nodeType&&!pb.test(p+r.event.triggered)&&(p.indexOf(".")>-1&&(q=p.split("."),p=q.shift(),q.sort()),k=p.indexOf(":")<0&&"on"+p,b=b[r.expando]?b:new r.Event(p,"object"==typeof b&&b),b.isTrigger=f?2:3,b.namespace=q.join("."),b.rnamespace=b.namespace?new RegExp("(^|\\.)"+q.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=e),c=null==c?[b]:r.makeArray(c,[b]),n=r.event.special[p]||{},f||!n.trigger||n.trigger.apply(e,c)!==!1)){if(!f&&!n.noBubble&&!r.isWindow(e)){for(j=n.delegateType||p,pb.test(j+p)||(h=h.parentNode);h;h=h.parentNode)o.push(h),i=h;i===(e.ownerDocument||d)&&o.push(i.defaultView||i.parentWindow||a)}g=0;while((h=o[g++])&&!b.isPropagationStopped())b.type=g>1?j:n.bindType||p,m=(V.get(h,"events")||{})[b.type]&&V.get(h,"handle"),m&&m.apply(h,c),m=k&&h[k],m&&m.apply&&T(h)&&(b.result=m.apply(h,c),b.result===!1&&b.preventDefault());return b.type=p,f||b.isDefaultPrevented()||n._default&&n._default.apply(o.pop(),c)!==!1||!T(e)||k&&r.isFunction(e[p])&&!r.isWindow(e)&&(i=e[k],i&&(e[k]=null),r.event.triggered=p,e[p](),r.event.triggered=void 0,i&&(e[k]=i)),b.result}},simulate:function(a,b,c){var d=r.extend(new r.Event,c,{type:a,isSimulated:!0});r.event.trigger(d,null,b)}}),r.fn.extend({trigger:function(a,b){return this.each(function(){r.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];if(c)return r.event.trigger(a,b,c,!0)}}),r.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(a,b){r.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),r.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),o.focusin="onfocusin"in a,o.focusin||r.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){r.event.simulate(b,a.target,r.event.fix(a))};r.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=V.access(d,b);e||d.addEventListener(a,c,!0),V.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=V.access(d,b)-1;e?V.access(d,b,e):(d.removeEventListener(a,c,!0),V.remove(d,b))}}});var qb=a.location,rb=r.now(),sb=/\?/;r.parseXML=function(b){var c;if(!b||"string"!=typeof b)return null;try{c=(new a.DOMParser).parseFromString(b,"text/xml")}catch(d){c=void 0}return c&&!c.getElementsByTagName("parsererror").length||r.error("Invalid XML: "+b),c};var tb=/\[\]$/,ub=/\r?\n/g,vb=/^(?:submit|button|image|reset|file)$/i,wb=/^(?:input|select|textarea|keygen)/i;function xb(a,b,c,d){var e;if(r.isArray(b))r.each(b,function(b,e){c||tb.test(a)?d(a,e):xb(a+"["+("object"==typeof e&&null!=e?b:"")+"]",e,c,d)});else if(c||"object"!==r.type(b))d(a,b);else for(e in b)xb(a+"["+e+"]",b[e],c,d)}r.param=function(a,b){var c,d=[],e=function(a,b){var c=r.isFunction(b)?b():b;d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(null==c?"":c)};if(r.isArray(a)||a.jquery&&!r.isPlainObject(a))r.each(a,function(){e(this.name,this.value)});else for(c in a)xb(c,a[c],b,e);return d.join("&")},r.fn.extend({serialize:function(){return r.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=r.prop(this,"elements");return a?r.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!r(this).is(":disabled")&&wb.test(this.nodeName)&&!vb.test(a)&&(this.checked||!ia.test(a))}).map(function(a,b){var c=r(this).val();return null==c?null:r.isArray(c)?r.map(c,function(a){return{name:b.name,value:a.replace(ub,"\r\n")}}):{name:b.name,value:c.replace(ub,"\r\n")}}).get()}});var yb=/%20/g,zb=/#.*$/,Ab=/([?&])_=[^&]*/,Bb=/^(.*?):[ \t]*([^\r\n]*)$/gm,Cb=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Db=/^(?:GET|HEAD)$/,Eb=/^\/\//,Fb={},Gb={},Hb="*/".concat("*"),Ib=d.createElement("a");Ib.href=qb.href;function Jb(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(K)||[];if(r.isFunction(c))while(d=f[e++])"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function Kb(a,b,c,d){var e={},f=a===Gb;function g(h){var i;return e[h]=!0,r.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function Lb(a,b){var c,d,e=r.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&r.extend(!0,a,d),a}function Mb(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}if(f)return f!==i[0]&&i.unshift(f),c[f]}function Nb(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}r.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:qb.href,type:"GET",isLocal:Cb.test(qb.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Hb,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":r.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Lb(Lb(a,r.ajaxSettings),b):Lb(r.ajaxSettings,a)},ajaxPrefilter:Jb(Fb),ajaxTransport:Jb(Gb),ajax:function(b,c){"object"==typeof b&&(c=b,b=void 0),c=c||{};var e,f,g,h,i,j,k,l,m,n,o=r.ajaxSetup({},c),p=o.context||o,q=o.context&&(p.nodeType||p.jquery)?r(p):r.event,s=r.Deferred(),t=r.Callbacks("once memory"),u=o.statusCode||{},v={},w={},x="canceled",y={readyState:0,getResponseHeader:function(a){var b;if(k){if(!h){h={};while(b=Bb.exec(g))h[b[1].toLowerCase()]=b[2]}b=h[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return k?g:null},setRequestHeader:function(a,b){return null==k&&(a=w[a.toLowerCase()]=w[a.toLowerCase()]||a,v[a]=b),this},overrideMimeType:function(a){return null==k&&(o.mimeType=a),this},statusCode:function(a){var b;if(a)if(k)y.always(a[y.status]);else for(b in a)u[b]=[u[b],a[b]];return this},abort:function(a){var b=a||x;return e&&e.abort(b),A(0,b),this}};if(s.promise(y),o.url=((b||o.url||qb.href)+"").replace(Eb,qb.protocol+"//"),o.type=c.method||c.type||o.method||o.type,o.dataTypes=(o.dataType||"*").toLowerCase().match(K)||[""],null==o.crossDomain){j=d.createElement("a");try{j.href=o.url,j.href=j.href,o.crossDomain=Ib.protocol+"//"+Ib.host!=j.protocol+"//"+j.host}catch(z){o.crossDomain=!0}}if(o.data&&o.processData&&"string"!=typeof o.data&&(o.data=r.param(o.data,o.traditional)),Kb(Fb,o,c,y),k)return y;l=r.event&&o.global,l&&0===r.active++&&r.event.trigger("ajaxStart"),o.type=o.type.toUpperCase(),o.hasContent=!Db.test(o.type),f=o.url.replace(zb,""),o.hasContent?o.data&&o.processData&&0===(o.contentType||"").indexOf("application/x-www-form-urlencoded")&&(o.data=o.data.replace(yb,"+")):(n=o.url.slice(f.length),o.data&&(f+=(sb.test(f)?"&":"?")+o.data,delete o.data),o.cache===!1&&(f=f.replace(Ab,"$1"),n=(sb.test(f)?"&":"?")+"_="+rb++ +n),o.url=f+n),o.ifModified&&(r.lastModified[f]&&y.setRequestHeader("If-Modified-Since",r.lastModified[f]),r.etag[f]&&y.setRequestHeader("If-None-Match",r.etag[f])),(o.data&&o.hasContent&&o.contentType!==!1||c.contentType)&&y.setRequestHeader("Content-Type",o.contentType),y.setRequestHeader("Accept",o.dataTypes[0]&&o.accepts[o.dataTypes[0]]?o.accepts[o.dataTypes[0]]+("*"!==o.dataTypes[0]?", "+Hb+"; q=0.01":""):o.accepts["*"]);for(m in o.headers)y.setRequestHeader(m,o.headers[m]);if(o.beforeSend&&(o.beforeSend.call(p,y,o)===!1||k))return y.abort();if(x="abort",t.add(o.complete),y.done(o.success),y.fail(o.error),e=Kb(Gb,o,c,y)){if(y.readyState=1,l&&q.trigger("ajaxSend",[y,o]),k)return y;o.async&&o.timeout>0&&(i=a.setTimeout(function(){y.abort("timeout")},o.timeout));try{k=!1,e.send(v,A)}catch(z){if(k)throw z;A(-1,z)}}else A(-1,"No Transport");function A(b,c,d,h){var j,m,n,v,w,x=c;k||(k=!0,i&&a.clearTimeout(i),e=void 0,g=h||"",y.readyState=b>0?4:0,j=b>=200&&b<300||304===b,d&&(v=Mb(o,y,d)),v=Nb(o,v,y,j),j?(o.ifModified&&(w=y.getResponseHeader("Last-Modified"),w&&(r.lastModified[f]=w),w=y.getResponseHeader("etag"),w&&(r.etag[f]=w)),204===b||"HEAD"===o.type?x="nocontent":304===b?x="notmodified":(x=v.state,m=v.data,n=v.error,j=!n)):(n=x,!b&&x||(x="error",b<0&&(b=0))),y.status=b,y.statusText=(c||x)+"",j?s.resolveWith(p,[m,x,y]):s.rejectWith(p,[y,x,n]),y.statusCode(u),u=void 0,l&&q.trigger(j?"ajaxSuccess":"ajaxError",[y,o,j?m:n]),t.fireWith(p,[y,x]),l&&(q.trigger("ajaxComplete",[y,o]),--r.active||r.event.trigger("ajaxStop")))}return y},getJSON:function(a,b,c){return r.get(a,b,c,"json")},getScript:function(a,b){return r.get(a,void 0,b,"script")}}),r.each(["get","post"],function(a,b){r[b]=function(a,c,d,e){return r.isFunction(c)&&(e=e||d,d=c,c=void 0),r.ajax(r.extend({url:a,type:b,dataType:e,data:c,success:d},r.isPlainObject(a)&&a))}}),r._evalUrl=function(a){return r.ajax({url:a,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,"throws":!0})},r.fn.extend({wrapAll:function(a){var b;return this[0]&&(r.isFunction(a)&&(a=a.call(this[0])),b=r(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstElementChild)a=a.firstElementChild;return a}).append(this)),this},wrapInner:function(a){return r.isFunction(a)?this.each(function(b){r(this).wrapInner(a.call(this,b))}):this.each(function(){var b=r(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=r.isFunction(a);return this.each(function(c){r(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(a){return this.parent(a).not("body").each(function(){r(this).replaceWith(this.childNodes)}),this}}),r.expr.pseudos.hidden=function(a){return!r.expr.pseudos.visible(a)},r.expr.pseudos.visible=function(a){return!!(a.offsetWidth||a.offsetHeight||a.getClientRects().length)},r.ajaxSettings.xhr=function(){try{return new a.XMLHttpRequest}catch(b){}};var Ob={0:200,1223:204},Pb=r.ajaxSettings.xhr();o.cors=!!Pb&&"withCredentials"in Pb,o.ajax=Pb=!!Pb,r.ajaxTransport(function(b){var c,d;if(o.cors||Pb&&!b.crossDomain)return{send:function(e,f){var g,h=b.xhr();if(h.open(b.type,b.url,b.async,b.username,b.password),b.xhrFields)for(g in b.xhrFields)h[g]=b.xhrFields[g];b.mimeType&&h.overrideMimeType&&h.overrideMimeType(b.mimeType),b.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest");for(g in e)h.setRequestHeader(g,e[g]);c=function(a){return function(){c&&(c=d=h.onload=h.onerror=h.onabort=h.onreadystatechange=null,"abort"===a?h.abort():"error"===a?"number"!=typeof h.status?f(0,"error"):f(h.status,h.statusText):f(Ob[h.status]||h.status,h.statusText,"text"!==(h.responseType||"text")||"string"!=typeof h.responseText?{binary:h.response}:{text:h.responseText},h.getAllResponseHeaders()))}},h.onload=c(),d=h.onerror=c("error"),void 0!==h.onabort?h.onabort=d:h.onreadystatechange=function(){4===h.readyState&&a.setTimeout(function(){c&&d()})},c=c("abort");try{h.send(b.hasContent&&b.data||null)}catch(i){if(c)throw i}},abort:function(){c&&c()}}}),r.ajaxPrefilter(function(a){a.crossDomain&&(a.contents.script=!1)}),r.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(a){return r.globalEval(a),a}}}),r.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),r.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(e,f){b=r("<script>").prop({charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&f("error"===a.type?404:200,a.type)}),d.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Qb=[],Rb=/(=)\?(?=&|$)|\?\?/;r.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Qb.pop()||r.expando+"_"+rb++;return this[a]=!0,a}}),r.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(Rb.test(b.url)?"url":"string"==typeof b.data&&0===(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Rb.test(b.data)&&"data");if(h||"jsonp"===b.dataTypes[0])return e=b.jsonpCallback=r.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Rb,"$1"+e):b.jsonp!==!1&&(b.url+=(sb.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||r.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){void 0===f?r(a).removeProp(e):a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Qb.push(e)),g&&r.isFunction(f)&&f(g[0]),g=f=void 0}),"script"}),o.createHTMLDocument=function(){var a=d.implementation.createHTMLDocument("").body;return a.innerHTML="<form></form><form></form>",2===a.childNodes.length}(),r.parseHTML=function(a,b,c){if("string"!=typeof a)return[];"boolean"==typeof b&&(c=b,b=!1);var e,f,g;return b||(o.createHTMLDocument?(b=d.implementation.createHTMLDocument(""),e=b.createElement("base"),e.href=d.location.href,b.head.appendChild(e)):b=d),f=B.exec(a),g=!c&&[],f?[b.createElement(f[1])]:(f=pa([a],b,g),g&&g.length&&r(g).remove(),r.merge([],f.childNodes))},r.fn.load=function(a,b,c){var d,e,f,g=this,h=a.indexOf(" ");return h>-1&&(d=mb(a.slice(h)),a=a.slice(0,h)),r.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&r.ajax({url:a,type:e||"GET",dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?r("<div>").append(r.parseHTML(a)).find(d):a)}).always(c&&function(a,b){g.each(function(){c.apply(this,f||[a.responseText,b,a])})}),this},r.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){r.fn[b]=function(a){return this.on(b,a)}}),r.expr.pseudos.animated=function(a){return r.grep(r.timers,function(b){return a===b.elem}).length};function Sb(a){return r.isWindow(a)?a:9===a.nodeType&&a.defaultView}r.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=r.css(a,"position"),l=r(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=r.css(a,"top"),i=r.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),r.isFunction(b)&&(b=b.call(a,c,r.extend({},h))),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},r.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){r.offset.setOffset(this,a,b)});var b,c,d,e,f=this[0];if(f)return f.getClientRects().length?(d=f.getBoundingClientRect(),d.width||d.height?(e=f.ownerDocument,c=Sb(e),b=e.documentElement,{top:d.top+c.pageYOffset-b.clientTop,left:d.left+c.pageXOffset-b.clientLeft}):d):{top:0,left:0}},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===r.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),r.nodeName(a[0],"html")||(d=a.offset()),d={top:d.top+r.css(a[0],"borderTopWidth",!0),left:d.left+r.css(a[0],"borderLeftWidth",!0)}),{top:b.top-d.top-r.css(c,"marginTop",!0),left:b.left-d.left-r.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent;while(a&&"static"===r.css(a,"position"))a=a.offsetParent;return a||qa})}}),r.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c="pageYOffset"===b;r.fn[a]=function(d){return S(this,function(a,d,e){var f=Sb(a);return void 0===e?f?f[b]:a[d]:void(f?f.scrollTo(c?f.pageXOffset:e,c?e:f.pageYOffset):a[d]=e)},a,d,arguments.length)}}),r.each(["top","left"],function(a,b){r.cssHooks[b]=Oa(o.pixelPosition,function(a,c){if(c)return c=Na(a,b),La.test(c)?r(a).position()[b]+"px":c})}),r.each({Height:"height",Width:"width"},function(a,b){r.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){r.fn[d]=function(e,f){var g=arguments.length&&(c||"boolean"!=typeof e),h=c||(e===!0||f===!0?"margin":"border");return S(this,function(b,c,e){var f;return r.isWindow(b)?0===d.indexOf("outer")?b["inner"+a]:b.document.documentElement["client"+a]:9===b.nodeType?(f=b.documentElement,Math.max(b.body["scroll"+a],f["scroll"+a],b.body["offset"+a],f["offset"+a],f["client"+a])):void 0===e?r.css(b,c,h):r.style(b,c,e,h)},b,g?e:void 0,g)}})}),r.fn.extend({bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}}),r.parseJSON=JSON.parse,"function"==typeof define&&define.amd&&define("jquery",[],function(){return r});var Tb=a.jQuery,Ub=a.$;return r.noConflict=function(b){return a.$===r&&(a.$=Ub),b&&a.jQuery===r&&(a.jQuery=Tb),r},b||(a.jQuery=a.$=r),r});
/*
 * jQuery throttle / debounce - v1.1 - 3/7/2010
 * http://benalman.com/projects/jquery-throttle-debounce-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function(b,c){var $=b.jQuery||b.Cowboy||(b.Cowboy={}),a;$.throttle=a=function(e,f,j,i){var h,d=0;if(typeof f!=="boolean"){i=j;j=f;f=c}function g(){var o=this,m=+new Date()-d,n=arguments;function l(){d=+new Date();j.apply(o,n)}function k(){h=c}if(i&&!h){l()}h&&clearTimeout(h);if(i===c&&m>e){l()}else{if(f!==true){h=setTimeout(i?k:l,i===c?e-m:e)}}}if($.guid){g.guid=j.guid=j.guid||$.guid++}return g};$.debounce=function(d,e,f){return f===c?a(d,e,false):a(d,f,e!==false)}})(this);
/*!
 * imagesLoaded PACKAGED v4.1.0
 * JavaScript is all like "You images are done yet or what?"
 * MIT License
 */
!function(t,e){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",e):"object"==typeof module&&module.exports?module.exports=e():t.EvEmitter=e()}(this,function(){function t(){}var e=t.prototype;return e.on=function(t,e){if(t&&e){var i=this._events=this._events||{},n=i[t]=i[t]||[];return-1==n.indexOf(e)&&n.push(e),this}},e.once=function(t,e){if(t&&e){this.on(t,e);var i=this._onceEvents=this._onceEvents||{},n=i[t]=i[t]||[];return n[e]=!0,this}},e.off=function(t,e){var i=this._events&&this._events[t];if(i&&i.length){var n=i.indexOf(e);return-1!=n&&i.splice(n,1),this}},e.emitEvent=function(t,e){var i=this._events&&this._events[t];if(i&&i.length){var n=0,o=i[n];e=e||[];for(var r=this._onceEvents&&this._onceEvents[t];o;){var s=r&&r[o];s&&(this.off(t,o),delete r[o]),o.apply(this,e),n+=s?0:1,o=i[n]}return this}},t}),function(t,e){"use strict";"function"==typeof define&&define.amd?define(["ev-emitter/ev-emitter"],function(i){return e(t,i)}):"object"==typeof module&&module.exports?module.exports=e(t,require("ev-emitter")):t.imagesLoaded=e(t,t.EvEmitter)}(window,function(t,e){function i(t,e){for(var i in e)t[i]=e[i];return t}function n(t){var e=[];if(Array.isArray(t))e=t;else if("number"==typeof t.length)for(var i=0;i<t.length;i++)e.push(t[i]);else e.push(t);return e}function o(t,e,r){return this instanceof o?("string"==typeof t&&(t=document.querySelectorAll(t)),this.elements=n(t),this.options=i({},this.options),"function"==typeof e?r=e:i(this.options,e),r&&this.on("always",r),this.getImages(),h&&(this.jqDeferred=new h.Deferred),void setTimeout(function(){this.check()}.bind(this))):new o(t,e,r)}function r(t){this.img=t}function s(t,e){this.url=t,this.element=e,this.img=new Image}var h=t.jQuery,a=t.console;o.prototype=Object.create(e.prototype),o.prototype.options={},o.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)},o.prototype.addElementImages=function(t){"IMG"==t.nodeName&&this.addImage(t),this.options.background===!0&&this.addElementBackgroundImages(t);var e=t.nodeType;if(e&&d[e]){for(var i=t.querySelectorAll("img"),n=0;n<i.length;n++){var o=i[n];this.addImage(o)}if("string"==typeof this.options.background){var r=t.querySelectorAll(this.options.background);for(n=0;n<r.length;n++){var s=r[n];this.addElementBackgroundImages(s)}}}};var d={1:!0,9:!0,11:!0};return o.prototype.addElementBackgroundImages=function(t){var e=getComputedStyle(t);if(e)for(var i=/url\((['"])?(.*?)\1\)/gi,n=i.exec(e.backgroundImage);null!==n;){var o=n&&n[2];o&&this.addBackground(o,t),n=i.exec(e.backgroundImage)}},o.prototype.addImage=function(t){var e=new r(t);this.images.push(e)},o.prototype.addBackground=function(t,e){var i=new s(t,e);this.images.push(i)},o.prototype.check=function(){function t(t,i,n){setTimeout(function(){e.progress(t,i,n)})}var e=this;return this.progressedCount=0,this.hasAnyBroken=!1,this.images.length?void this.images.forEach(function(e){e.once("progress",t),e.check()}):void this.complete()},o.prototype.progress=function(t,e,i){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!t.isLoaded,this.emitEvent("progress",[this,t,e]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,t),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&a&&a.log("progress: "+i,t,e)},o.prototype.complete=function(){var t=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(t,[this]),this.emitEvent("always",[this]),this.jqDeferred){var e=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[e](this)}},r.prototype=Object.create(e.prototype),r.prototype.check=function(){var t=this.getIsImageComplete();return t?void this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(this.proxyImage=new Image,this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),void(this.proxyImage.src=this.img.src))},r.prototype.getIsImageComplete=function(){return this.img.complete&&void 0!==this.img.naturalWidth},r.prototype.confirm=function(t,e){this.isLoaded=t,this.emitEvent("progress",[this,this.img,e])},r.prototype.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},r.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},r.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},r.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},s.prototype=Object.create(r.prototype),s.prototype.check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url;var t=this.getIsImageComplete();t&&(this.confirm(0!==this.img.naturalWidth,"naturalWidth"),this.unbindEvents())},s.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},s.prototype.confirm=function(t,e){this.isLoaded=t,this.emitEvent("progress",[this,this.element,e])},o.makeJQueryPlugin=function(e){e=e||t.jQuery,e&&(h=e,h.fn.imagesLoaded=function(t,e){var i=new o(this,t,e);return i.jqDeferred.promise(h(this))})},o.makeJQueryPlugin(),o});
/*! lz-string-1.3.3-min.js | (c) 2013 Pieroxy | Licensed under a WTFPL license */
var LZString={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(e){if(e==null)return"";var t="";var n,r,i,s,o,u,a;var f=0;e=LZString.compress(e);while(f<e.length*2){if(f%2==0){n=e.charCodeAt(f/2)>>8;r=e.charCodeAt(f/2)&255;if(f/2+1<e.length)i=e.charCodeAt(f/2+1)>>8;else i=NaN}else{n=e.charCodeAt((f-1)/2)&255;if((f+1)/2<e.length){r=e.charCodeAt((f+1)/2)>>8;i=e.charCodeAt((f+1)/2)&255}else r=i=NaN}f+=3;s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+LZString._keyStr.charAt(s)+LZString._keyStr.charAt(o)+LZString._keyStr.charAt(u)+LZString._keyStr.charAt(a)}return t},decompressFromBase64:function(e){if(e==null)return"";var t="",n=0,r,i,s,o,u,a,f,l,c=0,h=LZString._f;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(c<e.length){u=LZString._keyStr.indexOf(e.charAt(c++));a=LZString._keyStr.indexOf(e.charAt(c++));f=LZString._keyStr.indexOf(e.charAt(c++));l=LZString._keyStr.indexOf(e.charAt(c++));i=u<<2|a>>4;s=(a&15)<<4|f>>2;o=(f&3)<<6|l;if(n%2==0){r=i<<8;if(f!=64){t+=h(r|s)}if(l!=64){r=o<<8}}else{t=t+h(r|i);if(f!=64){r=s<<8}if(l!=64){t+=h(r|o)}}n+=3}return LZString.decompress(t)},compressToUTF16:function(e){if(e==null)return"";var t="",n,r,i,s=0,o=LZString._f;e=LZString.compress(e);for(n=0;n<e.length;n++){r=e.charCodeAt(n);switch(s++){case 0:t+=o((r>>1)+32);i=(r&1)<<14;break;case 1:t+=o(i+(r>>2)+32);i=(r&3)<<13;break;case 2:t+=o(i+(r>>3)+32);i=(r&7)<<12;break;case 3:t+=o(i+(r>>4)+32);i=(r&15)<<11;break;case 4:t+=o(i+(r>>5)+32);i=(r&31)<<10;break;case 5:t+=o(i+(r>>6)+32);i=(r&63)<<9;break;case 6:t+=o(i+(r>>7)+32);i=(r&127)<<8;break;case 7:t+=o(i+(r>>8)+32);i=(r&255)<<7;break;case 8:t+=o(i+(r>>9)+32);i=(r&511)<<6;break;case 9:t+=o(i+(r>>10)+32);i=(r&1023)<<5;break;case 10:t+=o(i+(r>>11)+32);i=(r&2047)<<4;break;case 11:t+=o(i+(r>>12)+32);i=(r&4095)<<3;break;case 12:t+=o(i+(r>>13)+32);i=(r&8191)<<2;break;case 13:t+=o(i+(r>>14)+32);i=(r&16383)<<1;break;case 14:t+=o(i+(r>>15)+32,(r&32767)+32);s=0;break}}return t+o(i+32)},decompressFromUTF16:function(e){if(e==null)return"";var t="",n,r,i=0,s=0,o=LZString._f;while(s<e.length){r=e.charCodeAt(s)-32;switch(i++){case 0:n=r<<1;break;case 1:t+=o(n|r>>14);n=(r&16383)<<2;break;case 2:t+=o(n|r>>13);n=(r&8191)<<3;break;case 3:t+=o(n|r>>12);n=(r&4095)<<4;break;case 4:t+=o(n|r>>11);n=(r&2047)<<5;break;case 5:t+=o(n|r>>10);n=(r&1023)<<6;break;case 6:t+=o(n|r>>9);n=(r&511)<<7;break;case 7:t+=o(n|r>>8);n=(r&255)<<8;break;case 8:t+=o(n|r>>7);n=(r&127)<<9;break;case 9:t+=o(n|r>>6);n=(r&63)<<10;break;case 10:t+=o(n|r>>5);n=(r&31)<<11;break;case 11:t+=o(n|r>>4);n=(r&15)<<12;break;case 12:t+=o(n|r>>3);n=(r&7)<<13;break;case 13:t+=o(n|r>>2);n=(r&3)<<14;break;case 14:t+=o(n|r>>1);n=(r&1)<<15;break;case 15:t+=o(n|r);i=0;break}s++}return LZString.decompress(t)},compress:function(e){if(e==null)return"";var t,n,r={},i={},s="",o="",u="",a=2,f=3,l=2,c="",h=0,p=0,d,v=LZString._f;for(d=0;d<e.length;d+=1){s=e.charAt(d);if(!Object.prototype.hasOwnProperty.call(r,s)){r[s]=f++;i[s]=true}o=u+s;if(Object.prototype.hasOwnProperty.call(r,o)){u=o}else{if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<l;t++){h=h<<1;if(p==15){p=0;c+=v(h);h=0}else{p++}}n=u.charCodeAt(0);for(t=0;t<8;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}else{n=1;for(t=0;t<l;t++){h=h<<1|n;if(p==15){p=0;c+=v(h);h=0}else{p++}n=0}n=u.charCodeAt(0);for(t=0;t<16;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}delete i[u]}else{n=r[u];for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}r[o]=f++;u=String(s)}}if(u!==""){if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<l;t++){h=h<<1;if(p==15){p=0;c+=v(h);h=0}else{p++}}n=u.charCodeAt(0);for(t=0;t<8;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}else{n=1;for(t=0;t<l;t++){h=h<<1|n;if(p==15){p=0;c+=v(h);h=0}else{p++}n=0}n=u.charCodeAt(0);for(t=0;t<16;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}delete i[u]}else{n=r[u];for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}}n=2;for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}while(true){h=h<<1;if(p==15){c+=v(h);break}else p++}return c},decompress:function(e){if(e==null)return"";if(e=="")return null;var t=[],n,r=4,i=4,s=3,o="",u="",a,f,l,c,h,p,d,v=LZString._f,m={string:e,val:e.charCodeAt(0),position:32768,index:1};for(a=0;a<3;a+=1){t[a]=a}l=0;h=Math.pow(2,2);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}switch(n=l){case 0:l=0;h=Math.pow(2,8);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}d=v(l);break;case 1:l=0;h=Math.pow(2,16);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}d=v(l);break;case 2:return""}t[3]=d;f=u=d;while(true){if(m.index>m.string.length){return""}l=0;h=Math.pow(2,s);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}switch(d=l){case 0:l=0;h=Math.pow(2,8);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}t[i++]=v(l);d=i-1;r--;break;case 1:l=0;h=Math.pow(2,16);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}t[i++]=v(l);d=i-1;r--;break;case 2:return u}if(r==0){r=Math.pow(2,s);s++}if(t[d]){o=t[d]}else{if(d===i){o=f+f.charAt(0)}else{return null}}u+=o;t[i++]=f+o.charAt(0);r--;f=o;if(r==0){r=Math.pow(2,s);s++}}}};if(typeof module!=="undefined"&&module!=null){module.exports=LZString}
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
var saveAs=saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator)||function(e){"use strict";var t=e.document,n=function(){return e.URL||e.webkitURL||e},r=e.URL||e.webkitURL||e,i=t.createElementNS("http://www.w3.org/1999/xhtml","a"),s="download"in i,o=function(n){var r=t.createEvent("MouseEvents");r.initMouseEvent("click",true,false,e,0,0,0,0,0,false,false,false,false,0,null);n.dispatchEvent(r)},u=e.webkitRequestFileSystem,a=e.requestFileSystem||u||e.mozRequestFileSystem,f=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},l="application/octet-stream",c=0,h=[],p=function(){var e=h.length;while(e--){var t=h[e];if(typeof t==="string"){r.revokeObjectURL(t)}else{t.remove()}}h.length=0},d=function(e,t,n){t=[].concat(t);var r=t.length;while(r--){var i=e["on"+t[r]];if(typeof i==="function"){try{i.call(e,n||e)}catch(s){f(s)}}}},v=function(t,r){var f=this,p=t.type,v=false,m,g,y=function(){var e=n().createObjectURL(t);h.push(e);return e},b=function(){d(f,"writestart progress write writeend".split(" "))},w=function(){if(v||!m){m=y(t)}if(g){g.location.href=m}else{window.open(m,"_blank")}f.readyState=f.DONE;b()},E=function(e){return function(){if(f.readyState!==f.DONE){return e.apply(this,arguments)}}},S={create:true,exclusive:false},x;f.readyState=f.INIT;if(!r){r="download"}if(s){m=y(t);i.href=m;i.download=r;o(i);f.readyState=f.DONE;b();return}if(e.chrome&&p&&p!==l){x=t.slice||t.webkitSlice;t=x.call(t,0,t.size,l);v=true}if(u&&r!=="download"){r+=".download"}if(p===l||u){g=e}if(!a){w();return}c+=t.size;a(e.TEMPORARY,c,E(function(e){e.root.getDirectory("saved",S,E(function(e){var n=function(){e.getFile(r,S,E(function(e){e.createWriter(E(function(n){n.onwriteend=function(t){g.location.href=e.toURL();h.push(e);f.readyState=f.DONE;d(f,"writeend",t)};n.onerror=function(){var e=n.error;if(e.code!==e.ABORT_ERR){w()}};"writestart progress write abort".split(" ").forEach(function(e){n["on"+e]=f["on"+e]});n.write(t);f.abort=function(){n.abort();f.readyState=f.DONE};f.readyState=f.WRITING}),w)}),w)};e.getFile(r,{create:false},E(function(e){e.remove();n()}),E(function(e){if(e.code===e.NOT_FOUND_ERR){n()}else{w()}}))}),w)}),w)},m=v.prototype,g=function(e,t){return new v(e,t)};m.abort=function(){var e=this;e.readyState=e.DONE;d(e,"abort")};m.readyState=m.INIT=0;m.WRITING=1;m.DONE=2;m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null;e.addEventListener("unload",p,false);return g}(self)
/*! seedrandom.js v2.3.3 | (c) 2013 David Bau, all rights reserved. | Licensed under a BSD-style license */
!function(a,b,c,d,e,f,g,h,i){function j(a){var b,c=a.length,e=this,f=0,g=e.i=e.j=0,h=e.S=[];for(c||(a=[c++]);d>f;)h[f]=f++;for(f=0;d>f;f++)h[f]=h[g=r&g+a[f%c]+(b=h[f])],h[g]=b;(e.g=function(a){for(var b,c=0,f=e.i,g=e.j,h=e.S;a--;)b=h[f=r&f+1],c=c*d+h[r&(h[f]=h[g=r&g+b])+(h[g]=b)];return e.i=f,e.j=g,c})(d)}function k(a,b){var c,d=[],e=typeof a;if(b&&"object"==e)for(c in a)try{d.push(k(a[c],b-1))}catch(f){}return d.length?d:"string"==e?a:a+"\0"}function l(a,b){for(var c,d=a+"",e=0;e<d.length;)b[r&e]=r&(c^=19*b[r&e])+d.charCodeAt(e++);return n(b)}function m(c){try{return a.crypto.getRandomValues(c=new Uint8Array(d)),n(c)}catch(e){return[+new Date,a,(c=a.navigator)&&c.plugins,a.screen,n(b)]}}function n(a){return String.fromCharCode.apply(0,a)}var o=c.pow(d,e),p=c.pow(2,f),q=2*p,r=d-1,s=c["seed"+i]=function(a,f,g){var h=[],r=l(k(f?[a,n(b)]:null==a?m():a,3),h),s=new j(h);return l(n(s.S),b),(g||function(a,b,d){return d?(c[i]=a,b):a})(function(){for(var a=s.g(e),b=o,c=0;p>a;)a=(a+c)*d,b*=d,c=s.g(1);for(;a>=q;)a/=2,b/=2,c>>>=1;return(a+c)/b},r,this==c)};l(c[i](),b),g&&g.exports?g.exports=s:h&&h.amd&&h(function(){return s})}(this,[],Math,256,6,52,"object"==typeof module&&module,"function"==typeof define&&define,"random");
/*! console_hack.js | (c) 2015 Thomas Michael Edwards | Licensed under SugarCube's Simple BSD license */
!function(){for(var methods=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],length=methods.length,noop=function(){},console=window.console=window.console||{};length--;){var method=methods[length];console[method]||(console[method]=noop)}}();
}else{document.documentElement.setAttribute("data-init", "lacking");}
</script>
<style id="style-normalize" type="text/css">/*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}</style>
<style id="style-init-screen" type="text/css">@-webkit-keyframes init-loading-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes init-loading-spin{0%{-o-transform:rotate(0);transform:rotate(0)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes init-loading-spin{0%{-webkit-transform:rotate(0);-o-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}#init-screen{display:none;z-index:100000;position:fixed;top:0;left:0;height:100%;width:100%;font:28px/1 Helmet,Freesans,sans-serif;font-weight:700;color:#eee;background-color:#111;text-align:center}#init-screen>div{display:none;position:relative;margin:0 auto;max-width:1136px;top:25%}html[data-init=lacking] #init-screen,html[data-init=loading] #init-screen,html[data-init=no-js] #init-screen{display:block}html[data-init=lacking] #init-lacking,html[data-init=no-js] #init-no-js{display:block;padding:0 1em}html[data-init=no-js] #init-no-js{color:red}html[data-init=loading] #init-loading{display:block;border:24px solid transparent;border-radius:50%;border-top-color:#7f7f7f;border-bottom-color:#7f7f7f;width:100px;height:100px;-webkit-animation:init-loading-spin 2s linear infinite;-o-animation:init-loading-spin 2s linear infinite;animation:init-loading-spin 2s linear infinite}html[data-init=loading] #init-loading>div{text-indent:9999em;overflow:hidden;white-space:nowrap}html[data-init=loading] #passages,html[data-init=loading] #ui-bar{display:none}</style>
<style id="style-font" type="text/css">@font-face{font-family:tme-fa-icons;src:url(data:application/octet-stream;base64,d09GRgABAAAAACWoAA4AAAAAQhQAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABPUy8yAAABRAAAAEQAAABWPihI/2NtYXAAAAGIAAAAOgAAAUrQXRm3Y3Z0IAAAAcQAAAAKAAAACgAAAABmcGdtAAAB0AAABZQAAAtwiJCQWWdhc3AAAAdkAAAACAAAAAgAAAAQZ2x5ZgAAB2wAABjCAAAq+uJ4WNtoZWFkAAAgMAAAADQAAAA2BZlJs2hoZWEAACBkAAAAIAAAACQIJwQZaG10eAAAIIQAAABuAAABOPTeAABsb2NhAAAg9AAAAJ4AAACeojKW6m1heHAAACGUAAAAIAAAACAA6gvwbmFtZQAAIbQAAAGPAAAC/eLsyKlwb3N0AAAjRAAAAfwAAAM0412SIHByZXAAACVAAAAAZQAAAHvdawOFeJxjYGRWYZzAwMrAwVTFtIeBgaEHQjM+YDBkZGJgYGJgZWbACgLSXFMYHF4wvPBhDvqfxRDFHMQwDSjMCJIDANLeC6V4nGNgYGBmgGAZBkYGEHAB8hjBfBYGDSDNBqQZGZgYGF74/P8PUvCCAURLMELVAwEjG8OIBwC4Ywb6AAAAAAAAAAAAAAAAAAB4nK1WaXMTRxCd1WHLNj6CDxI2gVnGcox2VpjLCBDG7EoW4BzylexCjl1Ldu6LT/wG/ZpekVSRb/y0vB4d2GAnVVQoSv2m9+1M9+ueXpPQksReWI+k3HwpprY2aWTnSUg3bFqO4kPZ2QspU0z+LoiCaLXUvu04JCISgap1hSWC2PfI0iTjQ48yWrYlvWpSbulJd9kaD+qt+vbT0FGO3QklNZuhQ+uRLanCqBJFMu2RkjYtw9VfSVrh5yvMfNUMJYLoJJLGm2EMj+Rn44xWGa3GdhxFkU2WG0WKRDM8iCKPslpin1wxQUD5oBlSXvk0onyEH5EVe5TTCnHJdprf9yU/6R3OvyTieouyJQf+QHZkB3unK/ki0toK46adbEehivB0fSfEI5uT6p/sUV7TaOB2RaYnzQiWyleQWPkJZfYPyWrhfMqXPBrVkoOcCFovc2Jf8g60HkdMiWsmyILujk6IoO6XnKHYY/q4+OO9XSwXIQTIOJb1jkq4EEYpYbOaJG0EOYiSskWV1HpHTJzyOi3iLWG/Tu3oS2e0Sag7MZ6th46tnKjkeDSp00ymTu2k5tGUBlFKOhM85tcBlB/RJK+2sZrEyqNpbDNjJJFQoIVzaSqIZSeWNAXRPJrRm7thmmvXokWaPFDPPXpPb26Fmzs9p+3AP2v8Z3UqpoO9MJ2eDshKfJp2uUnRun56hn8m8UPWAiqRLTbDlMVDtn4H5eVjS47CawNs957zK+h99kTIpIH4G/AeL9UpBUyFmFVQC9201rUsy9RqVotUZOq7IU0rX9ZpAk05Dn1jX8Y4/q+ZGUtMCd/vxOnZEZeeufYlyDSH3GZdj+Z1arFdgM5sz+k0y/Z9nebYfqDTPNvzOh1ha+t0lO2HOi2w/UinY2wvaEGT7jsEchGBXMAGEoGwdRAI20sIhK1CIGwXEQjbIgJhu4RA2H6MQNguIxC2l7Wsmn4qaRw7E8sARYgDoznuyGVuKldTyaUSrotGpzbkKXKrpKJ4Vv0rA/3ikTesgbVAukTW/IpJrnxUleOPrmh508S5Ao5Vf3tzXJ8TD2W/WPhT8L/amqqkV6x5ZHIVeSPQk+NE1yYVj67p8rmqR9f/i4oOa4F+A6UQC0VZlg2+mZDwUafTUA1c5RAzGzMP1/W6Zc3P4fybGCEL6H78NxQaC9yDTllJWe1gr9XXj2W5twflsCdYkmK+zOtb4YuMzEr7RWYpez7yecAVMCqVYasNXK3gzXsS85DpTfJMELcVZYOkjceZILGBYx4wb76TICRMXbWB2imcsIG8YMwp2O+EQ1RvlOVwe6F9Ho2Uf2tX7MgZFU0Q+G32Rtjrs1DyW6yBhCe/1NdAVSFNxbipgEsj5YZq8GFcrdtGMk6gr6jYDcuyig8fR9x3So5lIPlIEatHRz+tvUKd1Ln9yihu3zv9CIJBaWL+9r6Z4qCUd7WSZVZtA1O3GpVT15rDxasO3c2j7nvH2Sdy1jTddE/c9L6mVbeDg7lZEO3bHJSlTC6o68MOG6jLzaXQ6mVckt52DzAsMKDfoRUb/1f3cfg8V6oKo+NIvZ2oH6PPYgzyDzh/R/UF6OcxTLmGlOd7lxOfbtzD2TJdxV2sn+LfwKy15mbpGnBD0w2Yh6xaHbrKDXynBjo90tyO9BDwse4K8QBgE8Bi8InuWsbzKYDxfMYcH+Bz5jBoMofBFnMYbDNnDWCHOQx2mcNgjzkMvmDOOsCXzGEQModBxBwGT5gTADxlDoOvmMPga+Yw+IY59wG+ZQ6DmDkMEuYw2Nd0ayhzixd0F6htUBXowPQTFvewONRUGbK/44Vhf28Qs38wiKk/aro9pP7EC0P92SCm/mIQU3/VdGdI/Y0Xhvq7QUz9wyCmPtMvxnKZwV9GvkuFA8ouNp/z98T7B8IaQLYAAQAB//8AD3icrToNcBzVefe9/b3dvd29u909/dyd7ke6k86yLEunOyHJsrCxJWyJGmEcLMDYxBhHNsZQBzOAkjQmFDrGIq5gHEIcCILOAGZq3IQO04RkIGkgaUMKMbQznSlJW0wgJtOQHxRr1e+93TvJwq7JTD3y2/f//bzvfX/vAhAIzL3KPcYNBFIB8UR9EJYuAcuAqGNbOiwDSczkuorlaJ6WTeVSRwMIDveY8aN20GztjzMhW4P2H+kNUPM5NaVNQE0K3tWM77vv8rJqgnT33VJE4WWIfd/QbKHZjcXcZiFAqjCDgUJA/mZTWOIIwi0vAwNiUjkW9THIZs6DAbnj6ffGP/P+0y2vv+5SXGLKuXHJPJH92c+yT7x3883wnI9W/DxI4T9+bm7uOL+MUwNywAg0BJYFQgNKa2NDzFBEjqeM0SFXLHU4YKe7yjFoSmdEKWw5nemOUj5czMXCliilM7lyuFgqp3HaDf1j/fhH+s6cfm4MEpA8c0BSQBO5CUkD5fJi05kDjSUoNnETTUUSXtpPVm0aGHDdmV0nNkPiMUWeHZMVRSZPSlp0dqypCKVG8iT9IK5AEeamyZGAjecW5tm5SSBm8ojiSqBsYoXDTRtuymw13V8axjB+p2EPlsMGcRzTTRkGOLRpmk/AzSZ+A97ecx+QN8g9gUbc26F7N+GJiN5pLGMA8hUo7EQcHI455A0PwrS3I37N+bZhTE8bex1aeeIJ4+MTjTY6gcH+iIvgGWQRdh2TR9sS81kspCzytguLfBcyuBOLXuhwYnZnh8NFUs6plLPLScGpWBKwkYztwsop7Hie9r7rYK/9brWXTg9U+RiBX+GJiyc0rgIv7UNJe3vPjrFdyZOV/byNUkyW/0AuIi/h+h6U5a64SmW5ieGcya2AYimG+EUtnZN08ImgveV+KOYykiiJVMrbkI+dHUkC9+nyPUFdD94j639r1uTq7FiSNrR1hXS8uLbGapYUSbpaJvzmp5aODbU9iJNBU1gJa5LFTCqihNpDigmWWtc2GjUy7Y2m3hHk14qmPJXp2cTInZudO85dhzw2AuXAJQHl+Yt7l0RVjkO8u4q5JZARE2A5yNxStNgGWcQSj7izA1HucCgJOsRsb7xYWgn9XAwvRqaN4HAS4ENF3kXFFovJ/muW3zsYDK3jxaCQbOouOPXZPmBDNZG4krS0N2/9wakf7hHv+IcPX/jcaGWZAp9fvrFtv66UeSlXn4zYdZo5kLNwIJJRTbEu3jz62Zf37Xv5l7RAeugZfAQ7kJ5koA3PoJB1eP8MpHRVWqpygyITpiKz4DCoHMENlun+wrDA0bNZ9jmJZdZwhhx9UnewMKztg2yAlie9j6O7Lzrks7tYdRdOO4u/FJ9e5G93RyFTJ1f5G17IZDs7z25uEfuFBYwlvYpUUuTnKJO6umg5IymD88yGGxbycjN2JOkIVk6wUoEzm/0O5T/Owb92Jg8NyL/6qFrl30IZ5nSgMp3nch7DkvOMCaMeoQ1U4JZxQncenmAMmcAei/S7V9CvAccW8mczwtMCceSQ8nwhXWuKAeQPJbRCc9RnhoSyhvBL+WgxTzsk0Y567IFj+35wa4Xq7ykS5YIm7UIdq4iCfKcsiIoSvFFWONUnFovZoXHKhXE69R9hTOIEgZPcJ0VZRrx+i3j9hhtFPqQDnYjX8uaEpS2+F4twiVkOylSJAwfvBZO3XBnoTaEHtltSWAGKIEl3SJIQ1CRESIRnLFtJRc88GckEbQuOBTO5zBXziL0JIPKiyMtzggwiMc+czmbDEbDMbJaLhC3LPzPuFOKaD6zEM+tt15gNxTPLIg5dvglCfGmbmakYmqmKsEfRVOWWAXjqvEzVeamT6botq9321Vu2rIb7KOrufmZ24LWmoiI3yspJJ65e704JprBSFGH3pxXLhAQe9fBzbM1rq7YAm1dsctvZSiqu8G94rxwS/LQ7JYorRR0XXq/GmSh4dJADKAsSk70ajQ8gHdE0MhzVjOCbVDSvKINd1PhKVN+fgMTG2zYCvIaq+V2mmsNTP36IRLD6xO7ejWTDisfc7zCVD6tQW+/eMTW1Y3fSt20foe+hBZpQ3zfGfH3vyzmCZNvHFoJFVPrRjj7m6I26M3r7KHQxgD5c2H/4tQdIeJLJ+yQDvTsZOwv4jYfJQxVaxxmtKtNTTVaQnRmS6kkWvfBoNvCeIT55jt41PJZwpg3YYeJYGK+dppgK/sF+R/8ggZIOBlnyNoK/qpwokLZ6uCFRKCTKV8HeGaYksPg2Xj/3fyQZb6dhGWv2QLLQU4DW7lZwf77Hw+vb3AjzexKIVywkEXoGlB1JUqr4FW3A7BZlDzgzhZ5W0tyfI1da7mmn13JvsZOFxLuJIRsmLXJVskByA41iu/uvSds9bWOnPZQ4lSgANm+xqQ6gMPlGH2YR79rSDIXLXQBujHZSxkCpSIeynwCdNxEFJ2HVmSDaFPxQYoIN2BfCM8E6zTCu66VDSQ97KkPfIa8i7nGUITNAZagDhYFJjeg5rXh+bcBuYamT/JWmRVE8Iopeb/3ud1ZdSIs4TkQLcaogJ63Z5dGUxEfefz8qSKko+Qm2PB/ZgyEEMngmjkjovYB0GBog+n9COzD7MiQ73pfOA5S8NLseIst+QWbPC9y/J8dRv7QFliCNWcnzAYlI3fE8hdNVbBPY1WEeZxm8m5mKOdypQRG1qhiRgQBnZbr7N20qT1ipoPsLVYWEGq8hE3BoLPn2tV8PhWVe0WTB4nIN3WMD7cmIiDZEhaSSROulWMbk2+sX4LIs0Iq4NNdUfV3mDeqCbaEOligmbYSFCaU0VRVULrhTKoKlIMubNvV3ZyyOByWMilXkBpNjcIjihTjBrwzF/bmKF1iMJNsHxrobcnxElDVF0C3u69fevP5txIsEcUrVZyR96DPqiI/C+zGTp0uZGkXVP6PG1RncET7Ey/eKjnX885QeWw83krsCIVyvMp8TD9P3rEvMFUkFZxS6Rw25ytWQJ/52/tqLyQSDrc7Dpiq/H2XDgYsVBgjnK7BF95EwLKLNKLh0bg5x74VXPNwJO1fq7raB588j7pbhat78pDKjPE1td1Jl6Hhn8Q73LdISsCrrgwuijljQ28Tinnavx+Xu9ap6jYqn2QzNaly7RoVJ99MoBl/DvmtU1X0Lu3FCnO37XXKEW832Nai8BYnDKKvIF92W3F9dotK94ahCNyJPuW+5b2L1WrQ2X6fSc1TBejLg77uvsm8FX2b1ghWk6cbjuB1FUIVm9y0f6aMKfMbdhjshNGihFKgIgE7044ZvkbXz+zbh3chXN/f35Z6mOyF2b/m7H6V7HVV3XYOYtiDOig/J25bh+xPuAPMdxRPRc8V1YU8Z2mEv9OIO2O6DTg8Wtt2C3+lCcjBRmEaNVbDhi0nLnUK1ttvqdVpsexruQ93WGnf3T9s47N+te7nN5FeohRGeChUfIvZx5htAPYTNjQl/ea/tTlkW7LZ7nIK3dyNsGUwWpq0+a4k/ALvozB5nurkCqwthUdrq5mnzBD/tu5rpfPVYuC6L0VZwnMfd/YnGxgTc97jjFNjGFvRQ6iyrYPfZjyPVyQJM233YRF5YVb1xgLzjwVMX3NOwZ/K7wtJZx4W8pGRNNzf4ZOBeCKgPCxuKcUYmxQNycbjP5wGlEJGk8OZc369tR3gtaZ+X6CbmVkIONRVJcugpluk1TQL1Fqmfy1ELVi4hYy1zJhYNj4zu7RkfbuebN17fv+q2Fj4sDgtE7Hv2uk89uneIH7j9yNWjR1YMmUvJSzO6s9QcGWkbHt83PtzW0yWCMMLr4roNcMm+o88e3XdJ/0VDkWiFDxSv5YhXq8d3nVAryjjtoDXp7Ojn2gg6ijGHIUxDpQZ0Y2lQym2+5NZHN219to8XhsUw33Lb6p6dG9DVGN598/bmkXA0NoPeR2t4qO/h0U8d3bcKtmB5yeilos6PCCB29fgINjeNmEsdfaYmGhm6qB9RrPhEx7mrEbfGwCDauZXNJo09wLJ1oAhSe1NxWkUDKKJofMqeE+szt8S4K9JYmjbLXRRtylOU1vWN//mVy4/0DVGNqM9QJT7SvL287ot5MSZoGC/oyHTWO7p3vdd5s6RB439/5fKH6aIaEDh46AVkpMqWo1YdaWpe1690hzT4e79jxGuLvD+R0iUwuiJ+TLUM4+yrA8aAdsVAsX1JFgMsTkCF4ceBdtgLZ8oXaENnPpfPipLA6A57nn4+XI1hUbCoYmig1KP5pH44Kybnq4cUyatKivvTmXpeOC7y8J4il3yHncWVz+SDrc5zTqucPyYro3Af7XP30/I8ddJxsQAgXIFbz37QdsmqNhJl0K6145C0rkWzExAX8aM3sDpwYyA8oF83PNBXWu7xRPQMIT1E6syw7M4F2tFwOmyhVKQ7+uH/lz9DribLBF4jsuze94lYBc+7LzLOXMw4c+66u52EZz/QLEWxyA0XZFuA9+OVUfSTwyzWCw0o3a0Jx9BYTrKp2AZiEi9qGSs6OFhZkPboRDXesZKpbcd3UOjV8dMgNNQhr1pJh0Qy5petVIQ48Zq1KefMj7zIhluf3pQeBs5JfUuJMGcgHFRik16gP1mzHX2EmroaYhmVysETLOo54aSGU/gHzbEwdRvCMXuGhUczHj3HkZ42Rk9LYIDS07c8YRuqSBg91Pmnwo8VghFR2Y9oKTmxziSwi0HTN2I1cMvT3E7Fezk/Pae1UnYyUwqdRnqCNZPoXSJSk6hxGWmRBKqBSMqyTP97/wmaJcQCGpqbG5Iw6vhEtHpEVWihepULpFG3rqG0rOha2qTxJIC0YOSYFjrxEtP8nlSlIxvu7PLcRKmS76mk04Sq0HoTqJ04CcfcK+DDIU34mhCX/dByaAiDy58ibicVeRdNJrNyezI2G/ESlUKsZDxiOtLJk/ChXCc9Imp+1nO2xL6QZIkkWiizM7SHIF9q9K8ZpQDx8zOjgWaMzORvdrSGPJ2sEzRYZer9O2gmWD4zSTr6sSuH8Uc/IGjmyLIMOHUV0G48840967ixy2v6zIhcU+pr3bDj9u0bc1xfqUbO9sUuH3O/iqEbFPqaPbOBZuFTO57rx7mxvnDL7avRFLah/ei55LZCpKddjqz4OxhyH6YRLuzA0rcfY5yC8rQTcb08JdLYleZW8TZ0lGgSCyVfQoQtRDiPV6BqKLryzL7kqRmkuoGdE5UzlKWy39mJQlU1OChf1KrEHOYcsdMhvaO3j5JN+zZBXJZ2Kmq0WRSMDSFJGqmtC0q8eZesmfWxPxNNca3DC3KzYsg7MBBXhJ2yHmvy5sojNXVBmQvfhUdoxJ0NgiENWTzfqwd3SOjC927ceNvGjbfTUTNp13eIumhvAKEvJA/HTUW6Maj1CeJAUtBFrcOI1xugSWxubV1qqaRJ1gZvqiHLbKqwOo5TR9hELw7/iBsjL/t6WXl+SWN9VOO5RfnTtJcwreTFY35bWthGB+bMB+yOcGEDg4bztxbkUR0wh1h2kJWgV0awMR+Hjvn5mlrmu9BMCMpYsZynmQC8KR2xco4maZIg5jN5CU86ViJ/s27nzqlxgFc6167fuXP92s5XYOdDO8j4pYNYw16IjR8eH79U0ra3Y6V9uyat20l2P7AbsKpjJ81Tzs39nt9PXgqYeL9LNB+Yi9uMN1BEZ0knnvijDiZLEDg6dJ30NuA9oQEVh9U0uk/kgO8A+R94pvWy8YveWn0ZWbfmLepJXdqz5Z5B94qhu7d2k75r7l0Lx2gVtvTMr6FXgDY7p56d6qSNS+/e0ke6r//CQ1/YXiTdW++u+FK/529HfC3klvzNhK3Te4txIUFlkuQ8tIjguXrUG6WAPWgMsIcDF664d3v3DHXwhQ07YMul2I9QDvtQXz+bokoej3uUo5mt1Qi7f/m58pGoIAyavsnnFiUl8cbhKTpRmI+CKw9Y1oKc5GvZZJCT6kWJcCHNzzDS3KTQKEocr/6Fe1GoUf+1rq/QG/W/hs9goz8E649Xc5M6HxXjAnDV9OT9spBFuwOC26Prv2bzQ3RhCHfwaYpW8+LxqOzlYOZR7/Kf/RbmXMktCzAr3jWP/Kqt5KUqZDq4uTqyBbYGfL17HcuL19KcjykyePSoAP2bNgILH1qOXXFwA9l471P3bOIvOwRXL8j+k0OjB6cPjrLCfe2sXP/824QcsAMZlOmGWiMo0rwb4K1qo+mH/LkBVlXdA+cFXFFWvz0//AXvbZ6+ac3GoyzHHvXfzCqvNILfLi9qV7KBJ/03OPbql/A+XlcDa3g9C1/rnPPU/XzkR4E3q/4p6kHES6V3vVx1M7x3EG4RnpwfhuT9B8mTF4BG6w/vZp7SbtoL4oJBkCuYe2+LL3GT6CtdzGKjNas6FGaHETyqOIeljCSdy4azYTwkLxFIL08OHSKaM+7sonl9vERpGguhHaS5bUgz24xu3ETTPsVKqntkIZfpqR1MdBfQKd6hmiFHviU1QZ260MQ2FSOcbfDmVoyFeHkb9rq/db9KFWsP6uutqz6LgZW6R+JrIjp86Gp6jSXL+7RoUv38yjEracH0NiVpKdu2ISBl27QDRdTKAT9WHoc/IL/p7w4sptcdmtpFR6IcZRnNXDnaT909x7Ykjj6PwmlFdP9FMuWgQvb8nAiKpHB7iS4/r+pk678LRCWOGpq9QwfOlOGlbpDkEPwThngKL7puibAY5LvMl+ZQQ8Yx4mxF/wZjkGJ7a3NjKl5jyjiJ/hAhLzVVExN+9qMpZsAyWImhu/eF2NlfcmS6bxq6lNlO9CZvxpjon/G7R5k1SqVwuFwOv3HTTZn0TTelSQs2wtjpPkNH8D/RH++b3mkosx0KLkzSlfi92qSrzPKX2arMTe692ChjJ7T5I75t3I487EIe5jXKQ6pg6Q83qs/lEn3noSFynmb4aOrBF9sEoBuHhKFYcL11up41emofLCQGE60wVdeDClSvn5qqM41Go7t+iuWUHqzrNrOGWTsFst5TtwLXXPk0Syc9fSX2rsBFmzadY6C/Fge8d+e5uXHkfyiQRc6vwTu2Ylkhz95Fq2/8+YVv/CxSqb7xxyqhDjDBRxFBxcQnSYzeBfrYNqGJjej4TLDfWEywII42hqZ+/BB/6I2DkCn0WS9uv3PD4Z0DpG/3oemDe7u5NS/aMOWtol60t2qCusYTSi19uHn1iHiQOpz2i2v6xx/4xqE9PfyqHQ+N3Ln9RftsmoxADcYAyvMt9Y73lr7wdwTUmb8g/u53GOaw6pPizJC9MJrEj7noG9sG1CNhmWN2BcF2dpRzGBfz5XrojEWZRxuj6aCYY0tiLJOTMmK2uJJQjxj/8hjKEB1iGHCj4JTpxczQzEtehAevG+5pUO12twtCjfG4I979yJB4a7RlZbDdVGV1OMgDQPZQY+ERm1wqiVyYJwJHMrGaP+o9YKbUlE2ApL6YEiyylNT9ESff74qtvCgqNSZcBVOa+2Hr9q9E70rVikGTcxRJ4BSQa6ImzpQIEXk+OFbqhvQRQ4souDWotqAiL2Xqm+AZ/Yz0kXcCOnvfqg1779vzOXtqtvPMii9Ig5+dwj87Kf4bQ6EJfdRt4PyQZYFY0/NXERbE5vPzi+As2njhToFqfp7h6ufXYTFiZ6MCryyG/xQX5qIBFddLfr6b+SYsHc3P1ocikRD5rxCMuNslxeBKuiZjzQpUY6kFvwNgPtyioHRxkEr9fv+HE5AwHFc9q0neOXOa/kiAi9ByQX3et1fZb2+q7yCL914QN5y1GVt/DOVaR29JPCECXV9iGaI84A7sQ9W3Y4dLZe4vVR1Mxd3Hc7rq7lNVOKjqHM9xqmiceVWXNTgoiO6fswpN0R/EfnefyHtnMvcsdw1nzMOJiSzGpQ+SPmclxmVRqlVM0HG5wNFSQYAIRhjE3ZDTsobwJbifVegTxj7sx7mCRwvp5XSWh6/QYs/TwjyMahKsVCYZVaeECMTR56MplPyzCfrSPO/dL0m8RwvpQ1oS56aF7i/58Mpn0eOHaKxcTNGd84cLd4oCvXPu3B+4a8kPUA7rmSzJ7E3Zy7OzuJEm/Mt+7Eh/pyDPMx7xF7luuh/CY9hDe4WZYLqvW+YhFlJiWX1PO0aOB6L0t3AVOUK7V/XSqP8Dx/CavHCY8erwC3jhyKHZR2nu9wXvpz4vKN4dwOIA22sZ/S1RTbhyBxbvF/XeXzEQpfEUTa0hLTTE+RigN9vzQhBp0RzT5OUaKazwlhEU8u0fx8D9XmGdwVmmZmpavDGuichhJJUz1nn5pp9yj5H3GG7DgZtovmnn5YNFiiT/JyIZqw6Uvd+i0TRIFwumFw7SVEg/TYvQDM/8hE9O4uTWEVlECuyU2tLW1oKK3jIk+bItDxy6TZKw36mttdZgKDxo1fIRzrFMSbrt0J/Cl8KVh1OcozuqGUyO7RxLBk3UrA6XfmDTF97qwAErpOl655GnjnTqOidyIQsHO08G/hcLt/j/AAB4nGNgZGBgAOLaW41M8fw2Xxm4mV8ARRguss1QhNC5H/9//Z/FUsEcBORyMDCBRAFTFwxveJxjYGRgYA76n8UQxVLGwPD/FUsFA1AEBfgBAHyYBUh4nGN+wcDAvACCWfSBNIgviMBM1kA6koGBMRWVBqsDYqYmiF4wHQkxg+kUBMPVWEP0gTDYvBdoahZAzYxEY0ciuWUBFjkoZimDYLC8IKpehmsQccYvSGYgYZB7YBhFL5o8cxTQjDUI/wIArpclrwAAAAAAAAA6AIYA3AEKAUgBgAGgAfoCYgKqAwIDOgOGA9wEQAR4BLYFAgU8BZoFzAYMBlIGmga6BtgG+AcYB0QHcAecB8gIAAg2CG4IpgjyCUAJrAo0CtALOAueDAoMYA0ADVANjg3mDiQOjg7GDvgPOA+ED84QPBB2EN4RNhGgEfISchKoEsgS6BMGEz4TXhOSE8QT+BQsFGIUiBTWFX0AAAABAAAATgBuAAYAAAAAAAIAAAAQAHMAAAAiC3AAAAAAeJx1kctOGzEUhn9DoIKgLloJdcdZIRDK5CKhSqyoogJrhLJDwgyeSzpjRx4HlGfgLcoz8Dp9j+76Z2KhqFJmZM93Ph/bxx4AX/AHCqvnnG3FCgeMVryFT/gReZv+JnKHfBd5B108RN6l/xV5H2d4idzFV/zmCqqzx2iK98gK39RR5C18Vt8jb9P/jNwh30fewaGaR96lf428j4l6i9zFsfo7drOFL/MiyMn4VEaD4bk8LsRRlVZXouehcL6RS8mcDaaqXJK6OtSml+lemTrb3Jp8Xmm/rtZ5YnxTOivDZLCur401XgfztNytec5HIWSSeVfLVdxHZt5NTRqSIoTZRb+/vj/GcJhhAY8SOQoECE5oT/kdYYAhf4zgkRnCzFVWCQuNikZjzhlFO9IwvmTLGFlaw4yKnCBlX9PUdD2Oa/Zlay1n3dLmXKei9xuzNvkJ7XLvso2F9SaselP2Na1tZ+i2wqePszV4ZhUj2sBZy1P4tmrB1X/nEd7XcmxKk9In7a0F2gv0+W44/z/KQo7lAHicbZLnlpswEIW5Bgy4bLLpvfeE9N57z76DLARWEJKOEEucpw8CO/kTncOdT6PhnlHxRt4wJt7/x47nYQQfAUKMESFGggmmmGGOLezBXmxjH/bjAA7iEA7jCI7iGI7jBE7iFE7jDM7iHM7jAi7iEi7jCq7iGq7jBlLcxC3cxh3cxT3cxwM8xCM8xhM8xTM8xwu8xCu8xhu8xTu8xwd8xCd8xhd8xTd8xw/sBLUlZuIkZZW2q0hzahvDRqocUyIpE4EWTR1WXDZ1sGRCz5yklBsqWBZwmauZk01mTqxl0nIlUyLs9r/Zej35m4kFl2XKftlAKFomTlKlmfQ1l74lRdB9dbxQqqyIKbc2MPQZGqbFKsqVaYnJ4ky1Ms24iQXLrYPE8GLZ07jRfaIvcf5JX+NoMhQ5jLoqFwenBS8Gpw7WTh05py6MaOtT2ibEGNXWKW1Da0i9nPY6dNe7CEWy7pc+5EJpvfJVnvtUFUHFZBPWS2LYxKqiECztVpINypAuGS2nvQ6Gs+H0hsk0U3ZznDETguua1/MNpLvMWH/RFGEuuobCihScxqS2zPC6jH4rVaVcxn1UjQ1yJW1QK2MTJ6nrPOqp0d3Vk1WoSVOz7p0oHeWdTbpoh5i3sVWpezp23AGTWch+Mmonu0o0Vb+l6RqdabLmRnveH9ru7j54nGPw3sFwIihiIyNjX+QGxp0cDBwMyQUbGVidNjIwaEFoDhR6JwMDAycyi5nBZaMKY0dgxAaHjoiNzCkuG9VAvF0cDQyMLA4dySERICWRQLCRgUdrB+P/1g0svRuZGFwAB9MiuAAAAA==) format('woff')}</style>
<style id="style-core" type="text/css">html{font:16px/1 Helmet,Freesans,sans-serif}#store-area,tw-storydata{display:none!important;z-index:0}.no-transition{-o-transition:none!important;transition:none!important}:focus{outline:thin dotted}:disabled{cursor:not-allowed!important}body{color:#eee;background-color:#111}a{cursor:pointer;color:#68d;text-decoration:none;-o-transition-duration:.2s;transition-duration:.2s}a:hover{color:#8af;text-decoration:underline}a.link-broken{color:#c22}a.link-broken:hover{color:#e44}span.link-disabled{color:#aaa}area{cursor:pointer}button{cursor:pointer;color:#eee;background-color:#35a;border:1px solid #57c;line-height:normal;padding:.4em;-o-transition-duration:.2s;transition-duration:.2s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}button:hover{background-color:#57c;border-color:#79e}button:disabled{background-color:#444;border:1px solid #666}input,select,textarea{color:#eee;background-color:transparent;border:1px solid #444;padding:.4em}select{padding:.34em .4em}input[type=text]{min-width:18em}textarea{min-width:30em}input[type=checkbox],input[type=file],input[type=radio],select{cursor:pointer}input:not(:disabled):focus,input:not(:disabled):hover,select:not(:disabled):focus,select:not(:disabled):hover,textarea:not(:disabled):focus,textarea:not(:disabled):hover{background-color:#333;border-color:#eee}hr{display:block;height:1px;border:none;border-top:1px solid #eee;margin:1em 0;padding:0}textarea{resize:vertical}audio,canvas,progress,video{max-width:100%;vertical-align:middle}.error-view{background-color:#511;border-left:.5em solid #c22;display:inline-block;margin:.1em;padding:0 .25em;position:relative}.error-view>.error-toggle{background-color:transparent;border:none;line-height:inherit;left:0;padding:0;position:absolute;top:0;width:1.875em}.error-view>.error{display:inline-block;margin-left:1.75em}.error-view>.error-source[hidden]{display:none}.error-view>.error-source:not([hidden]){display:block;margin:0 0 .25em;padding:.25em;background-color:rgba(0,0,0,.2)}.highlight,.marked{color:#ff0;font-weight:700;font-style:italic}.nobr{white-space:nowrap}.error-view>.error-toggle:before,.error-view>.error:before,[data-icon-after]:after,[data-icon-before]:before,[data-icon]:before,a.link-external:after{font-family:tme-fa-icons;font-style:normal;font-weight:400;font-variant:normal;text-transform:none;line-height:1;speak:none}[data-icon]:before{content:attr(data-icon)}[data-icon-before]:before{content:attr(data-icon-before) "\00a0"}[data-icon-after]:after{content:"\00a0" attr(data-icon-after)}.error-view>.error-toggle:before{content:"\e81a"}.error-view>.error-toggle.enabled:before{content:"\e818"}.error-view>.error:before{content:"\e80d\00a0\00a0"}a.link-external:after{content:"\00a0\e80e"}</style>
<style id="style-core-display" type="text/css">#story{z-index:10;margin:2.5em;-o-transition:margin-left .2s ease-in;transition:margin-left .2s ease-in}@media screen and (max-width:1136px){#story{margin-right:1.5em}}#passages{max-width:54em;margin:0 auto}</style>
<style id="style-core-passage" type="text/css">.passage{line-height:1.75;text-align:left;-o-transition:opacity .4s ease-in;transition:opacity .4s ease-in}.passage-in{opacity:0}.passage ol,.passage ul{margin-left:.5em;padding-left:1.5em}.passage table{margin:1em 0;border-collapse:collapse;font-size:100%}.passage caption,.passage td,.passage th,.passage tr{padding:3px}</style>
<style id="style-core-macro" type="text/css">.macro-linkappend-insert,.macro-linkprepend-insert,.macro-linkreplace-insert,.macro-repeat-insert,.macro-timed-insert{-o-transition:opacity .4s ease-in;transition:opacity .4s ease-in}.macro-linkappend-in,.macro-linkprepend-in,.macro-linkreplace-in,.macro-repeat-in,.macro-timed-in{opacity:0}</style>
<style id="style-ui-dialog" type="text/css">html[data-dialog] body{overflow:hidden}#ui-overlay.open{visibility:visible;-o-transition:opacity .2s ease-in;transition:opacity .2s ease-in}#ui-overlay:not(.open){-o-transition:visibility .2s step-end,opacity .2s ease-in;transition:visibility .2s step-end,opacity .2s ease-in}#ui-overlay{visibility:hidden;opacity:0;z-index:100000;position:fixed;top:0;left:0;height:100%;width:100%}#ui-dialog.open{display:block;-o-transition:opacity .2s ease-in;transition:opacity .2s ease-in}#ui-dialog{display:none;opacity:0;z-index:100100;position:fixed;top:50px;margin:0;padding:0}#ui-dialog-titlebar{position:relative}#ui-dialog-close{display:block;position:absolute;right:0;top:0;white-space:nowrap}#ui-dialog-body{overflow:auto;min-width:280px;height:90%;height:calc(100% - 2.1em - 34px)}#ui-overlay{background-color:#000}#ui-overlay.open{opacity:.8}#ui-dialog{max-width:66em}#ui-dialog.open{opacity:1}#ui-dialog-titlebar{background-color:#444;min-height:24px}#ui-dialog-title{margin:0;padding:.2em 3.5em .2em .5em;font-size:1.5em;text-align:center;text-transform:uppercase}#ui-dialog-close{cursor:pointer;font-size:120%;margin:0;padding:0;width:3.6em;height:92%;background-color:transparent;border:1px solid transparent;-o-transition-duration:.2s;transition-duration:.2s}#ui-dialog-close:hover{background-color:#b44;border-color:#d66}#ui-dialog-body{background-color:#111;border:1px solid #444;text-align:left;line-height:1.5;padding:1em}#ui-dialog-body>:first-child{margin-top:0}#ui-dialog-body hr{background-color:#444}#ui-dialog-body ul.buttons{margin:0;padding:0;list-style:none}#ui-dialog-body ul.buttons li{display:inline-block;margin:0;padding:.4em .4em 0 0}#ui-dialog-body ul.buttons>li+li>button{margin-left:1em}#ui-dialog-close{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#ui-dialog-close{font-family:tme-fa-icons;font-style:normal;font-weight:400;font-variant:normal;text-transform:none;line-height:1;speak:none}</style>
<style id="style-ui" type="text/css">#ui-dialog-body.settings [id|=setting-body]{display:table;width:100%}#ui-dialog-body.settings [id|=setting-label]{display:table-cell;padding:.4em 2em .4em 0}#ui-dialog-body.settings [id|=setting-label]+div{display:table-cell;min-width:8em;text-align:right;vertical-align:middle;white-space:nowrap}#ui-dialog-body.list{padding:0;min-width:140px}#ui-dialog-body.list ul{margin:0;padding:0;list-style:none;border:1px solid transparent}#ui-dialog-body.list li{margin:0}#ui-dialog-body.list li:not(:first-child){border-top:1px solid #444}#ui-dialog-body.list li a{display:block;padding:.25em .75em;border:1px solid transparent;color:#eee;text-decoration:none}#ui-dialog-body.list li a:hover{background-color:#333;border-color:#eee}#ui-dialog-body.saves{padding:0 0 1px}#ui-dialog-body.saves>:not(:first-child){border-top:1px solid #444}#ui-dialog-body.saves table{border-spacing:0;min-width:340px;width:100%}#ui-dialog-body.saves tr:not(:first-child){border-top:1px solid #444}#ui-dialog-body.saves td{padding:.33em .33em}#ui-dialog-body.saves td:first-child{min-width:1.5em;text-align:center}#ui-dialog-body.saves td:nth-child(3){line-height:1.2}#ui-dialog-body.saves td:last-child{text-align:right}#ui-dialog-body.saves .empty{color:#999}#ui-dialog-body.saves .datestamp{font-size:75%}#ui-dialog-body.saves ul.buttons li{padding:.4em}#ui-dialog-body.saves ul.buttons>li+li>button{margin-left:.2em}#ui-dialog-body.saves ul.buttons li:last-child{float:right}#ui-dialog-body.settings div[id|=header-body]{margin:1em 0}#ui-dialog-body.settings div[id|=header-body]:first-child{margin-top:0}#ui-dialog-body.settings div[id|=header-body]:not(:first-child){border-top:1px solid #444;padding-top:1em}#ui-dialog-body.settings div[id|=header-body]>*{margin:0}#ui-dialog-body.settings h2[id|=header-heading]{font-size:1.375em}#ui-dialog-body.settings p[id|=header-label]{font-size:87.5%}#ui-dialog-body.settings div[id|=setting-body]+div[id|=setting-body]{margin:.5em 0}#ui-dialog-body.settings [id|=setting-control]{white-space:nowrap}#ui-dialog-body.settings button[id|=setting-control]{color:#eee;background-color:transparent;border:1px solid #444;padding:.4em}#ui-dialog-body.settings button[id|=setting-control]:hover{background-color:#333;border-color:#eee}#ui-dialog-body.settings button[id|=setting-control].enabled{background-color:#282;border-color:#4a4}#ui-dialog-body.settings button[id|=setting-control].enabled:hover{background-color:#4a4;border-color:#6c6}#ui-dialog-body.share{min-width:140px}#ui-dialog-body.list a,#ui-dialog-body.settings span[id|=setting-input]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#ui-dialog-body.saves button[id=saves-clear]:before,#ui-dialog-body.saves button[id=saves-export]:before,#ui-dialog-body.saves button[id=saves-import]:before,#ui-dialog-body.settings button[id|=setting-control].enabled:after,#ui-dialog-body.settings button[id|=setting-control]:after{font-family:tme-fa-icons;font-style:normal;font-weight:400;font-variant:normal;text-transform:none;line-height:1;speak:none}#ui-dialog-body.saves button[id=saves-export]:before{content:"\e829\00a0"}#ui-dialog-body.saves button[id=saves-import]:before{content:"\e82a\00a0"}#ui-dialog-body.saves button[id=saves-clear]:before{content:"\e827\00a0"}#ui-dialog-body.settings button[id|=setting-control]:after{content:"\00a0\00a0\e830"}#ui-dialog-body.settings button[id|=setting-control].enabled:after{content:"\00a0\00a0\e831"}</style>
<style id="style-ui-bar" type="text/css">#story{margin-left:20em}#ui-bar.stowed~#story{margin-left:4.5em}@media screen and (max-width:1136px){#story{margin-left:19em}#ui-bar.stowed~#story{margin-left:3.5em}}@media screen and (max-width:768px){#story{margin-left:3.5em}}#ui-bar{position:fixed;z-index:50;top:0;left:0;width:17.5em;height:100%;margin:0;padding:0;-o-transition:left .2s ease-in;transition:left .2s ease-in}#ui-bar.stowed{left:-15.5em}#ui-bar-body{height:90%;height:calc(100% - 2.5em);margin:2.5em 0;padding:0 1.5em}#ui-bar.stowed #ui-bar-body,#ui-bar.stowed #ui-bar-history{visibility:hidden;-o-transition:visibility .2s step-end;transition:visibility .2s step-end}#ui-bar{background-color:#222;border-right:1px solid #444;text-align:center}#ui-bar-tray{position:absolute;top:.2em;left:0;right:0}#ui-bar a{text-decoration:none}#ui-bar hr{border-color:#444}#ui-bar-history [id|=history],#ui-bar-toggle{font-size:1.2em;line-height:inherit;color:#eee;background-color:transparent;border:1px solid #444}#ui-bar-toggle{display:block;position:absolute;top:0;right:0;border-right:none;padding:.3em .45em .25em}#ui-bar.stowed #ui-bar-toggle{padding:.3em .35em .25em .55em}#ui-bar-toggle:hover{background-color:#444;border-color:#eee}#ui-bar-history{margin:0 auto}#ui-bar-history [id|=history]{padding:.2em .45em .35em}#ui-bar-history #history-jumpto{padding:.2em .665em .35em}#ui-bar-history [id|=history]:not(:first-child){margin-left:1.2em}#ui-bar-history [id|=history]:hover{background-color:#444;border-color:#eee}#ui-bar-history [id|=history]:disabled{color:#444;background-color:transparent;border-color:#444}#ui-bar-body{line-height:1.5;overflow:auto}#ui-bar-body>:not(:first-child){margin-top:2em}#story-title{margin:0;font-size:162.5%}#story-author{margin-top:2em;font-weight:700}#menu ul{margin:1em 0 0;padding:0;list-style:none;border:1px solid #444}#menu ul:empty{display:none}#menu li{margin:0}#menu li:not(:first-child){border-top:1px solid #444}#menu li a{display:block;padding:.25em .75em;border:1px solid transparent;color:#eee;text-transform:uppercase}#menu li a:hover{background-color:#444;border-color:#eee}#menu a,#ui-bar-history [id|=history],#ui-bar-toggle{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#menu-core li[id|=menu-item] a:before,#ui-bar-history [id|=history],#ui-bar-toggle:before{font-family:tme-fa-icons;font-style:normal;font-weight:400;font-variant:normal;text-transform:none;line-height:1;speak:none}#ui-bar-toggle:before{content:"\e81d"}#ui-bar.stowed #ui-bar-toggle:before{content:"\e81e"}#menu-item-saves a:before{content:"\e82b\00a0"}#menu-item-settings a:before{content:"\e82d\00a0"}#menu-item-restart a:before{content:"\e82c\00a0"}#menu-item-share a:before{content:"\e82f\00a0"}</style>
<style id="style-ui-debug" type="text/css">#debug-bar{background-color:#222;border-left:1px solid #444;border-top:1px solid #444;bottom:0;margin:0;max-height:75%;padding:.5em;position:fixed;right:0;z-index:99900}#debug-bar>div:not([id])+div{margin-top:.5em}#debug-bar>div>label{margin-right:.5em}#debug-bar>div>input[type=text]{min-width:0;width:8em}#debug-bar>div>select{width:15em}#debug-bar-watch{background-color:#222;border-left:1px solid #444;border-top:1px solid #444;bottom:102%;bottom:calc(100% + 1px);font-size:.9em;left:-1px;max-height:600%;max-height:60vh;position:absolute;overflow-x:hidden;overflow-y:scroll;right:0;z-index:99800}#debug-bar-watch[hidden]{display:none}#debug-bar-watch div{color:#999;font-style:italic;margin:1em auto;text-align:center}#debug-bar-watch table{width:100%}#debug-bar-watch tr:nth-child(2n){background-color:rgba(127,127,127,.15)}#debug-bar-watch td{padding:.2em 0}#debug-bar-watch td:first-child+td{padding:.2em .3em .2em .1em}#debug-bar-watch .watch-delete{background-color:transparent;border:none}#debug-bar-watch-all,#debug-bar-watch-none{margin-left:.5em}#debug-bar-views-toggle,#debug-bar-watch-toggle{color:#eee;background-color:transparent;border:1px solid #444;margin-right:1em;padding:.4em}#debug-bar-views-toggle:hover,#debug-bar-watch-toggle:hover{background-color:#333;border-color:#eee}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle,html[data-debug-view] #debug-bar-views-toggle{background-color:#282;border-color:#4a4}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle:hover,html[data-debug-view] #debug-bar-views-toggle:hover{background-color:#4a4;border-color:#6c6}#debug-bar-views-toggle:after,#debug-bar-watch .watch-delete:before,#debug-bar-watch-add:before,#debug-bar-watch-all:before,#debug-bar-watch-none:before,#debug-bar-watch-toggle:after{font-family:tme-fa-icons;font-style:normal;font-weight:400;font-variant:normal;text-transform:none;line-height:1;speak:none}#debug-bar-watch .watch-delete:before{content:"\e804"}#debug-bar-watch-add:before{content:"\e805"}#debug-bar-watch-all:before{content:"\e83a"}#debug-bar-watch-none:before{content:"\e827"}#debug-bar-views-toggle:after,#debug-bar-watch-toggle:after{content:"\00a0\00a0\e830"}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle:after,html[data-debug-view] #debug-bar-views-toggle:after{content:"\00a0\00a0\e831"}html[data-debug-view] .debug{padding:.25em;background-color:#234}html[data-debug-view] .debug[title]{cursor:help}html[data-debug-view] .debug.block{display:inline-block;vertical-align:middle}html[data-debug-view] .debug.invalid{text-decoration:line-through}html[data-debug-view] .debug.hidden,html[data-debug-view] .debug.hidden .debug{background-color:#555}html:not([data-debug-view]) .debug.hidden{display:none}html[data-debug-view] .debug[data-name][data-type].nonvoid:after,html[data-debug-view] .debug[data-name][data-type]:before{background-color:rgba(0,0,0,.25);font-family:monospace,monospace;white-space:pre}html[data-debug-view] .debug[data-name][data-type]:before{content:attr(data-name)}html[data-debug-view] .debug[data-name][data-type|=macro]:before{content:"<<" attr(data-name) ">>"}html[data-debug-view] .debug[data-name][data-type|=macro].nonvoid:after{content:"<</" attr(data-name) ">>"}html[data-debug-view] .debug[data-name][data-type|=html]:before{content:"<" attr(data-name) ">"}html[data-debug-view] .debug[data-name][data-type|=html].nonvoid:after{content:"</" attr(data-name) ">"}html[data-debug-view] .debug[data-name][data-type]:not(:empty):before{margin-right:.25em}html[data-debug-view] .debug[data-name][data-type].nonvoid:not(:empty):after{margin-left:.25em}html[data-debug-view] .debug[data-name][data-type|=special],html[data-debug-view] .debug[data-name][data-type|=special]:before{display:block}</style>
</head>
<body>
	<div id="init-screen">
		<div id="init-no-js"><noscript>JavaScript is required. Please enable it to continue.</noscript></div>
		<div id="init-lacking">Your browser lacks required capabilities. Please upgrade it or switch to another to continue.</div>
		<div id="init-loading"><div>Loading&hellip;</div></div>
	</div>
	<div id="store-area" hidden><tw-storydata name="Eigengrau&#39;s Essential Establishment Generator" startnode="51" creator="Tweego" creator-version="1.2.0" ifid="F7166797-FFA0-4EC8-A0B6-FBB555954C13" zoom="1" format="SugarCube" format-version="2.23.5" options="" hidden><style role="stylesheet" id="twine-user-stylesheet" type="text/twine-css">/* twine-user-stylesheet #1: "stylesheet.css" */
body.output {
  background-image:
url(https://pre00.deviantart.net/3a51/th/pre/i/2015/198/a/1/phb_background_texture_by_kluckham-d91rf3o.png);
  background-attachment: scroll;
  background-repeat: repeat;
  background-size: cover;
  font-family: Bookos;
  font-size: 18px;
  margin-bottom: 4px;
  margin-top: 4px;
}
/*
h1 {
  font-family: MrJeeves;
  font-size: 37px;
  color: rgb(88, 24, 42);
;
}

h2 {
  font-family: MrJeeves;
  font-size: 26px;
  color: #58182a;
}

h3 {
  font-family: MrJeeves;
  font-size: 19px;
  color: #58180D;
  border-bottom: 2px solid #c9ad6a;
  display: block;
}

h4 {
  font-family: MrJeeves;
  font-size: 17px;
  color: #58180D;
}

h5 {
  font-family: ScalySansSmallCaps;
  font-size: 16px;
  color: black;
}

.firstcharacter {
  float: left;
  font-family: Solbera Imitation;
  font-size: 75px;
  line-height: 60px;
  padding-top: 4px;
  padding-right: 8px;
  padding-left: 3px;
}

blockquote {
    border-style: solid;
    border-width: 2px;
  	background-color: #E0E5C1;
    box-sizing: border-box;
}

descriptive {
  border-style: solid;
  font-family: ScalySans;
  border-top-width: 1px;
  border-bottom-width: 1px;
  border-left-width: 2px;
  border-right-width: 2px;
  background-color: #FAF7EA;
  box-sizing: border-box;
}

a:link {
  color: 58180D;
}

a {
  color: 58180D;
}
*/

h1, h2, h3, h4{
margin-top:         .2em;
margin-bottom:      .2em;
font-family:        MrJeeves;
font-weight:        800;
color:              #58180D;}

/* H1 */

h1{
column-span:        all;
font-size:          .987cm;
-webkit-column-span:all;
-moz-column-span:   all;}


/* H2 */

h2{
font-size:          .705cm;
}


/* H3 */

h3{
font-size:          .529cm;
border-bottom:      2px solid #c9ad6a
}


/* H4 */

h4{
margin-bottom:      0;
font-size:          .458cm
}


/* H5 */

h5{
margin-bottom:      .2em;
font-family:        ScalySansSmallCaps;
font-size:          .423cm;
font-weight:        900
}


/* H6 */


h6{}


/* ### Paragraphs */

/* P */

p{
line-height:        1.3em;}


/* P+P */

p+p{
margin-top:         -0.8em;}


/* Text Indentation */

p+p,
ul+p,
ol+p {
    text-indent:    1em
}


/* Text Decoration */

strong {
    font-weight:    bold;
    letter-spacing: .03em
}
em {
    font-style:     italic
}
sup {
    vertical-align: super;
    font-size:      xx-small;
    line-height:    0
}
sub {
    vertical-align: sub;
    font-size:      smaller;
    line-height:    0
}


/* First Letter after H1 */

h1+p::first-letter {
    float:          left;
    font-family:    Solberry;
    font-size:      10em;
    color:          #222;
    line-height:    .8em
}
blockquote {
    font-family: ScalySans;
    box-sizing: border-box;
    margin-bottom: 1em;
    margin-top: 9px;
    padding: 5px 10px;
    background-color: #e0e5c1;
    border-style: solid;
    border-width: 11px;
    border-image: url('http://www.gmbinder.com/assets/img/note-wrap.png') 11;
    border-image-outset: 9px 0;
    box-shadow: 1px 4px 14px #888
}
blockquote em {
    font-family: ScalySans;
    font-style: italic
}
blockquote strong {
    font-family: ScalySans;
    font-weight: 800;
    letter-spacing: -0.02em
}
blockquote p,
blockquote ul {
    font-size: .352cm;
    line-height: 1.1em
}
pre+blockquote,
h2+blockquote,
h3+blockquote,
h4+blockquote,
h5+blockquote {
    margin-top: 13px}
blockquote h5 {
    margin-top: 0}

    .descriptive{
        display:block-inline;
        margin-bottom:1em;
        background-color:#faf7ea;
        font-family:ScalySans;
        border-style:solid;
        border-width:7px;
        border-image:url('http://www.gmbinder.com/assets/img/sidebars.png') 12 round;
        border-image-outset:4px;
        box-shadow:0 0 6px #faf7ea
    }
    .descriptive p{
        display:block;
        padding-bottom:0;
        line-height:1.5em
    }
    .descriptive p+p{
        padding-top:.8em
    }
    .descriptive em{
        font-family:ScalySans;
        font-style:italic
    }
    .descriptive strong{
        font-family:ScalySans;
        font-weight:800;
        letter-spacing:-0.02em
    }
    pre+.descriptive{
        margin-top:8px
    }

    descriptive{
        display:block-inline;
        margin-bottom:1em;
        background-color:#faf7ea;
        font-family:ScalySans;
        border-style:solid;
        border-width:7px;
        border-image:url('http://www.gmbinder.com/assets/img/sidebars.png') 12 round;
        border-image-outset:4px;
        box-shadow:0 0 6px #faf7ea
    }


    table {
        font-family: ScalySans;
        width: 100%;
        margin-bottom: 1em;
        font-size: 10pt;
        line-height: 1.1em;
        table-layout: auto;
    }

    table.a {
    table-layout: auto;
    width: 180px;
}
    table em {
        font-family: ScalySans;
        font-style: italic
    }
    table strong {
        font-family: ScalySans;
        font-weight: 800;
        letter-spacing: -0.02em
    }
    table thead {
        font-weight: 800
    }
    table thead th {
        vertical-align: bottom;
        padding-bottom: .3em;
        padding-right: .1em;
        padding-left: .1em
    }
    table tbody tr td {
        padding: .3em .1em
    }
    table tbody tr:nth-child(odd) {
        background-color: #e0e5c1
    }
    tr:nth-child(even) {background-color: #e0e5c1;}


/***********************************************************************
	BLEACHED - A largely white style for SugarCube â‰¥v2.23.1
***********************************************************************/
body {
	color: #111;

}
a {
	color: #35c;
}
a:hover {
	color: #57e;
}
span.link-disabled {
	color: #777;
}
button {
	color: #111;
	background-color: #acf;
	border-color: #8ad;
}
button:hover {
	background-color: #8ad;
	border-color: #68b;
}
button:disabled {
	background-color: #ccc;
	border-color: #aaa;
}
input, select, textarea {
	color: #111;
	border-color: #ccc;
}
input:not(:disabled):focus, select:not(:disabled):focus, textarea:not(:disabled):focus,
input:not(:disabled):hover, select:not(:disabled):hover, textarea:not(:disabled):hover {
	background-color: #eee;
	border-color: #111;
}
hr {
	border-color: #111;
}

.error-view {
	background-color: #eaa;
	border-left-color: #d77;
}
.error-view > .error-source:not([hidden]) {
	background-color: rgba(255, 255, 255, 0.2);
}

#ui-bar {
	background-color: #eee;
	border-color: #ccc;
}
#ui-bar hr {
	border-color: #ccc;
}
#ui-bar-toggle,
#ui-bar-history [id|="history"] {
	color: #111;
	border-color: #ccc;
}
#ui-bar-toggle:hover,
#ui-bar-history [id|="history"]:hover {
	background-color: #ccc;
	border-color: #111;
}
#ui-bar-history [id|="history"]:disabled {
	color: #ccc;
	background-color: transparent;
	border-color: #ccc;
}
#menu ul {
	border-color: #ccc;
}
#menu li:not(:first-child) {
	border-top-color: #ccc;
}
#menu li a {
	color: #111;
}
#menu li a:hover {
	background-color: #ccc;
	border-color: #111;
}

/* Default dialog styling */
#ui-overlay {
	background-color: #777;
}
#ui-dialog-titlebar {
	background-color: #ccc;
}
#ui-dialog-close:hover {
	background-color: #b44;
	border-color: #a33;
}
#ui-dialog-body {
	background-color: #fff;
	border-color: #ccc;
}
#ui-dialog-body hr {
	background-color: #ccc;
}

/* List-based dialog styling */
#ui-dialog-body.list li:not(:first-child) {
	border-top-color: #ccc;
}
#ui-dialog-body.list li a {
	color: #111;
}
#ui-dialog-body.list li a:hover {
	background-color: #ccc;
	border-color: #111;
}

/* Saves dialog styling */
#ui-dialog-body.saves > *:not(:first-child),
#ui-dialog-body.saves tr:not(:first-child) {
	border-top-color: #ccc;
}
#ui-dialog-body.saves .empty {
	color: #777;
}

/* Settings dialog styling */
#ui-dialog-body.settings button[id|="setting-control"] {
	color: #111;
	border-color: #ccc;
}
#ui-dialog-body.settings button[id|="setting-control"]:hover {
	background-color: #eee;
	border-color: #111;
}
#ui-dialog-body.settings button[id|="setting-control"].enabled {
	background-color: #9e9;
	border-color: #7c7;
}
#ui-dialog-body.settings button[id|="setting-control"].enabled:hover {
	background-color: #7c7;
	border-color: #5a5;
}

/* Debug bar styling */
#debug-bar,
#debug-bar-watch {
	background-color: #eee;
	border-color: #ccc;
}
#debug-bar-watch div {
	color: #777;
}
#debug-bar-watch-toggle,
#debug-bar-views-toggle {
	color: #111;
	border-color: #ccc;
}
#debug-bar-watch-toggle:hover,
#debug-bar-views-toggle:hover {
	background-color: #eee;
	border-color: #111;
}
#debug-bar-watch:not([hidden]) ~ div #debug-bar-watch-toggle,
html[data-debug-view] #debug-bar-views-toggle {
	background-color: #9e9;
	border-color: #7c7;
}
#debug-bar-watch:not([hidden]) ~ div #debug-bar-watch-toggle:hover,
html[data-debug-view] #debug-bar-views-toggle:hover {
	background-color: #7c7;
	border-color: #5a5;
}

/* Debug view styling */
html:not([data-debug-view]) #debug-view-toggle {
	color: #111;
	border-color: #ccc;
}
html:not([data-debug-view]) #debug-view-toggle:hover {
	background-color: #eee;
	border-color: #111;
}
html[data-debug-view] #debug-view-toggle {
	background-color: #9e9;
	border-color: #7c7;
}
html[data-debug-view] #debug-view-toggle:hover {
	background-color: #7c7;
	border-color: #5a5;
}
html[data-debug-view] .debug {
	background-color: #dc9;
}
html[data-debug-view] .debug.hidden,
html[data-debug-view] .debug.hidden .debug {
	background-color: #bbb;
}
/*! <<numberpool>> macro set for SugarCube v2 */
div[id|="numberbox-body"] {
	display: inline-block;
}
div[id|="numberbox-body"] input {
	min-width: 3em;
	width: 3em;
	text-align: center;
   	font-color: black;
}
div[id|="numberbox-body"] button {
	font-family: "tme-fa-icons";
	font-style: normal;
	font-weight: normal;
	font-variant: normal;
  	font-color: black;
	text-transform: none;
	line-height: normal;
	speak: none;
	padding: 0.4em 0.6em;
}
div[id|="numberbox-body"] button[id|="numberbox-minus"] {
	margin-right: 0.4em;
}
div[id|="numberbox-body"] button[id|="numberbox-plus"] {
	margin-left: 0.4em;
}

div[id|="numberslider-body"] {
	display: inline-block;
}
div[id|="numberslider-body"] span {
	display: inline-block;
	/*font-size: 1.25em;*/
	margin-left: 0.25em;
	min-width: 3em;
	text-align: center;
	vertical-align: middle;
}
div[id|="numberslider-body"] input {
	-webkit-appearance: none;
	cursor: pointer;
	height: 1.25em;
	min-width: 20em;
	vertical-align: middle;
}
div[id|="numberslider-body"] input:focus {
	outline: none;
}
div[id|="numberslider-body"] input::-webkit-slider-runnable-track {
	background: #222;
	border: 1px solid #444;
	border-radius: 0;
	cursor: pointer;
	height: 10px;
	width: 100%;
}
div[id|="numberslider-body"] input::-webkit-slider-thumb {
	-webkit-appearance: none;
	background: #35a;
	border: 1px solid #57c;
	border-radius: 0;
	cursor: pointer;
	height: 18px;
	margin-top: -5px;
	width: 33px;
}
div[id|="numberslider-body"] input:focus::-webkit-slider-runnable-track {
	background: #222;
}
div[id|="numberslider-body"] input::-moz-range-track {
	background: #222;
	border: 1px solid #444;
	border-radius: 0;
	cursor: pointer;
	height: 10px;
	width: 100%;
}
div[id|="numberslider-body"] input::-moz-range-thumb {
	background: #35a;
	border: 1px solid #57c;
	border-radius: 0;
	cursor: pointer;
	height: 18px;
	width: 33px;
}
div[id|="numberslider-body"] input::-ms-track {
	background: transparent;
	border-color: transparent;
	color: transparent;
	cursor: pointer;
	height: 10px;
	width: 99%; /* fallback for MS browsers without support for calc() */
	width: calc(100% - 1px);
}
div[id|="numberslider-body"] input::-ms-fill-lower {
	background: #222;
	border: 1px solid #444;
	border-radius: 0;
}
div[id|="numberslider-body"] input::-ms-fill-upper {
	background: #222;
	border: 1px solid #444;
	border-radius: 0;
}
div[id|="numberslider-body"] input::-ms-thumb {
	background: #35a;
	border: 1px solid #57c;
	border-radius: 0;
	cursor: pointer;
	height: 16px;
	width: 33px;
}

/*! <<bugreport>> macro for SugarCube v2 */
#ui-dialog-body.bugreport #bugreport-info {
	margin-bottom: 1em;
}
#ui-dialog-body.bugreport #bugreport-data {
	background-color: #eee;
	border: 1px solid #111;
	display: block;
	margin: 0;
	padding: 0;
}
#ui-dialog-body.bugreport #bugreport-data > code {
	display: block;
	font-family: monospace, monospace;
	height: auto;
	margin: 0;
	min-height: 200px;
	overflow: auto;
	padding: 0.5em;
	white-space: pre-wrap;
}


/*! <<checkvars>> macro for SugarCube 2.x */
#ui-dialog-body.checkvars{padding:1em}#ui-dialog-body.checkvars h1{font-size:1.5em;margin-top:0}#ui-dialog-body.checkvars table{border-collapse:collapse;border-spacing:0}#ui-dialog-body.checkvars thead tr{border-bottom:2px solid #ccc}#ui-dialog-body.checkvars tr:not(:first-child){border-top:1px solid #ccc}#ui-dialog-body.checkvars td,#ui-dialog-body.checkvars th{padding:.25em 1em}#ui-dialog-body.checkvars td:first-child,#ui-dialog-body.checkvars th:first-child{padding-left:.5em;border-right:1px solid #ccc}#ui-dialog-body.checkvars td:last-child,#ui-dialog-body.checkvars th:last-child{padding-right:.5em}#ui-dialog-body.checkvars th:first-child{text-align:center}#ui-dialog-body.checkvars td:first-child{font-weight:700;text-align:right}#ui-dialog-body.checkvars td{font-family:monospace,monospace;vertical-align:top;white-space:pre-wrap}#ui-dialog-body.checkvars .scroll-pad{margin:0;padding:0}
</style><script role="script" id="twine-user-script" type="text/twine-javascript">/* twine-user-script #1: "SetupBuilding.js" */
setup.createBuilding = function() {
    var material          = ["wooden", "wooden", "wooden", "wooden", "wooden", "stone", "stone", "stone", "stone", "hewn rock", "chiseled stone", "wooden", "wooden", "wooden", "wooden", "wooden", "stone", "stone", "stone", "stone", "hewn rock", "chiseled stone", "marble"];
    var purpose           = ["home", "barber", "alchemist's shop", "blacksmithery", "temple", "tannery", "butchery", "library"];
    var outside           = ["a horse grazing on the bushes nearby", "a rusted shovel near a somewhat overgrown flowerbed", "a well with an old rope, but no bucket to go on the end", "a dog panting by the door", "a cat lazily lounging in the shade", "a muddy pair of boots by the door", "a sign from the local paper which reads '$newspaperheadline'"];
    var disrepair         = ["dilapidated", "ruined", "old", "somewhat rickety", "well-loved", "well-kept", "brand new"];
    var magicroll         = Math.floor(Math.random() * 80) + 20;
    var pricemodifier     = Math.floor(Math.random() * 10) - 10;
    var sizeroll          = Math.floor(Math.random() * 80) + 20;
    var diversityroll     = Math.floor(Math.random() * 80) + 20;
    var wealthroll        = Math.floor(Math.random() * 99) + 1;
    var populationroll    = Math.floor(Math.random() * 99) + 1;
    var reputationroll    = Math.floor(Math.random() * 99) + 1;
    var sinroll           = Math.floor(Math.random() * 99) + 1;
    var roughnessroll     = Math.floor(Math.random() * 99) + 1;
    var cleanlinessroll   = Math.floor(Math.random() * 99) + 1;
    var expertiseroll     = Math.floor(Math.random() * 99) + 1;
    var intricacyroll     = Math.floor(Math.random() * 99) + 1;
    var hardinessroll     = Math.floor(Math.random() * 99) + 1;


    return {
        material          : material.random(),
        purpose           : purpose.random(),
        outside           : outside.random(),
        disrepair         : disrepair.random(),
        wealthroll        : wealthroll,
        magicroll         : magicroll,
        pricemodifier     : pricemodifier,
        sizeroll          : sizeroll,
        diversityroll     : diversityroll,
        populationroll    : populationroll,
        reputationroll    : reputationroll,
        sinroll           : sinroll,
        roughnessroll     : roughnessroll,
        cleanlinessroll   : cleanlinessroll,
        expertiseroll     : expertiseroll,
        intricacyroll     : intricacyroll,
        hardinessroll     : hardinessroll
    };
};
/* twine-user-script #2: "SetupNPC.js" */
setup.createNPC = function() {
	var gender        = ["man", "woman"].random();
	var heshe;
	var himher;
	var hisher;
	var boygirl;
	var manwoman;
	var menwomen;
	var guygirl;
  var race          = ["human", "human", "human", "human", "human", "human", "half-elf", "half-elf", "elf", "elf", "dwarf", "dwarf", "gnome", "halfling", "half-orc", "dragonborn", "tiefling"].random();
	var racenote;
	var physicaltrait;
	var firstname;
  var lastname      = State.variables.name.last.random();
	var name;
	var age           =  ["childlike", "rather young", "eighteen year old", "surprisingly young", "relatively young", "relatively young", "middle aged", "middle aged", "middle aged", "middle aged", "middle aged", "relatively old", "sun wizened", "quite old", "ancient"].random();
  var eyes;
  var racesingular;
  var raceplural;
  var raceadjective;
  var racelanguage;
  var height;
  var weight;
  var skinColours   = ["translucent", "white", "pale", "fair", "light", "light tan", "tan", "pale", "fair", "light", "light tan", "tan", "dark tan", "brown"];
  var haircolour    = ["brunette", "brunette", "brown", "brownish", "auburn", "amber", "hazel", "redhead", "dark redhead", "blonde", "dark blonde", "white", "platinum", "black", "black"].random();
	var hairtype      = ["thick", "wispy", "straight", "straight", "wavy", "wavy", "curly", "wiry", "oily", "lush", "poofy", "long", "braided", "very long", "greasy", "unruly", "unusually styled", "short cropped hair", "a shaved head"].random();
	var hair					= hairtype + " " + haircolour + " hair";
	var scar          = ["a jagged scar", "a dark purple scar", "an angry red scar", "a long, thin scar running up the arm", "a scar on the eye", "a scar around the neck", "a scar on the throat", "a fiery red scar", "a finger missing", "two fingers missing"].random();
	var tattoo        = ["a dagger tattoo", "an arrow tattoo", "an anchor tattoo", "a skull tattoo", "a pair of crossed bones tattoo", "a snake tattoo", "a scorpion tattoo", "a spider web tattoo", "a heart tattoo", "a ring of thorns tattoo", "a mermaid tattoo", "a dragon tattoo"].random();
	var dndclass      = ["barbarian", "bard", "cleric", "druid", "fighter", "monk", "rogue", "ranger", "paladin", "sorcerer", "warlock", "wizard"];
	var profession    = ["Actor", "Advocate", "Advisor", "Animal handler", "Apothecary", "Architect", "Archivist", "Armorer", "Astrologer", "Baker", "Banker", "Barber", "Barkeep", "Blacksmith", "Bookseller", "Brewer", "Bricklayer", "Brothel keeper", "Buccaneer", "Butcher", "Caravanner", "Carpenter", "Cartographer", "Chandler", "Chef", "Clock maker", "Cobbler", "Cook", "Counselor", "Courtesan", "Courtier", "Cowherd", "Dancer", "Diplomat", "Distiller", "Diver", "Farmer", "Fisherman", "Fishmonger", "Gardener", "General", "Gladiator", "Glovemaker", "Goldsmith", "Grocer", "Guardsman", "Guildmaster", "Hatmaker", "Healer", "Herald", "Herbalist", "Hermit", "Historian", "Hunter", "Ice seller", "Innkeeper", "Inventor", "Jailer", "Jester", "Jeweler", "Judge", "Knight", "Lady", "Leatherworker", "Librarian", "Linguist", "Locksmith", "Lord", "Lumberjack", "Mason", "Masseur", "Merchant", "Messenger", "Midwife", "Miller", "Miner", "Minister", "Minstrel", "Monk", "Mortician", "Necromancer", "Noble", "Nun", "Nurse", "Officer", "Painter", "Patissier", "Perfumer", "Philosopher", "Physician", "Pilgrim", "Potter", "Priest", "Privateer", "Professor", "Roofer", "Ropemaker", "Rugmaker", "Saddler", "Sailor", "Scabbard maker", "Sculptor", "Scavenger", "Scholar", "Seamstress", "Servant", "Shaman", "Shepherd", "Ship's captain", "Silversmith", "Slave", "Slaver", "Smith", "Soldier", "Spice Merchant", "Squire", "Stablehand", "Stevedore", "Stonemason", "Steward", "Street seller", "Street sweeper", "Student", "Surgeon", "Surveyor", "Sailor", "Tanner", "Tavernkeeper", "Tax collector", "Teacher", "Thatcher", "Thief", "Torturer", "Town crier", "Toymaker", "Vendor", "Veterinarian", "Vintner", "Weaver", "Wetnurse", "Woodcarver", "Wood seller", "Wrestler", "Writer"];
	var trait       = ["fidgets", "drinks too much", "eats too much", "swears often", "has poor hygiene", "cannot resist flirting", "cannot stop staring at you", "sweats profusely and easily", "is a habitual liar", "embellishes the truth", "exaggerates details", "has a short temper", "is melodramatic", "gossips about the most mundane things", "cannot resist a juicy secret", "chews with an open mouth", "often sniffs audibly", "is incredibly gullible", "is skeptical of everything", "paces about incessantly", "makes poor eye contact"];
	var currentmood = ["annoyed", "scared", "relaxed", "concerned", "bemused", "stressed", "amused", "content", "distracted"];
	var idle        = ["sitting, with a piece of bread in hand", "sitting, mug in hand", "poring over some map", "reading some letter intently", "reading a book", "shuffling a pack of cards", "chewing on a piece of hay", "sharpening a knife", "buffing a piece of armour", "polishing a shield", "sharpening the blade on a fearsome looking dagger", "cutting an apple into bite sized pieces", "biting into an apple", "eating an apple while looking at some book", "eating a hunk of cheese while reading a book", "sipping out of a huge mug while reading a book", "reading a book titled '<<print $book.pun.pluck()>>'", "reading a book titled '<<print $book.pun.pluck()>>'", "reading a book titled '<<print $book.pun.pluck()>>'"];
	var reading     = ["a piece of history- my forefather's journal, detailing his life in $town.name when it was just a settlement.", "my journal, from many years ago.", "my mother's journal, from just before she disappeared", "a document which I received by postboy two days ago... I believe it is in code, and somebody is trying to tell me something.", "a traitor's memoirs, extremely rare... I thought it would be a good laugh, but some of what he says is concerningly accurate.", "some sort of spell, though I don't know how to read it.", "a document I bought at the flea market; it looks to be a set of instructions on how to make a golem.", "a book which I bought, believing it to be blank, and suitable for a journal. However, now there's this strange foreign script that I can't read in it.", "a book that I bought as a gift for my mother, who loves beautiful covers, despite not being able to read."];
	var pockets			= ["5 cp",
	"6 cp",
	"15 cp",
	"22 cp",
	"27 cp",
	"5 sp",
	"5 sp",
	"6 sp",
	"7 sp",
	"2 gp",
	"34 cp and 4 sp",
	"12 sp and 7 gp",
	"a clove of garlic",
	"a vial of ink worth 8sp",
	"hardtack",
	"an explosive rune, dealing 2d4 fire damage",
	"a palm-sized glass sphere",
	"a wooden comb",
	"fragments of a shattered sword",
	"a deck of tarot cards",
	"map of a nearby castle",
	"map of the local area",
	"a tin spoon",
	"a mess kit",
	"lacy undergarments",
	"spectacles worth 5gp",
	"a spool of thread",
	"a piece of chalk",
	"a ecklace of animal teeth",
	"a headhunter's contract",
	"a list of people in a nearby city",
	"a worn leather strap",
	"a ring of iron keys",
	"a flask full of salt water",
	"a box of candles",
	"a vial of quicksilver",
	"a traveller's journal",
	"a lead amulet",
	"a signet ring for a noble house",
	"a list of local taverns",
	"a golden yellow topaz gem worth 50gp",
	"a page torn from a spellbook",
	"scraps of bad poetry",
	"a pair of bloodstained gloves",
	"thirteen mouse teeth",
	"a pouch full of dried berries",
	"an invitation to a wedding that happened a few weeks ago",
	"a brass ring",
	"a shopping list",
	"the cork from a wine bottle",
	"a scrap of paper with uninteligible writing on it",
	"a smoking pipe",
	"a pouch of ruby powder",
	"a deed to a ruined tower",
	"a bottle of honey",
	"a sling with 10 bullets",
	"a broken buckle",
	"a knot of silk ribbons",
	"a silver pearl worth 10gp",
	"a potion of Polymorph Self worth 350gp",
	"1pp wrapped in a crude map",
	"pocket sand",
	"a wedge of cheese",
	"a string of wooden prayer beads",
	"a lock of hair",
	"a dead mouse",
	"a compass",
	"an empty flask",
	"85gp",
	"three diamonds worth 30gp each",
	"a black pearl worth 50gp",
	"a black opal worth 100gp"].random();

	switch (gender) {
		case "man":
			heshe 				= "he";
			himher 				= "him";
			hisher 				= "his";
			boygirl			  = "boy";
			manwoman 			= "man";
			menwomen 			= "men";
			guygirl 			= "guy";
			break;
		case "woman":
			heshe 				= "she";
			himher			  = "her";
			hisher 				= "her";
			boygirl			  = "girl";
			manwoman 			= "woman";
			menwomen		  = "women";
			guygirl 			= "girl";
}

var physicaltraitroll = Math.floor(Math.random() * 10) + 1;
		if (physicaltraitroll > 8)
		{
				physicaltrait = scar;
		}
		else if (physicaltraitroll > 6)
		{
				physicaltrait = tattoo;
		}
		else if (physicaltraitroll <= 6)
		{
				physicaltrait = hair;
		}


    switch (race) {
    case "human":
        eyes    = ["yellow", "amber", "brown", "hazel", "green", "blue", "gray", "aqua", "brown", "hazel", "green", "blue", "gray", "aqua", "purple", "pale brown", "pale blue", "pale green", "ash gray"].random();
        racesingular  = "person";
        raceplural    = "humans";
        raceadjective = "man";
        racelanguage  = "Common";
        height        = ["tiny", "short", "slightly below average height", "rather average height", "slightly above average height", "tall", "tall", "tall", "giraffe-like"].random();
				weight        = ["waif-like", "thin", "skinny", "skinny", "wiry", "thin", "stocky", "beefy", "muscular", "slightly underweight", "slightly overweight", "slightly overweight", "round", "tubby", "portly"].random();
				racenote 			= height + " " + gender;
			  if (gender === "man") {
            firstname = State.variables.name.man.pluck();
        }
        else if (gender === "woman") {
            firstname = State.variables.name.woman.pluck();
        }
        break;

    case "elf":
        eyes    = ["yellow", "amber", "brown", "hazel", "green", "blue", "gray", "aqua", "purple", "pale brown", "pale blue", "pale green", "ash gray"].random();
        racesingular  = "elf";
				racenote 			= race;
        raceplural    = "elves";
        raceadjective = "elfish";
        racelanguage  = "Elven";
        height        = ["rather average height", "slightly above average height", "tall", "tall", "tall"].random();
        weight        = ["waif-like", "thin", "skinny", "skinny", "wiry", "thin", "stocky", "slightly underweight"].random();
        if (gender === "man") {
            firstname = State.variables.name.maleelf.pluck();
        }
        else if (gender === "woman") {
            firstname = State.variables.name.femaleelf.pluck();
        }
        break;

  	case "dwarf":
      eyes      = ["yellow", "amber", "brown", "dark brown", "hazel", "green", "blue", "gray", "brown", "dark brown", "hazel", "green", "blue", "gray", "aqua"].random();
  		racesingular    = "dwarf";
			racenote 				= race;
  		raceplural      = "dwarves";
  		raceadjective   = "dwarven";
  		racelanguage    = "Dwarven";
  		height          = ["short", "squat"].random();
      weight          = ["stocky", "beefy", "muscular", "slightly underweight", "slightly overweight", "slightly overweight", "round", "tubby", "portly"].random();
  		if (gender === "man") {
  			   firstname  = State.variables.name.maledwarf.pluck();
      }
  		else if (gender === "woman") {
  				 firstname = State.variables.name.femaledwarf.pluck();
  		}
      break;

  	case "halfling":
      eyes      = ["yellow", "amber", "brown", "hazel", "green", "blue", "gray", "aqua", "red", "purple", "pale brown", "pale blue", "pale green", "ash gray"].random();
  	  racesingular    = "halfling";
			racenote 				= race;
  		raceplural      = "hobbits";
  		raceadjective   = "halfling";
  		racelanguage    = "Halfling";
  		height          = ["short", "tiny", "diminuitive", "little"].random();
      weight          = ["waif-like", "thin", "skinny", "skinny", "wiry", "thin", "stocky", "beefy", "muscular", "slightly underweight"].random();
      if (gender === "man") {
          firstname = State.variables.name.malehalfling.pluck();
      }
      else if (gender === "woman") {
          firstname = State.variables.name.femalehalfling.pluck();
      }
      break;
  	case "half-orc":
      eyes      = ["yellow", "amber", "orange", "brown", "hazel", "yellow", "amber", "orange", "brown", "hazel", "green", "blue", "gray", "aqua", "red"].random();
  		racesingular    = "half-orc";
			racenote 				= race;
  		raceplural      = "half-orcs";
  		raceadjective   = "orcish";
  		racelanguage    = "Orcish";
  		height          = ["rather average height", "slightly above average height", "tall", "tall", "intimidatingly tall"].random();
  		weight          = ["slightly underweight", "stocky", "beefy", "muscular", "extremely muscular", "slightly overweight"].random();
  		if (gender === "man") {
  				 firstname = State.variables.name.maleorc.pluck();
      }
  			  else if (gender === "woman") {
  				 firstname = State.variables.name.femaleorc.pluck();
  		}
      break;

  	case "dragonborn":
      eyes      = ["yellow", "amber", "yellow", "amber", "brown", "hazel", "green", "blue", "gray", "aqua", "red", "purple", "aqua", "red", "purple", "gold", "gold"].random();
  		racesingular    = "drake";
			racenote 				= race;
  		raceplural      = "drakes";
  		raceadjective   = "draconian";
  		racelanguage    = "Draconic";
  		height          = ["rather average height", "slightly above average height", "tall", "tall", "tall"].random();
      weight          = ["stocky", "beefy", "muscular", "slightly underweight", "extremely muscular", "slightly overweight"].random();
      if (gender === "man") {
          firstname = State.variables.name.maledragonborn.pluck();
      }
      else if (gender === "woman") {
          firstname = State.variables.name.femaledragonborn.pluck();
      }
      break;

  	case "tiefling":
      eyes      = ["yellow", "amber", "brown", "hazel", "green", "blue", "aqua", "red", "purple", "pale brown", "pale blue", "pale green", "ash gray", "violet red", "aquamarine", "deep blue", "spring green", "sea green", "emerald green"].random();
  		racesingular    = "tiefling";
			racenote 				= race;
  		raceplural      = "tieflings";
  		raceadjective   = "devilish";
  		racelanguage    = "Demonic";
  		height          = ["tiny", "short", "slightly below average height", "rather average height", "slightly above average height", "tall", "tall", "tall", "giraffe-like"].random();
  		weight          = ["waif-like", "thin", "skinny", "skinny", "wiry", "thin", "stocky", "beefy", "muscular", "slightly underweight"].random();
  		if (gender === "man") {
  				 firstname = State.variables.name.maletiefling.pluck();
      }
  			  else if (gender === "woman") {
  				 firstname = State.variables.name.femaletiefling.pluck();
  		}
      break;

  	case "half-elf":
      eyes      = ["yellow", "amber", "brown", "hazel", "green", "blue", "gray", "aqua", "red", "purple", "pale brown", "pale blue", "pale green", "ash gray"].random();
  		racesingular    = "half-elf";
			racenote 				= race;
  		raceplural      = "half-elves";
  		raceadjective   = "elfish";
  		racelanguage    = "Elven";
  		height          = ["rather average height", "slightly above average height", "tall", "tall", "tall"].random();
      weight          = ["waif-like", "thin", "skinny", "skinny", "wiry", "thin", "stocky", "beefy", "muscular", "slightly underweight"].random();
      if (gender === "man") {
  				 firstname = [State.variables.name.man.pluck(), State.variables.name.maleelf.pluck()].random();
      }
  			  else if (gender === "woman") {
  				 firstname = [State.variables.name.woman.pluck(), State.variables.name.femaleelf.pluck()].random();
  		}
      break;

  	case "gnome":
      eyes      = ["yellow", "amber", "brown", "hazel", "green", "blue", "gray", "aqua", "red", "purple", "pale brown", "pale blue", "pale green", "ash gray"].random();
  		racesingular    = "gnome";
			racenote 				= race;
  		raceplural      = "gnomes";
  		raceadjective   = "gnomish";
  		racelanguage    = "Gnomish";
  		height          = ["short", "tiny"].random();
  		weight          = ["slightly underweight", "stocky", "beefy", "slightly overweight", "slightly overweight", "round", "tubby"].random();
      if (gender === "man") {
           firstname = State.variables.name.maledwarf.pluck();
      }
          else if (gender === "woman") {
           firstname = State.variables.name.femaledwarf.pluck();
      }
      break;
}

		var name 					= firstname + " " + lastname;

  return {
      gender        : gender,
			heshe					: heshe,
			himher				: himher,
			hisher				: hisher,
			boygirl				: boygirl,
			manwoman			: manwoman,
			menwomen			: menwomen,
			guygirl				: guygirl,
      race          : race,
      age           : age,
      eyes   			  : eyes,
			racenote			: racenote,
			physicaltrait : physicaltrait,
      racesingular  : racesingular,
      raceplural    : raceplural,
      raceadjective : raceadjective,
      racelanguage  : racelanguage,
			name					: name,
      firstname     : firstname,
      lastname      : lastname,
      height        : height,
      weight        : weight,
      skinColours   : skinColours.random(),
      haircolour    : haircolour,
      hairtype      : hairtype,
			hair					: hair,
      scar          : scar,
      tattoo        : tattoo,
      dndclass      : dndclass.random(),
      profession    : profession.random(),
      trait         : trait.random(),
      currentmood   : currentmood,
      idle          : idle,
      reading       : reading,
			pockets				: pockets
  };

};
/* twine-user-script #3: "numberpool.js" */
/*! <<numberpool>> macro set for SugarCube v2 */
!function(){"use strict";if("undefined"==typeof version||"undefined"==typeof version.title||"SugarCube"!==version.title||"undefined"==typeof version.major||version.major<2||"undefined"==typeof version.minor||version.minor<5)throw new Error("<<numberpool>> macro set requires SugarCube 2.5.0 or greater, aborting load");Macro.add("numberbox",{handler:function(){function validateAndApply(el,addend){var curValue=Math.trunc(Wikifier.getValue(varName)),newValue=Math.trunc(el.value),newPoolValue=null;if(Number.isNaN(newValue)||!Number.isFinite(newValue))return el.value=curValue,!1;if(null!=addend&&(newValue+=addend),newValue<minValue?newValue=minValue:newValue>maxValue&&(newValue=maxValue),null!==pool){var poolValue=pool.get(),delta=(newValue-curValue)*poolCost;delta<0?newPoolValue=poolValue-delta:delta>0&&poolValue>=poolCost?(poolValue<delta&&(newValue=curValue+Math.trunc(poolValue/poolCost),delta=poolValue-poolValue%poolCost),newPoolValue=poolValue-delta):newValue=curValue}return Wikifier.setValue(varName,newValue),el.value=newValue,null!==newPoolValue&&pool.set(newPoolValue),!0}var _this=this;if(this.args.length<4){var errors=[];return this.args.length<1&&errors.push("variable name"),this.args.length<2&&errors.push("default value"),this.args.length<3&&errors.push("min value"),this.args.length<4&&errors.push("max value"),this.error("no "+errors.join(" or ")+" specified")}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var varId=Util.slugify(varName),defValue=Number(this.args[1]),minValue=Number(this.args[2]),maxValue=Number(this.args[3]),poolCost=1,autofocus=!1;if(this.args.length>5?(poolCost=Number(this.args[4]),autofocus="autofocus"===this.args[5]):this.args.length>4&&("autofocus"===this.args[4]?autofocus=!0:poolCost=Number(this.args[4])),Number.isNaN(defValue)||!Number.isFinite(defValue)||Math.trunc(defValue)!==defValue)return this.error("default value ("+this.args[1]+") is not a whole number");if(Number.isNaN(minValue)||!Number.isFinite(minValue)||Math.trunc(minValue)!==minValue)return this.error("min value ("+this.args[2]+") is not a whole number");if(Number.isNaN(maxValue)||!Number.isFinite(maxValue)||Math.trunc(maxValue)!==maxValue)return this.error("max value ("+this.args[3]+") is not a whole number");if(Number.isNaN(poolCost)||!Number.isFinite(poolCost)||Math.trunc(poolCost)!==poolCost||poolCost<=0)return this.error("pool cost ("+this.args[4]+") is not a whole number greater than zero");if(defValue<minValue)return this.error("default value ("+this.args[1]+") is less than min value ("+this.args[2]+")");if(defValue>maxValue)return this.error("default value ("+this.args[1]+") is greater than max value ("+this.args[3]+")");var pool=function(){var parent=_this.contextSelect(function(ctx){return"numberpool"===ctx.name});return null!==parent&&parent.hasOwnProperty("pool")?parent.pool:null}();Config.debug&&this.debugView.modes({block:!0});var $elControl=jQuery(document.createElement("div")),$elInput=jQuery(document.createElement("input"));$elControl.attr("id",this.name+"-body-"+varId).addClass("macro-"+this.name).appendTo(this.output),jQuery(document.createElement("button")).attr({id:this.name+"-minus-"+varId,tabindex:0}).text("").on("click",function(){return validateAndApply($elInput[0],-1)}).appendTo($elControl),$elInput.attr({id:this.name+"-input-"+varId,name:this.name+"-input-"+varId,type:"text",pattern:"\\d+",tabindex:0}).on("change",function(){validateAndApply(this)}).on("keypress",function(ev){13===ev.which&&(ev.preventDefault(),$elInput.trigger("change"))}).appendTo($elControl),jQuery(document.createElement("button")).attr({id:this.name+"-plus-"+varId,tabindex:0}).text("").on("click",function(){return validateAndApply($elInput[0],1)}).appendTo($elControl),$elInput.val(defValue),validateAndApply($elInput[0]),autofocus&&($elInput.attr("autofocus","autofocus"),postdisplay["#autofocus:"+$elInput.attr("id")]=function(task){delete postdisplay[task],setTimeout(function(){return $elInput.focus()},Engine.minDomActionDelay)})}}),Macro.add("numberpool",{tags:["onchange"],handler:function(){if(0===this.args.length)return this.error("no variable name specified");if(this.payload.length>2)return this.error("multiple <<onchange>> sections specified");if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var curValue=Wikifier.getValue(varName);if("number"!=typeof curValue||Number.isNaN(curValue)||!Number.isFinite(curValue))return this.error("pool value is not a number");var varId=Util.slugify(varName);TempState.hasOwnProperty(this.name)||(TempState[this.name]={}),TempState[this.name].hasOwnProperty(varId)||(TempState[this.name][varId]=0),Object.defineProperty(this,"pool",{value:Object.defineProperties({},{get:{value:function(){return Wikifier.getValue(varName)}},set:{value:function(content){return function(value){var curValue=Wikifier.getValue(varName);value!==curValue&&(Wikifier.setValue(varName,value),content&&new Wikifier(null,content))}}(this.payload.length>1?this.payload[1].contents.trim():"")}})}),jQuery(document.createElement("div")).attr("id",this.name+"-"+varId+"-"+TempState[this.name][varId]++).addClass("macro-"+this.name).wiki(this.payload[0].contents.replace(/^\n/,"")).appendTo(this.output)}}),Macro.add("numberslider",{handler:function(){function stepValidate(value){if(fracDigits>0){var ma=Number(minValue+"e"+fracDigits),sa=Number(stepValue+"e"+fracDigits),_va=Number(value+"e"+fracDigits)-ma;return Number(_va-_va%sa+ma+"e-"+fracDigits)}var va=value-minValue;return va-va%stepValue+minValue}function validateAndApply(el){var curValue=Wikifier.getValue(varName),newValue=Number(el.value),newPoolValue=null;if(Number.isNaN(newValue)||!Number.isFinite(newValue))return el.value=curValue,!1;if(newValue=stepValidate(newValue),newValue<minValue?newValue=minValue:newValue>maxValue&&(newValue=maxValue),null!==pool)if(fracDigits>0){var pa=Number(pool.get()+"e"+fracDigits),ca=Number(curValue+"e"+fracDigits),na=Number(newValue+"e"+fracDigits),delta=na-ca;pa<delta&&(na-=delta-pa,delta=na-ca,newValue=Number(na+"e-"+fracDigits)),newPoolValue=Number(pa-delta+"e-"+fracDigits)}else{var poolValue=pool.get(),_delta=newValue-curValue;poolValue<_delta&&(newValue-=_delta-poolValue,_delta=newValue-curValue),newPoolValue=poolValue-_delta}return Wikifier.setValue(varName,newValue),el.value=newValue,null!==newPoolValue&&pool.set(newPoolValue),!0}var _this2=this;if(this.args.length<5){var errors=[];return this.args.length<1&&errors.push("variable name"),this.args.length<2&&errors.push("default value"),this.args.length<3&&errors.push("min value"),this.args.length<4&&errors.push("max value"),this.args.length<5&&errors.push("step value"),this.error("no "+errors.join(" or ")+" specified")}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var varId=Util.slugify(varName),defValue=Number(this.args[1]),minValue=Number(this.args[2]),maxValue=Number(this.args[3]),stepValue=Number(this.args[4]),autofocus=this.args.length>5&&"autofocus"===this.args[5];if(Number.isNaN(defValue)||!Number.isFinite(defValue))return this.error("default value ("+this.args[1]+") is not a number");if(Number.isNaN(minValue)||!Number.isFinite(minValue))return this.error("min value ("+this.args[2]+") is not a number");if(Number.isNaN(maxValue)||!Number.isFinite(maxValue))return this.error("max value ("+this.args[3]+") is not a number");if(Number.isNaN(stepValue)||!Number.isFinite(stepValue)||stepValue<=0)return this.error("step value ("+this.args[4]+") is not a number greater than zero");if(defValue<minValue)return this.error("default value ("+this.args[1]+") is less than min value ("+this.args[2]+")");if(defValue>maxValue)return this.error("default value ("+this.args[1]+") is greater than max value ("+this.args[3]+")");var fracDigits=function(){var str=String(stepValue),pos=str.lastIndexOf(".");return pos===-1?0:str.length-pos-1}();if(stepValidate(maxValue)!==maxValue)return this.error("max value ("+this.args[3]+") is not a multiple of the step value ("+this.args[4]+") plus the min value ("+this.args[2]+")");var pool=function(){var parent=_this2.contextSelect(function(ctx){return"numberpool"===ctx.name});return null!==parent&&parent.hasOwnProperty("pool")?parent.pool:null}();Config.debug&&this.debugView.modes({block:!0});var $elControl=jQuery(document.createElement("div")),$elInput=jQuery(document.createElement("input")),$elValue=void 0,showValue=void 0;$elControl.attr("id",this.name+"-body-"+varId).addClass("macro-"+this.name).appendTo(this.output),$elInput.attr({id:this.name+"-input-"+varId,name:this.name+"-input-"+varId,type:"range",min:minValue,max:maxValue,step:stepValue,tabindex:0}).on("change input."+Util.slugify(this.name),function(){validateAndApply(this),"function"==typeof showValue&&showValue()}).on("keypress",function(ev){13===ev.which&&(ev.preventDefault(),$elInput.trigger("change"))}).appendTo($elControl),!Browser.isIE||Browser.ieVersion>9?($elValue=jQuery(document.createElement("span")).attr("id",this.name+"-value-"+varId).appendTo($elControl),showValue=function(){$elValue.text(Number($elInput.val()).toFixed(fracDigits))}):$elInput.off("input."+Util.slugify(this.name)),$elInput.val(defValue),validateAndApply($elInput[0]),"function"==typeof showValue&&showValue(),autofocus&&($elInput.attr("autofocus","autofocus"),postdisplay["#autofocus:"+$elInput.attr("id")]=function(task){delete postdisplay[task],setTimeout(function(){return $elInput.focus()},Engine.minDomActionDelay)})}})}();


/*! <<bugreport>> macro for SugarCube v2 */
!function(){"use strict";if("undefined"==typeof version||"undefined"==typeof version.title||"SugarCube"!==version.title||"undefined"==typeof version.major||version.major<2||"undefined"==typeof version.minor||version.minor<19)throw new Error("<<bugreport>> macro requires SugarCube 2.19.0 or greater, aborting load");Macro.add("bugreport",{fence:["[spoiler][code]","[/code][/spoiler]"],handler:function(){function serializeVariables(varObj,diffObj,doSort){function renderDiff(diff,orig){for(var keys=Object.keys(diff||{}),render=orig?clone(orig):{},i=0,klen=keys.length;i<klen;++i){var key=keys[i],diffP=diff[key];if(diffP===Diff.Op.Delete)delete render[key];else if(Array.isArray(diffP))switch(diffP[0]){case Diff.Op.SpliceArray:try{render.splice(diffP[1],1+(diffP[2]-diffP[1]))}catch(ex){}break;case Diff.Op.Copy:render[key]=clone(diffP[1]);break;case Diff.Op.CopyDate:render[key]=new Date(diffP[1])}else{var recurse=renderDiff(diffP,render[key]);0!==Object.keys(recurse).length&&(render[key]=recurse)}}return render}var varList=[],diff=renderDiff(Diff.diff(varObj,diffObj));for(var key in diff){var sName="$"+(key.search(/[^\w]/)===-1?key:'"'+key+'"');varList.push(sName+"="+JSON.stringify(diff[key]))}return doSort&&("function"==typeof doSort?varList.sort(doSort):varList.sort()),0!==varList.length?varList.join(", "):""}var info=this.args.length>0&&Story.has(this.args[0])?Story.get(this.args[0]).processText():"",last=State.length-1,passages=[],source=unescape(window.location),srcMatch=void 0;null!==(srcMatch=/\/([^\/]+)$/.exec(source))&&(source=srcMatch[1]);for(var i=0;i<=last;++i)passages.push('"'+State.index(i).title+'"');passages=passages.join(", ");var varsPre=serializeVariables(State.index(0).variables,State.index(last).variables),varsPost=serializeVariables(State.index(last).variables,State.variables),$dialog=jQuery(Dialog.setup("Bug Report","bugreport"));$dialog.append((info?'<div id="bugreport-info"></div>':"")+'<div><b>Bug report:</b> <a id="bugreport-data-select" class="link-internal macro-bugreport">[Select]</a></div><pre id="bugreport-data"><code tabindex="0"></code></pre>'),info&&new Wikifier($dialog.find("#bugreport-info"),info);var $data=jQuery($dialog.find("#bugreport-data > code").get(0));$data.text(this.self.fence[0]+"\n"+("SOURCE: "+source+"\n\n")+("PASSAGES:\n"+passages+"\n\n")+("VARIABLES (PRE-EXECUTION):\n"+(varsPre?varsPre+"\n":"")+"\n")+("VARIABLES (POST-EXECUTION):\n"+(varsPost?varsPost+"\n":""))+(""+this.self.fence[1])),$dialog.find("#bugreport-data-select").ariaClick(function(selectData){return function(){$data.focus(),selectData($data.get(0))}}(this.self.selectData)),Dialog.open()},selectData:function(el){var getSelection=window.getSelection||document.getSelection;if(getSelection){var sel=getSelection();if(sel.setBaseAndExtent)sel.setBaseAndExtent(el,0,el,el.childNodes.length);else{var rng=document.createRange();rng.selectNodeContents(el),sel.removeAllRanges(),sel.addRange(rng)}}else if(document.selection){var _rng=document.body.createTextRange();_rng.moveToElementText(el),_rng.select()}}})}();


/*! <<checkvars>> macro for SugarCube 2.x */
!function(){"use strict";if("undefined"==typeof version||"undefined"==typeof version.title||"SugarCube"!==version.title||"undefined"==typeof version.major||version.major<2)throw new Error("<<checkvars>> macro requires SugarCube 2.0 or greater, aborting load");Macro.add("checkvars",{handler:function(){function toString(value,indent){var baseType=typeof value;switch(baseType){case"number":return isNaN(value)?"NaN":isFinite(value)?String(value):"Infinity";case"string":return JSON.stringify(value);case"function":return"(function)";default:if("object"!==baseType||null==value)return String(value);var objType=Object.prototype.toString.call(value);if("[object Date]"===objType)return'(object: Date, value: "'+value.toISOString()+'")';if("[object RegExp]"===objType)return"(object: RegExp, value: "+value.toString()+")";var opener,closer,result=[],indentText="Â Â ";return indent||(indent=""),("[object Set]"===objType||value instanceof Set)&&(value=Array.from(value)),Array.isArray(value)?(opener="[\n",closer="\n"+indent+"]",value.forEach(function(p,i){result.push(indent+indentText+i+" â‡’ "+toString(value[i],indent+indentText))}),Object.keys(value).forEach(function(p){/^\d+$/.test(p)||result.push(indent+indentText+toString(p)+" â‡’ "+toString(value[p],indent+indentText))})):"[object Map]"===objType||value instanceof Map?(opener="{\n",closer="\n"+indent+"}",Array.from(value).map(function(kv){result.push(indent+indentText+toString(kv[0],indent+indentText)+" â‡’ "+toString(kv[1],indent+indentText))})):(opener="{\n",closer="\n"+indent+"}",Object.keys(value).forEach(function(p){result.push(indent+indentText+toString(p)+" â‡’ "+toString(value[p],indent+indentText))})),opener+result.join(",\n")+closer}}var dialog,sv=State.variables,names=Object.keys(sv);if(dialog=UI.setup("Story $variables","checkvars"),0===names.length)return dialog.innerHTML="<h1>Story $variables (<code>State.variables</code>):</h1><p><em>No $variables currently setâ€¦</em></p>",void UI.open();dialog.innerHTML="<h1>Story $variables (<code>State.variables</code>):</h1><table><thead><tr><th>Name</th><th>Value</th></tr></thead><tbody></tbody></table>"+(/applewebkit|chrome/.test(Browser.userAgent)?"":'<div class="scroll-pad">&nbsp;</div>');var tbody=dialog.querySelector("tbody");names.sort(function(a,b){return Util.isNumeric(a)&&Util.isNumeric(b)?Number(a)-Number(b):a.localeCompare(b)});for(var i=0;i<names.length;i++){var tr=document.createElement("tr"),tdName=document.createElement("td"),tdValue=document.createElement("td");tdName.textContent="$"+names[i],tdValue.textContent=toString(sv[names[i]]),tr.appendChild(tdName),tr.appendChild(tdValue),tbody.appendChild(tr)}UI.open()}})}();
</script><tw-passagedata pid="1" name="Alchemist" tags="" position="100,100">&lt;&lt;set $chemist to setup.createNPC()&gt;&gt;

&lt;&lt;set $chemist.idle to [&quot;talking with a customer&quot;, &quot;picking $chemist.hisher nose&quot;, &quot;playing a card game by $chemist.himher&lt;&lt;nobr&gt;&gt;self&lt;&lt;/nobr&gt;&gt;&quot;, &quot;looking over a recipe book&quot;, &quot;carefully putting ingredients into a vial&quot;, &quot;pouring ingredients into a tube&quot;, &quot;throwing herbs into a cauldron&quot;, &quot;taking a drink from a glass&quot;, &quot;taking a drink from a glass of water&quot;, &quot;stirring a pot which is bubbling happily&quot;, &quot;stirring a cauldron which bubbles menacingly&quot;, &quot;stirring a small pot with a glass spoon carefully&quot;],
	$chemist.owner to either([&quot;owner&quot;, &quot;caretaker&quot;, &quot;proud owner&quot;, &quot;proprietor&quot;, &quot;current owner&quot;, &quot;chief owner&quot;, &quot;master chemist&quot;, &quot;chief researcher&quot;]),
	$chemist.greeting to [&quot;nods at you&quot;, &quot;looks suspiciously at your hair, and then smiles, and welcomes you warmly&quot;, &quot;looks at your eyes intently, and then smiles, and welcomes you&quot;, &quot;welcomes you warmly&quot;, &quot;smiles and greets you&quot;, &quot;raises a gloved hand with a wave&quot;, &quot;sizes you up, before $chemist.heshe nods at you&quot;, &quot;checks you out for just a moment before smiling at you&quot;]
&gt;&gt;

&lt;&lt;set $alchemist to setup.createBuilding()&gt;&gt;
&lt;&lt;set $alchemist.magicroll to random(40, 100)&gt;&gt;</tw-passagedata><tw-passagedata pid="2" name="AlchemistInventory" tags="" position="225,100">&lt;&lt;set $alchemist.inventory to [

	{
	name: &quot;Potion (Common)&quot;,
	cost: 50000,
	availability: 1
	},

	{
	name: &quot;Potion (Uncommon)&quot;,
	cost: 250000,
	availability: 1
	},

	{
	name: &quot;Poison, Basic&quot;,
	cost: 10000,
	availability: 1
	},

	{
	name: &quot;Potion of Healing&quot;,
	cost: 5000,
	availability: 1
	},

	{
	name: &quot;Vial&quot;,
	cost: 20,
	availability: 1
	},

	{
	name: &quot;Flask&quot;,
	cost: 2,
	availability: 1
	},

	{
	name: &quot;Jug&quot;,
	cost: 2,
	availability: 1
	},

	{
	name: &quot;Anti-toxin (vial)&quot;,
	cost: 5000,
	availability: 1
	},

	{
	name: &quot;Bottle, glass&quot;,
	cost: 200,
	availability: 1
	},

	{
	name: &quot;Brewer&#39;s Supplies&quot;,
	cost: 2000,
	availability: 1
	},

	{
	name: &quot;Acid&quot;,
	cost: 2500,
	availability: 2
	},

	{
	name: &quot;Flask of Oil&quot;,
	cost: 10,
	availability: 2
	},

	{
	name: &quot;Component Pouch&quot;,
	cost: 2500,
	availability: 2
	},


	{
	name: &quot;Poisoner&#39;s Kit&quot;,
	cost: 50000,
	availability: 2
	},


	{
	name: &quot;Healer&#39;s Kit&quot;,
	cost: 500,
	availability: 2
	},

	{
	name: &quot;Alchemist&#39;s Supplies&quot;,
	cost: 50000,
	availability: 2
	},

	{
	name: &quot;Cook&#39;s Utensils&quot;,
	cost: 20,
	availability: 3
	},

	{
	name: &quot;Alchemist&#39;s Fire (flask)&quot;,
	cost: 5000,
	availability: 3
	},


	{
	name: &quot;Potion (Rare)&quot;,
	cost: 2500000,
	availability: 3
	},


	{
	name: &quot;Perfume (vial)&quot;,
	cost: 500,
	availability: 4
	},

	{
	name: &quot;Ink (1 ounce bottle)&quot;,
	cost: 1000,
	availability: 4
	},

	]&gt;&gt;</tw-passagedata><tw-passagedata pid="3" name="AlchemistLookAround" tags="" position="350,100">&lt;&lt;nobr&gt;&gt;
&lt;&lt;if $alchemist.cleanlinessroll gt 80&gt;&gt;
	   Looking around, $alchemist.name is an extremely clean shop. Sheafs of paper are stacked in piles neatly, with recipes being used currently carefully placed on stands. The typical chemical burns that stain most alchemist shops are nowhere to be found.
	&lt;&lt;elseif $alchemist.cleanlinessroll gt 70&gt;&gt;
    Looking around, $alchemist.name is a very clean shop (as far as alchemist shops go). There are sheafs of paper, presumably recipes, neatly stacked on benches away from the ominous bubbling of pots that are brewing new concoctions.
	&lt;&lt;elseif $alchemist.cleanlinessroll gt 60&gt;&gt;
    Looking around, $alchemist.name is pretty clean, by alchemical standards. There&#39;s a decent sense of order, and sheafs of paper are for the most part kept away from the pots and jugs of strangely coloured brews that stand in a line on the desk.
	&lt;&lt;elseif $alchemist.cleanlinessroll gt 50&gt;&gt;
    Looking around, $alchemist.name is as clean as you&#39;d expect for a shop that deals with magical, often volatile chemicals. There&#39;s some sense of order, with papers (presumably recipes) kept in stacks, some of them concerningly close to the pots and jugs of strangely coloured brews that clutter the desk.
	&lt;&lt;elseif $alchemist.cleanlinessroll gt 40&gt;&gt;
    Looking around, $alchemist.name is somewhat messy; a dangerous trait for a shop that deals with magical, often volatile chemicals. There&#39;s a vague sense of order, although the papers that are strewn around the room do little to help. There are pots and pans of mixtures yet to be decanted crowding the desk.
	&lt;&lt;elseif $alchemist.cleanlinessroll gt 30&gt;&gt;
    Looking around, $alchemist.name is rather messy; a dangerous trait for a shop that deals with magical, often volatile chemicals. There&#39;s little sense of order, and you accidentally step on a recipe as you make your way through the shop. There are pots and pans of mixtures yet to be decanted crowding the desk, leaving the currently brewing potions to take residence on the floor, where they could be easily knocked over.
	&lt;&lt;elseif $alchemist.cleanlinessroll gt 20&gt;&gt;
    Looking around, $alchemist.name is extremely messy; a very dangerous trait for a shop that deals with magical, often volatile chemicals. There&#39;s no sense of order, and you accidentally step in something that fizzled rather disconcertingly as you make your way through the shop. There are pots and pans of mixtures yet to be cleaned crowding the desk, leaving the currently brewing potions to take residence on the floor, where they could be easily knocked over.
	&lt;&lt;elseif $alchemist.cleanlinessroll lte 20&gt;&gt;
    Looking around, $alchemist.name must have had an explosion the day before; there is no other possible reason that a shop that deals with magical, often volatile chemicals would be so cluttered, crowded, and blatantly a danger to itself and the half-mile radius surrounding it. There are pots and pans of mixtures that have already spilt over crowding the desk, with potions that are currently brewing strewn around the floor. There&#39;s little hope to walk through the shop without putting your boot in something that you probably would prefer not to put it in. Just as you try and hesitate, you hear the distinct sound of &quot;no, please don&#39;t go!&quot; come from the floorboards, which at first seemed to be sticky, but on closer inspection, was more... &#39;grabby&#39;.
&lt;&lt;/if&gt;&gt;&lt;&lt;/nobr&gt;&gt;</tw-passagedata><tw-passagedata pid="4" name="AlchemistNameGen" tags="" position="475,100">&lt;&lt;set _alchemistnameroll to random(1, 5)&gt;&gt;

&lt;&lt;set $alchemist.adjective to either(&quot;Bubbling&quot;, &quot;Spicy&quot;, &quot;Soggy&quot;, &quot;Fizzy&quot;, &quot;Liquid&quot;, &quot;Fluorescent&quot;, &quot;Clear&quot;, &quot;Alcoholic&quot;, &quot;Abyssal&quot;, &quot;Angelic&quot;, &quot;Elven&quot;, &quot;Measured&quot;, &quot;Marked&quot;, &quot;Glass&quot;, &quot;Glass&quot;, &quot;Copper&quot;, &quot;Corked&quot;, &quot;Burning&quot;, &quot;Red&quot;, &quot;Blue&quot;, &quot;Green&quot;, &quot;Gold&quot;, &quot;Yellow&quot;, &quot;Vile&quot;, &quot;Genuine&quot;, &quot;Original&quot;)&gt;&gt;

&lt;&lt;set $alchemist.noun to either(&quot;Potion&quot;, &quot;Liquid&quot;, &quot;Fumes&quot;, &quot;Bottle&quot;, &quot;Vial&quot;, &quot;Firewater&quot;, &quot;Mortar and Pestle&quot;, &quot;Lab&quot;, &quot;Laboratory&quot;, &quot;Chemist&quot;, &quot;Alchemist&quot;, &quot;Brewer&quot;, &quot;Lotion&quot;, &quot;Wishes&quot;)&gt;&gt;

&lt;&lt;set $alchemist.family to either(&quot;Son&quot;, &quot;Daughter&quot;, &quot;Brother&quot;, &quot;Sister&quot;, &quot;Uncle&quot;, &quot;Aunt&quot;, &quot;Father&quot;, &quot;Friends&quot;, &quot;Family&quot;, &quot;Fool&quot;)&gt;&gt;

&lt;&lt;set $alchemist.rider to either(&quot;Chemist&quot;, &quot;Alchemist&quot;, &quot;Potion Shop&quot;, &quot;Potionery&quot;, &quot;Ointmentary&quot;, &quot;Juice Bar&quot;, &quot;Lab&quot;, &quot;Laboratory&quot;, &quot;Secret Lair&quot;)&gt;&gt;

&lt;&lt;switch _alchemistnameroll&gt;&gt;
	&lt;&lt;case 1&gt;&gt;
		&lt;&lt;set $alchemist.name to &quot;The &quot; + $alchemist.adjective + &quot; &quot; + $alchemist.noun&gt;&gt;
	&lt;&lt;case 2&gt;&gt;
		&lt;&lt;set $alchemist.name to $chemist.firstname + &quot; and &quot; + $alchemist.family&gt;&gt;
	&lt;&lt;case 3&gt;&gt;
		&lt;&lt;set $alchemist.name to $alchemist.noun + &quot; and &quot; + $alchemist.family&gt;&gt;
	&lt;&lt;case 4&gt;&gt;
		&lt;&lt;set $alchemist.name to &quot;The &quot; + $alchemist.adjective + &quot; &quot; + $alchemist.rider&gt;&gt;
	&lt;&lt;case 5&gt;&gt;
		&lt;&lt;set $alchemist.name to $alchemist.adjective + &quot; &quot; + $alchemist.noun&gt;&gt;
&lt;&lt;default&gt;&gt;
    &lt;&lt;set $alchemist.name to &quot;The &quot; + $alchemist.adjective + &quot; alchemist&quot;&gt;&gt;
&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="5" name="AlchemistOutput" tags="output" position="600,100">&lt;h1&gt;$alchemist.name&lt;/h1&gt;You enter $alchemist.name and see the chemist is &lt;&lt;print $chemist.idle.random()&gt;&gt;. The $alchemist.size room is $alchemist.cleanliness. The chemist &lt;&lt;print either($chemist.greeting)&gt;&gt;, and &lt;&lt;print either(&quot;saunters&quot;, &quot;walks&quot;, &quot;strolls&quot;, &quot;walks&quot;, &quot;slowly walks&quot;, &quot;drags $chemist.hisher feet over&quot;)&gt;&gt; to you, and introduces $chemist.himher&lt;&lt;nobr&gt;&gt;self&lt;&lt;/nobr&gt;&gt; as $chemist.name, the $chemist.owner of the shop, and asks what $chemist.heshe can do for you.
&lt;&lt;include &quot;AlchemistLookAround&quot;&gt;&gt;
&lt;&lt;linkreplace &quot;&lt;h4&gt;Talk with $chemist.name&lt;/h4&gt;&quot; t8n&gt;&gt;
&lt;h3&gt;$chemist.name&lt;/h3&gt;&lt;&lt;/linkreplace&gt;&gt;

&lt;&lt;link &quot;&lt;h4&gt;Generate a random potion!&lt;/h4&gt;&quot;&gt;&gt;
  &lt;&lt;set $potionroll to random(0, 99)&gt;&gt;
	&lt;&lt;set $potion.title to $potion.titleoriginal[$potionroll],
  $potion.effect to $potion.effectoriginal[$potionroll]&gt;&gt;
  &lt;&lt;set $potion.titlereadout to either($potion.type) + &quot; of &quot; + either($potion.title)&gt;&gt;
  &lt;&lt;set $potion.descriptionreadout to &quot;The potion is in a &quot; + either($potion.container) + &quot;, and has a label showing &quot; + either($potion.label) + &quot;. It looks &quot; + either($potion.appearance) + &quot; with &quot; + either($potion.appearance2) + &quot;. &quot; + &quot;It is &quot; + either($potion.texture) + &quot; and smells of &quot; + either($potion.smell) + &quot; but tastes of &quot; + either($potion.taste) + &quot;.&quot;&gt;&gt;
  &lt;&lt;set $potion.functionreadout to &quot;The potion&#39;s strength is &quot; + either($potion.strength) + &quot;, and &quot; + either($potion.effect) + &quot; with the side effect of &quot; + either($potion.sideeffect) + &quot;.&quot;&gt;&gt;
    &lt;&lt;replace &quot;#randpotion&quot;&gt;&gt;
        \&lt;div class=&quot;descriptive&quot;&gt;
            \&lt;h3&gt;$potion.titlereadout&lt;/h3&gt;
            \$potion.descriptionreadout&lt;br&gt;&lt;/div&gt;
            \&lt;blockquote&gt;$potion.functionreadout&lt;/blockquote&gt;
        \
    \&lt;&lt;/replace&gt;&gt;
&lt;&lt;/link&gt;&gt;\
&lt;span id=&quot;randpotion&quot;&gt;&lt;/span&gt;


&lt;&lt;linkappend &quot;&lt;h4&gt;Buy something&lt;/h4&gt;&quot;&gt;&gt;&lt;&lt;nobr&gt;&gt;
&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;Item&lt;/th&gt;
    &lt;th&gt;Cost&lt;/th&gt;
  &lt;/tr&gt;
&lt;&lt;switch $town.type&gt;&gt;
  &lt;&lt;case &quot;city&quot;&gt;&gt;
  &lt;&lt;for _i, _item range $alchemist.inventory.filter(function (item) { return item.availability &lt;= 4; })&gt;&gt;&lt;tr&gt;&lt;td&gt;_item.name&lt;/td&gt;
&lt;td&gt;&lt;&lt;money _item.cost&gt;&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;&lt;/for&gt;&gt;
  &lt;&lt;case &quot;town&quot;&gt;&gt;
  &lt;&lt;for _i, _item range $alchemist.inventory.filter(function (item) { return item.availability &lt;= 3; })&gt;&gt;&lt;tr&gt;&lt;td&gt;_item.name&lt;/td&gt;
&lt;td&gt;&lt;&lt;money _item.cost&gt;&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;&lt;/for&gt;&gt;
  &lt;&lt;case &quot;village&quot;&gt;&gt;
  &lt;&lt;for _i, _item range $alchemist.inventory.filter(function (item) { return item.availability &lt;= 2; })&gt;&gt;&lt;tr&gt;&lt;td&gt;_item.name&lt;/td&gt;
&lt;td&gt;&lt;&lt;money _item.cost&gt;&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;&lt;/for&gt;&gt;
  &lt;&lt;case &quot;hamlet&quot;&gt;&gt;
  &lt;&lt;for _i, _item range $alchemist.inventory.filter(function (item) { return item.availability &lt;= 1; })&gt;&gt;&lt;tr&gt;&lt;td&gt;_item.name&lt;/td&gt;
&lt;td&gt;&lt;&lt;money _item.cost&gt;&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;&lt;/for&gt;&gt;&lt;/table&gt;
&lt;&lt;/switch&gt;&gt;&lt;&lt;/nobr&gt;&gt;&lt;&lt;/linkappend&gt;&gt;</tw-passagedata><tw-passagedata pid="6" name="AlchemistRenders" tags="render" position="725,100">&lt;&lt;if $alchemist.sizeroll gt 80&gt;&gt;
		&lt;&lt;set $alchemist.size to &quot;huge&quot;&gt;&gt;
	&lt;&lt;elseif $alchemist.sizeroll gt 70&gt;&gt;
		&lt;&lt;set $alchemist.size to &quot;quite large&quot;&gt;&gt;
	&lt;&lt;elseif $alchemist.sizeroll gt 60&gt;&gt;
		&lt;&lt;set $alchemist.size to &quot;large&quot;&gt;&gt;
	&lt;&lt;elseif $alchemist.sizeroll gt 50&gt;&gt;
		&lt;&lt;set $alchemist.size to &quot;spacious&quot;&gt;&gt;
	&lt;&lt;elseif $alchemist.sizeroll gt 40&gt;&gt;
		&lt;&lt;set $alchemist.size to &quot;medium&quot;&gt;&gt;
	&lt;&lt;elseif $alchemist.sizeroll gt 30&gt;&gt;
		&lt;&lt;set $alchemist.size to &quot;slightly cramped&quot;&gt;&gt;
	&lt;&lt;elseif $alchemist.sizeroll gt 20&gt;&gt;
		&lt;&lt;set $alchemist.size to &quot;small&quot;&gt;&gt;
	&lt;&lt;elseif $alchemist.sizeroll lte 20&gt;&gt;
		&lt;&lt;set $alchemist.size to &quot;tiny&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if $alchemist.wealthroll gt 95&gt;&gt;
		&lt;&lt;set $alchemist.wealth to &quot;kingly&quot;&gt;&gt;
	&lt;&lt;elseif $alchemistwealthroll gt 80&gt;&gt;
		&lt;&lt;set $alchemist.wealth to &quot;aristocratic&quot;&gt;&gt;
	&lt;&lt;elseif $alchemistwealthroll gt 70&gt;&gt;
		&lt;&lt;set $alchemist.wealth to &quot;wealthy&quot;&gt;&gt;
	&lt;&lt;elseif $alchemistwealthroll gt 60&gt;&gt;
		&lt;&lt;set $alchemist.wealth to &quot;comfortable&quot;&gt;&gt;
	&lt;&lt;elseif $alchemistwealthroll gt 50&gt;&gt;
		&lt;&lt;set $alchemist.wealth to &quot;modest&quot;&gt;&gt;
	&lt;&lt;elseif $alchemistwealthroll gt 25&gt;&gt;
		&lt;&lt;set $alchemist.wealth to &quot;poor&quot;&gt;&gt;
	&lt;&lt;elseif $alchemistwealthroll lte 25&gt;&gt;
		&lt;&lt;set $alchemist.wealth to &quot;squalid&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;


/* ------------------------- CLEANLINESS -------------------------- */


&lt;&lt;if $alchemist.cleanlinessroll gt 80&gt;&gt;
		&lt;&lt;set $alchemist.cleanliness to &quot;fastidious&quot;&gt;&gt;
	&lt;&lt;elseif $alchemist.cleanlinessroll gt 70&gt;&gt;
		&lt;&lt;set $alchemist.cleanliness to &quot;very tidy&quot;&gt;&gt;
	&lt;&lt;elseif $alchemist.cleanlinessroll gt 60&gt;&gt;
		&lt;&lt;set $alchemist.cleanliness to &quot;tidy&quot;&gt;&gt;
	&lt;&lt;elseif $alchemist.cleanlinessroll gt 50&gt;&gt;
		&lt;&lt;set $alchemist.cleanliness to &quot;reasonably tidy&quot;&gt;&gt;
	&lt;&lt;elseif $alchemist.cleanlinessroll gt 40&gt;&gt;
		&lt;&lt;set $alchemist.cleanliness to &quot;somewhat messy&quot;&gt;&gt;
	&lt;&lt;elseif $alchemist.cleanlinessroll gt 30&gt;&gt;
		&lt;&lt;set $alchemist.cleanliness to &quot;rather messy&quot;&gt;&gt;
	&lt;&lt;elseif $alchemist.cleanlinessroll gt 20&gt;&gt;
		&lt;&lt;set $alchemist.cleanliness to &quot;very messy&quot;&gt;&gt;
	&lt;&lt;elseif $alchemist.cleanlinessroll lte 20&gt;&gt;
		&lt;&lt;set $alchemist.cleanliness to &quot;filthy&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;


/* ------------------------- Expertise -------------------------- */

&lt;&lt;if $alchemist.expertiseroll gt 80&gt;&gt;
		&lt;&lt;set $alchemist.expertise to &quot;masterful&quot;&gt;&gt;
&lt;&lt;elseif $alchemist.expertiseroll gt 70&gt;&gt;
		&lt;&lt;set $alchemist.expertise to &quot;exceptional&quot;&gt;&gt;
&lt;&lt;elseif $alchemist.expertiseroll gt 60&gt;&gt;
		&lt;&lt;set $alchemist.expertise to &quot;superior quality&quot;&gt;&gt;
&lt;&lt;elseif $alchemist.expertiseroll gt 50&gt;&gt;
		&lt;&lt;set $alchemist.expertise to &quot;finely-crafted&quot;&gt;&gt;
&lt;&lt;elseif $alchemist.expertiseroll gt 40&gt;&gt;
		&lt;&lt;set $alchemist.expertise to &quot;well-crafted&quot;&gt;&gt;
&lt;&lt;elseif $alchemist.expertiseroll gt 30&gt;&gt;
		&lt;&lt;set $alchemist.expertise to &quot;somewhat well made&quot;&gt;&gt;
&lt;&lt;elseif $alchemist.expertiseroll gt 20&gt;&gt;
		&lt;&lt;set $alchemist.expertise to &quot;somewhat amateur&quot;&gt;&gt;
&lt;&lt;elseif $alchemist.expertiseroll lte 20&gt;&gt;
		&lt;&lt;set $alchemist.expertise to &quot;blatantly amateur&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="7" name="InitAlchemist" tags="output" position="850,100">&lt;&lt;linkreplace &quot;Rename &lt;strong&gt;$alchemist.name&lt;/strong&gt;&quot;&gt;&gt;&lt;h3&gt;&lt;&lt;textbox &quot;$alchemist.name&quot; $alchemist.name&gt;&gt;&lt;/h3&gt;&lt;&lt;/linkreplace&gt;&gt;

Alchemist Wealth: &lt;&lt;numberslider &quot;$alchemist.wealthroll&quot; $alchemist.wealthroll 1 100 1&gt;&gt;

Alchemist Size: &lt;&lt;numberslider &quot;$alchemist.sizeroll&quot; $alchemist.sizeroll 1 100 1&gt;&gt;

Alchemist Reputation: &lt;&lt;numberslider &quot;$alchemist.reputationroll&quot; $alchemist.reputationroll 1 100 1&gt;&gt;

Alchemist Cleanliness: &lt;&lt;numberslider &quot;$alchemist.cleanlinessroll&quot; $alchemist.cleanlinessroll 1 100 1&gt;&gt;

&lt;&lt;linkreplace &quot;Alchemist Craftsmanship&quot;&gt;&gt;Alchemist Expertise: &lt;&lt;numberslider &quot;$alchemist.expertiseroll&quot; $alchemist.expertiseroll 1 100 1&gt;&gt;

Alchemist Intricacy: &lt;&lt;numberslider &quot;$alchemist.intricacyroll&quot; $alchemist.intricacyroll 1 100 1&gt;&gt;

Alchemist Magic: &lt;&lt;numberslider &quot;$alchemist.magicroll&quot; $alchemist.magicroll 1 100 1&gt;&gt;
&lt;&lt;/linkreplace&gt;&gt;

When you&#39;re ready, here&#39;s the [[alchemist|AlchemistOutput]]</tw-passagedata><tw-passagedata pid="8" name="Potions" tags="" position="975,100">&lt;&lt;set $potion to {
	type: [
&quot;Potion&quot;,
&quot;Elixir&quot;,
&quot;Draught&quot;,
&quot;Vial&quot;,
&quot;Philter&quot;,
&quot;Tonic&quot;,
&quot;Brew&quot;,
&quot;Ichor&quot;,
&quot;Juice&quot;,
&quot;Concoction&quot;],
	titleoriginal: [
&quot;Healing&quot;,
&quot;Vigor&quot;,
&quot;Vitality&quot;,
&quot;Might&quot;,
&quot;Courage&quot;,
&quot;Giant Strength&quot;,
&quot;Flame Resistance&quot;,
&quot;Cold Resistance&quot;,
&quot;Necro Resistance&quot;,
&quot;Radiant Resistance&quot;,
&quot;Stoneskin&quot;,
&quot;Acid Resistance&quot;,
&quot;Lightning Resistance&quot;,
&quot;Succubus Charm&quot;,
&quot;Shielding&quot;,
&quot;Flame Breath&quot;,
&quot;Growth&quot;,
&quot;Shrinking&quot;,
&quot;Comprehension&quot;,
&quot;Fertility&quot;,
&quot;Intimidation&quot;,
&quot;Luck&quot;,
&quot;Mana&quot;,
&quot;Arcane&quot;,
&quot;Animal form&quot;,
&quot;Dreams&quot;,
&quot;Nightmares&quot;,
&quot;Stamina&quot;,
&quot;Fleet foot&quot;,
&quot;Knowledge&quot;,
&quot;The Bard&quot;,
&quot;Disguise&quot;,
&quot;Feast&quot;,
&quot;Youth&quot;,
&quot;Age&quot;,
&quot;Furnace&quot;,
&quot;Eagle Sight&quot;,
&quot;Health&quot;,
&quot;Invulnerability&quot;,
&quot;Riddle me gone&quot;,
&quot;Horrifying appearance&quot;,
&quot;Beautiful appearance&quot;,
&quot;Swordsmanship&quot;,
&quot;Bowmanship&quot;,
&quot;Nymph breath&quot;,
&quot;Midas&quot;,
&quot;Berserker&quot;,
&quot;Utter Hatred&quot;,
&quot;Oracle&quot;,
&quot;Demonic Leech&quot;,
&quot;Fey Nature&quot;,
&quot;Tracelessness&quot;,
&quot;Gracefulness&quot;,
&quot;Goblin Climb&quot;,
&quot;Dead Ringer&quot;,
&quot;One Leafed Clover&quot;,
&quot;Possession&quot;,
&quot;Owls Wake&quot;,
&quot;Hawks Flight&quot;,
&quot;Peace&quot;,
&quot;Rejuvenation&quot;,
&quot;Sphinxes Truth&quot;,
&quot;Serpent Tongue&quot;,
&quot;Navigation&quot;,
&quot;Hook Horror&quot;,
&quot;Schaffensfreude&quot;,
&quot;Invisibility&quot;,
&quot;Wild magic&quot;,
&quot;Fame&quot;,
&quot;Goats Trek&quot;,
&quot;Gargoyle Toughness&quot;,
&quot;Atomic Clock&quot;,
&quot;Transmutation&quot;,
&quot;Iron Skin&quot;,
&quot;Sex Change&quot;,
&quot;Race Change&quot;,
&quot;Musical Breath&quot;,
&quot;Utter Understanding&quot;,
&quot;Split Form&quot;,
&quot;Flavour&quot;,
&quot;Glimmer&quot;,
&quot;Love&quot;,
&quot;Poison&quot;,
&quot;Rebirth&quot;,
&quot;Elemental form&quot;,
&quot;True form&quot;,
&quot;Gods Touch&quot;,
&quot;Antidepressant&quot;,
&quot;Ghostly Form&quot;,
&quot;Artisans Skill&quot;,
&quot;Godly form&quot;,
&quot;Bless Weapon&quot;,
&quot;Euphoria&quot;,
&quot;Bodyguard&quot;,
&quot;Babelfish&quot;,
&quot;Preservation&quot;,
&quot;Fear&quot;,
&quot;Night vision&quot;,
&quot;Tracking&quot;,
&quot;Cure-all&quot;],

	effectoriginal: [
&quot;instantly regenerates some health when drank&quot;,
&quot;gives temporary health when drank&quot;,
&quot;slowly regenerates health over a period of some hours&quot;,
&quot;gives a bonus to attack rolls after drinking&quot;,
&quot;gives immunity to fear and some temporary inspiration&quot;,
&quot;gives the user much more strength&quot;,
&quot;gives resistance to fire damage&quot;,
&quot;gives resistance to cold damage&quot;,
&quot;gives resistance to necrotic damage&quot;,
&quot;gives resistance to radiant damage&quot;,
&quot;gives resistance to martial damage&quot;,
&quot;gives resistance to acid&quot;,
&quot;gives resistance to lightning damage&quot;,
&quot;makes the drinker irresistible to nearby people&quot;,
&quot;gives the user a magical shield of energy&quot;,
&quot;gives the user fire breath for a short time&quot;,
&quot;makes the user double in size&quot;,
&quot;makes the user half in size&quot;,
&quot;lets the user understand all languages&quot;,
&quot;makes the user very fertile, almost certain to make a baby under its effects&quot;,
&quot;gives the user a huge booming voice that terrifies those around&quot;,
&quot;gives the user a temporary boost to luck&quot;,
&quot;gives the user more magical power to cast with&quot;,
&quot;gives the user more powerful spells&quot;,
&quot;makes the user turn into a random animal&quot;,
&quot;makes the user get lost in a hallucinary dream world of their perfect dream&quot;,
&quot;makes the user get lost in a hallucinary dream world of their worst nightmares&quot;,
&quot;gives the user more stamina and constitution&quot;,
&quot;makes the user have more speed&quot;,
&quot;increases the users intelligence temporarily&quot;,
&quot;increases the users dexterity temporarily&quot;,
&quot;changes the users form to a disguised form of any race and appeance&quot;,
&quot;removes all hunger and thirst from the target&quot;,
&quot;makes the user grow some years younger&quot;,
&quot;makes the user grow some years older&quot;,
&quot;makes the user radiate with a damaging aura&quot;,
&quot;gives the user strong vision and a bonus to perception&quot;,
&quot;cures all diseases and illnesses&quot;,
&quot;freezes the user in stasis that makes them immune to damage but they cannot move or act&quot;,
&quot;gives the user the cure to a single riddle&quot;,
&quot;makes the user look more ugly for a time&quot;,
&quot;makes the user appear more attractive for a time&quot;,
&quot;makes the user more effective and versatile with a blade&quot;,
&quot;makes the user more effective with a bow or ranged weapon&quot;,
&quot;gives water breathing&quot;,
&quot;makes the user turn things to gold&quot;,
&quot;makes the user rage with great strength&quot;,
&quot;makes the user have bonuses against a particular type of enemy&quot;,
&quot;lets the user divinate the future&quot;,
&quot;heals a portion of all damage the user deals&quot;,
&quot;lets the user become one with animals and nature around them&quot;,
&quot;makes the user very hard to follow&quot;,
&quot;makes the user have a better acrobatics skill&quot;,
&quot;gives the user a bonus to climbing&quot;,
&quot;makes the user appear completely dead to all magic&quot;,
&quot;gives the user worst luck&quot;,
&quot;lets the user gain control of a nearby creature, their body comatosed while they do&quot;,
&quot;makes the user need no sleep for a time&quot;,
&quot;lets the user fly&quot;,
&quot;makes the user very calm and unable to harm others&quot;,
&quot;heals a single scar or bad injury on the user such as a missing arm&quot;,
&quot;makes the user tell the truth&quot;,
&quot;makes the user only able to lie&quot;,
&quot;makes the user unable to get lost and find where they need&quot;,
&quot;turns the users hands become sharp weaponised blades&quot;,
&quot;makes the enemies take damage as they deal it to the user&quot;,
&quot;makes the user invisible&quot;,
&quot;taps into wild magic making an absolutely random thing happen&quot;,
&quot;makes the user more famous&quot;,
&quot;makes the user immune to the toils of long travels and bad weather&quot;,
&quot;increases the users constitution&quot;,
&quot;lets the user know the exact tme and date&quot;,
&quot;lets the user have the ability to change somethings properties&quot;,
&quot;turns the users skin to metal giving them many resistances&quot;,
&quot;changes the users gender&quot;,
&quot;changes the users race&quot;,
&quot;makes the user say everything in song, and fey music follows them in the air&quot;,
&quot;makes the user know very intimately about one exact thing&quot;,
&quot;turns the user into two or three tiny versions of themselves and controls them all&quot;,
&quot;makes anything and everything taste amazing!&quot;,
&quot;makes the user and its gear instantly clean and as good looking as possible&quot;,
&quot;makes the user and someone else fall in love&quot;,
&quot;poisons the user, weakening them&quot;,
&quot;resurrects the user if they die soon after drinking&quot;,
&quot;turns the user to an elemental form relevant to their personality&quot;,
&quot;turns the user into a familiar like creature similar to their personality&quot;,
&quot;gives the user a holy connection to their god or fiendish deity&quot;,
&quot;does what it says on the tin&quot;,
&quot;makes the user intangible and able to phase through objects&quot;,
&quot;gives the user skill in a particular art temporarily&quot;,
&quot;improves all stats&quot;,
&quot;makes the users weapons do more damage&quot;,
&quot;makes the user feel amazing and trip out&quot;,
&quot;creates a spectral bodyguard for a short time who obeys orders&quot;,
&quot;lets the user speak any language but not understand it&quot;,
&quot;stops whatever its poured on from rotting or degrading&quot;,
&quot;makes the user terrified&quot;,
&quot;gives the ability to see in the dark&quot;,
&quot;lets the user track an enemy&quot;,
&quot;cures any status effects&quot;],

	strength: [
&quot;regular with no side effect&quot;,
&quot;regular with a slight side effect&quot;,
&quot;regular with a strong side effect&quot;,
&quot;minor with a strong side effect&quot;,
&quot;minor with a slight side effect&quot;,
&quot;major with a strong side effect&quot;,
&quot;major with a small side effect&quot;,
&quot;poisonous. Almost no positive effect and is all side effect&quot;,
&quot;temporary, but strong and wears off quickly&quot;,
&quot;seemingly permanent&quot;],

	sideeffect: [
&quot;nothing bad at all&quot;,
&quot;puts the user to sleep&quot;,
&quot;rapid hair growth all over the body&quot;,
&quot;bleeding from the eyes&quot;,
&quot;vivid hallucinations&quot;,
&quot;flashbacks of your own eventual demise&quot;,
&quot;the skin to crack and appear distorted&quot;,
&quot;spots to grow on the skin&quot;,
&quot;diarrhoea&quot;,
&quot;vomiting&quot;,
&quot;blurred vision&quot;,
&quot;blindness&quot;,
&quot;deafness&quot;,
&quot;mutism&quot;,
&quot;health loss via rapid bleeding&quot;,
&quot;a sudden horrific accent&quot;,
&quot;the irresistible urge to dance&quot;,
&quot;the hearing of demons&quot;,
&quot;loss of balance&quot;,
&quot;everything tasting like dirt for some time&quot;,
&quot;excessive drooling&quot;,
&quot;loss of intelligence&quot;,
&quot;loss of strength&quot;,
&quot;loss of speed&quot;,
&quot;loss of charisma&quot;,
&quot;genuine happiness&quot;,
&quot;hunger&quot;,
&quot;thirst&quot;,
&quot;trouble breathing&quot;,
&quot;sudden moustache&quot;,
&quot;poisoning&quot;,
&quot;petrification&quot;,
&quot;stunning&quot;,
&quot;immobilisation&quot;,
&quot;increased libido&quot;,
&quot;fidgeting&quot;,
&quot;itchiness&quot;,
&quot;rashes&quot;,
&quot;attracts bears&quot;,
&quot;magically covers in dirt&quot;,
&quot;horrifying stench&quot;,
&quot;baldness&quot;,
&quot;swelling&quot;,
&quot;loss of a random item&quot;,
&quot;curses&quot;,
&quot;damage&quot;,
&quot;weakness to a magical damage type&quot;,
&quot;weakness to physical damage&quot;,
&quot;feelings of guilt&quot;,
&quot;feelings of anxiety&quot;,
&quot;feelings of shame&quot;,
&quot;sneezing&quot;,
&quot;uncontrollable crying&quot;,
&quot;need to sing heroic music&quot;,
&quot;urge to hug&quot;,
&quot;kleptomania&quot;,
&quot;burping&quot;,
&quot;loss of smell&quot;,
&quot;insomnia&quot;,
&quot;paranoia&quot;,
&quot;bad luck&quot;,
&quot;summons imps that want to kill you&quot;,
&quot;summons angry bees&quot;,
&quot;fear of something&quot;,
&quot;temporary madness&quot;,
&quot;relaxation&quot;,
&quot;appreciation of colours and sound&quot;,
&quot;tripping the hell out&quot;,
&quot;painful lust&quot;,
&quot;light headedness&quot;,
&quot;increased confidence&quot;,
&quot;recklessness&quot;,
&quot;rage&quot;,
&quot;sadness&quot;,
&quot;dizziness&quot;,
&quot;pain&quot;,
&quot;slight possession&quot;,
&quot;allergic reaction to your favourite food&quot;,
&quot;strong belief that you are someone else&quot;,
&quot;severe debt&quot;,
&quot;grumpiness&quot;,
&quot;muscle spasms&quot;,
&quot;a bloated feeling&quot;,
&quot;a cold&quot;,
&quot;a fever&quot;,
&quot;becoming strangely light&quot;,
&quot;weakness&quot;,
&quot;the urge to fight&quot;,
&quot;the need to make friends&quot;,
&quot;nausea&quot;,
&quot;mood swings&quot;,
&quot;addiction&quot;,
&quot;need for booze&quot;,
&quot;drunkeness&quot;,
&quot;coughing&quot;,
&quot;uncontrollable babbling&quot;,
&quot;slight aches&quot;,
&quot;a bad taste for some time&quot;,
&quot;giddiness&quot;,
&quot;laughter&quot;],


	container: [
&quot;conical smooth glass bottle&quot;,
&quot;square glass bottle&quot;,
&quot;not quite watertight leather waterskin&quot;,
&quot;stone flask&quot;,
&quot;metal thermos&quot;,
&quot;glass syringe&quot;,
&quot;small medical vial&quot;,
&quot;small shot sized bottle&quot;,
&quot;large metal bottle&quot;,
&quot;capped horn&quot;,
&quot;rather decorative glass bottle&quot;,
&quot;geometric diamond shaped bottle&quot;,
&quot;translucent long wine bottle&quot;,
&quot;translucent beer bottle&quot;,
&quot;leather pouch&quot;,
&quot;spray bottle&quot;,
&quot;coloured bottle&quot;,
&quot;bone flask&quot;,
&quot;small metal vial&quot;,
&quot;large bottle that can be swigged several times&quot;],

	appearance: [
&quot;clear&quot;,
&quot;blue&quot;,
&quot;green&quot;,
&quot;red&quot;,
&quot;pale green&quot;,
&quot;pink&quot;,
&quot;light blue&quot;,
&quot;white&quot;,
&quot;black&quot;,
&quot;dark grey&quot;,
&quot;light grey&quot;,
&quot;yellow&quot;,
&quot;orange&quot;,
&quot;gold&quot;,
&quot;orange&quot;,
&quot;bronze&quot;,
&quot;metallic&quot;,
&quot;purple&quot;,
&quot;brown&quot;,
&quot;dark red&quot;],

	appearance2: [
&quot;flecks of colour&quot;,
&quot;swirls of colour&quot;,
&quot;fizzing bubbles&quot;,
&quot;bubbles suspended in it&quot;,
&quot;some kind of bone floating in it&quot;,
&quot;leaves and flowers in it&quot;,
&quot;two separating liquid&quot;,
&quot;a bright glow&quot;,
&quot;a soft glow&quot;,
&quot;stripes of colour&quot;,
&quot;translucency&quot;,
&quot;a cloudy murkiness&quot;,
&quot;blood within it&quot;,
&quot;dirt floating in it&quot;,
&quot;chunks of metal in it&quot;,
&quot;some type of gore from a slain creature&quot;,
&quot;steam coming from it&quot;,
&quot;a face in the liquid&quot;,
&quot;constantly moving and shifting liquid&quot;,
&quot;a constant heat&quot;],

	texture: [
&quot;thick and sludgy&quot;,
&quot;thin and watery&quot;,
&quot;airy and bubbly&quot;,
&quot;slimey&quot;,
&quot;almost solid&quot;,
&quot;oily&quot;,
&quot;chunky&quot;,
&quot;bitty&quot;,
&quot;milky&quot;,
&quot;almost gaseous&quot;],

	smell: [
&quot;nothing at all&quot;,
&quot;sulphur&quot;,
&quot;fresh air&quot;,
&quot;baking cookies&quot;,
&quot;flowers&quot;,
&quot;rotting meat&quot;,
&quot;egg&quot;,
&quot;rotten eggs&quot;,
&quot;fresh bread&quot;,
&quot;blood&quot;,
&quot;home&quot;,
&quot;vomit&quot;,
&quot;garlic&quot;,
&quot;fruit&quot;,
&quot;chocolate&quot;,
&quot;beer&quot;,
&quot;smoke&quot;,
&quot;wood&quot;,
&quot;death&quot;,
&quot;orc&quot;,
&quot;wet dog&quot;,
&quot;wet goblin&quot;,
&quot;perfume&quot;,
&quot;cheap perfume&quot;,
&quot;musk&quot;,
&quot;garbage&quot;,
&quot;sand&quot;,
&quot;the forest&quot;,
&quot;nuts&quot;,
&quot;acid&quot;,
&quot;spicy things&quot;,
&quot;mint&quot;,
&quot;chemicals&quot;,
&quot;dirt&quot;,
&quot;something bad flavoured to taste better&quot;,
&quot;alcohol&quot;,
&quot;sugar&quot;,
&quot;a damp cave&quot;,
&quot;strange&quot;,
&quot;something indescribable but nice&quot;,
&quot;something indescribable but horrid&quot;,
&quot;rain&quot;,
&quot;medical equipment&quot;,
&quot;bacon&quot;,
&quot;coffee&quot;,
&quot;cut grass&quot;,
&quot;vanilla&quot;,
&quot;the sea&quot;,
&quot;roast meat&quot;,
&quot;festive&quot;,
&quot;lavender&quot;,
&quot;lilac and gooseberries&quot;,
&quot;a fresh baby&quot;,
&quot;a new axe&quot;,
&quot;citrus&quot;,
&quot;leather&quot;,
&quot;metal&quot;,
&quot;a forge&quot;,
&quot;fresh cake&quot;,
&quot;paint&quot;,
&quot;wine&quot;,
&quot;polish&quot;,
&quot;cheese&quot;,
&quot;fish&quot;,
&quot;compost&quot;,
&quot;the sewers&quot;,
&quot;apples&quot;,
&quot;holy oils&quot;,
&quot;massage oil&quot;,
&quot;a brothel&quot;,
&quot;old fruit&quot;,
&quot;roses&quot;,
&quot;something that stirs memories&quot;,
&quot;gingerbread&quot;,
&quot;cinnamon&quot;,
&quot;candy&quot;,
&quot;fumes&quot;,
&quot;bark&quot;,
&quot;chicken&quot;,
&quot;beef&quot;,
&quot;human flesh&quot;,
&quot;gunpowder&quot;,
&quot;a storm&quot;,
&quot;success&quot;,
&quot;gold&quot;,
&quot;mayonnaise&quot;,
&quot;barbeque&quot;,
&quot;salt&quot;,
&quot;pepper&quot;,
&quot;aromatic spices&quot;,
&quot;fruit punch&quot;,
&quot;water&quot;,
&quot;fresh water&quot;,
&quot;stagnant water&quot;,
&quot;mud&quot;,
&quot;a colour&quot;,
&quot;music&quot;,
&quot;the end of the world&quot;,
&quot;the worst, most terrible thing ever&quot;,
&quot;magically the most desirable thing to you&quot;],

	taste: [
	&quot;thick and sludgy&quot;,
	&quot;thin and watery&quot;,
	&quot;airy and bubbly&quot;,
	&quot;slimey&quot;,
	&quot;almost solid&quot;,
	&quot;oily&quot;,
	&quot;chunky&quot;,
	&quot;bitty&quot;,
	&quot;milky&quot;,
	&quot;almost gaseous&quot;],

		smell: [
	&quot;nothing at all&quot;,
	&quot;sulphur&quot;,
	&quot;fresh air&quot;,
	&quot;baking cookies&quot;,
	&quot;flowers&quot;,
	&quot;rotting meat&quot;,
	&quot;egg&quot;,
	&quot;rotten eggs&quot;,
	&quot;fresh bread&quot;,
	&quot;blood&quot;,
	&quot;home&quot;,
	&quot;vomit&quot;,
	&quot;garlic&quot;,
	&quot;fruit&quot;,
	&quot;chocolate&quot;,
	&quot;beer&quot;,
	&quot;smoke&quot;,
	&quot;wood&quot;,
	&quot;death&quot;,
	&quot;orc&quot;,
	&quot;wet dog&quot;,
	&quot;wet goblin&quot;,
	&quot;perfume&quot;,
	&quot;cheap perfume&quot;,
	&quot;musk&quot;,
	&quot;garbage&quot;,
	&quot;sand&quot;,
	&quot;the forest&quot;,
	&quot;nuts&quot;,
	&quot;acid&quot;,
	&quot;spicy things&quot;,
	&quot;mint&quot;,
	&quot;chemicals&quot;,
	&quot;dirt&quot;,
	&quot;something bad flavoured to taste better&quot;,
	&quot;alcohol&quot;,
	&quot;sugar&quot;,
	&quot;a damp cave&quot;,
	&quot;strange&quot;,
	&quot;something indescribable but nice&quot;,
	&quot;something indescribable but horrid&quot;,
	&quot;rain&quot;,
	&quot;medical equipment&quot;,
	&quot;bacon&quot;,
	&quot;coffee&quot;,
	&quot;cut grass&quot;,
	&quot;vanilla&quot;,
	&quot;the sea&quot;,
	&quot;roast meat&quot;,
	&quot;festive&quot;,
	&quot;lavender&quot;,
	&quot;lilac and gooseberries&quot;,
	&quot;a fresh baby&quot;,
	&quot;a new axe&quot;,
	&quot;citrus&quot;,
	&quot;leather&quot;,
	&quot;metal&quot;,
	&quot;a forge&quot;,
	&quot;fresh cake&quot;,
	&quot;paint&quot;,
	&quot;wine&quot;,
	&quot;polish&quot;,
	&quot;cheese&quot;,
	&quot;fish&quot;,
	&quot;compost&quot;,
	&quot;the sewers&quot;,
	&quot;apples&quot;,
	&quot;holy oils&quot;,
	&quot;massage oil&quot;,
	&quot;a brothel&quot;,
	&quot;old fruit&quot;,
	&quot;roses&quot;,
	&quot;something that stirs memories&quot;,
	&quot;gingerbread&quot;,
	&quot;cinnamon&quot;,
	&quot;candy&quot;,
	&quot;fumes&quot;,
	&quot;bark&quot;,
	&quot;chicken&quot;,
	&quot;beef&quot;,
	&quot;human flesh&quot;,
	&quot;gunpowder&quot;,
	&quot;a storm&quot;,
	&quot;success&quot;,
	&quot;gold&quot;,
	&quot;mayonnaise&quot;,
	&quot;barbeque&quot;,
	&quot;salt&quot;,
	&quot;pepper&quot;,
	&quot;aromatic spices&quot;,
	&quot;fruit punch&quot;,
	&quot;water&quot;,
	&quot;fresh water&quot;,
	&quot;stagnant water&quot;,
	&quot;mud&quot;,
	&quot;a colour&quot;,
	&quot;music&quot;,
	&quot;the end of the world&quot;,
	&quot;the worst, most terrible thing ever&quot;,
	&quot;magically the most desirable thing to you&quot;],

	label: [
&quot;its name and title in bold letters&quot;,
&quot;its description in ornate elvish&quot;,
&quot;its description in elvish with a relevant mythic story&quot;,
&quot;its description on dwarven&quot;,
&quot;Dwarven runes&quot;,
&quot;its description in gnomish&quot;,
&quot;Gnomish diagrams for its use&quot;,
&quot;the words USE ONLY IN EMERGANCIES scrawled on it&quot;,
&quot;a mass produced label claiming the company has no fault for any side effects&quot;,
&quot;a mass produced label saying that it’s a new flavour&quot;,
&quot;very tiny print describing how the potion was made in great detail, around 1000 words&quot;,
&quot;its name in Bold words in Giant&quot;,
&quot;is scrawled off&quot;,
&quot;has faded beyond reading&quot;,
&quot;has been scraped off&quot;,
&quot;its description and a random fact&quot;,
&quot;its description and a small compliment to make your day better&quot;,
&quot;its description and a joke&quot;,
&quot;its description in infernal&quot;,
&quot;its description in some ancient language&quot;,
&quot;all in some kind of symbols&quot;,
&quot;all in some kind of raised symbols for the blind to read&quot;,
&quot;its description in elemental languages&quot;,
&quot;its name and flavour&quot;,
&quot;its name with a warning about side effects&quot;,
&quot;its name and its recommended buying price&quot;,
&quot;bloody prints all over it&quot;,
&quot;name engraved into the container&quot;,
&quot;its name glowing with minor magic&quot;,
&quot;a cartoony mascot&quot;,
&quot;a warning of an ancient curse&quot;,
&quot;its name and description in invisible ink&quot;,
&quot;its description in draconic&quot;,
&quot;several different names and descriptions plastered over each other&quot;,
&quot;a name of a completely different potion to what it does&quot;,
&quot;a title describing the exact opposite&quot;,
&quot;a money back guarantee&quot;,
&quot;a coupon for a free potion&quot;,
&quot;a living face looking around&quot;,
&quot;its name and recipe for other alchemists&quot;,
&quot;a heartfelt love letter for someone&quot;,
&quot;a heartfelt hate letter for someone&quot;,
&quot;a persons name&quot;,
&quot;the potion won&#39;t work unless asked by its name to do so&quot;,
&quot;a strange prophecy&quot;,
&quot;a small doodle&quot;,
&quot;a note saying DO NOT DRINK&quot;,
&quot;a passive aggressive note about other people drinking potions that do not belong to them&quot;,
&quot;brightly glowing letters&quot;,
&quot;that plays a very quiet sing song &#39;till the bottle is empty&quot;,
&quot;ornate and beautiful designs&quot;,
&quot;very practical designs&quot;,
&quot;holy symbols&quot;,
&quot;unholy symbols&quot;,
&quot;Fey symbols and Sylvan writing&quot;,
&quot;a riddle, the lid not opening unless the riddle is solved&quot;,
&quot;saying its designed for babies&quot;,
&quot;saying that it shouldn’t be drank by anyone under 18&quot;,
&quot;a note saying it is illegal contraband being confiscated&quot;,
&quot;a note saying the alchemist thinks it is its greatest work&quot;,
&quot;a note saying the alchemist is sorry for ever creating it&quot;,
&quot;a note saying that it never should have been made and copius blood stains over the bottle&quot;,
&quot;it says you’re being watched&quot;,
&quot;its description in Druidic&quot;,
&quot;its description in Orcish&quot;,
&quot;its description in Goblin&quot;,
&quot;its description in Halfling&quot;,
&quot;its description in Celestial&quot;,
&quot;its description in Undercommon&quot;,
&quot;its description in Deep speech&quot;,
&quot;its description in strange arcane symbols&quot;,
&quot;a map of where the potion was made&quot;,
&quot;a small puzzle for kids&quot;,
&quot;a list of ingredients in their chemical forms&quot;,
&quot;a list of possible side effects as long as the bottle is&quot;,
&quot;a red X&quot;,
&quot;a sad face&quot;,
&quot;an angry face&quot;,
&quot;a happy face&quot;,
&quot;a healing symbol&quot;,
&quot;a cheesy pun potion name&quot;,
&quot;growing with vines&quot;,
&quot;growing with flowers&quot;,
&quot;growing with crystals&quot;,
&quot;growing with rock&quot;,
&quot;shamanistic symbols and shavings&quot;,
&quot;no words just a single colour&quot;,
&quot;water damaged but a just barely legible label&quot;,
&quot;a label as if it was some kind of present&quot;,
&quot;a label showing how many calories it is&quot;,
&quot;a warning about potion abuse and to only take in moderation&quot;,
&quot;a label with warnings and side effects all scribbled out&quot;,
&quot;that only shows the side effects&quot;,
&quot;a mysterious number- &lt;&lt;print random(0, 100)&gt;&gt;&quot;,
&quot;a code name&quot;,
&quot;a few unrelated letters&quot;,
&quot;the name of one of the party members&quot;,
&quot;the name of the bad guy&quot;,
&quot;crawling with bugs&quot;,
&quot;covered in something unspeakable&quot;,
&quot;covered in glitter. It gets everywhere&quot;]
}&gt;&gt;
/*
&lt;&lt;set _potionroll to random(0, 99)&gt;&gt;
	&lt;&lt;set $potion.title to $potion.title[_potionroll], $potion.effect to $potion.effect[_potionroll]&gt;&gt;

&lt;&lt;set $potion.titlereadout to either($potion.type) + &quot; of &quot; + either($potion.title)&gt;&gt;
&lt;&lt;set $potion.descriptionreadout to &quot;The potion is in a &quot; + either($potion.container) + &quot;, and has a label showing &quot; + either($potion.label) + &quot;. It looks &quot; + either($potion.appearance) + &quot; with &quot; + either($potion.appearance2) + &quot;. &quot; + &quot;It is &quot; + either($potion.texture) + &quot; and smells of &quot; + either($potion.smell) + &quot; but tastes of &quot; + either($potion.taste) + &quot;.&quot;&gt;&gt;
&lt;&lt;set $potion.functionreadout to &quot;The potion&#39;s strength is &quot; + either($potion.strength) + &quot;, and &quot; + either($potion.effect) + &quot; with the side effect of &quot; + either($potion.sideeffect) + &quot;.&quot;&gt;&gt;*/</tw-passagedata><tw-passagedata pid="9" name="Blacksmith" tags="" position="1100,100">&lt;&lt;set $blacksmith to setup.createNPC()&gt;&gt;

&lt;&lt;set $blacksmith.idle to [&quot;talking with a customer&quot;, &quot;picking $blacksmith.hisher nose&quot;, &quot;playing a card game by $blacksmith.himher&lt;&lt;nobr&gt;&gt;self&lt;&lt;/nobr&gt;&gt;&quot;, &quot;sharpening a knife&quot;, &quot;stocking the forge with fresh coals&quot;, &quot;lugging a piece of metal to be worked on&quot;, &quot;wiping the sweat from $blacksmith.hisher brow&quot;, &quot;taking a drink of water&quot;, &quot;sweating profusely from exertion&quot;],
	$blacksmith.owner to either([&quot;owner&quot;, &quot;caretaker&quot;, &quot;proud owner&quot;, &quot;proprietor&quot;, &quot;current owner&quot;, &quot;chief owner&quot;, &quot;master smith&quot;, &quot;resident smith&quot;]),
	$blacksmith.greeting to [&quot;nods at you&quot;, &quot;welcomes you warmly&quot;, &quot;smiles and greets you&quot;, &quot;raises a hand with a wave&quot;, &quot;sizes you up, before $blacksmith.heshe nods at you&quot;, &quot;checks you out for just a moment before smiling at you&quot;],
	$blacksmith.currentproject to either([&quot;a &lt;&lt;print either($smithy.weapons)&gt;&gt; for Lord $lord.lastname&#39;s son.&quot;, &quot;a &lt;&lt;print either($smithy.weapons)&gt;&gt; which I&#39;m hoping to sell on the market in a couple day&#39;s time.&quot;, &quot;a &lt;&lt;print either($smithy.weapons)&gt;&gt; which I&#39;m hoping to sell on the market in a couple day&#39;s time.&quot;, &quot;a mace for the priest; nothing too special, just because his old one was starting to get a bit rusty.&quot;, &quot;a dagger for uh, a client which I&#39;m not at liberty to name.&quot;, &quot;a greataxe. Dunno why, just thought that it&#39;d be fun to try and make one.&quot;, &quot;a set of horseshoes for ol&#39; Bessie. Nah, I&#39;m just messin&#39; with ya. I&#39;m working on a &lt;&lt;print either($smithy.weapons)&gt;&gt;. Should be pretty fun once it&#39;s finished!&quot;, &quot;a &lt;&lt;print either($smithy.weapons)&gt;&gt; for my son, he&#39;s growing up so fast- he&#39;ll be six next winter!&quot;, &quot;a &lt;&lt;print either($smithy.weapons)&gt;&gt; for $guardcaptain.name.&quot;, &quot;a &lt;&lt;print either($smithy.weapons)&gt;&gt; for $guardcaptain.name.&quot;])&gt;&gt;</tw-passagedata><tw-passagedata pid="10" name="BlacksmithTalk" tags="" position="1225,100">$blacksmith.firstname looks &lt;&lt;print $blacksmith.currentmood.random()&gt;&gt;, and while you chat, $blacksmith.heshe moves around the shop, preparing a new project for work. $blacksmith.firstname &lt;&lt;print either(&quot;loves working in $smithy.name&quot;, &quot;hates working in $smithy.name&quot;, &quot;finds working in the $smithy.name boring&quot;, &quot;finds working in the smithy fun&quot;)&gt;&gt;, and says that the patrons of $smithy.name are &lt;&lt;print either(&quot;alright, especially the farmers, who are pretty decent blokes&quot;, &quot;a bit stingy, especially the farmers&quot;, &quot;somewhat stingy&quot;, &quot;fine, but rather dull&quot;, &quot;way too exciting for $blacksmith.firstname&#39;s tastes&quot;, &quot;nice and friendly&quot;, &quot;nice and friendly, but rather boring- nothing interesting is ever ordered&quot;, &quot;just a bunch of hicks&quot;, &quot;a bunch of weirdos&quot;)&gt;&gt;. You ask $blacksmith.firstname about $blacksmith.hisher current project, and $blacksmith.heshe says &quot;I&#39;m working on $blacksmith.currentproject&quot;</tw-passagedata><tw-passagedata pid="11" name="InitSmithy" tags="output" position="100,225">&lt;&lt;linkreplace &quot;Rename &lt;strong&gt;$smithy.name&lt;/strong&gt;&quot;&gt;&gt;&lt;h3&gt;&lt;&lt;textbox &quot;$smithy.name&quot; $smithy.name&gt;&gt;&lt;/h3&gt;&lt;&lt;/linkreplace&gt;&gt;

Smithy Wealth: &lt;&lt;numberslider &quot;$smithy.wealthroll&quot; $smithy.wealthroll 1 100 1&gt;&gt;

Smithy Size: &lt;&lt;numberslider &quot;$smithy.sizeroll&quot; $smithy.sizeroll 1 100 1&gt;&gt;

Smithy Reputation: &lt;&lt;numberslider &quot;$smithy.reputationroll&quot; $smithy.reputationroll 1 100 1&gt;&gt;

Smithy Cleanliness: &lt;&lt;numberslider &quot;$smithy.cleanlinessroll&quot; $smithy.cleanlinessroll 1 100 1&gt;&gt;

Smithy Expertise: &lt;&lt;numberslider &quot;$smithy.expertiseroll&quot; $smithy.expertiseroll 1 100 1&gt;&gt;

Smithy Magic: &lt;&lt;numberslider &quot;$smithy.magicroll&quot; $smithy.magicroll 1 100 1&gt;&gt;
&lt;&lt;/linkreplace&gt;&gt;

When you&#39;re ready, here&#39;s the [[smithy|SmithyOutput]]</tw-passagedata><tw-passagedata pid="12" name="Smithy" tags="" position="225,225">&lt;&lt;set $smithy to setup.createBuilding()&gt;&gt;
&lt;&lt;set $smithy.weapons to [&quot;dagger&quot;, &quot;long sword&quot;, &quot;short sword&quot;, &quot;morning star&quot;, &quot;mace&quot;, &quot;axe&quot;, &quot;greataxe&quot;, &quot;spear&quot;, &quot;falcheon&quot;]&gt;&gt;
&lt;&lt;set $smithy.mundane to [&quot;plows&quot;, &quot;rabbit traps&quot;, &quot;horseshoes&quot;, &quot;shovels&quot;, &quot;lamps&quot;, &quot;fire pokers&quot;, &quot;axes&quot;, &quot;hammers&quot;, &quot;pliers&quot;, &quot;steel couplings&quot;, &quot;trays&quot;, &quot;wheelbarrows&quot;]&gt;&gt;</tw-passagedata><tw-passagedata pid="13" name="SmithyInventory" tags="" position="350,225">&lt;&lt;set $smithy.inventory to [
      {name: &quot;Dagger&quot;, cost: 200, availability: 1},
      {name: &quot;Handaxe&quot;, cost: 500, availability: 1},
      {name: &quot;Javelin&quot;, cost: 50, availability: 2},
      {name: &quot;Light Hammer&quot;, cost: 200, availability: 1},
      {name: &quot;Sickle&quot;, cost: 100, availability: 1},
      {name: &quot;Spear&quot;, cost: 100, availability: 1},

      {name: &quot;Battleaxe&quot;, cost: 1000, availability: 2},
      {name: &quot;Flail&quot;, cost: 1000, availability: 2},
      {name: &quot;Glaive&quot;, cost: 2000, availability: 3},
      {name: &quot;Greataxe&quot;, cost: 3000, availability: 3},
      {name: &quot;Greatsword&quot;, cost: 5000, availability: 4},
      {name: &quot;Halberd&quot;, cost: 2000, availability: 4},
      {name: &quot;Lance&quot;, cost: 1000, availability: 4},
      {name: &quot;Longsword&quot;, cost: 1500, availability: 2},
      {name: &quot;Maul&quot;, cost: 1000, availability: 2},
      {name: &quot;Morningstar&quot;, cost: 1500, availability: 2},
      {name: &quot;Pike&quot;, cost: 500, availability: 1},
      {name: &quot;Rapier&quot;, cost: 2500, availability: 3},
      {name: &quot;Scimitar&quot;, cost: 2500, availability: 2},
      {name: &quot;Shortsword&quot;, cost: 1000, availability: 1},
      {name: &quot;Arrows (20)&quot;, cost: 100, availability: 1},
      {name: &quot;Crossbow Bolts (20)&quot;, cost: 100, availability: 2},

      {name: &quot;Leather Armor&quot;, cost: 2000, availability: 2},
      {name: &quot;Studded Leather Armor&quot;, cost: 4500, availability: 3},
      {name: &quot;Chain Shirt&quot;, cost: 5000, availability: 1},
      {name: &quot;Scale Mail&quot;, cost: 5000, availability: 1},
      {name: &quot;Breastplate&quot;, cost: 40000, availability: 2},
      {name: &quot;Half Plate&quot;, cost: 750000, availability: 4},
      {name: &quot;Ring Mail&quot;, cost: 3000, availability: 2},
      {name: &quot;Chain Mail&quot;, cost: 7500, availability: 2},
      {name: &quot;Splint&quot;, cost: 20000, availability: 3},
      {name: &quot;Plate&quot;, cost: 1500000, availability: 4},
      {name: &quot;Shield&quot;, cost: 1000, availability: 1},

      {name: &quot;Ball Bearings (1000)&quot;, cost: 100, availability: 2},
      {name: &quot;Bell&quot;, cost: 100, availability: 1},
      {name: &quot;Block and Tackle&quot;, cost: 100, availability: 1},
      {name: &quot;Chain (10 feet)&quot;, cost: 500, availability: 1},
      {name: &quot;Caltrops (Bag of 20)&quot;, cost: 100, availability: 2},
      {name: &quot;Crowbar&quot;, cost: 200, availability: 1},
      {name: &quot;Grappling Hook&quot;, cost: 200, availability: 3},
      {name: &quot;Hammer&quot;, cost: 100, availability: 1},
      {name: &quot;Sledge Hammer&quot;, cost: 200, availability: 1},
      {name: &quot;Hunting Trap&quot;, cost: 500, availability: 1},
      {name: &quot;Lamp&quot;, cost: 50, availability: 1},
      {name: &quot;Lantern, Bullseye&quot;, cost: 1000, availability: 4},
      {name: &quot;Lantern, Hooded&quot;, cost: 500, availability: 3},
      {name: &quot;Lock&quot;, cost: 1000, availability: 1},
      {name: &quot;Manacles&quot;, cost: 200, availability: 2},
      {name: &quot;Mirror, Steel&quot;, cost: 500, availability: 2},
      {name: &quot;Pick, Miner&#39;s&quot;, cost: 200, availability: 1},
      {name: &quot;Piton&quot;, cost: 5, availability: 1},
      {name: &quot;Pot, Iron&quot;, cost: 200, availability: 1},
      {name: &quot;Ram, Portable&quot;, cost: 400, availability: 4},
      {name: &quot;Spikes, Iron (10)&quot;, cost: 100, availability: 1},
      {name: &quot;Mason&#39;s Tools&quot;, cost: 1000, availability: 2},
      {name: &quot;Smith&#39;s Tools&quot;, cost: 2000, availability: 1},
      {name: &quot;Tinker&#39;s Tools&quot;, cost: 5000, availability: 3},
      {name: &quot;Horn&quot;, cost: 300, availability: 4}
]&gt;&gt;</tw-passagedata><tw-passagedata pid="14" name="SmithyLookAround" tags="" position="475,225">&lt;&lt;nobr&gt;&gt;
	&lt;&lt;if $smithy.cleanlinessroll gt 80&gt;&gt;
		The smithy is fastidious, with a swept floor and tools stored neatly on the walls. There&#39;s a desk in the corner with a piece of parchment showing the current project&#39;s measurements, and the materials are neatly stored in bins. Clearly, whatever apprentice has been charged with upkeep of the smithy has taken their job very seriously.
	&lt;&lt;elseif $smithy.cleanlinessroll gt 70&gt;&gt;
		The smithy is very tidy, with a swept floor and tools stored neatly on the bench in a row. The forge has been recently swept, and there&#39;s a surprising lack of grime. On the wall are several project specifications nailed, with bins of their respective required materials underneath; it&#39;s clearly a well kempt smithy.
	&lt;&lt;elseif $smithy.cleanlinessroll gt 60&gt;&gt;
		The smithy is tidy, with a swept floor and things in some semblance of order. There are sheafs of paper on the bench, with hunks of metal neatly holding each stack down; clearly, they are specifications for different projects, and the materials needed for each of them.
	&lt;&lt;elseif $smithy.cleanlinessroll gt 50&gt;&gt;
		The smithy is reasonably tidy, with the usual dirt from $blacksmith.firstname&lt;&lt;nobr&gt;&gt;&#39;s&lt;&lt;/nobr&gt;&gt; current project on the floor. There are sheafs of parchment on the bench with measurements and specifications for projects, and there&#39;s a bucket of water still sizzling from a recent dousing in the corner.
	&lt;&lt;elseif $smithy.cleanlinessroll gt 40&gt;&gt;
		The smithy is somewhat messy, with the usual dirt and debris from $blacksmith.firstname&lt;&lt;nobr&gt;&gt;&#39;s&lt;&lt;/nobr&gt;&gt; current project on the floor; a half-hearted sweeping has been recently made, although all that did was push the dirt around the smithy to dirty up different parts of the floor.
	&lt;&lt;elseif $smithy.cleanlinessroll gt 30&gt;&gt;
		The smithy is rather messy, with tools strewn around, and spare hunks of metal littering the floor. You can see several projects lying either abandoned or at least temporarily forgotten, coated in a layer of dust. The bench top is cluttered with hammers, and the anvil itself has a layer of grime on it, in desperate need of a cleaning.
	&lt;&lt;elseif $smithy.cleanlinessroll gt 20&gt;&gt;
		The smithy is very messy, with tools and offcuts strewn around, and blackened cobwebs lining the ceiling. There&#39;s a layer of dust and grime on the bench top, and the floor has not been swept in quite a while.
	&lt;&lt;elseif $smithy.cleanlinessroll lte 20&gt;&gt;
		The smithy is filthy, with smoke having blackened the walls and a thick layer of grime and dust coating every surface. The smell of various burnt woods, coals, and other things permeates your nostrils, and your boots leave visible footprints in the ash underfoot.
&lt;&lt;/if&gt;&gt;

&lt;&lt;if $smithy.expertiseroll gt 80&gt;&gt;
		On the bench lies a &lt;&lt;print either($smithy.weapons)&gt;&gt;, and just by looking at it, you can tell that the blacksmith is extremely talented at $blacksmith.hisher craft; this is a weapon clearly fit for a king.
&lt;&lt;elseif $smithy.expertiseroll gt 70&gt;&gt;
		On the bench lies a &lt;&lt;print either($smithy.weapons)&gt;&gt;, and looking at it, you can tell that the blacksmith is talented at $blacksmith.hisher craft; this is a well made weapon.
&lt;&lt;elseif $smithy.expertiseroll gt 60&gt;&gt;
		On the bench is a &lt;&lt;print either($smithy.weapons)&gt;&gt;, and you can tell that $blacksmith.name is well trained; the weapon is more than servicable, and carries a nice heft to it.
&lt;&lt;elseif $smithy.expertiseroll gt 50&gt;&gt;
		On the bench lies a &lt;&lt;print either($smithy.weapons)&gt;&gt;. Inspecting it, it&#39;s of slightly above average quality, and is made well.
&lt;&lt;elseif $smithy.expertiseroll gt 40&gt;&gt;
		On the bench is a &lt;&lt;print either($smithy.weapons)&gt;&gt;. Inspecting it, it&#39;s of slightly below average quality, and has an odd weight to it.
&lt;&lt;elseif $smithy.expertiseroll gt 30&gt;&gt;
		On the bench lies a &lt;&lt;print either($smithy.weapons)&gt;&gt;. Looking at it, you can see that it&#39;s not very well made.
&lt;&lt;elseif $smithy.expertiseroll gt 20&gt;&gt;
		On the bench lies a &lt;&lt;print either($smithy.weapons)&gt;&gt;. It&#39;s a respectable effort for an amateur, but for a professional blacksmith, it&#39;s rather poor quality.
&lt;&lt;elseif $smithy.expertiseroll lte 20&gt;&gt;
		On the bench lies a &lt;&lt;print either($smithy.weapons)&gt;&gt;. It&#39;s obviously amateurish. $blacksmith.firstname moves around the shop, unsure of $blacksmith.himher&lt;&lt;nobr&gt;&gt;self&lt;&lt;/nobr&gt;&gt;, betraying $blacksmith.hisher lack of skills.
&lt;&lt;/if&gt;&gt;&lt;&lt;/nobr&gt;&gt;</tw-passagedata><tw-passagedata pid="15" name="SmithyModifiers" tags="" position="600,225">/* ------------------------- SIZE -------------------------- */
&lt;&lt;if $smithy.sizeroll gt 80&gt;&gt;
		&lt;&lt;set $smithy.size to &quot;huge&quot;&gt;&gt;
	&lt;&lt;elseif $smithy.sizeroll gt 60&gt;&gt;
		&lt;&lt;set $smithy.size to &quot;large&quot;&gt;&gt;
	&lt;&lt;elseif $smithy.sizeroll gt 40&gt;&gt;
		&lt;&lt;set $smithy.size to &quot;medium&quot;&gt;&gt;
	&lt;&lt;elseif $smithy.sizeroll gt 20&gt;&gt;
		&lt;&lt;set $smithy.size to &quot;small&quot;&gt;&gt;
	&lt;&lt;elseif $smithy.sizeroll lte 20&gt;&gt;
		&lt;&lt;set $smithy.size to &quot;tiny&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;

/*
	reputationroll: random(1, 100),
	cleanlinessroll: random(1, 100),
	expertiseroll: random(1, 100),
	intricacyroll: random(1, 100),
	hardinessroll: random(1, 100),
	magicroll:
*/

&lt;&lt;if $smithy.material is &quot;hewn rock&quot;&gt;&gt;
		&lt;&lt;set $smithy.roughnessroll += 3&gt;&gt;
	&lt;&lt;elseif $smithy.material is &quot;chiseled stone&quot;&gt;&gt;
		&lt;&lt;set $smithy.roughnessroll -= 1&gt;&gt;
	&lt;&lt;elseif $smithy.material is &quot;marble&quot;&gt;&gt;
		&lt;&lt;set $smithy.cleanlinessroll += 5, $smithy.wealthroll += 6&gt;&gt;
&lt;&lt;/if&gt;&gt;

/* ------------------------- CLEANLINESS -------------------------- */
&lt;&lt;if $smithy.cleanlinessroll gt 80&gt;&gt;
		&lt;&lt;set $smithy.expertiseroll += 10,
		$smithy.intricacyroll += 12,
		$smithy.hardinessroll += 8,
		$smithy.cleanliness to &quot;fastidious&quot;&gt;&gt;
	&lt;&lt;elseif $smithy.cleanlinessroll gt 70&gt;&gt;
		&lt;&lt;set $smithy.expertiseroll += 7,
		$smithy.intricacyroll += 8,
		$smithy.hardinessroll += 6,
		$smithy.cleanliness to &quot;very tidy&quot;&gt;&gt;
	&lt;&lt;elseif $smithy.cleanlinessroll gt 60&gt;&gt;
		&lt;&lt;set $smithy.expertiseroll += 3,
		$smithy.intricacyroll += 4,
		$smithy.hardinessroll += 4,
		$smithy.cleanliness to &quot;tidy&quot;&gt;&gt;
	&lt;&lt;elseif $smithy.cleanlinessroll gt 50&gt;&gt;
		&lt;&lt;set $smithy.expertiseroll += 1,
		$smithy.hardinessroll += 2,
		$smithy.cleanliness to &quot;reasonably tidy&quot;&gt;&gt;
	&lt;&lt;elseif $smithy.cleanlinessroll gt 40&gt;&gt;
		&lt;&lt;set $smithy.expertiseroll -= 1,
		$smithy.hardinessroll -= 2,
		$smithy.cleanliness to &quot;somewhat messy&quot;&gt;&gt;
	&lt;&lt;elseif $smithy.cleanlinessroll gt 30&gt;&gt;
		&lt;&lt;set $smithy.expertiseroll -= 3,
		$smithy.hardinessroll -= 4,
		$smithy.intricacyroll -= 2,
		$smithy.cleanliness to &quot;rather messy&quot;&gt;&gt;
	&lt;&lt;elseif $smithy.cleanlinessroll gt 20&gt;&gt;
		&lt;&lt;set $smithy.expertiseroll -= 5,
		$smithy.hardinessroll -= 6,
		$smithy.intricacyroll -= 6,
		$smithy.cleanliness to &quot;very messy&quot;&gt;&gt;
	&lt;&lt;elseif $smithy.cleanlinessroll lte 20&gt;&gt;
		&lt;&lt;set $smithy.expertiseroll -= 7,
		$smithy.hardinessroll -= 8,
		$smithy.intricacyroll -= 10,
		$smithy.cleanliness to &quot;filthy&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="16" name="SmithyNameGen" tags="" position="725,225">&lt;&lt;set _smithynameroll to random(1, 5)&gt;&gt;

&lt;&lt;set $smithy.adjective to either(&quot;Hard&quot;, &quot;Sharp&quot;, &quot;Pointy&quot;, &quot;Well-worn&quot;, &quot;Rusted&quot;, &quot;Shiny&quot;, &quot;Cold&quot;, &quot;Glowing&quot;, &quot;Heated&quot;, &quot;Golden&quot;, &quot;Silvered&quot;, &quot;Bronzed&quot;, &quot;Polished&quot;, &quot;Engraved&quot;, &quot;Jeweled&quot;, &quot;Plated&quot;, &quot;Eternal&quot;, &quot;Long-Lasting&quot;, &quot;Famed&quot;)&gt;&gt;

&lt;&lt;set $smithy.noun to either(&quot;Iron&quot;, &quot;Metal&quot;, &quot;Gold&quot;, &quot;Silver&quot;, &quot;Bronze&quot;, &quot;Copper&quot;, &quot;Platinum&quot;, &quot;Electrum&quot;, &quot;Ingot&quot;, &quot;Tongs&quot;, &quot;Pliers&quot;, &quot;Anvil&quot;, &quot;Hammer&quot;, &quot;Forge&quot;, &quot;Bellows&quot;, &quot;Bucket&quot;, &quot;Steam&quot;, &quot;Smoke&quot;, &quot;Chimney&quot;, &quot;Flame&quot;, &quot;Fire&quot;, &quot;Magma&quot;, &quot;Coal&quot;, &quot;Crucible&quot;)&gt;&gt;

&lt;&lt;set $smithy.family to either(&quot;Son&quot;, &quot;Daughter&quot;, &quot;Brother&quot;, &quot;Sister&quot;, &quot;Uncle&quot;, &quot;Aunt&quot;, &quot;Father&quot;, &quot;Friends&quot;, &quot;Family&quot;, &quot;Fool&quot;)&gt;&gt;

&lt;&lt;set $smithy.rider to either(&quot;Shop&quot;, &quot;Blacksmith&quot;, &quot;Fabricator&quot;, &quot;Smith&quot;, &quot;Smithy&quot;, &quot;Farrier&quot;, &quot;Metalsmith&quot;, &quot;Swordsmith&quot;)&gt;&gt;

&lt;&lt;switch _smithynameroll&gt;&gt;
	&lt;&lt;case 1&gt;&gt;
		&lt;&lt;set $smithy.name to &quot;The &quot; + $smithy.adjective + &quot; &quot; + $smithy.noun&gt;&gt;
	&lt;&lt;case 2&gt;&gt;
		&lt;&lt;set $smithy.name to $blacksmith.firstname + &quot; and &quot; + $smithy.family&gt;&gt;
	&lt;&lt;case 3&gt;&gt;
		&lt;&lt;set $smithy.name to $smithy.noun + &quot; and &quot; + $smithy.family&gt;&gt;
	&lt;&lt;case 4&gt;&gt;
		&lt;&lt;set $smithy.name to &quot;The &quot; + $smithy.adjective + &quot; &quot; + $smithy.rider&gt;&gt;
	&lt;&lt;case 5&gt;&gt;
		&lt;&lt;set $smithy.name to $smithy.adjective + &quot; &quot; + $smithy.noun&gt;&gt;
&lt;&lt;default&gt;&gt;
    &lt;&lt;set $smithy.name to &quot;The &quot; + $smithy.adjective + &quot; Smithy&quot;&gt;&gt;
&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="17" name="SmithyOutput" tags="output" position="850,225">&lt;h1&gt;$smithy.name&lt;/h1&gt;You enter $smithy.name and see that inside, the $smithy.size $smithy.material building is $smithy.warmth. The blacksmith is &lt;&lt;print $blacksmith.idle.random()&gt;&gt;. The blacksmith &lt;&lt;print either($blacksmith.greeting)&gt;&gt;, and &lt;&lt;print either(&quot;saunters&quot;, &quot;walks&quot;, &quot;strolls&quot;, &quot;walks&quot;, &quot;slowly walks&quot;, &quot;drags $blacksmith.hisher feet over&quot;)&gt;&gt; to you, and introduces $blacksmith.himher&lt;&lt;nobr&gt;&gt;self&lt;&lt;/nobr&gt;&gt; as $blacksmith.name, the $blacksmith.owner of the smithy, and asks what $blacksmith.heshe can do for you.

&lt;&lt;include &quot;SmithyLookAround&quot;&gt;&gt;


&lt;&lt;linkreplace &quot;&lt;h4&gt;Talk with $blacksmith.name&lt;/h4&gt;&quot; t8n&gt;&gt;
&lt;h3&gt;$blacksmith.name&lt;/h3&gt;&lt;&lt;include &quot;BlacksmithTalk&quot;&gt;&gt;&lt;&lt;/linkreplace&gt;&gt;

&lt;&lt;linkappend &quot;&lt;h4&gt;Buy something&lt;/h4&gt;&quot;&gt;&gt;&lt;&lt;include &quot;SmithySell&quot;&gt;&gt;&lt;&lt;/linkappend&gt;&gt;</tw-passagedata><tw-passagedata pid="18" name="SmithyRenders" tags="render" position="975,225">/* ------------------------- SIZE -------------------------- */
&lt;&lt;set _warmthroll to random(1, 100)&gt;&gt;
&lt;&lt;if $smithy.sizeroll gt 80&gt;&gt;
		&lt;&lt;set $smithy.size to &quot;huge&quot;&gt;&gt;
		&lt;&lt;set _warmthroll -= 20&gt;&gt;
	&lt;&lt;elseif $smithy.sizeroll gt 70&gt;&gt;
		&lt;&lt;set $smithy.size to &quot;quite large&quot;&gt;&gt;
		&lt;&lt;set _warmthroll -= 15&gt;&gt;
	&lt;&lt;elseif $smithy.sizeroll gt 60&gt;&gt;
		&lt;&lt;set $smithy.size to &quot;large&quot;&gt;&gt;
		&lt;&lt;set _warmthroll -= 10&gt;&gt;
	&lt;&lt;elseif $smithy.sizeroll gt 50&gt;&gt;
		&lt;&lt;set $smithy.size to &quot;spacious&quot;&gt;&gt;
		&lt;&lt;set _warmthroll -= 5&gt;&gt;
	&lt;&lt;elseif $smithy.sizeroll gt 40&gt;&gt;
		&lt;&lt;set $smithy.size to &quot;medium&quot;&gt;&gt;
	&lt;&lt;elseif $smithy.sizeroll gt 30&gt;&gt;
		&lt;&lt;set $smithy.size to &quot;slightly cramped&quot;&gt;&gt;
		&lt;&lt;set _warmthroll += 15&gt;&gt;
	&lt;&lt;elseif $smithy.sizeroll gt 20&gt;&gt;
		&lt;&lt;set $smithy.size to &quot;small&quot;&gt;&gt;
		&lt;&lt;set _warmthroll += 15&gt;&gt;
	&lt;&lt;elseif $smithy.sizeroll lte 20&gt;&gt;
		&lt;&lt;set $smithy.size to &quot;tiny&quot;&gt;&gt;
		&lt;&lt;set _warmthroll += 30&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if _warmthroll gt 80&gt;&gt;
		&lt;&lt;set $smithy.warmth to &quot;swelteringly hot&quot;&gt;&gt;
	&lt;&lt;elseif _warmthroll gt 70&gt;&gt;
		&lt;&lt;set $smithy.warmth to &quot;extremely warm&quot;&gt;&gt;
	&lt;&lt;elseif _warmthroll gt 60&gt;&gt;
		&lt;&lt;set $smithy.warmth to &quot;uncomfortably warm&quot;&gt;&gt;
	&lt;&lt;elseif _warmthroll gt 50&gt;&gt;
		&lt;&lt;set $smithy.warmth to &quot;nice and toasty&quot;&gt;&gt;
	&lt;&lt;elseif _warmthroll gt 40&gt;&gt;
		&lt;&lt;set $smithy.warmth to &quot;quite warm&quot;&gt;&gt;
	&lt;&lt;elseif _warmthroll gt 30&gt;&gt;
		&lt;&lt;set $smithy.warmth to &quot;warm&quot;&gt;&gt;
	&lt;&lt;elseif _warmthroll gt 20&gt;&gt;
		&lt;&lt;set $smithy.warmth to &quot;mild&quot;&gt;&gt;
	&lt;&lt;elseif _warmthroll lte 20&gt;&gt;
		&lt;&lt;set $smithy.warmth to &quot;cold&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;

/* ------------------------- CLEANLINESS -------------------------- */


&lt;&lt;if $smithy.cleanlinessroll gt 80&gt;&gt;
		&lt;&lt;set $smithy.cleanliness to &quot;fastidious&quot;&gt;&gt;
	&lt;&lt;elseif $smithy.cleanlinessroll gt 70&gt;&gt;
		&lt;&lt;set $smithy.cleanliness to &quot;very tidy&quot;&gt;&gt;
	&lt;&lt;elseif $smithy.cleanlinessroll gt 60&gt;&gt;
		&lt;&lt;set $smithy.cleanliness to &quot;tidy&quot;&gt;&gt;
	&lt;&lt;elseif $smithy.cleanlinessroll gt 50&gt;&gt;
		&lt;&lt;set $smithy.cleanliness to &quot;reasonably tidy&quot;&gt;&gt;
	&lt;&lt;elseif $smithy.cleanlinessroll gt 40&gt;&gt;
		&lt;&lt;set $smithy.cleanliness to &quot;somewhat messy&quot;&gt;&gt;
	&lt;&lt;elseif $smithy.cleanlinessroll gt 30&gt;&gt;
		&lt;&lt;set $smithy.cleanliness to &quot;rather messy&quot;&gt;&gt;
	&lt;&lt;elseif $smithy.cleanlinessroll gt 20&gt;&gt;
		&lt;&lt;set $smithy.cleanliness to &quot;very messy&quot;&gt;&gt;
	&lt;&lt;elseif $smithy.cleanlinessroll lte 20&gt;&gt;
		&lt;&lt;set $smithy.cleanliness to &quot;filthy&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;


/* ------------------------- Expertise -------------------------- */

&lt;&lt;if $smithy.expertiseroll gt 80&gt;&gt;
		&lt;&lt;set $smithy.expertise to &quot;masterful&quot;&gt;&gt;
&lt;&lt;elseif $smithy.expertiseroll gt 70&gt;&gt;
		&lt;&lt;set $smithy.expertise to &quot;exceptional&quot;&gt;&gt;
&lt;&lt;elseif $smithy.expertiseroll gt 60&gt;&gt;
		&lt;&lt;set $smithy.expertise to &quot;superior quality&quot;&gt;&gt;
&lt;&lt;elseif $smithy.expertiseroll gt 50&gt;&gt;
		&lt;&lt;set $smithy.expertise to &quot;finely-crafted&quot;&gt;&gt;
&lt;&lt;elseif $smithy.expertiseroll gt 40&gt;&gt;
		&lt;&lt;set $smithy.expertise to &quot;well-crafted&quot;&gt;&gt;
&lt;&lt;elseif $smithy.expertiseroll gt 30&gt;&gt;
		&lt;&lt;set $smithy.expertise to &quot;somewhat well made&quot;&gt;&gt;
&lt;&lt;elseif $smithy.expertiseroll gt 20&gt;&gt;
		&lt;&lt;set $smithy.expertise to &quot;somewhat amateur&quot;&gt;&gt;
&lt;&lt;elseif $smithy.expertiseroll lte 20&gt;&gt;
		&lt;&lt;set $smithy.expertise to &quot;blatantly amateur&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="19" name="SmithySell" tags="" position="1100,225">&lt;&lt;nobr&gt;&gt;&lt;div class=&quot;descriptive&quot;&gt;
&lt;&lt;switch $town.type&gt;&gt;
  &lt;&lt;case &quot;city&quot;&gt;&gt;
  $blacksmith.name smiles, and says &quot;You&#39;re looking to buy something? Name it, here at $smithy.name, we stock everything the average man could possibly need!&quot;
  &lt;&lt;case &quot;town&quot;&gt;&gt;
  $blacksmith.name says &quot;Well, what is it you need? We specialise in &lt;&lt;print either($smithy.weapons)&gt;&gt;s, but can do just about anything for you.&quot;
  &lt;&lt;case &quot;village&quot;&gt;&gt;
  $blacksmith.name says &quot;Sure, what are you after? &lt;&lt;print $smithy.mundane.toUpperFirst()random()&gt;&gt;? We&#39;ve got some new traps, very good, guaranteed to kill immediately! Or we have some swords for the more up close and personal.&quot;
  &lt;&lt;case &quot;hamlet&quot;&gt;&gt;
  $blacksmith.name smiles, and says &quot;What are you after? We can do just about anything you could possibly need; &lt;&lt;print $smithy.mundane.randomMany(4)&gt;&gt;, you name it!&quot;
&lt;&lt;/switch&gt;&gt;&lt;/div&gt;

&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;Item&lt;/th&gt;
    &lt;th&gt;Cost&lt;/th&gt;
  &lt;/tr&gt;
&lt;&lt;switch $town.type&gt;&gt;
  &lt;&lt;case &quot;city&quot;&gt;&gt;
  &lt;&lt;for _i, _item range $smithy.inventory.filter(function (item) { return item.availability &lt;= 4; })&gt;&gt;&lt;tr&gt;&lt;td&gt;_item.name&lt;/td&gt;
&lt;td&gt;&lt;&lt;money _item.cost&gt;&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;&lt;/for&gt;&gt;
  &lt;&lt;case &quot;town&quot;&gt;&gt;
  &lt;&lt;for _i, _item range $smithy.inventory.filter(function (item) { return item.availability &lt;= 3; })&gt;&gt;&lt;tr&gt;&lt;td&gt;_item.name&lt;/td&gt;
&lt;td&gt;&lt;&lt;money _item.cost&gt;&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;&lt;/for&gt;&gt;
  &lt;&lt;case &quot;village&quot;&gt;&gt;
  &lt;&lt;for _i, _item range $smithy.inventory.filter(function (item) { return item.availability &lt;= 2; })&gt;&gt;&lt;tr&gt;&lt;td&gt;_item.name&lt;/td&gt;
&lt;td&gt;&lt;&lt;money _item.cost&gt;&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;&lt;/for&gt;&gt;
  &lt;&lt;case &quot;hamlet&quot;&gt;&gt;
  &lt;&lt;for _i, _item range $smithy.inventory.filter(function (item) { return item.availability &lt;= 1; })&gt;&gt;&lt;tr&gt;&lt;td&gt;_item.name&lt;/td&gt;
&lt;td&gt;&lt;&lt;money _item.cost&gt;&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;&lt;/for&gt;&gt;&lt;/table&gt;
&lt;&lt;/switch&gt;&gt;&lt;&lt;/nobr&gt;&gt;</tw-passagedata><tw-passagedata pid="20" name="Authors" tags="" position="1225,225">$specialbrew.author</tw-passagedata><tw-passagedata pid="21" name="Changelog" tags="" position="100,350">v.0.3
- Added ability to rename town &amp; tavern
- Modified room cost formula to mirror the recommended prices
- CSS Style update
- Drop caps!
- Added exclusions for the brothels&#39; main attractions being near the church...
- Minor code cleanup behind the scenes

v.0.2.0
- Added vegetarian &amp; carnivorous menus based on tavern&#39;s roughness.
- Replaced attribute buttons with sliders (that actually work)
- Added races
	&lt;i&gt;Bartender&#39;s race will impact the tavern&#39;s roughness, cleanliness, etc.&lt;/i&gt;
- Added special brews
	&lt;i&gt;Stolen from the /r/DnDBehindTheScreen 10000 Drinks thread&lt;/i&gt;
- Added bonds
	&lt;i&gt;These are kinda hamfisted in, but it&#39;s just in case your PCs are really into talking with the bartender, and you need to make up more stuff to keep them interested.&lt;/i&gt;
- Added descriptions of taverns based on size and draw.
- Made room availability dependent on size, and current population of the tavern.

v.0.1.0
* First release</tw-passagedata><tw-passagedata pid="22" name="CodeSnippets" tags="" position="225,350">/*
tweego -o EEEG.html github/Eigengrau

export TWEEGO_PATH=/Users/admin/Documents/Twine/story-formats/

&lt;&lt;set $npctest to setup.createNPC()&gt;&gt;


&lt;&lt;for _i, _item range $alchemistinventory.filter(function (item) { return item.availability &lt;= 2; })&gt;&gt;
    &lt;&lt;= _i + 1&gt;&gt;. _item.name - &lt;&lt;money _item.cost&gt;&gt;

either($potion.smell)

&lt;div class=&#39;descriptive&#39;&gt;Test &lt;/div&gt;

*/</tw-passagedata><tw-passagedata pid="23" name="Credits" tags="output" position="350,350">Many thanks to /u/FamousHippopotamus and /u/OrkishBlade for their excellent tables and DMing advice over the years. Shoutout to /r/twinegames and the good folks in the Discord server who helped a total newb learn how to code in Twine.

This software is provided on an as-is basis, and no warranty or guarantee that it works is provided. This software will always be free, without any ads or for any pay. If you have purchased this software, seek a refund immediately.

This is still in alpha. If you have any bug reports, suggestions, or submissions (in desperate need of more plot hooks!), please click here: [[Submission Form]]

We have a subreddit! www.reddit.com/r/EigengrausGenerator

&lt;strong&gt;Version: $versionnumber&lt;/strong&gt;

&lt;&lt;linkappend &quot;Changelog:&quot;&gt;&gt;
&lt;&lt;include &quot;Changelog&quot;&gt;&gt;&lt;&lt;/linkappend&gt;&gt;

The following user&#39;s content appears in this instance (i.e. only the content that is currently running is visible in the list below:

$specialbrew.author

&lt;&lt;linkappend &quot;To Do List&quot;&gt;&gt;
&lt;&lt;include &quot;ToDo&quot;&gt;&gt;&lt;&lt;/linkappend&gt;&gt;</tw-passagedata><tw-passagedata pid="24" name="Inactive Stuff" tags="" position="475,350">Ships

Smithy and Blacksmith</tw-passagedata><tw-passagedata pid="25" name="Submission Form" tags="" position="600,350">&lt;&lt;include &quot;Bugs&quot;&gt;&gt;

&lt;iframe src=&quot;https://docs.google.com/forms/d/e/1FAIpQLSekxPe31_N0dzBiE_4CpqAXTQzJoH_XUQcxV2O1C35UsVXvEw/viewform?embedded=true&quot; width=&quot;760&quot; height=&quot;500&quot; frameborder=&quot;0&quot; marginheight=&quot;0&quot; marginwidth=&quot;0&quot;&gt;Loading...&lt;/iframe&gt;</tw-passagedata><tw-passagedata pid="26" name="ToDo" tags="" position="725,350">- Implement Fairmath for some modifiers
- Implement neighbouring taverns
- Implement overview of the town
- Implement pickpocketing
- More rumours
- Implement variable tavern prices based on size, cleanliness, wealth.
  - Fix how lodging is priced during the render phase so it can be modified
- Implement brawls in the tavern
- Implement alchemist&#39;s shop

&lt;&lt;include &quot;Bugs&quot;&gt;&gt;</tw-passagedata><tw-passagedata pid="27" name="Bugs" tags="" position="850,350">Known bugs:</tw-passagedata><tw-passagedata pid="28" name="Books" tags="" position="975,350">&lt;&lt;set $book to {
  pun: [&quot;How to make Illusions and Charm People&quot;,
&quot;The Illithid by Homer&quot;,
&quot;Memoirs of a Genasi&quot;,
&quot;The 7 Habits of Highly Effective Peasants (The sequel to &#39;The Hunger Games: a True Story&#39;)&quot;,
&quot;Diary of a Wimpy Kobold&quot;,
&quot;A Handmaid&#39;s Tail: a collection of short stories by notable Tieflings&quot;,
&quot;Ready Mindflayer One&quot;,
&quot;Dragon Turtles All the Way Down&quot;,
&quot;The Lion, the Witch, and the War-forged&quot;,
&quot;Gone with the Healing Wind&quot;,
&quot;To Kill a Manticore&quot;,
&quot;Planar-shifting for People in a Hurry&quot;,
&quot;One Flew Over the Kenku&#39;s Nest&quot;,
&quot;The Brothers Dragonbornov&quot;,
&quot;For Whom the Behir Tolls&quot;,
&quot;The Power of Mimics: Why Certain Encounters Have Extraordinary Impact&quot;,
&quot;The Wizard of Ooze&quot;,
&quot;Fight. Club. - A Comprehensive Guide for Barbarians&quot;,
&quot;The Secret Life of Bards&quot;,
&quot;The Giving Treant&quot;,
&quot;Alice&#39;s Adventures in the Underdark&quot;,
&quot;50 Shades of Fey&quot;,
&quot;Sense Motive and Sensability&quot;,
&quot;As I Lay at Zero Hit Points&quot;,
&quot;Great Incantations&quot;,
&quot;The Amityville Hook Horror&quot;,
&quot;Dante&#39;s Infernal&quot;,
&quot;The Girl with the Dragonborn Tattoo&quot;,
&quot;Lolth&#39;s Web&quot;,
&quot;Satyrs and Sensibility&quot;,
&quot;Pride and Prestidigitation&quot;,
&quot;The Constant Scrivener&quot;,
&quot;The Left Hand Casts Darkness&quot;,
&quot;The Cockatrice in the Rye&quot;,
&quot;One Thousand and One Knights&quot;,
&quot;The Grapes of Wraith: Wining and Dining the Undead&quot;,
&quot;The Adventures of Nancy Druid&quot;]
}&gt;&gt;</tw-passagedata><tw-passagedata pid="29" name="Guard" tags="" position="1100,350">&lt;&lt;set $guardcaptain to setup.createNPC()&gt;&gt;
&lt;&lt;set $guard to {}&gt;&gt;


&lt;&lt;set _guardpopulationroll to random(-20, 20)&gt;&gt;
&lt;&lt;set _townpop to $town.population&gt;&gt;
&lt;&lt;set $guard.population == (_townpop /= 150 + _guardpopulationroll)&gt;&gt;

&lt;&lt;set _guardnameA to either([&quot;Regiment&quot;, &quot;guard&quot;, &quot;Officers&quot;, &quot;guardsmen&quot;, &quot;Protectors&quot;, &quot;Protectorate&quot;, &quot;Defenders&quot;, &quot;Watch&quot;, &quot;Watchers&quot;, &quot;Watchmen&quot;, &quot;Police&quot;, &quot;Peacemen&quot;, &quot;Axemen&quot;, &quot;Swordsmen&quot;, &quot;Pikesmen&quot;, &quot;Squad&quot;, &quot;Batallion&quot;, &quot;Battlesquad&quot;, &quot;Fighters&quot;])&gt;&gt;
&lt;&lt;set _guardnameB to either([&quot;Justice&quot;, &quot;Righteousness&quot;, &quot;Law&quot;, &quot;Order&quot;, &quot;Safety&quot;, &quot;Strength&quot;, &quot;$town.name&quot;, &quot;$town.name&quot;, &quot;$town.name&quot;])&gt;&gt;
&lt;&lt;set _guardnameC to either([&quot;Black&quot;, &quot;White&quot;, &quot;Shining&quot;, &quot;Just&quot;, &quot;Tall&quot;, &quot;Impenetrable&quot;, &quot;Unbreakable&quot;, &quot;Brass&quot;, &quot;Bronze&quot;, &quot;Blue&quot;, &quot;Strong&quot;])&gt;&gt;
&lt;&lt;set _guardnameD to either([&quot;Hand&quot;, &quot;Fist&quot;, &quot;Gauntlet&quot;, &quot;Glove&quot;, &quot;Hammer&quot;, &quot;Shield&quot;, &quot;Cloak&quot;])&gt;&gt;


&lt;&lt;set _guardnameroll to random(1, 6)&gt;&gt;
&lt;&lt;switch _guardnameroll&gt;&gt;
	&lt;&lt;case 1&gt;&gt;
		&lt;&lt;set $guard.name to &quot;The &quot; + _guardnameA + &quot; of &quot; + $town.name&gt;&gt;
	&lt;&lt;case 2&gt;&gt;
		&lt;&lt;set $guard.name to &quot;The &quot; + $town.name + _guardnameA&gt;&gt;
	&lt;&lt;case 3&gt;&gt;
		&lt;&lt;set $guard.name to &quot;The &quot; + _guardnameA + &quot; of &quot; + _guardnameB&gt;&gt;
	&lt;&lt;case 4&gt;&gt;
		&lt;&lt;set $guard.name to &quot;The &quot; + _guardnameC + &quot; &quot; + _guardnameA&gt;&gt;
	&lt;&lt;case 5&gt;&gt;
		&lt;&lt;set $guard.name to &quot;The &quot; + _guardnameC + &quot; &quot; + _guardnameD&gt;&gt;
	&lt;&lt;case 6&gt;&gt;
			&lt;&lt;set $guard.name to &quot;The &quot; + _guardnameC + &quot; &quot; + _guardnameD + &quot; of &quot; + _guardnameB&gt;&gt;
&lt;&lt;/switch&gt;&gt;

&lt;&lt;if $guard.population gt 20&gt;&gt;
		&lt;&lt;set $guard.size to &quot;batallion&quot;&gt;&gt;
	&lt;&lt;elseif $guard.population gt 10&gt;&gt;
		&lt;&lt;set $guard.size to &quot;squad&quot;&gt;&gt;
	&lt;&lt;elseif $guard.population lte 10&gt;&gt;
		&lt;&lt;set $guard.size to &quot;militia&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="30" name="Markets" tags="" position="1225,350">&lt;&lt;set $market to {
  selling: [&quot;Ale by the pint&quot;,
&quot;Amulets and totems&quot;,
&quot;Apples&quot;,
&quot;Attractive young slaves (bedmates)&quot;,
&quot;Axes and hammers&quot;,
&quot;Bearskin rugs and capes&quot;,
&quot;Beer by the barrel&quot;,
&quot;Biscuits and rolls&quot;,
&quot;Blankets and pillows&quot;,
&quot;Blessings&quot;,
&quot;Bouquets of flowers&quot;,
&quot;Bows and arrows&quot;,
&quot;Brass candlesticks, plates, and lamps&quot;,
&quot;Brass horns and flutes&quot;,
&quot;Cabbages&quot;,
&quot;Candles and candlesticks&quot;,
&quot;Carrots&quot;,
&quot;Carved stone figures&quot;,
&quot;Carved wooden figures&quot;,
&quot;Ceramic vases and cups&quot;,
&quot;Cheap jewelry and trinkets&quot;,
&quot;Cherries&quot;,
&quot;Clay pots, bowls, cups, and vases&quot;,
&quot;Coal&quot;,
&quot;Copper bowls, spoons, kettles, cups&quot;,
&quot;Corn on the cob&quot;,
&quot;Cotton shirts and pants&quot;,
&quot;Dogs and cats&quot;,
&quot;Domestic slaves (maidservants)&quot;,
&quot;Dried fish&quot;,
&quot;Dried herbs&quot;,
&quot;Dried venison&quot;,
&quot;Dried whole grain&quot;,
&quot;Drums and bells&quot;,
&quot;Exotic spices&quot;,
&quot;Exotic teas&quot;,
&quot;Firewood&quot;,
&quot;Flower seeds&quot;,
&quot;Foreign books&quot;,
&quot;Foreign coins&quot;,
&quot;Fresh bread&quot;,
&quot;Fresh fish&quot;,
&quot;Fruit pies&quot;,
&quot;Glass bottles, jars, vials, and cups&quot;,
&quot;Hardy slaves (laborers)&quot;,
&quot;Hot soup&quot;,
&quot;Iron candlesticks and tools&quot;,
&quot;Iron pots and pans&quot;,
&quot;Knives, forks, spoons and cooking utensils&quot;,
&quot;Lamps, lanterns, and oil&quot;,
&quot;Leather boots and caps&quot;,
&quot;Live poultry&quot;,
&quot;Lutes and fiddles&quot;,
&quot;Manure&quot;,
&quot;Meat pies&quot;,
&quot;Medicinal teas&quot;,
&quot;Onions&quot;,
&quot;Pears and plums&quot;,
&quot;Perfumes and scented oils&quot;,
&quot;Piglets&quot;,
&quot;Poisons and remedies&quot;,
&quot;Polished stones and crystals&quot;,
&quot;Potatoes&quot;,
&quot;Potions&quot;,
&quot;Potted herbs&quot;,
&quot;Quarrels and crossbows&quot;,
&quot;Rats and pigeons&quot;,
&quot;Rope&quot;,
&quot;Rough-cut gems&quot;,
&quot;Saddles and bridles&quot;,
&quot;Salted pork&quot;,
&quot;Saplings&quot;,
&quot;Scented candles&quot;,
&quot;Seasonal berries&quot;,
&quot;Shields and helms&quot;,
&quot;Shiny leather shoes&quot;,
&quot;Silk shirts and scarves&quot;,
&quot;Snakeskin boots&quot;,
&quot;Soap&quot;,
&quot;Stone-ground flour&quot;,
&quot;Sturdy leather shoes&quot;,
&quot;Swords and spears&quot;,
&quot;Tables and chairs&quot;,
&quot;Tankards and mugs&quot;,
&quot;Tarot readings&quot;,
&quot;Torches and rations&quot;,
&quot;Traditional spices&quot;,
&quot;Turnips&quot;,
&quot;Used books&quot;,
&quot;Used horses and ponies&quot;,
&quot;Wagons and carts&quot;,
&quot;Waterskins and wineskins&quot;,
&quot;Whale oil&quot;,
&quot;Wine by the barrel&quot;,
&quot;Wine by the bottle&quot;,
&quot;Wolfskin rugs and capes&quot;,
&quot;Wooden-soled shoes&quot;,
&quot;Wool shirts and caps&quot;,
&quot;Woven baskets&quot;, 
&quot;Young horses and ponies&quot;]
}&gt;&gt;</tw-passagedata><tw-passagedata pid="31" name="Mercenaries" tags="" position="100,475">&lt;&lt;set $mercenary to {
  colours: [
    &quot;black&quot;,
    &quot;red&quot;,
    &quot;scarlet&quot;,
    &quot;gold&quot;,
    &quot;forest green&quot;,
    &quot;royal blue&quot;,
    &quot;brown&quot;,
    &quot;dark grey&quot;,
    &quot;gunmetal&quot;,
    &quot;maroon&quot;,
    &quot;navy blue&quot;,
    &quot;dark brown&quot;,
    &quot;steel&quot;,
    &quot;olive green&quot;],
  insignia: [
    &quot;a skull&quot;,
    &quot;a ghost&quot;,
    &quot;a clenched fist&quot;,
    &quot;a flame&quot;,
    &quot;an arrow&quot;,
    &quot;a dagger&quot;,
    &quot;a sword&quot;,
    &quot;a hammer&quot;,
    &quot;the sun&quot;,
    &quot;the moon&quot;,
    &quot;a bat&quot;,
    &quot;a bull&quot;,
    &quot;a dragon&quot;,
    &quot;a falcon&quot;,
    &quot;a lion&quot;,
    &quot;a raven&quot;,
    &quot;a scorpion&quot;,
    &quot;a snake&quot;,
    &quot;a vulture&quot;,
    &quot;a wolf&quot;],
  commander: [
    &quot;a brazen outlaw&quot;,
    &quot;a charismatic demagogue&quot;,
    &quot;a mysterious foreigner&quot;,
    &quot;an outcast from a prominent family&quot;,
    &quot;a ruthless killer&quot;,
    &quot;a dashing swashbuckler&quot;,
    &quot;a brutish thug&quot;,
    &quot;a celebrated war hero&quot;,
    &quot;a disgraced knight&quot;,
    &quot;a former arena champion&quot;],
  attitude: [
    &quot;friendly and loyal&quot;,
    &quot;respectful and business-like&quot;,
    &quot;cautious and uncertain&quot;,
    &quot;terrified and tight-lipped&quot;,
    &quot;disappointed and rude&quot;,
    &quot;angry and rebellious&quot;],
  currently: [
    &quot;gainfully employed as guards&quot;,
    &quot;gainfully employed in war&quot;,
    &quot;under contract with some criminals&quot;,
    &quot;under contract with some merchants&quot;,
    &quot;under contract with some nobles&quot;,
    &quot;looking for work&quot;],
  specializes: [
    &quot;siege-breaking&quot;,
    &quot;holding a redoubt or fort&quot;,
    &quot;frontal assault&quot;,
    &quot;infiltration tactics&quot;,
    &quot;skirmishes&quot;,
    &quot;laying ambushes&quot;,
    &quot;patrolling&quot;,
    &quot;flanking maneuvers&quot;,
    &quot;guerilla tactics&quot;,
    &quot;raiding and pillaging&quot;],
  notorious: [
    &quot;taking no prisoners&quot;,
    &quot;leaving the dead to be eaten by beasts&quot;,
    &quot;tattooing or branding prisoners&quot;,
    &quot;scalping or flaying prisoners&quot;,
    &quot;burning villages and fields&quot;,
    &quot;betraying their employers&quot;,
    &quot;singing bawdy songs&quot;,
    &quot;drinking too much ale and wine&quot;],
  tactics: [
    &quot;hit-and-run tactics&quot;,
    &quot;direct assaults on the enemy&quot;,
    &quot;fancy footwork&quot;,
    &quot;unpredictable lurches&quot;,
    &quot;masterful combat maneuvers&quot;,
    &quot;complete lack of mercy&quot;,
    &quot;taunting and jeering the enemy&quot;,
    &quot;dirty tactics&quot;],
  armour: [
    &quot;exotic robes&quot;,
    &quot;leather armor&quot;,
    &quot;studded leather armor&quot;,
    &quot;hide armor&quot;,
    &quot;ringmail&quot;,
    &quot;chainmail&quot;,
    &quot;scale armor&quot;,
    &quot;plate armor&quot;],
  weapon: [
    &quot;longswords&quot;,
    &quot;longswords and shields&quot;,
    &quot;shortswords and spears&quot;,
    &quot;shortswords and shields&quot;,
    &quot;longswords and crossbows&quot;,
    &quot;greatswords&quot;,
    &quot;spears and shields&quot;,
    &quot;battleaxes&quot;,
    &quot;battleaxes and shields&quot;,
    &quot;warhammers&quot;,
    &quot;scimitars&quot;,
    &quot;scimitars and a shields&quot;]
}&gt;&gt;
&lt;&lt;set $mercenary.readout to &quot;A group of mercenaries sit in the corner of the room, armed to the teeth with &quot; + either($mercenary.weapon) + &quot;, wearing &quot; + either($mercenary.colours) + &quot; livery over their &quot; + either($mercenary.armour) + &quot; with an insignia of &quot; + either($mercenary.insignia) + &quot;. They are &quot; + either($mercenary.attitude) + &quot; towards their commander, who is &quot; + either($mercenary.commander) + &quot;. They specialise in &quot; + either($mercenary.specializes) + &quot;, and are notorious for &quot; + either($mercenary.notorious) + &quot;. They are famous for their &quot; + either($mercenary.tactics) + &quot;, and are currently &quot; + either($mercenary.currently) + &quot;.&quot;&gt;&gt;</tw-passagedata><tw-passagedata pid="32" name="Raiders" tags="" position="225,475">&lt;&lt;set $raiders to {
  exorting: either([
    &quot;&lt;&lt;print random(2, 10)&gt;&gt; CP per week from each family&quot;,
    &quot;&lt;&lt;print random(5, 12)&gt;&gt; CP per from from each family&quot;,
    &quot;&lt;&lt;print random(2, 5)&gt;&gt; SP per month from from each family&quot;,
    &quot;&lt;&lt;print random(1, 6)&gt;&gt; SP per month from from each family&quot;]),
  demand: either([
    &quot;that we give them half of all the food we grow&quot;,
    &quot;that we provide free room and board whenever they travel through our territory&quot;,
    &quot;that we give them the eldest son from each family to bolster their might&quot;,
    &quot;that we perform free maintenance and repair of their equipment&quot;,
    &quot;that we give them the fairest of our daughters to bear the children of their leader&quot;,
    &quot;free food and drink at the tavern every time they come through town&quot;,
    &quot;slave labor from the men in our village, who work all day building a new encampment&quot;,
    &quot;a cut of all the goods that we produce here&quot;,
    &quot;to be tipped off when merchants and travelers come through town&quot;,
    &quot;that we store dangerous substances in our homes for them&quot;,
    ]),
  torment: either([
    &quot;forcing us to grovel like dogs when they come through town&quot;,
    &quot;making many of us impart cruel abuses on our loved ones&quot;,
    &quot;forcing us to watch as they debase our wives and daughters&quot;,
    &quot;making our children fight for their amusement&quot;,
    &quot;making us burn our clothing and shave our heads&quot;,
    &quot;ordering us to make our children sleep in barns with the livestock&quot;,
    &quot;making us eat manure and other foul substances&quot;,
    &quot;ordering us to lick their boots clean&quot;,
    &quot;forcing us to dance for their amusement&quot;,
    &quot;brutally violating the men and boys of our village&quot;,
    &quot;forcing our children to kick helpless animals to death&quot;,
    &quot;relieving themselves in our well&quot;,
    &quot;forcing us to violate our livestock&quot;,
    &quot;making us watch as they destroy our market stands&quot;,
    &quot;making us smile and sing as they whip us&quot;,
    &quot;beating our loved ones while we helplessly watch&quot;,
    &quot;urinating on our feet&quot;,
    &quot;desecrating our church and assaulting the priest&quot;,
    &quot;defiling the graves of our loved ones&quot;,
    &quot;painting our bodies with crude obscenities and making us march through town&quot;
    ]),
  disobey: either([
    &quot;hold our children hostage until we give them what they want&quot;,
    &quot;destroy our harvest and starve us&quot;,
    &quot;kill one of us every day until we give in&quot;,
    &quot;make our children suffer for our disobedience&quot;,
    &quot;release a dangerous beast into the home of any family that challenges them&quot;,
    &quot;make a bloody and public example of any family that disobeys them&quot;,
    &quot;slaughter our livestock&quot;,
    &quot;poison our well&quot;,
    &quot;skin the wife of any man who challenges them alive, and make him listen to her screams&quot;,
    &quot;construct a gallows and hang any troublemakers in the center of town&quot;,
    &quot;drag any who challenge them behind their horses&quot;,
    &quot;take our children as slaves, and kill everyone else&quot;,
    &quot;burn our homes to the ground, one by one, until we give in&quot;,
    &quot;cut off the right hand of any who defy them&quot;,
    &quot;mutilate the faces of our wives&quot;,
    &quot;force the children of any who challenge them to drink acid&quot;,
    &quot;draw and quarter those who defy them&quot;,
    &quot;gouge out the eyes and cut out the tongue of any who stand against them&quot;,
    &quot;bind any who defy them to a post, to be eaten by dogs&quot;,
    &quot;nail those who defy them to a tree, to suffer and die of exposure&quot;
    ]),
  finally: either([
    &quot;We have never challenged these fiends. We are powerless to stop them.&quot;,
    &quot;A small group of adventurers came through and heard our plight. They sought to help, but the raiders cut them down. We were severely punished.&quot;,
    &quot;One family couldn&#39;t pay their dues to the raiders. Not two days passed before those bastards made good on their threats.&quot;,
    &quot;Some of the men in our village sought to drive out our tormentors. They failed, and the raiders made good on their threats.&quot;,
    &quot;We routinely miss payments, and the raiders have yet to carry out their ultimate threat. However, they have punished us in less severe ways.&quot;,
    &quot;We managed to drive the raiders off, but fear that they will soon return in greater numbers to make us pay for our defiance.&quot;,
    &quot;We haven&#39;t dared to challenge them yet, but suspect that they wouldn&#39;t actually follow through on their threats. They seem to be more bark than bite.&quot;,
    &quot;We&#39;ve always complied with their demands, but they recently began warring with another raider encampment nearby. Now, they ask us for more and more! If it doesn&#39;t stop, we&#39;ll have nothing left to give.&quot;,
    &quot;Recently, they have stopped coming to collect their payments. We do not know why, and fear to press our luck by investigating.&quot;,
    &quot;A second group of raiders has recently arrived, and they, too, demand tribute! We can&#39;t possibly pay both.&quot;,
    &quot;A stranger passed through town recently, and ended up killing several raiders in a tavern fight. He has already left, and we now fear retaliation.&quot;,
    &quot;The raiders have a new leader, now, and this one is even more demanding and cruel than the last. We can&#39;t take this anymore!&quot;,
    &quot;In spite of their abuses, these raiders are a mere annoyance. They spend more time backstabbing each other than enforcing their threats upon us.&quot;,
    &quot;These raiders are ruthless. Even though we&#39;ve never defied them, they parade the mutilated remains of travellers through town just to remind us what they&#39;re capable of.&quot;,
    &quot;There are many among their group who are actually decent folk. They try to keep the abuses from their comrades to a minimum, but can only do so much. If we could bring those few to our defense, it could make all the difference.&quot;,
    &quot;So long as we pay on time, the abuses are kept to a minimum. We should really just be thankful that they aren&#39;t asking for more.&quot;,
    &quot;There is no end to this hell in sight, and our spirits are broken. We keep nothing for ourselves, and are little better than slaves under the brutal rule of these raiders.&quot;,
    &quot;We&#39;ve had enough, and are preparing an ambush.&quot;,
    &quot;It&#39;s hard to make our payments, but that&#39;s just how things work out here. We&#39;d rather not risk inciting the raiders to anger.&quot;,
    &quot;Just when we thought things couldn&#39;t get worse, one of our daughters was found murdered and brutalized. Enough is enough!&quot;
    ])
    }&gt;&gt;</tw-passagedata><tw-passagedata pid="33" name="Rings" tags="" position="350,475">Gold.
White gold.
Tarnished silver.
Polished silver.
Gold-plated brass.
Silver-plated brass.
Gold-plated steel.
Silver-plated steel.
Brass.
Black steel.
Bone.
Ivory.
Ebony.
Mahogany.
Walnut.
Turquoise.
Jade.
Iron.
Copper.
Platinum.
d20 Decorative feature: The ring features a/an…

Handful of small gemstones arrayed around the band.
Trio of small gemstones.
Single small gemstone.
Single large gemstone.
Large gemstone with flanking smaller stones.
Snake&#39;s head with a gemstone set in its eyes.
Dragon&#39;s head with a gemstone set in its eyes.
Fiend with gemstones set in its eyes.
Skull with gemstones set in its eyes.
Floral pattern.
Leafy motif.
Antler motif.
Thorny motif.
Hexagonal pattern.
Wavy pattern.
Spider-web motif.
Cross-hatching pattern.
Phrase written in a Dwarvish script.
Phrase written in an Elvish script.
Handful of arcane runes.
d20 Gemstone: The ring has a/an...

Diamond.
Blue diamond.
Pink diamond.
Yelllow diamond.
Ruby.
Fire opal.
White opal.
Black opal.
Yellow opal.
Green opal.
Emerald.
Blue sapphire.
Purple sapphire.
Pink sapphire.
Star sapphire.
Garnet.
Pearl.
Black pearl.
Amethyst.
Topaz.
d20 Creator: This ring was made by or made for a/an..

Dwarvish king.
Elvish prince.
Terrifying elf-witch.
Gnomish gemcutter.
Ancient hero.
Dark sorceress.
Notorious witch.
Legendary mage.
High priest or priestess.
Mysterious knight.
Sinister lich.
Devious rogue.
Eccentric wizard.
Powerful queen.
Beautiful princess.
Wealthy lord.
Conniving fiend.
Infamous warlord.
Renowned explorer.
Famous singer.
d20 Special power: When properly activated, the ring allows its wearer to...

Absorb (d6): 1. fire damage; 2. lightning damage; 3. memories; 4. souls; 5. spells; 6. water.
Attract (d6): 1. birds; 2. ghosts; 3. members of the opposite sex; 4. rats; 5. snakes; 6. stirges.
Avoid (d6): 1. former lovers; 2. sobriety; 3. trap triggers; 4. trolls; 5. vampires; 6. werewolves.
Bolster your (d6): 1. agility and reflexes; 2. awareness and senses; 3. confidence and self-esteem; 4. health and toughness; 5. intellect and problem-solving skills; 6. strength and endurance.
Cast a spell (d6): 1. at random; 2. prepared and stored in the ring by the ring&#39;s creator; 3. prepared and stored in the ring by you; 4. that creates a disguise; 5. that restores lost hit points; 6. that grants invisibility.
Command (d6): 1. air elementals; 2. earth elementals; 3. fire elementals; 4. ghouls; 5. water elementals; 6. wolves.
Conjure a swarm of (d6): 1. bats; 2. parrots; 3. ravens; 4. rats; 5. spiders; 6. zombies.
Control (d6): 1. demons; 2. dwarves; 3. elves; 4. flames; 5. human minds; 6. weather.
Detect (d6): 1. lies; 2. illusions; 3. poisoned food and drink; 4. secret doors; 5. traps; 6. water sources.
Disappear in/into a (d6): 1. hole in the earth; 2. flash of light; 3. nearby tree; 4. shimmering mist; 5. swirl of shadows; 6. wisp of smoke.
Dodge (d6): 1. attacks from dragons; 2. attacks from giants; 3. lightning bolts; 4. mechanical traps; 5. spell attacks; 6. weapon attacks.
Locate the nearest (d6): 1. corpse; 2. dragon; 3. gold; 4. living creature; 5. poisonous plant; 6. undead.
Move like a/an (d6): 1. dolphin; 2. burrowing badger; 3. gust of wind; 4. jackrabbit; 5. ooze; 6. spider.
Predict (d6): 1. deaths; 2. fluctuations in the price of grain; 3. future catastrophes; 4. military victories; 5. storms; 6. winning horses.
Recover (d6): 1. expended spell slots; 2. lost dignity; 3. lost hit points; 4. lost gold; 5. lost time; 6. used torches.
Resist (d6): 1. diseases; 2. mind-affecting charms; 3. persuasion; 4. poisons; 5. psionic powers; 6. seduction.
See (d6): 1. faraway places; 2. into others&#39; dreams; 3. invisible creatures and objects; 4. people dear to you wherever they are; 5. through the eyes of a beast; 6. through the eyes of a corpse.
Speak with a/an (d6): 1. dear friend or lover; 2. long-dead person; 3. recently deceased person; 4. snake; 5. spider; 6. wolf.
Summon a/an (d6): 1. angel; 2. demon; 3. devil; 4. djinni; 5. efreet; 6. pack of wolves.
Teleport (d6): 1. up to ten feet; 2. to another room nearby; 3. to a well-known temple; 4. to a previously prepared teleportation circle; 5. to the presence of a powerful fiend; 6. to an ancient crypt.
d6 Activation/amplification: The ring&#39;s special power or special property activates or amplifies…

On a particular plane (d6): 1. celestial realm; 2. fiendish realm; 3. mortal world; 4. realm of death; 5. realm of dreams and magic; 6. realm of shadow and death.
When worn by a member of a specific race (d6): 1. dwarf; 2. half-dragon; 3. high elf; 4. serpentfolk; 5. shadowfolk; 6. wood elf.
In sunlight.
In moonlight.
Underground.
Under starlight.
d6 Reliability and costs: The ring&#39;s special power...

Works (d6): 1. perfectly, every time; 2. most of the time with infrequent mishaps; 3. as expected about half the time; 4. occasionally, when the proper conditions are met; 5. rarely and unpredictably; 6. only the first time the wearer uses the power.
Comes at a temporary or acute health cost (d6): 1. chills; 2. fatigue; 3. flatulence; 4. headaches; 5. nausea; 6. unsightly and rapid hair growth.
Comes at a chronic or permanent health cost (d6): 1. blurred vision or blindness; 2. loss of the power of speech; 3. painful scarring and deformity; 4. poor wound healing; 5. tumorous growths and deformity; 6. wasting sickness.
Brings on mental distress (d6): 1. anxiety; 2. bad dreams; 3. compulsive behavior (drinking, smoking, scratching, hygiene, etc.); 4. insomnia; 5. short temper (irritability); 6. weight gain (stress eating).
Attracts the attention of malevolent creatures (d6): 1. aberrations; 2. dragons; 3. fiends; 4. ghosts and wraiths; 5. spiders or snakes; 6. zombies and wights.
Is occasionally accompanied by (d6): 1. blizzards; 2. earthquakes; 3. rapid plant growth; 4. thick fog; 5. thunderstorms; 6. volcanic eruptions.
d6 Importance: The ring is rumored to be important to a/an...

Quirky individual who claims to be descended from a/an (d6): 1. ancient king or queen; 2. dragon; 3. fiend; 4. legendary warrior; 5. notorious giant; 6. well-known prophet.
Powerful spellcaster (d6): 1. arch-lich; 2. master conjurer or illusionist; 3. high priest or priestess; 4. shadow-witch or warlock; 5. dark sorcerer or sorceress; 6. druid or woods-witch.
Heir to a fallen noble house.
Sitting monarch.
Fiendish prince or elemental lord.
Forgotten god or ancient evil.
d6 Purpose: The ring is rumored to be important because its wearer could...

Sell it for an unimaginable fortune.
Gain the cooperation of a world leader (d6): 1. brutal warlord; 2. high priest or priestess; 3. infamous pirate captain or outlaw; 4. king or queen; 5. merchant-prince; 6. vampire lord.
Unlock ancient knowledge and secrets.
Gain immense wealth and influence.
Conquer the world.
Open portals to other realms.</tw-passagedata><tw-passagedata pid="34" name="Trinkets" tags="" position="475,475">&lt;&lt;set $trinket to {
  originalowner: [&quot;a wizard of immense power&quot;, &quot;a poor mother who had to sell it to feed her family&quot;, &quot;a chronic gambler who had to make good on a bet&quot;, &quot;a man who lost it in a game of cards&quot;, &quot;a goblin who thought it was pretty&quot;],
  value: [&quot;next to worthless&quot;, &quot;barely a copper&quot;, &quot;maybe a copper&quot;, &quot;a copper or two&quot;, &quot;perhaps three copper&quot;, &quot;a meal or two&quot;, &quot;a good night at the tavern&quot;, &quot;a great night out at the tavern&quot;, &quot;a round of beers&quot;, &quot;board for a night at a tavern&quot;, &quot;a silver, if that&quot;, &quot;a handful of silver&quot;, &quot;a decent bag of gold&quot;, &quot;a sizable hunk of gold&quot;, &quot;a considerable amount&quot;, &quot;a treasury filled with gold&quot;, &quot;a dragon&#39;s hoard&quot;],
  material: [&quot;bone&quot;, &quot;wood&quot;, &quot;mahogany&quot;, &quot;oak&quot;, &quot;cedar&quot;, &quot;crystal&quot;, &quot;perpetually frozen ice&quot;, &quot;glass&quot;, &quot;iron&quot;, &quot;lead&quot;, &quot;leather&quot;
 &quot;bronze&quot;, &quot;silver&quot;, &quot;gold&quot;, &quot;electrum&quot;, &quot;platinum&quot;],
  type: [&quot;tooth of a tiger&quot;, &quot;rose&quot;, &quot;doll&quot;, &quot;key&quot;, &quot;dagger&quot;, &quot;fork&quot;, &quot;rabbit&#39;s paw&quot;, &quot;ring&quot;, &quot;dice&quot;, &quot;amulet&quot;, &quot;necklace&quot;, &quot;earring&quot;, &quot;looking glass&quot;, &quot;monocle&quot;, &quot;telescope&quot;, &quot;urn&quot;, &quot;death mask&quot;, &quot;mask&quot;],
}&gt;&gt;</tw-passagedata><tw-passagedata pid="35" name="Newspaper" tags="" position="600,475">&lt;&lt;set $newspaperheadline to either([&quot;NPC attempts to become player, ridiculed.&quot;,
&quot;Underground homunculi fights discovered - homunculi sales increase.&quot;,
&quot;Wizard house vanishes in the night, locals suspect shenanigans.&quot;,
&quot;Doppelganger discovered in mayor&#39;s place. Townsfolk agree he&#39;s better than the old.&quot;,
&quot;Tiefling, dragonborn, and hobbit visit tavern, local economy booming. (Adventures visited)&quot;,
&quot;Werewolf suspected to live in town, buy your silver at Jameson&#39;s general store!&quot;,
&quot;Goblins threaten to kill all townsfolk, distracted by &#39;shiny things&#39;&quot;,
&quot;Dragon flies over town, local illusionist jailed.&quot;,
&quot;Lawyer discovered to be vampire, surprising no one.&quot;,
&quot;Dwarf and human proclaim love, refused wedding ceremony by cleric.&quot;,
&quot;Dragon rider gives birth to half dragon.&quot;,
&quot;Centaur&#39;s father jailed for bestially.&quot;,
&quot;Cultists file for rights to be called clerics.&quot;,
&quot;Forest gnome discovered in wood elf elementary school, been &#39;stealing our food for years.&#39;&quot;,
&quot;Portal to elemental plane discovered, hot springs are rejuvenating says discoverer.&quot;,
&quot;Fey found making old man&#39;s shoes, old man to be jailed for slavery.&quot;,
&quot;Jack steals gold from &#39;giant in sky&#39; giants pissed.&quot;,
&quot;Necromancer family man caught trying to raise a family.&quot;,
&quot;Drunken old ramblings of future discovered to be 90% accurate.&quot;,
&quot;Dragonborn day-care suspected to be kobold infiltration team.&quot;,
&quot;Local dungeon deliver finds &#39;artefact with a demonic presence&#39; leaves it due to lack of modifiers.&quot;,
&quot;Travelling circus to visit soon.&quot;,
&quot;Farmer discovers wishing well works.&quot;,
&quot;Druid makes farm animals talk, town goes vegetarian.&quot;,
&quot;Druid threatens to awaken plants.&quot;,
&quot;House pet discovered to be archdruid.&quot;,
&quot;30 year old half elf sick of &#39;being treated like a child.&#39;&quot;,
&quot;Low level adventurers causing trouble in town; seeking rat infested basement to start them on a long quest.&quot;,
&quot;Lost: Pet invisible stalker, if found return to Wash gust (Wizard). Poster includes a picture of the pet&quot;,
&quot;Small medium at large; a poster for an escaped gnomish diviner&quot;,
&quot;Familiars getting too familiar? Please spay or neuter your animal companions.&quot;,
&quot;&#39;Blurry face of something, angle or demon? Who knows&#39; Do you trust your sight? MADD Magicians Against Drunken Divining.&quot;,
&quot;St. Cuthbert&#39;s school of phrenology and trepanning&quot;,
&quot;&#39;Beware of doppelgangers!&#39; Then fill the town with exact replicas of one whacky NPC, all claiming to be the real one.&quot;,
&quot;&#39;Local wizard went missing after experimenting with a bag of holding&#39;&quot;,
&quot;&#39;You will not believe your eyes when you read what this Halfling found in a dungeon!!!&#39;&quot;,
&quot;&#39;Apprentice sorcerer blew up himself and started a forest fire&#39;&quot;,
&quot;&#39;Thieves&#39; guild revealed to be just a rumour&#39;&quot;,
&quot;&#39;Gnome banished from town after drinking 200 potions of inappropriate yodelling&#39;&quot;,
&quot;&#39;Banshee was still alive hours before she died!&#39;&quot;,
&quot;&#39;City unsure why the sewer smells.&#39;&quot;,
&quot;&#39;City guard&#39;s raid smithy, find +1 weapons&#39;&quot;,
&quot;&#39;Goose attacked by aggressive dog, goose refused medical treatment.&#39;&quot;,
&quot;&#39;Ilitrasee an obstakul for billboards, studee finds.&#39;&quot;,
&quot;&#39;Group of adventurers mugged by a parrot.&#39;&quot;,
&quot;&#39;Guard investigation reveals suspicious gold coin to be a copper coin.&#39;&quot;,
&quot;&#39;Cows lose their jobs as milk prices drop&#39;&quot;,
&quot;Seeking apprentice cook/tavern staff&quot;,
&quot;Seeking wizard to remove awaken from my pots and broom.&quot;,
&quot;Local wizard apprentice blamed for recent flood, discovered to be awakened mouse&quot;,
&quot;&#39;Local merchant arrested for selling mimics disguised as furniture and appliances, scheme discovered after customer noticed his refrigerator was running.&#39;&quot;,
&quot;&#39;Rampaging beast destroys slum, townsfolk celebrate new town square.&#39;&quot;,
&quot;Local instrument shop has massive blowout on Large-sized Lutes, due to a hilarious misunderstanding with local adventurers.&quot;,
&quot;Help! Help! I&#39;m being held here and made to write these signs!&quot;,
&quot;Fourth-annual dwarf-throwing competition dissolves into chaos, bloodshed. &#39;We&#39;re looking forward to the fifth year!&#39; says local dwarven merchant.&quot;,
&quot;Bloodknife the Deathrager, level 20 Barbarian, buys local farm. Interviewed while re-forging a sword into a ploughshare, he said &#39;My DM doesn&#39;t support Epic levels.&#39;&quot;,
&quot;Strange ill rumours heard from those fleeing from the north. &#39;Probably nothing,&#39; agrees city council.&quot;,
&quot;Local wizard&#39;s attempt at opening a portal to the Plane of Uncertain Outcomes has succeeded and failed.&quot;,
&quot;Local church erupts into violence over the usage of non-blunt weaponry among clergy. &#39;What&#39;s next,&#39; cried a local priest, &#39;Paladins with no alignment restrictions?!&#39;&quot;,
&quot;Magical cobblers continue to take heavy losses on sales of Boots of Striding and Springing. Demand continues to drop as more editions are released.&quot;,
&quot;Copyright permit for 11-foot pole denied by local council. &#39;It IS different!&#39; cried the merchant, as he was escorted from the premises.&quot;,
&quot;Market share for d12 weapons at an all time low. A local blacksmith was reached for comment, &#39;Orcs just ain&#39;t buyin&#39; no more.&#39;&quot;,
&quot;A local village has reached a settlement to recompense a magical tailor for injury and losses sustained after the villagers ran him out of town. The elder of the village said, &#39;We thought t&#39;were one of them parables! Turns out he does sell invisible cloth. We&#39;re truly sorry.&#39;&quot;,
&quot;Dairy farmer to begin offering &#39;milk for the Khorne flakes&#39;. In an interview, he says &#39;Well, I began by getting Chaotic Evil cows.&#39;&quot;,
&quot;Orcs-no-eat insurance! You want not get eat, you pay us gold. Our motto are, &#39;Your money or you get eat.&#39;&quot;,
&quot;A local scientist claims &#39;Humans are slowly being replaced.&#39; He went on to state that, &#39;These so-called &#39;variant humans&#39; look exactly like us, and it is nearly impossible to tell if someone you know is one.&#39;&quot;,
&quot;The town of Westbrynn is under investigation after allegations surfaced that they are offering incentives for higher level creatures to move into the area. Authorities were tipped off after shipments of +5 weapons were intercepted on their way to the town.&quot;,
&quot;Steampunk genres threaten takeover. Coastal wizards decline to comment&quot;,
&quot;Lvl 3 familiars unionized! Necromancers at a loss for words&quot;,
&quot;Gravity subject to change over the next few weeks: alchemists give assurances&quot;,
&quot;Due to the recent rise in tectonic activity, all elemental mages are advised to avoid using materials near riverbanks and volcanoes&quot;,
&quot;Dragon scale market plummets as advances in metalwork create stronger materials&quot;,
&quot;Recent reports confirm health potions to cause loss in bone density. Heavy users of these potions argue that they usually don&#39;t live long enough to be effected&quot;,
&quot;Theoretical alchemists argue the universe was created in a failed transmutation event coined &#39;The Big Bang&#39;&quot;,
&quot;&#39;Local gangsters are putting up false notice boards to an excess.&#39;&quot;,
&quot;Kobold seeks dragon wing for no particular reason.&quot;,
&quot;Local human scholar in need of parchment urgently.&quot;,
&quot;Gnome mystic requires escort to deathly swamp.&quot;,
&quot;Family wedding requires cooks. Will eat any one thing.&quot;,
&quot;The Order of the Magi requires help in procuring the whereabouts of Magus Ornathuss.&quot;,
&quot;Animated sword seeks better life; tired of being used in one way relationship.&quot;,
&quot;Half-elf Baron Faelin Merrybrook found dead at his home. An investigation is still ongoing.&quot;,
&quot;Finals of the annual $tavern.name tavern brawl to take place tomorrow!&quot;,
&quot;Doppelganger suffering from identity crisis trying to find purpose in life.&quot;,
&quot;The Wandering Troupe in town for two days only! Have the minstrels on the run from a bunch of bandits they fleeced and inadvertently involve the characters in their acts.&quot;,
&quot;Local farmer requires assistance. I am unable to pay you for your troubles I am afraid.&quot;,
&quot;Dwarf having some trouble removing a ring. The ring is actually a symbiotic ring and has fused with its new owner. It responds well to gluttony, which the dwarf is afflicted by. As the dwarf becomes more charitable, the ring loosens. If anyone wants to wear the ring, it gives 10 temporary hit points at dawn, each day.&quot;,
&quot;Waresloth seeking help on slow nights.&quot;,
&quot;Dwarf tossing championship at local tavern, bring your own dwarf.&quot;,
&quot;Three gnomes in long coat arrested for impersonating human.&quot;,
&quot;Trigeraian&#39;s Used Armour: Eh, it should serve you better than the previous wearer.&quot;,
&quot;Castle executioner found using illegal muscle enchantments.&quot;,
&quot;Local elven leader, famously against interracial breeding, found in orc brothel.&quot;,
&quot;Charngroc&#39;s Custom Chimeras: personalized pets for any personality.&quot;,
&quot;Local oracle revealed to be fraud. &#39;I just wanted to make a prophet&#39; he says.&quot;,
&quot;A Capella singing competition finished. Winner was a buomman asking for directions.&quot;,
&quot;Adventurer teaches blink dog Common. &#39;Wow. Very language.&#39; comments dog.&quot;,
&quot;Unidentified kobold mage summons sarrukh. Apocalypse scheduled for 6 PM.&quot;,
&quot;Evil Lich Necromancer escaped prison. Wanted dead or alive.&quot;,
&quot;Impersonator discovers his house is a mimic&quot;])&gt;&gt;</tw-passagedata><tw-passagedata pid="36" name="PlotHook" tags="" position="725,475">&lt;&lt;set $plothook to {
	people: [&quot;I overheard from two servants that they plan to poison the Lord of $town.name! I&#39;ve tried to get in to his grounds, but the doorguard won&#39;t listen to me because I&#39;m just a nobody... Please, save him!&quot;,
	&quot;There&#39;s a tournament coming up, not far from here. We need strong, trustworthy people as the Lord of $town.name&#39;s security detail.&quot;, &quot;There&#39;s a bard, of great renown that lives not far from $town.name- perhaps you know of him, the Great &lt;&lt;print $name.man.pluck()&gt;&gt;? Well, last week, thieves broke in to the Songsmith&#39;s mansion, but the only thing that the scoundrels took was the bard&#39;s voice. There&#39;s a handsome reward for the return of it, too.&quot;,
	&quot;I know that you are not likely to believe me, but... I am the messenger for the Duke&#39;s brother- yes, he had a brother, who has been in exile for some time. I&#39;ve been charged to deliver this letter to the Duke, but I fear that I&#39;m being followed and may meet my fate soon; the exact details are better left unknown, lest you make yourself a permanent target for holding the knowledge that I do. You must get this message to him. But do not open it, as the Duke will not touch it if the wax seal has been broken.&quot;,
	&quot;I&#39;m looking for some guards to help me deliver some cargo some weeks&#39; way away from $town.name; I can&#39;t promise that it&#39;s going to be easy, but if you keep me and my cargo safe, I can promise rewards well worth your time.&quot;,
	&quot;For many years, I&#39;ve kept in contact with the priest of $town.name, Father &lt;&lt;print $name.man.pluck()&gt;&gt;. But when I visited last spring, he was nowhere to be seen, and $bartender.firstname said that he died last Autumn... I did not mention my trip to $town.name, and yet the letters from him continue.&quot;,
	&quot;Many years ago, my sister $npc.woman.pluck() had a child out of wedlock. She loved it dearly, but it passed in the winter. But recently, she&#39;s been hearing its cries again, and swears to the Gods that she has seen it waving from in the paddocks, where the child played with the cows.&quot;,
	&quot;I&#39;ve been hearing strange rattling and moans coming from the abandoned house next door. Would you mind checking it out for me?&quot;],


	things: [&quot;Behind the bar of $tavern.name, there&#39;s a small rat which you&#39;ve seen the bartender look directly at, without trying to kill the pest.&quot;],


	rumour: [&quot;The hedge maze in front of the manor has been maintained for decades by a strange elf who speaks in cryptic riddles. Recently, a visiting noble from a nearby kingdom went into the maze and never came out. Everyone who has gone in looking for him has met the same fate...&quot;,
	&quot;A talented sculptor recently did a sculpture for the Lord of $town.name and ever since, the Lord has not been himself- before he remembered all his servants names, and now he merely bark orders... We fear that something happened to him.&quot;,
	&quot;A local tinkerer named Ebonweg has recently gone missing. The locals know him as an honest tradesman; however he was also something of a recluse, whose tinkerings sometimes bordered on the immoral.&quot;,
	&quot;There was talk of a group of bandits that had taken up terrorizing the road to the north of $town.name, but I went through there just last week, and there was nought a sound the entire journey.&quot;,
	&quot;The lord of the city is rumored to have been killed and replaced with a doppleganger. A local guard thought he saw the lord change skin, but he had no proof, so his accusation was thrown out. He turned up dead yesterday.&quot;],
	boring: [&quot;I&#39;ve heard that over the &quot;],

	paper: [&quot;The piece of paper bears large block letters, stating &#39;WANTED&#39;, with an illustration underneath- the faces below bear a remarkable similarity to your own...&quot;,
	&quot;The paper states &#39;WANTED: DEAD OR ALIVE&#39;, with the fine print reading &#39;For the crimes of theft, robbery, burglary, and arson, the $town.name Bandit is wanted dead or alive.&#39; You ask $bartender.firstname about what the crimes entailed, and apparently there&#39;s been a huge rash of thefts of food in $town.name recently, resulting in food shortages. The $town.type&#39;s council has hired bounty hunters to catch the criminal.&quot;,
	&quot;The paper has the headline &#39;HENS STOPPED LAYING, EGGS COST 2 SILVER! Apparently, all hens in the area have stopped laying eggs, and has driven the price of eggs sky high.&quot;]
}&gt;&gt;

/*
A local farmer asks the party to either scare off or kill a pack of wolves that have been terrorizing his cattle periodically. (u/Joemac-)
Two opposing tailors each have half of the finest pair of pants ever created. You have been hired to repair the pants and reunite the halves. (u/ANEPICLIE)
A local dancer complains of screaming at odd hours of the morning. (u/Naxura)
The library has been infested with small mimics disguised as books. Exterminate them. (u/SheogorathGaming)
Rumor has it that the local librarian is secretly a dangerous lich/vampire. Investigate. (u/SheogorathGaming)
A bard has been found dead in an alleyway. Investigate. (u/SheogorathGaming)
A young boy has a small pouch of copper stolen from him by teenage thugs. (u/SheogorathGaming)
Through less-than-reputable channels, the party hears about a plan to hunt a small roving group of purple worms. The local crime syndicate wants the precious and hard to obtain organs and blood from the worms. The local city guard wants the location of the nest discovered and reported and nothing more. (u/SSV-Kearsarge)
A noble requests that the party deliver a small package. Around ten minutes after the package is delivered, someone approaches the party and asks where their package is, providing valid identification. (u/U-THNK-IM-HOT-DONT-U)
A city watchman requests the party&#39;s help in setting up a sting. If the party agrees, the operation begins, but when the target arrives, at least one member of the party recognizes the target and believes them to be innocent. (u/U-THNK-IM-HOT-DONT-U)
The owner of an herbalist shop hires the party to descend into the city&#39;s sewers and gather ingredients, including an organ belonging to a creature that should not rightly be living in the sewer. (u/U-THNK-IM-HOT-DONT-U)
A wizard/scholar shows the party some maps detailing the locations of lightning strikes in the city in the past few years/months/days. There is a strangely perfect circle of lightning strikes around a small, inconspicuous area. An orphan is attempting to learn magic, and the spell he&#39;s attempting is much too powerful for him. (u/U-THNK-IM-HOT-DONT-U)
A local organisation ask for your help to find and eliminate cult influence from a variety of districts. (u/bluesoulblaze)
The mayor asks you to help them with a zombie problem. (u/redfighter04)
A rash of political assassinations has sweapt the city council. The only other connecting thread is the same calio cat being seen at the scene. (u/four-art-thou)
A massive sinkhole has collapsed the market square into the sewers. The local urchines claim seeing a shadowy tower and a glowing rainbow mist rise from the hole in the middle of the night. (u/four-art-thou)
A grandly dressed man or woman of significant weight shouts at the adventurers to stop a young thief that ran off with a basket of hers. (u/Billybaf)
A local bard has been abducting local pets and harvesting their tendons for lute strings. A young orphan approaches the party and asks them to rescue his cat, as it is the closest thing he has to a family. (u/Habacoa)
The party is approached by a hunched man with an awful, hacking cough. His face is obscured somewhat by a hood, but he asks the group for some medicine or healing, preferably in his own home. (u/AlDaruma)
A townsman claims to have seen starved, pale humans dragging others away, and the players see that exact man get dragged away moments later if they dismiss it. (u/thunder-runner)
An increasing amount of people are being found dead in their bed with bite marks in the neck. Rumours of vampires are going around, however the bite marks of the victims correspond to their own arrangement of teeth. (u/koekeritis)
It has remained mysteriously cloudy above the city for the last couple of weeks and dead birds keep dropping out of the sky at night. (u/koekeritis)
One day the players find that their favourite tavern is just straight up gone. It has been replaced with a normal living house or two. Nobody in town, not even the people who visited the tavern regularly, can remember the tavern. (u/koekeritis)
A small child asks you to help their father who has been injured in an alley, but when you arrive, nothing is there. The child sits crying and hugging nothing but air. (u/The-Incredible-Thulk)
All of the Clergymen in the town have fallen deathly ill. The town elder asked the party to investigate this phenomenon. (u/Send-Me--Corgi-Gifs)
A young child approaches the party and asks that they find his missing siblings. Their last known location was the decrepit chapel where the city outskirts meets the forest. (u/BardToTheBone)
A sweet old lady stops the party in the street and asks if they can go and buy things on her shopping list for her. She hands the party a bag of gold and the list. Upon closer inspection, the items seem to be ingredients for a deadly mass ritual. (u/ven-resing)
A mad alchemist set up shop next to your favorite tavern. The whole establishment reeks of foul eggs and other unpleasant things. The tavern owner asks you to help convincing the alchemist to stop his work or leave. (u/Scriptorian)
A plague of rats has struck the poorest streets of the city. They seem unusually focused and vicious. Seek out and quash the infestation. (u/Shonen-JUMP)
A tavern has burned to the ground with thirteen people inside, and inside was found the bodies of ten dopplegangers. (u/Silverdragon701)
A local smuggling gang has recently begun battling against a tribe of Grung in the sewers- they have appealed to the city guard for help, and frogs have been seen in concerning numbers after recent rainfalls. (u/Silverdragon701)
Rumors abound that the local magistrate is a devil in disguise- but in fact, they are a polymorphed dragon. (u/Silverdragon701)
An ancient fey ruin has been discovered beneath the city, and green-eyed deer and wolves have begun running through the streets at night, howling and hunting down those who don&#39;t get inside fast enough. (u/Silverdragon701)
A child has fallen ill and the local herbalist needs some very specific ingredients but can&#39;t leave the child unattended, the herbalist requests your party to get them. (u/Glaedr304)
A string of missing children have been happening in a sector with constant reports of a “dragon” in the sewers. The local guild council asks the party to investigate. (u/cornho1eo99)
A large tiger is running loose in the market. If the party kills it, the noblewoman it belongs to emerges from the crowd and demands immediate compensation. (u/Kami-Kahzy)
A bit of food sold to the party (cake, pie, soup, etc.) suddenly has a humanoid pinky finger found within it. (u/Kami-Kahzy)
A string of young noblemen have turned up missing, and the only connection is that they all visited the same brothel. (u/Kami-Kahzy)
A magnificent circus has arrived in town, but during the last night of the festivities the castle will be robbed. (u/Kami-Kahzy)
An old ship thought to be lost at sea for many years suddenly returns to port, seemingly no worse for wear. The crew and passengers are completely unscathed, and no one has any idea how long they&#39;ve actually been gone. (u/Kami-Kahzy)
The poorest and youngest citizens start to drown on dry land and in open places, skin soaked and slimey. There is an aboleth somewhere infecting the oldest, deepest, well of the city with its slime. (u/NeoBlue42)
Somebody is &quot;kidnapping&quot; all the bronze statues in the city. Its either a military faction building a massive hidden cannon, a were-rust monster, or a mad mage perfecting an animate object spell. (u/NeoBlue42)
The Guild of Actors and Musicians has challenged both the Illusionest Guild and Bard College to a contest of pomp and pagency for the next festival. They need the party to sabotage the competition. (u/NeoBlue42)
The city guard has lost two female members undercover in the brothel district. Not missing but giving up law and order in favor of vice and hedonism There may be a succubi flipping all of the agents being sent. (u/NeoBlue42)
The local brewer&#39;s latest batch of high end whiskey has been sabotaged/cursed by fae. The five barrels already sold need reclaimed quickly and quietly less the brewery&#39;s reputation suffers. (u/NeoBlue42)
Half the city has become overgrown with dense vegetation overnight. The city watch is busy defending the rest of the city from wild animal incursions from the newly-formed woods, so the Captain of the Guard asks the party to investigate the root of the matter. (u/UristMcRandom)
An infection seems to spreading in the slums. City officials deny any proof of it and guards no longer keep watch close to the slums at night. You are beckoned into an alleyway by a hooded figure who implores you to find out the fate their loved one who went into the slums to heal the sick. (u/ApertureJunkieZA)
A local sports team have gotten inexplicably unstoppable in a very short time. Rumours of something amiss range from dark bargains, to an amazing halfling herbalist (and everything in between). Collect clues, follow up leads, and get to the bottom of it! (u/EchoIndia)
The water in one district has suddenly become highly flammable. The local government want to find out why, and want it stopped. Players find that a group of anti-establishment rabble employee a pyromancer to make this easy to hide accelerant, but something went wrong. (u/EchoIndia)
The entire upper class are loosing their hair and want you to get to the bottom of it. (u/Patergia)
It&#39;s election time for the new city Mayor. To everyone&#39;s surprise, the Kobolds that live in the city sewers have put forward a candidate for the job... (u/CasparGlass)
A local cult of demon worshippers have recently been seen helping the community, feeding the homeless, and housing the poor. The city guard is SURE they&#39;re up to no good, but can&#39;t PROVE it. (u/CasparGlass)
The village drunkard is stuck in a Groundhog day loop, and uses his knowledge to mess with the party for 24 hours, as it&#39;s the most fun way to spend repeating eternity. (u/CasparGlass)
A distressed-looking housewife implores the party to kill the giant rats living in her basement. Once down there, however, the party finds hallucinogenic mushroom spores that cause them to see their greatest fears. It&#39;s otherwise a perfectly ordinary basement. (u/CasparGlass)
A peddler with a cart selling odd wares, such as jugs that transform water into oil and pots that heat up without fire, has been seen wandering the streets at night. However, the items he sells often malfunction or explode. (u/davechua)
A talking rat has been hustling the three shell game in dark alleys, cheating locals of their gold. It&#39;s rumoured it wears a hat. (u/davechua)
Every full moon, the cats of town gather inside a deserted house. What are they planning? (u/davechua)
A local merchant asks the party to deliver a note across the city. When they return for payment the merchant doesn&#39;t remember the party. An investigation will show that his left ring finger is now missing. (u/bigfootbob)
The party sees a local elderly woman attacked by a large half-orc man. He steals a small pouch filled with the leaves of an exotic plant. If the party returns the plant to the woman, she rewards them with a dozen cookies made from the plant they returned to her. After consuming the cookies the adventurers find out that the plant is this worlds equivalent to marijuana. (u/z4ch4ry27)
An Ooze that was planted in the sewers to clean them and deal with the rat problem has grown ginormous and started to split into more Oozes. (u/GreenUnlogic)
The party hears about a man getting murdered last night. The perpetrator is a spirit and there were plenty of witnesses, but only about half saw the spirit. Every night another victim is taken until the group can unravel the secret. (u/Tyreal01)
A man is confronted by a mob for not being able to control his sorcery. (u/Tyreal01)
The local Thief Guild is fighting a Feud with the local Gypsy family for the drugdealing control of a district. The governor/s, know this and get money for looking the other side, a lot of money, but their feud might recall unwanted attention over the city and his pocket, he ask your help in the matter. (u/caciuccoecostine)
A brewer of the second best ale in town believes the most popular brewer has made a pact with a demon to enhance her wares. If the party investigates, they find that all the brewers in town have unknowingly made deals with the same demon, which has plans to adulterate all their wares and take control of the townsfolks&#39; minds. (u/KNHaw)
Workmen are sledgehammering tombstones from the local cemetery for material to repair the cobblestone streets. The dead are not happy about this. (u/KNHaw)
A statue in the town square has disappeared overnight and footprints (apparently from the statue) are found leading to the Magicians&#39; quarter. It could be a prank or something more sinister. (u/KNHaw)
A drunkard begins to screaming at the party, claiming they robbed him. When searched by watchmen, the man&#39;s purse turns up in their pockets. (u/KNHaw)
Bodies have begun appearing at the exits of the sewers with bite marks on them. Rumors of cannibal cults, lycanthropes, and other such things have begun flying around. You are hired to investigate the matter. (u/Cybercancer)
A seemingly mad doomsayer is yelling in the streets that the sewers are a gateway to the Abyss. Every day this is ignored, d8 demons of a challenge rating of 1 or lower will crawl out of the sewers at night. Every week this is ignored, the challenge rating increases by 1. (u/BeastlyDecks)
In the big garden of a powerful family, the party notices several woodland critters acting strange. Upon further inspection, they appear almost human in their mannerisms. If the party inquires about the family, they learn that they are rather known for being proficient in charming and polymorphing... (u/BeastlyDecks)
A single member of the party notices a young boy in an alleyway with a third eye in his forehead. The boy telepathically tells the member to come find him in the graveyard. (u/BeastlyDecks)
The party is stopped by a traveling salesman, that frantically insists on handing a spherical object wrapped in cloth to the party. (u/BeastlyDecks)
Eleanor, an heiress to a wealthy baron&#39;s estate, is found murdered in the old meatpacking district. Gretchen, her identical twin, plasters the city in posters offering a bountiful purse for the head of her sister&#39;s killer. Meanwhile, a woman claiming to be Eleanor swears that it was her sister Gretchen that was killed, and is offering a matching reward to anyone who can uncover the truth. (u/MrKHackworth)
A beloved statue has disappeared from the center of town. An alderman asks the party to find it, but the more they investigate, the more people insist that the statue never existed. (u/MrKHackworth)
Animate slimes and oozes are seeping out of the sewers. (u/Patergia)
A long line of ill townfolks are waiting impatiently outside the apothecary&#39;s house, they been there all day and either the apothecary or her assistant are answering the door. The thing is that the apothecary kept some creatures caged to farm their poison and somehow, they were freed. (u/rhockman)
The party encounters a burning building and must rescue several commoners trapped inside. Later, they discover that this is one in a string of arsons. (u/Pawthorn)
The party must earn the respect of a local group of toughs by competing in a bracket-style fighting tournament. However, some competitors have been meeting with unfortunate accidents... (u/Pawthorn)
Several locals have committed uncharacteristic, violent acts. Each claims to have been commanded to do so by a benevolent deity in their dreams. (u/Pawthorn)
A talking cat follows the party, promising to take them to a magical place where wine flows like water and gold litters the ground. (u/Okami-G)
The building of a new road has earned the city the ire of the local druids. (u/Okami-G)
The local miners have gone on strike, demanding higher wages and better equipment. The Boss wants your to remind them who&#39;s in charge. (u/Okami-G)
A portal to hell/the abyss opens in the town square, but nobody else seems to notice or care. Demons are now shopping in the market. (u/Gllithid)
When the local innkeeper is rebuilding his hearth, a removed section of a wall reveals a human skeleton embedded in the masonry, covered in strangle carvings. (u/k1bsTV)
The group sees a Drow named Vicepenny with a red balloon trying to lure a child into the sewers from a sewer drain. (u/Hwga-lurker-tw)
A monkey steals and runs off with one of their hats. Will return for a piece of fruit. (u/Hwga-lurker-tw)
An employee in a lumberjack costume offers the party free samples of jerky from a nearby tavern counting as one daily ration. (u/Hwga-lurker-tw)
A group of mean geese begin chasing any dwarves or gnomes in the group. Geese are protected under the city rulers. (u/Hwga-lurker-tw)
A peaceful Hill Giant sells his intricate lace patterns. People wonder how he does it. Upon interrogation he reveals he does most of the work himself but his two Pixie roommates are always waiting for him to go to sleep. The lace over your face lets you get a good night&#39;s rest no matter where you are. (u/Hwga-lurker-tw)
A hippy elf sells a single dragon scale necklace with your name on it for 1d6x10GP. (u/Hwga-lurker-tw)
The party gets a coupon for one free lesson &quot;For You &amp; A Friend&quot; at the local Fighting Pit. They have to pay for their own uniforms. (u/Hwga-lurker-tw)
Ever since the ascension of the new baron/burgher, criminals have been taken into the keep and never seen again. The captain of the guard knows that the keep should have run out of room in the dungeons long ago, but he hasn&#39;t been allowed inside to see them. (u/crunkDealer)
A public execution is taking place in the town square, the town is split on whether the accused is actually guilty. (u/crunkDealer)
A house/shop in the middle of town has vanished entirely, as if it were just erased from creation. A strange scent and magical residue permeates the premises. (u/crunkDealer)
A very belligerent (and often drunk) old man is causing problems in town. The hangup: it is the burgher&#39;s dearly beloved uncle who remains an extremely proficient fighter in his advanced age. The guard can&#39;t apprehend him without serious injury to the man. (u/crunkDealer)
*/</tw-passagedata><tw-passagedata pid="37" name="PlotHookCity" tags="" position="850,475">&lt;&lt;set $plothook.city to [&quot;The town guard think the party&#39;s mage is responsible for a magical duel fought atop the cathedral roof last night. Can the party find the real culprit before they are hunted down themselves? Do they dare, knowing that the criminal dispatched his last opponent with a frighteningly high level spell?&quot;,
&quot;The party is taken aside to the guardhouse upon first entering the city. They are told the guard captain wants to speak with them. When the captain arrives, he attempts to shake down the party under pain of death.&quot;,
&quot;A woman falls into the street from the second story window in front of the party and dies on impact. Soon after, a PC notices a hooded figure skillfully dropping, uninjured, from another second story window facing into the alley. The figure quickly disappears into a maze of side streets.&quot;,
&quot;The party is invited to a manor by an important socialite for a potential job opportunity. When they arrive, they are told to wait in an empty room. Soon after entering the room, the party realizes they are locked in with a magical ward.&quot;,
&quot;The party stops to witness a funeral procession for a crime lord. Soon after passing, the party hears an explosion and sees a gigantic smoking fireball rise into the sky a block away.&quot;,
&quot;In need of food and shelter from the elements (or from enemies), the characters come to a ruined tower full of revelling adventurers. But the Rules of the House say no one may enter until they have entertained the rabble with a rousing tale.&quot;,
&quot;As you step out of the tavern, a disheveled girl smashes into you. &#39;Wilkenson&#39;s dog is loose again!&#39; she exclaims as she attempts to hide behind you. You turn back in the direction she came to see a metal construct resembling a dog charging toward you.&quot;,
&quot;The PCs spot a pregnant woman walking through the bazaar. As she passes the baker&#39;s stall she quickly grabs a loaf of bread and keeps walking, favouring one of the PCs with a wink as she goes. Is she a thief or the wife of the store owner?&quot;,
&quot;The PCs are resting in their inn room when suddenly the door bursts open. A well-armed man with weapon drawn storms in and says, &#39;Don&#39;t move, I&#39;ve...crap, wrong room.&#39; The intruder then quickly exits.&quot;,
&quot;The PCs find the item they have been seeking in the marketplace. As the purchase is completed and they are about to leave, a stranger rushes up to the merchant shouting, &#39;I know you have it Balthasar, and I want my back now!&#39;&quot;,
&quot;The inhabitants of a large building start a war against an identical neighboring building. At the beginning it&#39;s because they are accused of stealing their water, but in fact they have held many petty grudges for years and this way they can vent them out violently. The party is hired by fearful authorities to stop the revolt that threatens to scale into a civil war, but one of the tenants in the rebel building is a PC&#39;s distant relative. Does the party intervene impartially, risking a family feud or do they help the relative exact revenge against his neighbors?&quot;,
&quot;The party is mistaken by a wealthy man as carriage caretakers in a shantytown neighborhood. He hands them money to protect his vehicle. The legitimate caretakers challenge the PCs and try to steal the wealthy wagon. Does the party protect the rich man&#39;s vehicle or do they leave the locals to do as they please, risking later persecution by the noble client?&quot;,
&quot;The PCs arrive at the inn and find a large group (at least three times their number) of mercenaries leaving for the jail where they plan to execute all the prisoners. The party is connected to one of the inmates (an old, recurrent, but not particularly hated enemy, maybe they put him behind bars in the first place) and wishes him to remain alive for some reason. Do they face the killers, race to save the prisoner first, warn the prisoners or set them all free?&quot;,
&quot;The city has a zoo filled with wondrous and dangerous creatures brought from far places. Just recently, some of the creatures escaped and now there is a royal reward for recovering the rare animals unharmed. How can this be done?&quot;,
&quot; sector of the city lies under quarantine after an outbreak of a mysterious fever. The party is being kept inside, and one of its members is starting to show symptoms of the illness. Do they try to escape, risking further contagion, or do they try to find a cure from the inside?&quot;,
&quot;The PCs are being chased by a criminal party through the streets of a city that celebrates its anniversary with improvised shows over plazas. They get caught in the middle of a show, in front of a demanding audience. The only way the mob will let them leave is by doing a successful artistic performance.&quot;,
&quot;A gypsy intercepts the most charismatic member of the party and tells him of a vision she had. She predicts the party member will find a beautiful person in this city and it will be the love of his life. She provides no further details. Later on, a beautiful person flirts with the character.&quot;,
&quot;One member of the party is seen carrying an exotic weapon and the authority of the local museum is told about it. This museum curator has been an adventurer and masters some kind of whip weapon. He prepares an ambush to steal the exotic weapon, yelling at the PCs on sight, &#39;That belongs in a museum!&#39;&quot;,
&quot;The Tourist. The PCs have messed up (possibly been framed) in the eyes of the King and have been apprehended. The King will release the party, if they allow a wealthy, influential and obese merchant to come along on a dungeon delve, where there are sure to be many tight spaces.&quot;,
&quot;Medieval Proliferation. Two blacksmiths are in competition to create better melee weapons for the King&#39;s army and only one can win the contract. One of the blacksmiths approaches the PCs to try the weapons and plead their virtues to the King. He also claims his competitors are playing dirty.&quot;,
&quot;Kindergarten Magic. Street urchins are rumored to have special powers. A representative of the Magicians Guild approaches your party to investigate. In reality, they are learning magic from an unknown source. The children have less inhibition and magical control, but have much more mana and capability of replenishing mana, making them dangerous magic users.&quot;,
&quot;As the PCs turn a corner, a law enforcement officer slams into them at breakneck speed. As they help him up, they notice he is covered in blood with grievous wounds. As he dies in their arms, he begs them to find his wife and relay his sincerest love and apologies.&quot;,
&quot;&#39;Psst, do you want to buy a crystal ball that really works? It&#39;s cheap!&#39; says a shady character while sneaking up on the PCs from an alley. The price really is cheap, and you might even lead the PCs to believe the ball works when they try to use it for petty things, but it is unreliable, maybe even cursed. And the big problem is that one or more groups of NPCs badly want this crystal ball.&quot;,
&quot;The PCs witness a break-in at a shop. If they intervene, then right at the end of the encounter the shop owner shows up and accuses the PCs of breaking in and causing damage in his shop. He immediately calls for the guard.&quot;,
&quot;The party runs over or mortally injures a shepherd&#39;s goat by accident. After apologizing, the shepherd starts demanding money equivalent to three or four times what the goat&#39;s value is. Then, as things settle down, another shepherd comes up and displays another goat injured. City guards start to show an interest in the event as well...&quot;,
&quot;A merchant discovers the PCs are buying something and comes to give them a more expensive offer for something of lesser quality. However, the merchant insists this is a good deal as his cousin works for the town hall and will cause great grief to the party if they refuse his offer.&quot;,
&quot;Two speeding coaches collide, leaving a bloody scene and angry families. The road is blocked, and the guards seem disinterested in assisting with either clearing the road or arbitrating between the families.&quot;,
&quot;Townspeople come up to the party and blame them for the local infestation of evil. If the PCs weren&#39;t there, so the argument goes, the evil would go elsewhere. A crowd gathers in support of their fellow citizens.&quot;,
&quot;There is but one accepted religion in town. What about the party cleric who serves what is here deemed a false god?&quot;,
&quot;Young lovers have taken the PCs&#39; room as refuge to meet in. They are sought after by families that do not approve.&quot;,
&quot;Injustice breaks out as revolution against a tyrant. The PCs are there to see the first flames, and may play a pivotal role in either supporting or crushing the uprising.&quot;,
&quot;A fast ship in the bay is bombarding the helpless port with siege engines. It&#39;s out of range for the locals to deal with, and possibly not alone.&quot;,
&quot;The PCs hear shrieks from a dark alley where a young maiden just went. Under the full moon, she is painfully turning into a werewolf for the first time.&quot;,
&quot;There have long been rumours of the cemetery being desecrated by someone stealing the corpses. One night the PCs chance upon the necromancer walking home with newly animated undead.&quot;,
&quot;One or more PCs are short-changed by a merchant who considers himself untouchable. Whether he truly is...&quot;,
&quot;An NPC seeks the protection of the PCs. To grant it makes her enemies the PCs&#39; enemies, and gives them the responsibility to protect a high-profile, fragile person who can&#39;t or won&#39;t leave town.&quot;,
&quot;PCs are marked by a guild of thieves or assassins for a contest. Low-skill, would-be guild members keep targeting the party with attempts on their health or goods.&quot;,
&quot;The spoiled child of a noble finds a PC has something he just *has to have*. The noble&#39;s staff does what it can to acquire it, by nearly any means necessary.&quot;,
&quot;The appearance of the PCs breaks the balance of a cold war between two rival mages. Each wishes their support to destroy the other, and fears that the other is successful in recruiting the PCs.&quot;,
&quot;A string of building construction accidents has occurred lately throughout the city. Fortunately, no one&#39;s been seriously hurt, but the accidents are increasing in size and damage. The local guild has put up flyers asking for help in solving their problem.&quot;,
&quot;As the PCs walk across a bridge over the river that cuts through town, they notice a couple of young boys standing near the edge of the bridge. They each have a large rock in their hands, and are watching one of the approaching river boats with smiles on their faces. As the boat gets closer, one of the boys raises his rock as if he is going to drop it.&quot;,
&quot;While travelling down by the docks, a ship captain waves the PCs over to talk. He&#39;s in a bind, he explains, saying that some of his dock workers didn&#39;t show up for work and he has a lot of cargo to load onto his ship so he can make the tide. The captain and crew look disreputable, and nervous, but he is willing to pay well for the work.&quot;,
&quot;The PCs come upon a sobbing woman holding a teenage boy who looks to have been severely beaten. If the PCs ask the woman if they can help, she explains her youngest son was beaten up by a gang of toughs. Of more immediate danger though, is that her oldest son has gone off to exact revenge on them, and she&#39;s afraid of what they will do to him.&quot;,
&quot;Down the dimly lit alley, two guards can be seen beating a kneeling man. One rips a coin purse from the kneeling man&#39;s belt and says, &#39;Don&#39;t be late next month, old man.&#39;&quot;,
&quot;Storm clouds hang heavy, and thick cold rain pounds down as it has for hours. Gutters gurgle, and the sewers moan as if carrying some great weight. From a drain, a swarm of thousands of black rats burst out and charge the PCs.&quot;,
&quot;As the PCs are travelling from one district to another they are confronted by a traffic jam. A building has fallen in and the umber hulk responsible is hiding, waiting for a snack to move near it.&quot;,
&quot;The PCs are hired as security for the auction of a mysterious artifact. While stopping repeated theft and auction-rigging attempts, they eventually learn of its evil nature and have to debate breaking their contract and destroying the thing while getting away with it.&quot;,
&quot;Someone falls out the window of a high building. It wasn&#39;t suicide as he had his hands and feet bound together and three large sacks of gold tied around his neck. What will be more important, the murder or the money?&quot;,
&quot;A rich man walks through a bad part of town with obvious riches and money. If mugged, he gives it willingly. He has been doing this for the last three days.&quot;,
&quot; small animal brushes past the PCs as they walk along a dock. After it jumps into the water, a group of sailors rushes onto the dock, firing crossbows and flinging harpoons at the ripples the animal left in the water. While the sailors curse and fire the last few missiles they have, one of the PCs notices the animal left a muddy gem on the top of her shoe.&quot;]&gt;&gt;</tw-passagedata><tw-passagedata pid="38" name="PlotHookPaper" tags="" position="975,475">You see a noticeboard next to the $tavern.wordnoun&#39;s $tavern.material bar. Walking over to it, you see a number of barter requests nailed to the noticeboard; simple things like &#39;have chook, want grain&#39;, &#39;have grain, want chook&#39;. One catches your eye, though; it reads &#39;&lt;&lt;print $plothook.paper.random()&gt;&gt;&#39;</tw-passagedata><tw-passagedata pid="39" name="PlotHookPeople" tags="" position="1100,475">&lt;&lt;nobr&gt;&gt;&lt;&lt;set $plotguy to setup.createNPC()&gt;&gt;&lt;&lt;/nobr&gt;&gt;
You wander around the $tavern.wordnoun, and eventually find yourself in conversation with a $plotguy.height, $plotguy.weight $plotguy.gender who introduces $plotguy.himher&lt;&lt;nobr&gt;&gt;self&lt;&lt;/nobr&gt;&gt; as $plotguy.firstname $plotguy.lastname&lt;&lt;nobr&gt;&gt;.&lt;&lt;/nobr&gt;&gt; You can&#39;t help but notice $plotguy.firstname has a &lt;&lt;print $plotguy.physicaltrait&gt;&gt;. You explain that you are adventurers, looking for work or otherwise profitable endeavours, and $plotguy.hisher $plotguy.eyes eyes light up, and $plotguy.firstname draws you closer, and whispers in a hushed tone &#39;I may have something of interest for you, in that case; &lt;&lt;print $plothook.people.random()&gt;&gt;&#39;</tw-passagedata><tw-passagedata pid="40" name="PlotHookRumour" tags="" position="1225,475">&lt;&lt;nobr&gt;&gt;
&lt;&lt;set _PlotHookRumourRoll to random(1, 2)&gt;&gt;
&lt;&lt;if _PlotHookRumourRoll is 1&gt;&gt;
	You make your way around the $tavern.wordnoun, and chat with a couple of the locals. They are friendly enough for simple $town.type folk, and are happy to share a drink with you, and gossip easily- apparently, $bartender.name $bartender.trait&lt;&lt;nobr&gt;&gt;.&lt;&lt;/nobr&gt;&gt; When you steer the conversation towards rumours that they&#39;ve heard, the half-drunk &lt;&lt;print either(&quot;man&quot;, &quot;woman&quot;)&gt;&gt; looks around, and in a hushed voice, whispers
	&lt;&lt;elseif _PlotHookRumourRoll is 2&gt;&gt;
You talk amongst the good folk of $town.name, who seem pleasant enough. They gossip easily, and reckon that $tavern.name is only known for its $tavern.draw, and that the pub across the road is totally way better. You steer the conversation towards topics that are more interesting to adventurers such as yourselves, and the drunk &lt;&lt;print $npc.weight.random()&gt;&gt; &lt;&lt;print either(&quot;man&quot;, &quot;woman&quot;, &quot;person whose gender you can&#39;t quite pin down&quot;)&gt;&gt; looks around, and whispers in a hushed voice
&lt;&lt;/if&gt;&gt;

&lt;&lt;/nobr&gt;&gt; &#39;&lt;&lt;print $plothook.rumour.pluck()&gt;&gt;&#39;</tw-passagedata><tw-passagedata pid="41" name="PlotHookThings" tags="" position="100,600">To be added.</tw-passagedata><tw-passagedata pid="42" name="ReputationDescriptor" tags="" position="225,600">&lt;&lt;nobr&gt;&gt;&lt;&lt;if $tavern.type == &quot;regular&quot;&gt;&gt;
		&lt;&lt;print &quot;just a regular inn, known&quot;&gt;&gt;
	&lt;&lt;else&gt;&gt;
		&lt;&lt;print $tavern.reputation&gt;&gt;
&lt;&lt;/if&gt;&gt;&lt;&lt;/nobr&gt;&gt;</tw-passagedata><tw-passagedata pid="43" name="Fairmath" tags="" position="350,600">/*

&lt;&lt;widget &quot;wealthincrease&quot;&gt;&gt;
&lt;&lt;set $tavern.wealthrollresult to Math.round($args[0]+((100-$args[0])*($args[1]/100))) &gt;&gt;
&lt;&lt;/widget&gt;&gt;

&lt;&lt;widget &quot;wealthdecrease&quot;&gt;&gt;
&lt;&lt;set $tavern.wealthrollresult to Math.round($args[0]-($args[0]*($args[1]/100) )) &gt;&gt;
&lt;&lt;/widget&gt;&gt;

&lt;&lt;widget &quot;populationincrease&quot;&gt;&gt;
&lt;&lt;set $tavern.populationrollresult to Math.round($args[0]+((100-$args[0])*($args[1]/100))) &gt;&gt;
&lt;&lt;/widget&gt;&gt;

&lt;&lt;widget &quot;populationdecrease&quot;&gt;&gt;
&lt;&lt;set $tavern.populationrollresult to Math.round($args[0]-($args[0]*($args[1]/100) )) &gt;&gt;
&lt;&lt;/widget&gt;&gt;

&lt;&lt;widget &quot;reputationincrease&quot;&gt;&gt;
&lt;&lt;set $tavern.reputationrollresult to Math.round($args[0]+((100-$args[0])*($args[1]/100))) &gt;&gt;
&lt;&lt;/widget&gt;&gt;

&lt;&lt;widget &quot;reputationdecrease&quot;&gt;&gt;
&lt;&lt;set $tavern.reputationrollresult to Math.round($args[0]-($args[0]*($args[1]/100) )) &gt;&gt;
&lt;&lt;/widget&gt;&gt;

&lt;&lt;widget &quot;sinincrease&quot;&gt;&gt;
&lt;&lt;set $tavern.sinrollresult to Math.round($args[0]+((100-$args[0])*($args[1]/100))) &gt;&gt;
&lt;&lt;/widget&gt;&gt;

&lt;&lt;widget &quot;sindecrease&quot;&gt;&gt;
&lt;&lt;set $tavern.sinrollresult to Math.round($args[0]-($args[0]*($args[1]/100) )) &gt;&gt;
&lt;&lt;/widget&gt;&gt;

&lt;&lt;widget &quot;sizeincrease&quot;&gt;&gt;
&lt;&lt;set $tavern.sizerollresult to Math.round($args[0]+((100-$args[0])*($args[1]/100))) &gt;&gt;
&lt;&lt;/widget&gt;&gt;

&lt;&lt;widget &quot;sizedecrease&quot;&gt;&gt;
&lt;&lt;set $tavern.sizerollresult to Math.round($args[0]-($args[0]*($args[1]/100) )) &gt;&gt;
&lt;&lt;/widget&gt;&gt;

&lt;&lt;widget &quot;diversityincrease&quot;&gt;&gt;
&lt;&lt;set $tavern.diversityrollresult to Math.round($args[0]+((100-$args[0])*($args[1]/100))) &gt;&gt;
&lt;&lt;/widget&gt;&gt;

&lt;&lt;widget &quot;diversitydecrease&quot;&gt;&gt;
&lt;&lt;set $tavern.diversityrollresult to Math.round($args[0]-($args[0]*($args[1]/100) )) &gt;&gt;
&lt;&lt;/widget&gt;&gt;

&lt;&lt;widget &quot;roughnessincrease&quot;&gt;&gt;
&lt;&lt;set $tavern.roughnessrollresult to Math.round($args[0]+((100-$args[0])*($args[1]/100))) &gt;&gt;
&lt;&lt;/widget&gt;&gt;

&lt;&lt;widget &quot;roughnessdecrease&quot;&gt;&gt;
&lt;&lt;set $tavern.roughnessrollresult to Math.round($args[0]-($args[0]*($args[1]/100) )) &gt;&gt;
&lt;&lt;/widget&gt;&gt;

&lt;&lt;widget &quot;cleanlinessincrease&quot;&gt;&gt;
&lt;&lt;set $tavern.cleanlinessrollresult to Math.round($args[0]+((100-$args[0])*($args[1]/100))) &gt;&gt;
&lt;&lt;/widget&gt;&gt;

&lt;&lt;widget &quot;cleanlinessdecrease&quot;&gt;&gt;
&lt;&lt;set $tavern.cleanlinessrollresult to Math.round($args[0]-($args[0]*($args[1]/100) )) &gt;&gt;
&lt;&lt;/widget&gt;&gt;

*/</tw-passagedata><tw-passagedata pid="44" name="PassageReady" tags="" position="475,600">&lt;&lt;for _passage range Story.lookup(&quot;tags&quot;, &quot;render&quot;)&gt;&gt;
    &lt;&lt;include _passage.title&gt;&gt;
&lt;&lt;/for&gt;&gt;</tw-passagedata><tw-passagedata pid="45" name="StoryAuthor" tags="" position="600,600">Created by /u/rcgy</tw-passagedata><tw-passagedata pid="46" name="StoryInit" tags="" position="725,600">&lt;&lt;set $versionnumber to &quot;0.3&quot;&gt;&gt;


&lt;&lt;include &quot;Town&quot;&gt;&gt;
/* ^^^^^^^^^^^^^^^^^^^^^^^^^^ Dependencies on Town ^^^^^^^^^^^^^^^^^^^^^^^^^^ */
&lt;&lt;include &quot;Building&quot;&gt;&gt;

&lt;&lt;include &quot;Names&quot;&gt;&gt;

/* ^^^^^^^^^^^^^^^^^^^^^^^^^^ Dependencies on Names ^^^^^^^^^^^^^^^^^^^^^^^^^^ */

&lt;&lt;include &quot;Guard&quot;&gt;&gt;

&lt;&lt;include &quot;SpecialBrew&quot;&gt;&gt;



&lt;&lt;include &quot;Tavern&quot;&gt;&gt;

&lt;&lt;include &quot;TavernNameGen&quot;&gt;&gt;

&lt;&lt;include &quot;TavernFlavour&quot;&gt;&gt;

&lt;&lt;include &quot;TavernInventory&quot;&gt;&gt;

/*&lt;&lt;include &quot;fairmath&quot;&gt;&gt;*/

&lt;&lt;include &quot;TavernModifiers&quot;&gt;&gt;

&lt;&lt;include &quot;NPC&quot;&gt;&gt;

&lt;&lt;include &quot;Bartender&quot;&gt;&gt;

&lt;&lt;include &quot;PlotHook&quot;&gt;&gt;

&lt;&lt;include &quot;ShitPlotHooks&quot;&gt;&gt;

&lt;&lt;include &quot;Bonds&quot;&gt;&gt;

&lt;&lt;include &quot;TavernRenders&quot;&gt;&gt;

&lt;&lt;include &quot;Newspaper&quot;&gt;&gt;

&lt;&lt;include &quot;Alchemist&quot;&gt;&gt;

&lt;&lt;include &quot;AlchemistNameGen&quot;&gt;&gt;

&lt;&lt;include &quot;Potions&quot;&gt;&gt;

&lt;&lt;include &quot;AlchemistInventory&quot;&gt;&gt;

&lt;&lt;include &quot;Blacksmith&quot;&gt;&gt;

&lt;&lt;include &quot;Smithy&quot;&gt;&gt;

&lt;&lt;include &quot;SmithyInventory&quot;&gt;&gt;

&lt;&lt;include &quot;SmithyModifiers&quot;&gt;&gt;

&lt;&lt;include &quot;SmithyRenders&quot;&gt;&gt;

&lt;&lt;include &quot;SmithyNameGen&quot;&gt;&gt;

&lt;&lt;include &quot;Books&quot;&gt;&gt;

&lt;&lt;include &quot;Mercenaries&quot;&gt;&gt;</tw-passagedata><tw-passagedata pid="47" name="StoryMenu" tags="" position="850,600">[[Credits]]

&lt;&lt;link &quot;Submit a Suggestion&quot;&gt;&gt;&lt;&lt;include &quot;Submission Form&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;


/*&lt;&lt;link &quot;Check Variables&quot;&gt;&gt;&lt;&lt;checkvars&gt;&gt;&lt;&lt;/link&gt;&gt;

&lt;&lt;link &quot;Create Bug Report&quot;&gt;&gt;&lt;&lt;bugreport &quot;Bug Report Instructions&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;*/</tw-passagedata><tw-passagedata pid="48" name="Widgets" tags="widget widgets" position="975,600">&lt;&lt;nobr&gt;&gt;&lt;&lt;widget &quot;money&quot;&gt;&gt;
&lt;&lt;if Math.floor($args / 100) gte 1 &amp;&amp; Math.floor(($args / 10) % 10) gte 1 &amp;&amp; Math.floor($args % 10) gte 1&gt;&gt;
		&lt;&lt;print Math.floor($args / 100)&gt;&gt; Gold, &lt;&lt;print Math.floor(($args / 10) % 10)&gt;&gt; Silver, and also &lt;&lt;print Math.floor($args % 10)&gt;&gt; Copper
	&lt;&lt;elseif Math.floor($args / 100) gte 1 &amp;&amp; Math.floor(($args / 10) % 10) lt 1 &amp;&amp; Math.floor($args % 10) gte 1&gt;&gt;
		&lt;&lt;print Math.floor($args / 100)&gt;&gt; Gold, and &lt;&lt;print Math.floor($args % 10)&gt;&gt; Copper
	&lt;&lt;elseif Math.floor($args / 100) gte 1 &amp;&amp; Math.floor(($args / 10) % 10) gte 1 &amp;&amp; Math.floor($args % 10) lt 1&gt;&gt;
		&lt;&lt;print Math.floor($args / 100)&gt;&gt; Gold, and &lt;&lt;print Math.floor(($args / 10) % 10)&gt;&gt; Silver
	&lt;&lt;elseif Math.floor($args / 100) gte 1 &amp;&amp; Math.floor(($args / 10) % 10) lt 1 &amp;&amp; Math.floor($args % 10) lt 1&gt;&gt;
		&lt;&lt;print Math.floor($args / 100)&gt;&gt; Gold
	&lt;&lt;elseif Math.floor($args / 100) lt 1 &amp;&amp; Math.floor(($args / 10) % 10) gte 1 &amp;&amp; Math.floor($args % 10) gte 1&gt;&gt;
		&lt;&lt;print Math.floor(($args / 10) % 10)&gt;&gt; Silver, and &lt;&lt;print Math.floor($args % 10)&gt;&gt; Copper
	&lt;&lt;elseif Math.floor($args / 100) lt 1 &amp;&amp; Math.floor(($args / 10) % 10) gte 1 &amp;&amp; Math.floor($args % 10) lt 1&gt;&gt;
		&lt;&lt;print Math.floor(($args / 10) % 10)&gt;&gt; Silver
	&lt;&lt;elseif Math.floor($args / 100) lt 1 &amp;&amp; Math.floor(($args / 10) % 10) lt 1&amp;&amp; Math.floor($args % 10) gte 1&gt;&gt;
		&lt;&lt;print Math.floor($args % 10)&gt;&gt; Copper
	&lt;&lt;/if&gt;&gt;
&lt;&lt;/widget&gt;&gt;&lt;&lt;/nobr&gt;&gt;

&lt;&lt;nobr&gt;&gt;&lt;&lt;widget &quot;heshe&quot;&gt;&gt;
&lt;&lt;switch $args.gender&gt;&gt;
	&lt;&lt;case &quot;man&quot;&gt;&gt;
		&lt;&lt;set $args.heshe to &quot;he&quot;&gt;&gt;
		&lt;&lt;set $args.himher to &quot;him&quot;&gt;&gt;
		&lt;&lt;set $args.hisher to &quot;his&quot;&gt;&gt;
		&lt;&lt;set $args.boygirl to &quot;boy&quot;&gt;&gt;
		&lt;&lt;set $args.manwoman to &quot;man&quot;&gt;&gt;
		&lt;&lt;set $args.menwomen to &quot;men&quot;&gt;&gt;
		&lt;&lt;set $args.guygirl to &quot;guy&quot;&gt;&gt;
	&lt;&lt;case &quot;woman&quot;&gt;&gt;
		&lt;&lt;set $args.heshe to &quot;she&quot;&gt;&gt;
		&lt;&lt;set $args.himher to &quot;her&quot;&gt;&gt;
		&lt;&lt;set $args.hisher to &quot;her&quot;&gt;&gt;
		&lt;&lt;set $args.boygirl to &quot;girl&quot;&gt;&gt;
		&lt;&lt;set $args.manwoman to &quot;woman&quot;&gt;&gt;
		&lt;&lt;set $args.menwomen to &quot;women&quot;&gt;&gt;
		&lt;&lt;set $args.guygirl to &quot;girl&quot;&gt;&gt;
&lt;&lt;/switch&gt;&gt;&lt;&lt;/widget&gt;&gt;&lt;&lt;/nobr&gt;&gt;</tw-passagedata><tw-passagedata pid="49" name="Ships" tags="" position="1100,600">&lt;&lt;set $ship to {
	name: [&quot;Lantheon&quot;, &quot;Starchaser&quot;, &quot;Dryad’s Fury&quot;, &quot;Black Trident&quot;, &quot;Corellon’s Arrow&quot;, &quot;Morkoth&quot;,&quot;Koalinthas&quot;, &quot;Sehanine’s Fool&quot;, &quot;Stormcrow&quot;, &quot;Vaazrus&quot;, &quot;Shield of Khahar&quot;, &quot;Stingray&quot;, &quot;Sanaj-Rakal&quot;,&quot;Zhal-Vazir&quot;, &quot;Griffonwing&quot;, &quot;Blademark&quot;, &quot;Golden Libram&quot;, &quot;Hareth’s Barrel&quot;, &quot;Kasha’s Wake&quot;, &quot;Shining Flute&quot;,&quot;White Feather&quot;, &quot;Riventide&quot;, &quot;Moonriser&quot;, &quot;Gem of Malfier&quot;, &quot;Dragon’s Glory&quot;, &quot;Menacer&quot;, &quot;Scarlet Dagger&quot;,
	&quot;Kral-Tajir&quot;, &quot;Ravager&quot;, &quot;Kerle’s Drum&quot;, &quot;Heart of Avandra&quot;, &quot;Goldraker&quot;, &quot;Sea Haunt&quot;, &quot;Storm Maven&quot;,&quot;Grimbol’s Cutlass&quot;, &quot;Scimitar&quot;, &quot;Black Gauntlet&quot;, &quot;Iron Maiden&quot;, &quot;Wavecrusher&quot;, &quot;Hammer of Kavath&quot;,
	&quot;Waterblade&quot;, &quot;Arkhor’s Secret&quot;, &quot;Dire Gar&quot;, &quot;Prallmar’s Shadow&quot;, &quot;Piranha&quot;, &quot;Devil’s Fork&quot;, &quot;Tuersyl’s Fist&quot;, &quot;Daraj-Vzan&quot;, &quot;Silver Chalice&quot;, &quot;Demonrudder&quot;, &quot;Turathi Flame&quot;, &quot;Storm’s Eye&quot;,
	&quot;Tanishar’s Fate&quot;, &quot;Shard of Night&quot;, &quot;Triton&quot;, &quot;Jarak’s Grasp&quot;, &quot;Nightmare&quot;, &quot;Harpy’s Lure&quot;, &quot;Devious&quot;,&quot;Arazandro’s Bluff&quot;, &quot;Nbod’s Haul&quot;, &quot;Astaryntha&quot;, &quot;Expeditious&quot;, &quot;Curse of Thuban&quot;, &quot;Siren’s Kiss&quot;,	&quot;Lonely Witch&quot;, &quot;Rat’s Nest&quot;, &quot;Evader&quot;, &quot;Mistreaver&quot;, &quot;Ven’r&quot;, &quot;Vicious&quot;, &quot;Dream of Melora&quot;, &quot;Shensari&quot;,
	&quot;Damilor&quot;, &quot;Krimilvin’s Charm&quot;, &quot;Bloodmonger&quot;, &quot;Lucky Scrag&quot;, &quot;Windstriker&quot;, &quot;Grim Gale&quot;, &quot;Djinni’s Wish&quot;, &quot;Flying Eel&quot;, &quot;Jewel of Irthos&quot;, &quot;Broken Keel&quot;, &quot;Javelin&quot;, &quot;Myrska’s Revenge&quot;, &quot;Fearsome&quot;, &quot;Archon’s Hammer&quot;, &quot;Vendetta&quot;, &quot;Thunderchaser&quot;, &quot;Heartless&quot;, &quot;Shrike&quot;, &quot;Morak’s Boat&quot;, &quot;Mar-Turang&quot;, &quot;Will-o’-wisp&quot;, &quot;Asha-Naga&quot;,
	&quot;Dominant&quot;, &quot;Shoal Courser&quot;, &quot;Crescent Moon&quot;, &quot;Crystal Tear&quot;, &quot;Kara-Vaji&quot;, &quot;Shalastar&quot;, &quot;Roc’s Talon&quot;, &quot;Wavecarver&quot;, &quot;Graethan&quot;, &quot;Rotten Apple&quot;, &quot;Bharzim’s Victory&quot;, &quot;Avarice&quot;, &quot;Farak-Changal&quot;, &quot;Falling Star&quot;, &quot;Crimson Knife&quot;, &quot;Yisek’s Ride&quot;, &quot;Shara-Vaja&quot;, &quot;Varalan’s Dweomer&quot;, &quot;Rangoth&quot;, &quot;Vostarika&quot;, &quot;Mirasandra&quot;, &quot;Second Chance&quot;, &quot;Redfeather&quot;, &quot;Maal-Destir&quot;, &quot;Scorpion&quot;, &quot;Ghorzaar’s Bane&quot;, &quot;Moonwatcher&quot;, &quot;Dragon’s Crown&quot;, &quot;Dragonhawk&quot;, &quot;Dancing Sword&quot;, &quot;Kaveth’s Whisper&quot;, &quot;Tirah&quot;, &quot;Phantom Shark&quot;, &quot;Hjeltia&quot;, &quot;Satyr&quot;, &quot;Breyten’s Thrill&quot;, &quot;Golden Coin&quot;, &quot;Pearl of Fire&quot;, &quot;Bhez-Rizma&quot;, &quot;Fireball&quot;, &quot;Color Spray&quot;, &quot;Sea Bear&quot;, &quot;Prosperous&quot;, &quot;Summer Rain&quot;, &quot;Sundowner&quot;, &quot;Skulldark’s Ire&quot;, &quot;Skandalor&quot;, &quot;Zarkanan&quot;, &quot;Sana-Losi&quot;, &quot;Wolfshark&quot;, &quot;Song of Elyndri&quot;, &quot;Coral Rose&quot;, &quot;Rune of Halendros&quot;, &quot;Maelstrom&quot;, &quot;Shadow Mask&quot;, &quot;Deep Heathen&quot;, &quot;Aurora&quot;, &quot;Rusted Cutlass&quot;, &quot;Thog’s Maul&quot;, &quot;Wooden Stake&quot;, &quot;Hellstrike&quot;, &quot;Scepter Queen&quot;, &quot;Prince of Lies&quot;, &quot;Fang of Tezmyr&quot;, &quot;White Hart&quot;, &quot;Floating Cask&quot;, &quot;Sea Howler&quot;, &quot;Frostwind&quot;, &quot;Moonshadow&quot;, &quot;Melora’s Favor&quot;, &quot;Dark Queen’s Voice&quot;, &quot;Chethel’s Ghost&quot;, &quot;Mad Hag&quot;, &quot;Tamarion’s Grudge&quot;, &quot;Raven’s Gamble&quot;, &quot;Reckoner&quot;, &quot;Wraithwind&quot;, &quot;Kalisa Tano&quot;, &quot;Beholder&quot;, &quot;Slippery Trickster&quot;, &quot;Retribution&quot;, &quot;Whirling Glyph&quot;, &quot;Lady Rose&quot;, &quot;Karthang’s Plunder&quot;, &quot;Good Fortune&quot;, &quot;Axe of Thard&quot;, &quot;Black Bow&quot;, &quot;Quickstrike&quot;, &quot;Thelandira&quot;, &quot;Hammergust&quot;, &quot;Barracuda&quot;, &quot;Sahandrian’s Quarrel&quot;, &quot;Feral Knave&quot;, &quot;Wildwyrm&quot;, &quot;Shevaya’s Honor&quot;, &quot;Blackhelm’s Legacy&quot;, &quot;Wyvern’s Sting&quot;, &quot;Dragonroar&quot;, &quot;Kegstaff&quot;, &quot;Oaken Ranger&quot;, &quot;Timber Serpent&quot;, &quot;Desperate Sorceress&quot;, &quot;Screaming Gull&quot;, &quot;Greedy Drake&quot;, &quot;Light of Pjaltr&quot;, &quot;Fate’s Blessing&quot;, &quot;Stardancer&quot;, &quot;Leering Skull&quot;, &quot;Ebon Moon&quot;, &quot;Werewolf&quot;, &quot;Redemption&quot;, &quot;Zaetchan’s Privilege&quot;, &quot;Sea Skulk&quot;, &quot;Savage Swan&quot;, &quot;Bane’s Breath&quot;, &quot;Ghorok’s Grail&quot;, &quot;Emerald Eye&quot;, &quot;Remorseless&quot;, &quot;Skiprock&quot;, &quot;Zaetra&quot;, &quot;Silverfin&quot;, &quot;Risen Ghost&quot;, &quot;Listless&quot;, &quot;Vortex&quot;, &quot;Advantage&quot;, &quot;Autumn Song&quot;, &quot;Trystan’s Delight&quot;, &quot;Soaring Manta&quot;, &quot;Calomaar’s Edge&quot;, &quot;Saerthzal&quot;, &quot;Iron Trumpet&quot;, &quot;Locathah&quot;, &quot;Demonskull&quot;, &quot;Arrowhead&quot;, &quot;Frastain’s Bottle&quot;],
	type: [&quot;caravel&quot;, &quot;carrack&quot;, &quot;crayer&quot;, &quot;hoy&quot;, &quot;picard&quot;, &quot;galley&quot;, &quot;longship&quot;, &quot;balinger&quot;, &quot;frigate&quot;, &quot;galleon&quot;, &quot;galleass&quot;, &quot;galley&quot;, &quot;nef&quot;]
	}
&gt;&gt;</tw-passagedata><tw-passagedata pid="50" name="ShitPlotHooks" tags="" position="1225,600">&lt;&lt;set $shitplothook to [&quot;A bard. Not a magic one. Just a bard. Like y&#39;know. A minstrel or some shit he&#39;s ok I guess.&quot;,
&quot;Man chasing after a woman through a corn field. Distant saxophone is heard before both get eaten by a troll which chokes to death on them.&quot;,
&quot;The world&#39;s highest dragon lands, eats three deer, tries to fly, crashes, then just sleeps where he fell.&quot;,
&quot;A circus is in town. A shitty circus. Like a mobile Chuck E. Cheeses during a power outage.&quot;,
&quot;A village is being savaged by the most passive aggressive wizard ever.&quot;,
&quot;Two heavily armed fighters going at it hammer and tongs in the middle of the road, Every attack is a miss on both sides.&quot;,
&quot;Suddenly ninjas. They don&#39;t attack or anything, they have better things to do. But still.&quot;,
&quot;What looks like a sword is stabbed into a stone. Turns out it&#39;s just a hilt. Made of tin.&quot;,
&quot;A gnome, a halfling and a dwarf are having a &#39;who&#39;s the shortest&#39; contest. It&#39;s fairly easy to resolve and they do so shortly after the party arrives.&quot;,
&quot;A bandit calls for the party to stand and deliver. He&#39;s not robbing them, he just really wants his package.&quot;,
&quot;An ugly old man offers the party some of his lunch stew. It&#39;s not bad, could use some savory herb or something though.&quot;,
&quot;A young child is crying for his mom. His mom is maybe 40 feet away waiting for the kid to shut up and actually look.&quot;,
&quot;A carrot is near the road. If disturbed a ranger yells at the party for disturbing his rabbit bait.&quot;,
&quot;A rabbit is caught in a trap. If disturbed a ranger yells at the party for disturbing his fox bait.&quot;,
&quot;A fox is caught in a trap. If disturbed a ranger yells at the party for disturbing his wolf bait.&quot;,
&quot;A wolf is caught in a trap. If disturbed a ranger yells at the party for disturbing his bear bait.&quot;,
&quot;A bear is caught in a trap. If disturbed a ranger yells at the party for disturbing his owlbear bait.&quot;,
&quot;An owlbear is caught in a trap. If disturbed a ranger yells at the party for disturbing his ogre bait.&quot;,
&quot;An ogre caught in a trap. If disturbed a ranger yells at the party for disturbing his dragon bait.&quot;,
&quot;A dragon is caught in a trap. If disturbed a ranger yells at the party for disturbing his tarasque bait.&quot;,
&quot;A local child has taken to following the smartest member of the party around asking him &#39;why&#39; in the most obnoxious voice possible.&quot;,
&quot;A bird poops right down the back of the most wizard-like character&#39;s clothes. Haha.&quot;,
&quot;A bird poops right in the eye of the most cleric-like character. Haha.&quot;,
&quot;A bird poops right on the mouth of the most thief like character. Haha.&quot;,
&quot;A branch or sign suddenly breaks it&#39;s base or chain or string and swings directly into the most wizard-like character&#39;s face.&quot;,
&quot;A lady hobo is telling shitty fortunes for 3 sp a pop. She&#39;s got no takers so far.&quot;,
&quot;A group of bandits or pirates are dead drunk singing bawdily together off to one side.&quot;,
&quot;A group of guards catch and hang a thief who just ripped off the necklace of some girl and stole from a few stands.&quot;,
&quot;An attractive bar wench starts flirting with the strongest looking male party member. If asked she&#39;ll gladly &#39;spend time&#39; with them. Nothing else worth noting here.&quot;,
&quot;Town drunk wraps an arm around a party member claiming. &#39;You&#39;se gais &#39;re al&#39;righ&#39;&#39; before puking on the fanciest dressed character and passing out.&quot;,
&quot;Town drunk pukes on the fanciest dressed character and passes out.&quot;,
&quot;Worst pickpocket in the world attempts to rob from the character who would most easily notice and deal with them. Mostly he just ends up groping them and the running off.&quot;,
&quot;Fake wizard claims to be a real one. When questioned he flings glitter in the party&#39;s collective face yelling &#39;Glitterrust!&#39; and running before tripping on his robes and knocking himself out.&quot;,
&quot;Hobo claims to be a deposed king who will reward the party if they can return to him his seal which some other hobos stole and are hiding out under the town bridge. He just wants to sleep under the bridge after the party clears the other hobos out.&quot;,
&quot;Local noble badly disguised as a commonfolk, no one care since he&#39;s got money and is a fairly decent person. Snobs if the party tries to talk to them.&quot;,
&quot;A short shower of copper bits fall from the sky. Like. 10 of them.&quot;,
&quot;A man in a nice set of robes is handing out pamphlets for the local good parish. Introduces himself as Brother Gideon.&quot;,
&quot;A man in a bad set of robes is handing out dead rats from the local evil temple. Introduces himself as Brother BabyStabber.&quot;,
&quot;A man in a decent set of robes is handing out blank pieces of paper from the local neutral temple. Introduces himself with a shrug and a sigh.&quot;,
&quot;A lovely gazebo is seen on the side of the road. It looks like a nice place for a picnic.&quot;]&gt;&gt;




/*
&quot;An adventure party passes by whining about a lack of something called &#39;Cheetos&#39; and some or of Dew of a Mountain. Weirdos.&quot;,
&quot;An adventure party passes by with each member spouting off silly &#39;Ni&#39; noises or something about bushes. Weirdos.&quot;,
&quot;An adventure party passes by with a drow sneaky fellow wearing two scimitars whinging about wanting more &#39;Ex-Pee&#39; because of &#39;Role-playing&#39;. Weirdo.&quot;,
&quot;An armless, legless knight has bled out near a creek. Apparently his corpse has been here for a while. His armor seems to be made of paper.&quot;,

&quot;A fairy offers the party a wish if they can answer her riddles three. If they agree she just leaves laughing saying &#39;I didn&#39;t think someone would actually believe me on that.&#39;. If they don&#39;t she gets mad and leaves saying &#39;It&#39;s not like they were THAT hard, pansies.&#39;&quot;,

&quot;A lumberjack is eating his lunch on the side of the road. If asked he&#39;ll share with one person.&quot;,
&quot;A miner is eating his lunch on the side of the road. If asked he&#39;ll share a beer with one person.&quot;,
&quot;A cultist is eating his lunch on the side of the road. If asked he&#39;ll share a bagel with one person.&quot;,
&quot;A perfectly serviceable wooden shield is found on the side of the road. Not masterwork or magic. Just serviceable.&quot;,
&quot;A perfectly serviceable shortsword is found on the side of the road. Not masterwork or magic. Just serviceable.&quot;,
&quot;There&#39;s a huge pot hole in the road. Like HUGE, for a pothole, it&#39;s not a pit or anything. DC 3 Acrobatics check to not stumble on it. Failure means you take 1d2-1 nonlethal teasing damage and fall flat on your ungraceful face.&quot;,
&quot;A tune if heard off in the distance. Nothing in particular, just kind of a musical edge to the area. Like a light mist.&quot;,
&quot;A troop of guardsmen are patrolling the road. They ask you to clear the way and move on.&quot;,
&quot;A man is selling sausages from a decent cart. The sausages are ok.&quot;,
&quot;A man is selling sausages from a crappy cart. The sausages are good, but you start to feel bad for eating too many of them. Like you ate an entire tin of ice cream bad.&quot;,
&quot;A man is selling sausages from a good cart with bread rolls. The bread is bland, and the spice in the sausage is forgettable, but it&#39;s filling.&quot;,
&quot;A man is selling wiener dogs from a cart that&#39;s barking. Not to eat. He&#39;s just selling the dogs. They make good mousers he says.&quot;,
&quot;A woman in armor is offering to bed any man who can beat her in an arm wrestle. She&#39;s got a 23 Strength and isn&#39;t particularly pretty, but if you&#39;re into that it&#39;s there.&quot;,

&quot;A group of guards force a group of prostitutes to &#39;Move along then.&#39;&quot;,
&quot;A minstrel plays nearby. He&#39;s ok, but he&#39;d be a lot better if he actually put some practice in.&quot;,
&quot;A local pubkeep offers the party a round of drinks for half off on account of them looking thirsty.&quot;,
&quot;A local inn offers the party a dinner half off on account of them looking hungry.&quot;,
&quot;A man missing a leg thanks the party for the good that they&#39;ve been doing.&quot;, &quot;A man missing an arm spits at the party for the good they missed doing.&quot;,
&quot;Two bards are utterly failing to sing a song in tune.&quot;,
&quot;Two bards are actually killing a particular song. The crowd around them is pretty into it.&quot;,
&quot;A man is selling hats. He&#39;s willing to trade for skins if anyone in the party has any.&quot;,
&quot;The party sees a mild acquaintance. S/He offers to get lunch with them.&quot;, &quot;The party sees a mild annoyance. S/He flips them the bird before wandering off.&quot;, &quot;A pie eating contest is in progress. It looks like it&#39;s down to the blacksmith&#39;s son or the cowherd&#39;s daughter.&quot;, &quot;Two teenagers are walking down the street holding hands and blushing whenever one catches the other&#39;s eye.&quot;, &quot;The wizard steps in shit. Roll 1d4 to see what kind. 1- Cow, 2- Cow, 3- Cow, 4- Builette.&quot;, &quot;A group of bandits charge, but petter out before combat engages because the party looks too tough to take on.&quot;, &quot;Seven men in hooded robes are fumbling around. Overhead is: &#39;Hey John, I think I&#39;ve got your robes&#39; &#39;Damnit Sev, your wife swapped our hoods again.&#39; and &#39;Who&#39;s got my sash? It was the scarlet one.&#39;&quot;,&quot;A drow is hung over on the side of the road. A three empty bottles of dwarven ale are nearby. He&#39;s waving his hands about muttering &#39;Turn off the sun.&#39; Shortly after Dancing Lights twirl around his location as he lets out a groan of pain.&quot;, &quot;A dwarf is passed out in a puddle of his own drool on the side of the road. A half empty bottle of elven wine is nearby.&quot;, &quot;A friendly dog comes by and starts begging for treats from the most cleric-like party member.&quot;, &quot;An unfriendly dog attempts to pee on the most wizard-like party member.&quot;, &quot;Two old men are playing some sort of game on the side of the road talking mostly in murmurs, grunts, and chortles.&quot;, &quot;Two old women are gossiping nearby knitting scarves longer than they are tall that are growing by the inch as you watch.&quot;, &quot;A man is juggling torches nearby. Nothing goes amiss.&quot;, &quot;Two young teenagers are arguing about whether a dragon could be three owlbears if the owlbears had armor and magic wands and the dragon had a sword.&quot;, &quot;A local noble is in town collecting his due taxes.&quot;, &quot;The worst bandit in the world attempts to way-lay the party with a sharpened stick and a dented pot lit. If actually confronted he faints in shock.&quot;, &quot;The wizard discovers he has a sign pinned to the back of his robes reading &#39;Ass-zard&#39;. It is unknown when it was placed there or how long it&#39;s been there.&quot;, &quot;A dungeon is nearby, if investigated it turns out that it&#39;s still in the process of being excavated and won&#39;t be ready for several more years.&quot;, &quot;The thief find a socket puppet nestled amongst his belongings. It appears to be made from one of the wizards socks.&quot;, &quot;The fighter finds a flask of good booze they had forgot about amongst their belongings.&quot;, &quot;The cleric finds a bag of honeyed nuts amongst her belongings.&quot;
*/</tw-passagedata><tw-passagedata pid="51" name="Start" tags="output" position="100,725">&lt;h1&gt;Eigengrau&#39;s Essential Establishment Generator&lt;/h1&gt;
Welcome to Eigengrau&#39;s Essential Establishment Generator, v$versionnumber! This is still in alpha. If you have any bug reports, suggestions, or submissions (in desperate need of more plot hooks!), please click here: [[Submission Form]]
&lt;&lt;linkappend &quot;&lt;h4&gt;Changelog&lt;/h4&gt;&quot; t8n&gt;&gt;
&lt;&lt;include &quot;Changelog&quot;&gt;&gt;&lt;&lt;linkappend &quot;&lt;h5&gt;To Do List&lt;/h5&gt;&quot; t8n&gt;&gt;
&lt;&lt;include &quot;ToDo&quot;&gt;&gt;&lt;&lt;/linkappend&gt;&gt;&lt;&lt;/linkappend&gt;&gt;

&lt;&lt;linkreplace &quot;Rename the $town.type &lt;strong&gt;$town.name&lt;/strong&gt;&quot;&gt;&gt;&lt;&lt;textbox &quot;$town.name&quot; $town.name&gt;&gt;&lt;&lt;/linkreplace&gt;&gt;

Town Wealth: &lt;&lt;numberslider &quot;$town.wealthroll&quot; $town.wealthroll 1 100 1&gt;&gt;

Town Population: &lt;&lt;numberslider &quot;$town.population&quot; $town.population 30 6000 10&gt;&gt;

[[$tavern.name|InitTavern]]

[[$smithy.name|InitSmithy]]

[[$alchemist.name|InitAlchemist]]</tw-passagedata><tw-passagedata pid="52" name="Bartender" tags="" position="225,725">&lt;&lt;set $bartender to setup.createNPC()&gt;&gt;
&lt;&lt;set $bartender.idle to [&quot;polishing a glass with $bartender.hisher hands&quot;, &quot;reading a newspaper which says &lt;&lt;print $newspaperheadline&gt;&gt;&quot;, &quot;pouring a drink for a customer&quot;, &quot;taking an order from a customer&quot;, &quot;talking with a customer&quot;, &quot;picking $bartender.hisher nose&quot;, &quot;playing a card game by $bartender.himher&lt;&lt;nobr&gt;&gt;self&lt;&lt;/nobr&gt;&gt;&quot;, &quot;checking the stock levels of the beer on tap&quot;, &quot;shouting into the kitchen, annoyed&quot;, &quot;yelling instructions into the kitchen&quot;, &quot;leaning against a stool, surveying the work of one of the barmaids&quot;],
	$bartender.owner to either([&quot;owner&quot;, &quot;caretaker&quot;, &quot;proud owner&quot;, &quot;proprietor&quot;, &quot;current owner&quot;, &quot;manager&quot;, &quot;manager&quot;, &quot;acting manager&quot;]),
	$bartender.greeting to [&quot;nods at you&quot;, &quot;welcomes you warmly&quot;, &quot;smiles and greets you&quot;, &quot;raises a hand with a wave&quot;, &quot;sizes you up, before $bartender.heshe nods at you&quot;, &quot;checks you out for just a moment before smiling at you&quot;]
&gt;&gt;

/* ------------------------- BARTENDER RACE -------------------------- */
&lt;&lt;switch $bartender.race&gt;&gt;
	&lt;&lt;case &quot;human&quot;&gt;&gt;
		&lt;&lt;set $tavern.diversityroll -= 10&gt;&gt;
	&lt;&lt;case &quot;half-elf&quot;&gt;&gt;
		&lt;&lt;set $tavern.diversityroll += 5, $tavern.roughnessroll -= 5, $tavern.magicroll += 2&gt;&gt;
	&lt;&lt;case &quot;elf&quot;&gt;&gt;
		&lt;&lt;set $tavern.diversityroll += 5, $tavern.roughnessroll -= 10, $tavern.wealthroll += 5, $tavern.magicroll += 4&gt;&gt;
	&lt;&lt;case &quot;dwarf&quot;&gt;&gt;
		&lt;&lt;set $tavern.diversityroll += 5, $tavern.roughnessroll += 5, $tavern.wealthroll += 5, $tavern.magicroll += 1&gt;&gt;
	&lt;&lt;case &quot;gnome&quot;&gt;&gt;
		&lt;&lt;set $tavern.diversityroll += 10, $tavern.roughnessroll -= 5, $tavern.magicroll += 1&gt;&gt;
	&lt;&lt;case &quot;halfling&quot;&gt;&gt;
		&lt;&lt;set $tavern.diversityroll += 5, $tavern.roughnessroll -= 5, $tavern.magicroll += 1&gt;&gt;
	&lt;&lt;case &quot;half-orc&quot;&gt;&gt;
		&lt;&lt;set $tavern.diversityroll += 10, $tavern.roughnessroll += 15&gt;&gt;
	&lt;&lt;case &quot;dragonborn&quot;&gt;&gt;
		&lt;&lt;set $tavern.diversityroll += 10, $tavern.roughnessroll += 5, $tavern.wealthroll += 5, $tavern.magicroll += 5&gt;&gt;
	&lt;&lt;case &quot;tiefling&quot;&gt;&gt;
		&lt;&lt;set $tavern.diversityroll += 15, $tavern.roughnessroll += 5, $tavern.sinroll += 15, $tavern.wealthroll += 10, $tavern.magicroll += 7&gt;&gt;
&lt;&lt;/switch&gt;&gt;

 Brothel Code - so the bartender is the Master or Madame of the brothel
&lt;&lt;if $tavern.draw is &quot;brothel&quot; &amp;&amp; $bartender.gender is &quot;man&quot;&gt;&gt;
		&lt;&lt;set $bartender.owner to &quot;master&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.draw is &quot;brothel&quot; &amp;&amp; $bartender.gender is &quot;woman&quot;&gt;&gt;
		&lt;&lt;set $bartender.owner to &quot;madame&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="53" name="BartenderTalk" tags="" position="350,725">$bartender.name looks &lt;&lt;print $npc.currentmood.random()&gt;&gt;, and is idly &lt;&lt;print $npc.idle.random()&gt;&gt;, until you start talking with the $bartender.weight $bartender.manwoman, who looks pleased with the welcome distraction from the patrons, who $bartender.heshe tells you are for the most part a &lt;&lt;print $tavern.sin&gt;&gt; lot. You talk about the regular goings on in $town.name, and $tavern.name, and $bartender.firstname says &quot;&lt;&lt;nobr&gt;&gt;

&lt;&lt;set _shortage to random(1, 10)&gt;&gt;
	&lt;&lt;if $tavern.wealthroll gt 80&gt;&gt;
		&lt;&lt;set _shortage += 4&gt;&gt;
	&lt;&lt;elseif $tavern.wealthroll gt 70&gt;&gt;
		&lt;&lt;set _shortage += 3&gt;&gt;
	&lt;&lt;elseif $tavern.wealthroll gt 60&gt;&gt;
		&lt;&lt;set _shortage += 2&gt;&gt;
	&lt;&lt;elseif $tavern.wealthroll gt 50&gt;&gt;
		&lt;&lt;set _shortage += 1&gt;&gt;
	&lt;&lt;elseif $tavern.wealthroll gt 40&gt;&gt;
		&lt;&lt;set _shortage -= 1&gt;&gt;
	&lt;&lt;elseif $tavern.wealthroll gt 30&gt;&gt;
		&lt;&lt;set _shortage -= 2&gt;&gt;
	&lt;&lt;elseif $tavern.wealthroll gt 20&gt;&gt;
		&lt;&lt;set _shortage -= 3&gt;&gt;
	&lt;&lt;elseif $tavern.wealthroll lte 20&gt;&gt;
		&lt;&lt;set _shortage -= 4&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if _shortage gt 7, $tavern.populationroll gt 70&gt;&gt;
		&lt;&lt;print either(&quot;We&#39;re lucky that I bought that extra case of grog... I get the feeling that we&#39;re gonna need it.&quot;,
		&quot;I&#39;m glad that Breiga kept an eye on the stock levels, otherwise we&#39;d have sold out of &lt;&lt;print $tavern.shortages.pluck()&gt;&gt;&quot;)&gt;&gt;
	&lt;&lt;elseif _shortage gt 7&gt;&gt;
		&lt;&lt;print either(&quot;Business is alright, in honesty I think that I prefer running out of supplies than not... At the moment, it looks like I&#39;ll not be running out any time soon.&quot;, &quot;I think that I may have oversupplied on &lt;&lt;print $tavern.shortages.pluck()&gt;&gt;...&quot;)&gt;&gt;
	&lt;&lt;elseif _shortage gt 4&gt;&gt;
		&lt;&lt;print either(&quot;We&#39;ve currently got a bit of a shortage of &lt;&lt;print $tavern.shortages.pluck()&gt;&gt;, but hopefully we&#39;ll be getting a cartload overmorrow.&quot;,
&quot;We&#39;re currently running out of &lt;&lt;print $tavern.shortages.pluck()&gt;&gt;, but with any luck, we&#39;ll be getting some more before the night is out.&quot;,
&quot;I don&#39;t know how it happened, but we&#39;re running out of &lt;&lt;print $tavern.shortages.pluck()&gt;&gt;&lt;&lt;nobr&gt;&gt;...&lt;&lt;/nobr&gt;&gt; To be honest, I reckon the barmaid is to blame.&quot;,
&quot;I swear that I ordered a cartload last week, but I&#39;ll be damned if we&#39;re not running low on &lt;&lt;print $tavern.shortages.pluck()&gt;&gt; somehow.&quot;,
&quot;I told &lt;&lt;print $name.woman.pluck()&gt;&gt; to order some, but wouldn&#39;t you know, I find myself low on &lt;&lt;print $tavern.shortages.pluck()&gt;&gt;!&quot;)&gt;&gt;
	&lt;&lt;elseif _shortage lte 4, $tavern.population gt 70&gt;&gt;
		&lt;&lt;print either(&quot;Things are honestly in a mess at the moment around the $tavern.name, we&#39;ve got a full house, and I&#39;m low on &lt;&lt;print $tavern.shortages.pluck()&gt;&gt; AND &lt;&lt;print $tavern.shortages.pluck()&gt;&gt;! How does that even happen!?&quot;,
		&quot;You can tell that business is booming, but there&#39;s only one more case of &lt;&lt;print $tavern.shortages.pluck()&gt;&gt;, and we&#39;re completely out of &lt;&lt;print $tavern.shortages.pluck()&gt;&gt;!&quot;)&gt;&gt;
	&lt;&lt;elseif _shortage lte 4, $tavern.populationroll lt 40&gt;&gt;
		&lt;&lt;print either(&quot;Well, you can probably guess that business isn&#39;t the best right at this moment. Maybe the lack of &lt;&lt;print $tavern.shortages.pluck()&gt;&gt; has something to do with it...&quot;,
		&quot;Business is slow, I&#39;m not gonna lie. We&#39;ve had no cartments of &lt;&lt;print $tavern.shortages.pluck()&gt;&gt; for almost a week, certainly isn&#39;t helping things.&quot;)&gt;&gt;
	&lt;&lt;elseif _shortage lte 4&gt;&gt;
		&lt;&lt;print &quot;Well, business could be better. We&#39;ve got a bit of a shortage on &lt;&lt;print $tavern.shortages.pluck()&gt;&gt;, and that certainly can&#39;t be helping things, but I suppose there&#39;s always some bad days; they&#39;re just not spending the coin, is all.&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;/nobr&gt;&gt;
&lt;&lt;linkreplace &quot;Talk more with $bartender.name&quot; t8n&gt;&gt;
$bartender.firstname tells you that the patrons are $tavern.diversity, and that $bartender.heshe &lt;&lt;print either(&quot;loves working in $tavern.name&quot;, &quot;hates working in $tavern.name&quot;, &quot;finds working in the $tavern.wordnoun boring&quot;, &quot;finds working in the $tavern.wordnoun fun&quot;)&gt;&gt;. $bartender.firstname says &quot;Before I took over $tavern.name, I was a $bartender.dndclass, and damn good at it. But that was a long time ago... The only thing that bonds me to the past now? &lt;&lt;print $bond.random()&gt;&gt;&#39;
&lt;&lt;/linkreplace&gt;&gt;
&lt;&lt;linkreplace &quot;Anything interesting been happening lately?&quot; t8n&gt;&gt;
&#39;Well...&lt;&lt;print $plothook.rumour.pluck()&gt;&gt;&#39;
&lt;&lt;/linkreplace&gt;&gt;</tw-passagedata><tw-passagedata pid="54" name="Cheese" tags="" position="475,725">&lt;&lt;set $cheese to {
  colour: [&quot;pale grey, with dark flecks&quot;, &quot;bright yellow&quot;, &quot;warm yellow&quot;, &quot;spotty yellow&quot;, &quot;pale yellow&quot;, &quot;light green&quot;, &quot;light greenish-yellow&quot;],
  texture: [&quot;crumbly, with a texture similar to plaster&quot;, &quot;rubbery, and squeaks while you eat it&quot;, &quot;rubbery, and squeaks rather disconcertingly while you eat it&quot;, &quot;crumbly, with bits going everywhere&quot;, &quot;somewhat rubbery&quot;, &quot;somewhat stringy&quot;, &quot;slightly stringy&quot;, &quot;rubbery, like a piece of leather that has been soaking in some greasy sludge&quot;, &quot;soft and spongey, with the occassional... crunch&quot;, &quot;soft, springy, and moist&quot;, &quot;gooey&quot;, &quot;moist and delicious&quot;, &quot;almost liquid once you bite through the rind&quot;],
  taste: [&quot;sharp&quot;, &quot;sharp and salty&quot;, &quot;somewhat bland&quot;, &quot;inoffensively mild&quot;, &quot;salty, like a cow&#39;s salt-lick&quot;, &quot;rich and creamy&quot;, &quot;creamy, with hints of oak&quot;, &quot;strong, slightly salty, and extremely more-ish&quot;, &quot;smokey, with hints of rum&quot;, &quot;smokey, with hints of chili&quot;, &quot;salty, but immediately the spice from the peppers takes over&quot;, &quot;bitter, with the rind tasting somewhere between a burnt log and dead bug, but the taste isn&#39;t entirely unpleasant&quot;, &quot;a warm and smooth creaminess which envelopes your taste buds like a mother&#39;s embrace&quot;],
  smell: [&quot;pungent, as if it was the result of somebody&#39;s terrible diet decisions&quot;, &quot;somewhat sweet, with a heady aroma&quot;, &quot;like the ass of a cow in cheese form&quot;, &quot;like the best parts of a farm&#39;s stable&quot;, &quot;like freshly baled hay&quot;, &quot;like freshly cut grass&quot;, &quot;like a lemon tree&quot;, &quot;like fresh cream&quot;, &quot;like a rotting corpse&quot;, &quot;like a roast duck filled with spices&quot;, &quot;like a delicious slice of bread toasted over a fire&quot;, &quot;like a slice of bread left in the fire far too long&quot;],
}&gt;&gt;</tw-passagedata><tw-passagedata pid="55" name="Games" tags="" position="600,725">&lt;&lt;set $games to either([
{
	name: &quot;Passe-dix&quot;,
	type: &quot;chance game&quot;,
	description: &quot;You see a man take three six-sided dice, and then roll them. He roars with pleasure as the dice come to a total of 12, and grabs his winnings from the banker. The dice moves to the next player, and the carrot (which signifies the banker) who spits on the dice, and everyone that&#39;s playing hands the new banker a silver piece. The player then rolls them, but only rolls a total of 9, which is met with boos and jeering.&quot;,
	rules: &quot;Passe-dix is played with three dice. There’s always a banker, and the number of players is unlimited. The first gamer rolls: every time he throws UNDER ten he (and all the other players in the game) lose the specified stake, which goes to the banker. Every time he rolls ABOVE ten (or PASSES TEN–whence the name of the game), the banker must return double the stake to all the players in the game. After three losses of the roller (no matter how many wins), the roller position is passed to another gamer in the circle. The banker changes after each roll.&quot;,
	bet: 20
	},

	{
	name: &quot;Highest Points&quot;,
	type: &quot;chance game&quot;,
	description: &quot;Two slack-jawed men are sitting in the middle of the room with two whittled dice each. They chuck a copper piece on the table, then roll, and the one that rolled higher grins as he grabs the copper.&quot;,
	rules: &quot;2 six-sided dice, 2 players: each roll both dice and the highest sum wins.&quot;,
	bet: 2
	},

	{
	name: &quot;Cross and Pile&quot;,
	type: &quot;chance game&quot;,
	description: &quot;Two men sit around a large table, and take turns flipping a coin. As the coin flies mid-air, the other calls out the result, winning the meager pot if they guess correctly.&quot;,
	rules: &quot;Two players choose each side of a coin, and then the coin is flipped. The top side after flipping the coin is the one that wins.&quot;,
	bet: 10
	},

	{
	name: &quot;Thimble Rig&quot;,
	type: &quot;guessing game&quot;,
	description: &quot;A quick hand, a rattling tongue, a deal board, three thimbles, and a pepper-corn. The game they played around the table with these three curious articles is a sort of Lilliputian game at cups and balls; and the beauty of it lies in dexterously seeming to place the pepper-corn under one particular thimble, getting the better to bet that it was there, and then winning his money by showing that it is not.&quot;,
	rules: &quot;The object of the game is to guess which thimble the peppercorn is under; sort of like a miniature cup and balls.&quot;,
	bet: 5
	},

	{
	name: &quot;Arm Wrestling&quot;,
	type: &quot;strength game&quot;,
	description: &quot;Two men sit across from each other, their right arms&#39; elbow on the table, holding each others hand in their palm. A referee counts down from three, and as soon as he shouts &#39;go&#39;!, the two start straining against each other, fighting to push the other&#39;s hand down through sheer force of will.&quot;,
	rules: &quot;It&#39;s easy, haven&#39;t you ever played before?&quot;,
	bet: 8

	},

	{
	name: &quot;Two-Up&quot;,
	type: &quot;gambling game&quot;,
	description: &quot;A small crowd of people are gathered around a table, where they flip two coins in the air, with one man groaning whenever they both turned heads, and another greedily grabbing the coins from the man in charge of overseeing the bets whenever they both turn tails, flicking the overseer a copper for his troubles.&quot;
	rules: &quot;Two coins are flipped by the &#39;spinner&#39;, who bets against another. Both heads wins, both tails loses, and one of each calls for another cointoss, with the &#39;spinner&#39; losing out on five consecutive re-tosses.&quot;,
	bet: 10
	}
	])&gt;&gt;</tw-passagedata><tw-passagedata pid="56" name="InitTavern" tags="output" position="725,725">&lt;&lt;linkreplace &quot;Rename &lt;strong&gt;$tavern.name&lt;/strong&gt;&quot;&gt;&gt;&lt;h3&gt;&lt;&lt;textbox &quot;$tavern.name&quot; $tavern.name&gt;&gt;&lt;/h3&gt;&lt;&lt;/linkreplace&gt;&gt;

Tavern Wealth: &lt;&lt;numberslider &quot;$tavern.wealthroll&quot; $tavern.wealthroll 1 100 1&gt;&gt;

Tavern Population: &lt;&lt;numberslider &quot;$tavern.populationroll&quot; $tavern.populationroll 1 100 1&gt;&gt;

Tavern Size: &lt;&lt;numberslider &quot;$tavern.sizeroll&quot; $tavern.sizeroll 1 100 1&gt;&gt;

Tavern Reputation: &lt;&lt;numberslider &quot;$tavern.reputationroll&quot; $tavern.reputationroll 1 100 1&gt;&gt;

Tavern Roughness: &lt;&lt;numberslider &quot;$tavern.roughnessroll&quot; $tavern.roughnessroll 1 100 1&gt;&gt;

Tavern Sin: &lt;&lt;numberslider &quot;$tavern.sinroll&quot; $tavern.sinroll 1 100 1&gt;&gt;

Tavern Cleanliness: &lt;&lt;numberslider &quot;$tavern.cleanlinessroll&quot; $tavern.cleanlinessroll 1 100 1&gt;&gt;

When you&#39;re ready, here&#39;s the &lt;&lt;nobr&gt;&gt;&lt;&lt;set _output to random(1, 3)&gt;&gt;
	&lt;&lt;switch _output&gt;&gt;
	&lt;&lt;case 1&gt;&gt;
		[[output|Output1]]
	&lt;&lt;case 2&gt;&gt;
		[[output|Output2]]
	&lt;&lt;case 3&gt;&gt;
		[[output|Output3]]
	&lt;&lt;/switch&gt;&gt;&lt;&lt;/nobr&gt;&gt;</tw-passagedata><tw-passagedata pid="57" name="Intrigue" tags="" position="850,725">&lt;&lt;nobr&gt;&gt;
&lt;&lt;linkreplace &quot;&lt;h4&gt;Anything interesting in $tavern.name?&lt;/h4&gt;&quot; t8n&gt;&gt;&lt;h4&gt;Interesting things in $tavern.name...&lt;/h4&gt;

&lt;&lt;set _rollintrigue to random(1, 4)&gt;&gt;
		&lt;&lt;if _rollintrigue is 1&gt;&gt;
			&lt;&lt;include &quot;PlotHookRumour&quot;&gt;&gt;
		&lt;&lt;elseif _rollintrigue is 2&gt;&gt;
			&lt;&lt;include &quot;PlotHookRumour&quot;&gt;&gt;
		&lt;&lt;elseif _rollintrigue is 3&gt;&gt;
			&lt;&lt;include &quot;PlotHookPaper&quot;&gt;&gt;
		&lt;&lt;elseif _rollintrigue is 4&gt;&gt;
			&lt;&lt;include &quot;PlotHookPeople&quot;&gt;&gt;
		&lt;&lt;elseif _rollintrigue is 5&gt;&gt;
			&lt;&lt;include &quot;PlotHookThings&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;linkreplace &quot;They need ANOTHER plot hook?&quot;&gt;&gt;&lt;&lt;print $shitplothook.pluck()&gt;&gt;&lt;&lt;/linkreplace&gt;&gt;
&lt;&lt;/linkreplace&gt;&gt;&lt;&lt;/nobr&gt;&gt;</tw-passagedata><tw-passagedata pid="58" name="LookAround" tags="" position="975,725">&lt;&lt;nobr&gt;&gt;
	&lt;&lt;if $tavern.populationroll gt 80 &amp;&amp; $tavern.roughnessroll gt 60&gt;&gt;
			&lt;&lt;print either(&quot;You can barely hear each other over the din of the other patrons ($tavern.diversity), who are pretty rowdy. One elbows you in the ribs as they try to get around you to the bar.&quot;,
			&quot;You find it difficult to hear each other over the din of the crowds that are drunkenly cavorting around.&quot;)&gt;&gt;
	&lt;&lt;elseif $tavern.populationroll gt 80&gt;&gt;
			&lt;&lt;print either(&quot;There&#39;s barely enough room to stand, let alone find a seat in the $tavern.wordnoun.&quot;,
			&quot;The $tavern.wordnoun is packed, and the patrons who are $tavern.diversity are clamouring to find the few barmaids that are on staff.&quot;)&gt;&gt;
	&lt;&lt;elseif $tavern.populationroll gt 60 &amp;&amp; $tavern.roughnessroll gt 60&gt;&gt;
			&lt;&lt;print either(&quot;The $tavern.wordnoun is packed with $tavern.diversity, and you&#39;re pushed to the side as somebody makes for the latrine in a hurry.&quot;,
			&quot;It&#39;s peak hour for $tavern.name and you can tell that $bartender.name is concerned about a fight breaking out. $tavern.diversity&quot;)&gt;&gt;
	&lt;&lt;elseif $tavern.populationroll gt 60&gt;&gt;
			&lt;&lt;print either(&quot;The $tavern.wordnoun is pretty packed with $tavern.diversity, and it&#39;s difficult for you to find a seat. $tavern.diversity&quot;,
			&quot;The $tavern.wordnoun is quite full; $tavern.diversity, and the owner is clearly enjoying the amount of business $bartender.hisher $tavern.wordnoun is receiving.&quot;,
			&quot;It must be peak hour for the $tavern.wordnoun. The barmaid is running back and forth between customers and the kitchen, trying desperately to keep ontop of the ever growing requests for more ale.&quot;)&gt;&gt;
	&lt;&lt;elseif $tavern.populationroll gt 40 &amp;&amp; $tavern.roughnessroll gt 60&gt;&gt;
			&lt;&lt;print either(&quot;The clientele is pretty rough, and might have scared off some of the less rambunctious potential customers.  $tavern.diversity&quot;,
			&quot;There&#39;s a fair number of people in the $tavern.wordnoun with quite a few swords on display. $tavern.diversity&quot;)&gt;&gt;
	&lt;&lt;elseif $tavern.populationroll gt 40&gt;&gt;
			&lt;&lt;print either(&quot;There&#39;s a reasonable amount of customers in the $tavern.wordnoun. $tavern.name&#39;s barmaid is happily walking back and forth from the kitchen, taking out plates as they are delivered.&quot;,
			&quot;There&#39;s a decent number of people in $tavern.name, and you manage to find a seat without too much trouble. $tavern.diversity&quot;)&gt;&gt;
	&lt;&lt;elseif $tavern.populationroll lte 40 &amp;&amp; $tavern.roughnessroll gt 60&gt;&gt;
			&lt;&lt;print either(&quot;The few people that are in the tavern bear scars, and openly talk of their violent exploits. It&#39;s pretty clear that they have scared away any regular clientele. $tavern.diversity&quot;,
			&quot;There are basically no people in the tavern, save for a few battle-hardened men talking in the corner.&quot;,
			&quot;There&#39;s not very many customers in $tavern.name at the moment. You see a couple of adventurers hunked over in the corner, quietly discussing battle plans, but nothing of particular interest in the clientele.&quot;)&gt;&gt;
	&lt;&lt;elseif $tavern.populationroll gt 30&gt;&gt;
			&lt;&lt;print &quot;$tavern.name is basically empty, and there&#39;s not much for the $tavern.wordnoun&lt;&lt;nobr&gt;&gt;&#39;s&lt;&lt;/nobr&gt;&gt; barmaid to do.&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.populationroll lte 30&gt;&gt;
			&lt;&lt;print &quot;It&#39;s almost just you and the bartender in here.&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;/nobr&gt;&gt;</tw-passagedata><tw-passagedata pid="59" name="Menu" tags="" position="1100,725">&lt;&lt;nobr&gt;&gt;
&lt;&lt;linkreplace &quot;&lt;h4&gt;What&#39;s good?&lt;/h4&gt;&quot; t8n&gt;&gt;
	&lt;h3&gt;On offer today...&lt;/h3&gt;
	&lt;&lt;if $tavern.wealthroll gt 80 &amp;&amp; $tavern.roughness gt 80&gt;&gt;
		&lt;&lt;print either(
			&quot;There&#39;s ales and boutique spirits available. Delicious smells are wafting from the kitchen, and your mouth salivates at the thought of the game that&#39;s on menu. $bartender.name proudly tells you that there are no stinkin&#39; vegetables, and that $tavern.name stocks only the finest meats.&quot;,
			&quot;The smells emanating from the kitchen tantalise your nostrils, and when you ask the waiting staff what&#39;s available to drink, they begin to take a deep breath, before listing out a huge array of wines, ales, lagers, and spirits. The &lt;&lt;print $npc.weight.random()&gt;&gt; &lt;&lt;print either(&quot;man&quot;, &quot;woman&quot;)&gt;&gt; then tells you that while $tavern.name is proud of its menu, it caters to an exclusively carnivorous diet.&quot;)&gt;&gt;
	&lt;&lt;elseif $tavern.wealthroll gt 80, $tavern.roughnessroll lt 30&gt;&gt;
		&lt;&lt;print either(
			&quot;There&#39;s ales and boutique spirits available. Delicious smells are wafting from the kitchen, and your mouth salivates at the thought of the food that&#39;s on menu. The waitstaff tell you that $tavern.name is proud to be 100% violence free; upon further clarification, this is revealed to mean that there is not a single bone of meat in the entire $tavern.wordnoun&lt;&lt;nobr&gt;&gt;.&lt;&lt;/nobr&gt;&gt;&quot;,
			&quot;The smells emanating from the kitchen tantalise your nostrils, and when you ask the waiting staff what&#39;s on menu, they begin to take a deep breath, before listing out a huge array of wines, ales, lagers, and spirits. The waitstaff tell you that $tavern.name is proud to be 100% violence free; upon further clarification, this is revealed to mean that there is not a single bone of meat in the entire $tavern.wordnoun.&quot;)&gt;&gt;
	&lt;&lt;elseif $tavern.wealthroll gt 80&gt;&gt;
		&lt;&lt;print either(
			&quot;There&#39;s ales and boutique spirits available. Delicious smells are wafting from the kitchen, and your mouth salivates at the thought of the game that&#39;s on menu.&quot;,
			&quot;The smells emanating from the kitchen tantalise your nostrils, and when you ask the waiting staff what&#39;s on menu, they begin to take a deep breath, before listing out a huge array of wines, ales, lagers, and spirits. It goes without saying that the kitchen is able to accomodate even the pickiest of royalty.&quot;)&gt;&gt;
	&lt;&lt;elseif $tavern.wealthroll gt 60 &amp;&amp; $tavern.roughnessroll gt 80&gt;&gt;
		&lt;&lt;print either(
			&quot;There&#39;s ales available. The food is standard fare, with roast beef, pork, and mutton on the menu for food, but curiously no vegetables. $bartender.name spits when you mention this, and says &#39;no stinkin&#39; veggies around here. We eat meat and we like it, so if you don&#39;t like it, yer not eatin&#39;.&quot;,
			&quot;There&#39;s your standard beers, with the $tavern.wordnoun specialising in ales, which are allegedly quite good. As far as food is concerned, there&#39;s regular fare of beef, pork, and mutton, but strangely, no breads, cheeses, or potatoes of any description; you hear another patron loudly state that he loves not having to put up with those &#39;pointy ears complaining about the lack of green stuff&#39; in $tavern.name&lt;&lt;nobr&gt;&gt;.&lt;&lt;/nobr&gt;&gt;&quot;)&gt;&gt;
	&lt;&lt;elseif $tavern.wealthroll gt 60 &amp;&amp; $tavern.roughnessroll lt 30&gt;&gt;
		&lt;&lt;print either(
			&quot;There&#39;s ales available. The food is a peculiarly limited menu; roast vegetables, breads, cheeses, but no meats, despite $tavern.name clearly being able to afford it.&quot;,
			&quot;There&#39;s your standard beers, with the $tavern.wordnoun specialising in ales, which are allegedly quite good. As far as food is concerned, there&#39;s breads, cheeses, and all the vegetables you could ever ask for, but not a single bone of meat is available.&quot;,
			&quot;Drinks are pretty standard, with a house lager being twenty percent off tonight. The menu is sadly lacking any meats, and when you ask $bartender.name about it, $bartender.heshe smiles, and says that $bartender.heshe is an animal lover, and wouldn&#39;t be able to forgive $bartender.himher&lt;&lt;nobr&gt;&gt;self&lt;&lt;/nobr&gt;&gt; if an animal came to harm due to $bartender.hisher business.&quot;)&gt;&gt;
	&lt;&lt;elseif $tavern.wealthroll gt 60 &amp;&amp; $bartender.race is &quot;elf&quot;&gt;&gt;
		&lt;&lt;print &quot;Drinks are pretty standard, with the house lager being twenty percent off tonight. The menu is sadly lacking any meats, and when you ask $bartender.name about it, $bartender.heshe smiles, and says that $bartender.heshe is an animal lover, and wouldn&#39;t be able to forgive $bartender.himher&lt;&lt;nobr&gt;&gt;self&lt;&lt;/nobr&gt;&gt; if an animal came to harm due to $bartender.hisher business.&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.wealthroll gt 60&gt;&gt;
		&lt;&lt;print either(
			&quot;There&#39;s ales available. The food is standard fare, with roast beef, pork, and mutton on the menu for food.&quot;,
			&quot;There&#39;s your standard beers, with the $tavern.wordnoun specialising in ales, which are allegedly quite good. As far as food is concerned, there&#39;s regular fare of beef, pork, breads and cheeses, and mutton.&quot;)&gt;&gt;
	&lt;&lt;elseif $tavern.wealthroll gt 40 &amp;&amp; $tavern.sinroll gt 60&gt;&gt;
		&lt;&lt;print either(
			&quot;There&#39;s the usual house-brewed ale on tap, but it is warm and undercarbonated. You suspect that $bartender.firstname has watered it down. As far as food is concerned, there is the usual mutton and breads available.&quot;,
			&quot;$bartender.firstname says that they have some freshly brewed ale, although you soon discover that to be a lie; it&#39;s lukewarm, and barely carbonated.&quot;)&gt;&gt;
	&lt;&lt;elseif $tavern.wealthroll gt 40&gt;&gt;
		&lt;&lt;print either(
			&quot;There&#39;s the usual house-brewed ale on tap, but it is warm and undercarbonated. As far as food is concerned, there is the usual mutton and breads available.&quot;,
			&quot;There&#39;s a limited range of beers, some of which have very clearly soured.&quot;,
			&quot;The food on offer is rather plain, with nothing terribly interesting or appetizing. The beer is unfortunately not much better.&quot;)&gt;&gt;
	&lt;&lt;elseif $tavern.wealthroll gt 20&gt;&gt;
		&lt;&lt;print &quot;There&#39;s what can only be described as piss available to drink, and the food isn&#39;t much better; other patrons can be seen chewing away at stale pieces of bread.&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.wealthroll lte 20&gt;&gt;
		&lt;&lt;print &quot;There&#39;s what can only be described as piss available to drink, and the food isn&#39;t much better; other patrons can be seen chewing away at stale pieces of bread.&quot;&gt;&gt;
	&lt;&lt;/if&gt;&gt;

&lt;&lt;if $tavern.wealthroll gte 50&gt;&gt;
	&lt;&lt;print &quot;The special brew of the week is a $specialbrew.type called $specialbrew.name, selling for &lt;&lt;money $specialbrew.cost&gt;&gt;. $specialbrew.description&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;&lt;&lt;/linkreplace&gt;&gt;&lt;&lt;/nobr&gt;&gt;
&lt;&lt;linkreplace &quot;&lt;h4&gt;Show me the menu!&lt;/h4&gt;&quot;&gt;&gt;&lt;&lt;nobr&gt;&gt;&lt;table&gt;
	&lt;tr&gt;
		&lt;th&gt;Dish&lt;/th&gt;
		&lt;th&gt;Cost&lt;/th&gt;
	&lt;/tr&gt;
&lt;&lt;switch $town.type&gt;&gt;
	&lt;&lt;case &quot;city&quot;&gt;&gt;
	&lt;&lt;for _i, _item range $tavern.inventory.filter(function (item) { return item.availability === 4; })&gt;&gt;&lt;tr&gt;&lt;td&gt;_item.name&lt;/td&gt;
&lt;td&gt;&lt;&lt;money _item.cost&gt;&gt;&lt;/td&gt;&lt;/tr&gt;
	&lt;&lt;/for&gt;&gt;
	&lt;&lt;case &quot;town&quot;&gt;&gt;
	&lt;&lt;for _i, _item range $tavern.inventory.filter(function (item) { return item.availability === 3; })&gt;&gt;&lt;tr&gt;&lt;td&gt;_item.name&lt;/td&gt;
&lt;td&gt;&lt;&lt;money _item.cost&gt;&gt;&lt;/td&gt;&lt;/tr&gt;
	&lt;&lt;/for&gt;&gt;
	&lt;&lt;case &quot;village&quot;&gt;&gt;
	&lt;&lt;for _i, _item range $tavern.inventory.filter(function (item) { return item.availability === 2; })&gt;&gt;&lt;tr&gt;&lt;td&gt;_item.name&lt;/td&gt;
&lt;td&gt;&lt;&lt;money _item.cost&gt;&gt;&lt;/td&gt;&lt;/tr&gt;
	&lt;&lt;/for&gt;&gt;
	&lt;&lt;case &quot;hamlet&quot;&gt;&gt;
	&lt;&lt;for _i, _item range $tavern.inventory.filter(function (item) { return item.availability === 1; })&gt;&gt;&lt;tr&gt;&lt;td&gt;_item.name&lt;/td&gt;
&lt;td&gt;&lt;&lt;money _item.cost&gt;&gt;&lt;/td&gt;&lt;/tr&gt;
	&lt;&lt;/for&gt;&gt;&lt;/table&gt;
&lt;&lt;/switch&gt;&gt;&lt;&lt;/nobr&gt;&gt;&lt;&lt;/linkreplace&gt;&gt;</tw-passagedata><tw-passagedata pid="60" name="Output1" tags="output" position="1225,725">&lt;h1&gt;$tavern.name&lt;/h1&gt;
&lt;&lt;nobr&gt;&gt;&lt;&lt;include &quot;TavernRenders&quot;&gt;&gt;&lt;&lt;/nobr&gt;&gt;&lt;span class=&quot;firstcharacter&quot;&gt;T&lt;/span&gt;he $tavern.wordnoun is called &lt;strong&gt;$tavern.name&lt;/strong&gt;&lt;&lt;nobr&gt;&gt;,&lt;&lt;/nobr&gt;&gt; and is &lt;&lt;include &quot;ReputationDescriptor&quot;&gt;&gt;&lt;&lt;nobr&gt;&gt;
&lt;&lt;if $tavern.type is &quot;regular&quot;&gt;&gt;
		&lt;&lt;print &quot;in $town.name for the cheap beer and its $tavern.sin patrons.&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.type isnot &quot;regular&quot;&gt;&gt;
		&lt;&lt;print &quot;in $town.name for being a $tavern.type, with $tavern.sin patrons. Its main draw in the $town.type is the $tavern.draw&lt;&lt;nobr&gt;&gt;.&lt;&lt;/nobr&gt;&gt;&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;include &quot;TavernDescription&quot;&gt;&gt;&lt;&lt;/nobr&gt;&gt;

&lt;h3&gt;The Bar&lt;/h3&gt;&lt;&lt;nobr&gt;&gt;

&lt;&lt;/nobr&gt;&gt;Behind $tavern.name&#39;s $tavern.material bar is a $bartender.racenote, who you notice has $bartender.physicaltrait. Currently, $bartender.heshe is &lt;&lt;print $bartender.idle.random()&gt;&gt;. Looking up, $bartender.heshe &lt;&lt;print $bartender.greeting.pluck()&gt;&gt; and introduces &lt;&lt;nobr&gt;&gt;$bartender.himher&lt;&lt;/nobr&gt;&gt;self as $bartender.name, $bartender.hisher $bartender.eyes eyes &lt;&lt;print either(&quot;looking brightly at you.&quot;, &quot;piercing through your armour.&quot;, &quot;staring at you warily.&quot;, &quot;watching you suspiciously.&quot;, &quot;looking at you kindly.&quot;, &quot;darting back and forth around the room.&quot;)&gt;&gt;&lt;&lt;nobr&gt;&gt;

&lt;&lt;linkreplace &quot;&lt;h4&gt;Talk with $bartender.name&lt;/h4&gt;&quot; t8n&gt;&gt;
&lt;h3&gt;$bartender.name&lt;/h3&gt;&lt;&lt;include &quot;BartenderTalk&quot;&gt;&gt;&lt;&lt;/linkreplace&gt;&gt;

&lt;&lt;/nobr&gt;&gt;&lt;&lt;include &quot;Menu&quot;&gt;&gt;
&lt;h3&gt;The Tavern&lt;/h3&gt;&lt;&lt;linkreplace &quot;&lt;h4&gt;Look around the $tavern.wordnoun&lt;/h4&gt;&quot; t8n&gt;&gt;&lt;&lt;include &quot;LookAround&quot;&gt;&gt;&lt;&lt;print $tavern.patrons.pluck()&gt;&gt;&lt;&lt;/linkreplace&gt;&gt;&lt;&lt;print $tavern.entertainment.pluck()&gt;&gt;
&lt;&lt;include &quot;Intrigue&quot;&gt;&gt;&lt;&lt;include &quot;Rooms&quot;&gt;&gt;</tw-passagedata><tw-passagedata pid="61" name="Output2" tags="output" position="100,850">&lt;h1&gt;$tavern.name&lt;/h1&gt;
&lt;&lt;nobr&gt;&gt;&lt;&lt;include &quot;TavernRenders&quot;&gt;&gt;&lt;&lt;/nobr&gt;&gt;&lt;span class=&quot;firstcharacter&quot;&gt;Y&lt;/span&gt;ou make your way through the $town.type of $town.name until you come to a $tavern.wordnoun, which is called &lt;strong&gt;$tavern.name&lt;/strong&gt;, a $tavern.size $tavern.material tavern that the locals know best for its $tavern.draw.

&lt;h3&gt;The Bar&lt;/h3&gt;Behind the counter is who you would assume to be the bartender, a $bartender.racenote who is currently &lt;&lt;print $bartender.idle.random()&gt;&gt;. You walk up to the bar, and strike up conversation with the $bartender.manwoman, who introduces $bartender.himher&lt;&lt;nobr&gt;&gt;self&lt;&lt;/nobr&gt;&gt; as $bartender.name, the $bartender.owner of $tavern.name&lt;&lt;nobr&gt;&gt;.&lt;&lt;/nobr&gt;&gt;
&lt;&lt;linkreplace &quot;&lt;h4&gt;Talk with $bartender.name&lt;/h4&gt;&quot; t8n&gt;&gt;&lt;h3&gt;$bartender.name&lt;/h3&gt;&lt;&lt;include &quot;BartenderTalk&quot;&gt;&gt;&lt;&lt;/linkreplace&gt;&gt;&lt;&lt;include &quot;Menu&quot;&gt;&gt;&lt;h3&gt;The Tavern&lt;/h3&gt;&lt;&lt;include &quot;TavernDescription&quot;&gt;&gt;&lt;&lt;include &quot;LookAround&quot;&gt;&gt;

&lt;&lt;print $tavern.patrons.pluck()&gt;&gt; &lt;&lt;print $tavern.entertainment.pluck()&gt;&gt;
&lt;&lt;include &quot;Intrigue&quot;&gt;&gt;&lt;&lt;include &quot;Rooms&quot;&gt;&gt;</tw-passagedata><tw-passagedata pid="62" name="Output3" tags="output" position="225,850">&lt;h1&gt;$tavern.name&lt;/h1&gt;
&lt;&lt;nobr&gt;&gt;&lt;&lt;include &quot;TavernRenders&quot;&gt;&gt;&lt;&lt;/nobr&gt;&gt;&lt;span class=&quot;firstcharacter&quot;&gt;Y&lt;/span&gt;ou walk through the $town.type of $town.name, and eventually come to &lt;strong&gt;$tavern.name&lt;/strong&gt;; a $tavern.material $tavern.wordnoun which is known in the area for its $tavern.draw, and &lt;&lt;nobr&gt;&gt;

&lt;&lt;if $tavern.type is &quot;regular&quot;&gt;&gt;
		&lt;&lt;print &quot;its &lt;&lt;print $tavern.sin&gt;&gt; patrons.&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.type isnot &quot;regular&quot;&gt;&gt;
		&lt;&lt;print &quot;for being a $tavern.type, with $tavern.sin patrons.&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;&lt;&lt;/nobr&gt;&gt;

&lt;&lt;include &quot;TavernDescription&quot;&gt;&gt;

&lt;h3&gt;The Bar&lt;/h3&gt;Behind the $tavern.material bar is a $bartender.racenote who you assume is the owner of the establishment; $bartender.heshe is currently &lt;&lt;print $bartender.idle.pluck()&gt;&gt;. You walk up to the bar, and introduce yourselves, and $bartender.heshe reciprocates; $bartender.heshe is $bartender.name, the $bartender.owner of $tavern.name.
&lt;&lt;linkreplace &quot;&lt;h4&gt;Talk with $bartender.name&lt;/h4&gt;&quot; t8n&gt;&gt;&lt;h3&gt;$bartender.name&lt;/h3&gt;&lt;&lt;include &quot;BartenderTalk&quot;&gt;&gt;&lt;&lt;/linkreplace&gt;&gt;&lt;&lt;include &quot;Menu&quot;&gt;&gt;&lt;h3&gt;The Tavern&lt;/h3&gt;&lt;&lt;include &quot;LookAround&quot;&gt;&gt; &lt;&lt;print $tavern.entertainment.pluck()&gt;&gt; &lt;&lt;include &quot;Intrigue&quot;&gt;&gt;&lt;&lt;include &quot;Rooms&quot;&gt;&gt;</tw-passagedata><tw-passagedata pid="63" name="Rooms" tags="" position="350,850">&lt;&lt;nobr&gt;&gt;&lt;&lt;if $tavern.sizeroll gt 80&gt;&gt;
		&lt;&lt;set _freerooms to random(6, 10)&gt;&gt;
	&lt;&lt;elseif $tavern.sizeroll gt 60&gt;&gt;
		&lt;&lt;set _freerooms to random(5, 9)&gt;&gt;
	&lt;&lt;elseif $tavern.sizeroll gt 40&gt;&gt;
		&lt;&lt;set _freerooms to random(4, 8)&gt;&gt;
	&lt;&lt;elseif $tavern.sizeroll gt 20&gt;&gt;
		&lt;&lt;set _freerooms to random(3, 6)&gt;&gt;
	&lt;&lt;elseif $tavern.sizeroll lte 20&gt;&gt;
		&lt;&lt;set _freerooms to random(2, 4)&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $tavern.populationroll gt 80&gt;&gt;
		&lt;&lt;set _freerooms -= 3&gt;&gt;
	&lt;&lt;elseif $tavern.populationroll gt 60&gt;&gt;
		&lt;&lt;set _freerooms -= 2&gt;&gt;
	&lt;&lt;elseif $tavern.populationroll gt 40&gt;&gt;
		&lt;&lt;set _freerooms -= 1&gt;&gt;
	&lt;&lt;elseif $tavern.populationroll gt 20&gt;&gt;
		&lt;&lt;set _freerooms += 2&gt;&gt;
	&lt;&lt;elseif $tavern.populationroll lte 20&gt;&gt;
		&lt;&lt;set _freerooms += 3&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if _freerooms lte 0&gt;&gt;
		&lt;span id=&quot;room-cost&quot;&gt;&lt;&lt;print &quot;You talk with the barmaid about lodgings, and she says that there are no free rooms in $tavern.name at the moment...&quot;&gt;&gt;&lt;/span&gt;
	&lt;&lt;elseif _freerooms == 1&gt;&gt;
		&lt;&lt;linkreplace &quot;&lt;h4&gt;Rent a room for the night&lt;/h4&gt;&quot; t8n&gt;&gt;
		&lt;&lt;replace &quot;#room-cost&quot;&gt;&gt;&lt;&lt;include &quot;Sleep&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;
		&lt;&lt;/linkreplace&gt;&gt;
		&lt;span id=&quot;room-cost&quot;&gt;&lt;&lt;print &quot;$tavern.name has just one available room, which is $tavern.size and $tavern.bedcleanliness. Because this $tavern.wordnoun is priced for $tavern.wealth patrons, it will cost &lt;&lt;money $tavern.lodging&gt;&gt; to stay here for the night.&quot;&gt;&gt;&lt;/span&gt;
	&lt;&lt;elseif _freerooms gt 1&gt;&gt;
		&lt;&lt;linkreplace &quot;&lt;h4&gt;Rent a room for the night&lt;/h4&gt;&quot; t8n&gt;&gt;
		&lt;&lt;replace &quot;#room-cost&quot;&gt;&gt;&lt;&lt;include &quot;Sleep&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;
		&lt;&lt;/linkreplace&gt;&gt;
		&lt;span id=&quot;room-cost&quot;&gt;&lt;&lt;print &quot;$tavern.name has _freerooms available rooms, which are $tavern.size and $tavern.bedcleanliness. Because this $tavern.wordnoun is priced for $tavern.wealth patrons, it will cost &lt;&lt;money $tavern.lodging&gt;&gt; to stay here for the night.&quot;&gt;&gt;&lt;/span&gt;
&lt;&lt;/if&gt;&gt;&lt;&lt;/nobr&gt;&gt;</tw-passagedata><tw-passagedata pid="64" name="Sleep" tags="" position="475,850">&lt;&lt;nobr&gt;&gt;
&lt;&lt;set _restfulness to random(1, 100)&gt;&gt;
&lt;&lt;set _sleepeasy to 0&gt;&gt;
	&lt;&lt;if $tavern.wealth is &quot;kingly&quot;&gt;&gt;
		&lt;&lt;set _restfulness += 30, _sleepeasy += 3&gt;&gt;
	&lt;&lt;elseif $tavern.wealth is &quot;aristocratic&quot;&gt;&gt;
		&lt;&lt;set _restfulness += 15, _sleepeasy += 2&gt;&gt;
	&lt;&lt;elseif $tavern.wealth is &quot;wealthy&quot;&gt;&gt;
		&lt;&lt;set _restfulness += 7, _sleepeasy += 1&gt;&gt;
	&lt;&lt;elseif $tavern.wealth is &quot;modest&quot;&gt;&gt;
		&lt;&lt;set _restfulness -= 2&gt;&gt;
	&lt;&lt;elseif $tavern.wealth is &quot;poor&quot;&gt;&gt;
		&lt;&lt;set _restfulness -= 5, _sleepeasy -= 2&gt;&gt;
	&lt;&lt;elseif $tavern.wealth is &quot;squalid&quot;&gt;&gt;
		&lt;&lt;set _restfulness -= 10, _sleepeasy -= 3&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $tavern.cleanlinessroll gt 90&gt;&gt;
  &lt;&lt;set _restfulness += 30&gt;&gt;
	  &lt;&lt;elseif $tavern.cleanlinessroll gt 80&gt;&gt;
		  &lt;&lt;set _restfulness += 15, _sleepeasy += 3&gt;&gt;
	  &lt;&lt;elseif $tavern.cleanlinessroll gt 70&gt;&gt;
		  &lt;&lt;set _restfulness += 5, _sleepeasy += 2&gt;&gt;
	  &lt;&lt;elseif $tavern.cleanlinessroll gt 60&gt;&gt;
		  &lt;&lt;set _restfulness += 3, _sleepeasy += 1&gt;&gt;
	  &lt;&lt;elseif $tavern.cleanlinessroll gt 50&gt;&gt;
		  &lt;&lt;set _restfulness -= 2&gt;&gt;
	  &lt;&lt;elseif $tavern.cleanlinessroll gt 40&gt;&gt;
		  &lt;&lt;set _restfulness -= 5&gt;&gt;
	  &lt;&lt;elseif $tavern.cleanlinessroll gt 30&gt;&gt;
		  &lt;&lt;set _restfulness -= 10, _sleepeasy -= 1&gt;&gt;
	  &lt;&lt;elseif $tavern.cleanlinessroll gt 20&gt;&gt;
		  &lt;&lt;set _restfulness -= 15, _sleepeasy -= 2&gt;&gt;
	  &lt;&lt;elseif $tavern.cleanlinessroll lte 20&gt;&gt;
		  &lt;&lt;set _restfulness -= 20, _sleepeasy -= 3&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if $tavern.bedcleanlinessroll gt 90&gt;&gt;
  &lt;&lt;set _restfulness += 30&gt;&gt;
	  &lt;&lt;elseif $tavern.bedcleanliness is &quot;perfectly prepared, with fresh sheets and a lemon scent in the air of the room&quot;&gt;&gt;
		  &lt;&lt;set _restfulness += 30, _sleepeasy += 3&gt;&gt;
	  &lt;&lt;elseif $tavern.bedcleanliness is &quot;freshly cleaned and neat&quot;&gt;&gt;
		  &lt;&lt;set _restfulness += 20, _sleepeasy += 2&gt;&gt;
	  &lt;&lt;elseif $tavern.bedcleanliness is &quot;tidy and neat&quot;&gt;&gt;
		  &lt;&lt;set _restfulness += 15, _sleepeasy += 1&gt;&gt;
	  &lt;&lt;elseif $tavern.bedcleanliness is &quot;reasonably clean&quot;&gt;&gt;
		  &lt;&lt;set _restfulness += 10&gt;&gt;
	  &lt;&lt;elseif $tavern.bedcleanliness is &quot;somewhat tidy&quot;&gt;&gt;
		  &lt;&lt;set _restfulness += 5&gt;&gt;
	  &lt;&lt;elseif $tavern.bedcleanliness is &quot;disgusting&quot;&gt;&gt;
		  &lt;&lt;set _restfulness -= 10, _sleepeasy -= 1&gt;&gt;
	  &lt;&lt;elseif $tavern.bedcleanliness is &quot;teeming with rats&quot;&gt;&gt;
		  &lt;&lt;set _restfulness -= 20, _sleepeasy -= 2&gt;&gt;
	  &lt;&lt;elseif $tavern.bedcleanliness is &quot;festering with bugs&quot;&gt;&gt;
		  &lt;&lt;set _restfulness -= 30, _sleepeasy -= 3&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if _restfulness gt 90, _sleepeasy gte 2&gt;&gt;
		You unsurprisingly get an excellent night&#39;s sleep, and awake feeling refreshed and reinvigorated&lt;span id=&quot;sleep-type&quot;&gt;.&lt;/span&gt;
	&lt;&lt;elseif _restfulness gt 90, _sleepeasy lte -2&gt;&gt;
		You surprisingly get an excellent night&#39;s sleep, and awake feeling refreshed and reinvigorated&lt;span id=&quot;sleep-type&quot;&gt;.&lt;/span&gt;
	&lt;&lt;elseif _restfulness gt 90&gt;&gt;
		You get an excellent night&#39;s sleep, and awake feeling refreshed and reinvigorated&lt;span id=&quot;sleep-type&quot;&gt;.&lt;/span&gt;
	&lt;&lt;elseif _restfulness gt 80, _sleepeasy gte 2&gt;&gt;
		You unsurprisingly get a great night&#39;s sleep, and awake feeling refreshed and reinvigorated&lt;span id=&quot;sleep-type&quot;&gt;.&lt;/span&gt;
	&lt;&lt;elseif _restfulness gt 80, _sleepeasy lte -2&gt;&gt;
		You surprisingly get a great night&#39;s sleep, and awake feeling refreshed and reinvigorated&lt;span id=&quot;sleep-type&quot;&gt;.&lt;/span&gt;
	&lt;&lt;elseif _restfulness gt 70, _sleepeasy gte 2&gt;&gt;
		You unsurprisingly get a good night&#39;s sleep, and awake feeling refreshed&lt;span id=&quot;sleep-type&quot;&gt;.&lt;/span&gt;
	&lt;&lt;elseif _restfulness gt 70, _sleepeasy lte -2&gt;&gt;
		You surprisingly get a good night&#39;s sleep, and awake feeling refreshed&lt;span id=&quot;sleep-type&quot;&gt;.&lt;/span&gt;
	&lt;&lt;elseif _restfulness gt 70&gt;&gt;
		You get a good night&#39;s sleep, and awake feeling refreshed&lt;span id=&quot;sleep-type&quot;&gt;.&lt;/span&gt;
	&lt;&lt;elseif _restfulness gt 50, _sleepeasy gte 2&gt;&gt;
		You get an alright night&#39;s sleep, which is disappointing considering the quality of $tavern.name, but you awake feeling reasonably refreshed&lt;span id=&quot;sleep-type&quot;&gt;.&lt;/span&gt;
	&lt;&lt;elseif _restfulness gt 50, _sleepeasy lte -2&gt;&gt;
		You get an alright night&#39;s sleep despite the poor quality of $tavern.name, but you awake feeling reasonably refreshed&lt;span id=&quot;sleep-type&quot;&gt;.&lt;/span&gt;
	&lt;&lt;elseif _restfulness gt 50&gt;&gt;
		You get an alright night&#39;s sleep, and awake feeling reasonably refreshed&lt;span id=&quot;sleep-type&quot;&gt;.&lt;/span&gt;
	&lt;&lt;elseif _restfulness gt 30, _sleepeasy gte 2&gt;&gt;
		You get an awful night&#39;s sleep, which is disappointing considering the quality of $tavern.name, and awake with a sore back; it might have been how you were sleeping, or the bed, but you feel pretty awful&lt;span id=&quot;sleep-type&quot;&gt;.&lt;/span&gt;
	&lt;&lt;elseif _restfulness gt 30, _sleepeasy lte -2&gt;&gt;
		You get an awful night&#39;s sleep, which is unsurprising considering the quality of $tavern.name, and awake with a sore back; it might have been how you were sleeping, or the bed, but you feel pretty awful&lt;span id=&quot;sleep-type&quot;&gt;.&lt;/span&gt;
	&lt;&lt;elseif _restfulness gt 30&gt;&gt;
		You get an awful night&#39;s sleep, and awake with a sore back; it might have been how you were sleeping, or the bed, but you feel pretty awful&lt;span id=&quot;sleep-type&quot;&gt;.&lt;/span&gt;
	&lt;&lt;elseif _restfulness lte 30, _sleepeasy gte 2&gt;&gt;
		The night seems to go on forever, and you just can&#39;t get to sleep, despite the comforts provided. You awake in the morning to the roosters outside, and feel groggy, and not at all rested&lt;span id=&quot;sleep-type&quot;&gt;.&lt;/span&gt;
	&lt;&lt;elseif _restfulness lte 30, _sleepeasy lte -2&gt;&gt;
		The night seems to go on forever, and you just can&#39;t get to sleep, probably due to the conditions that you were expected to sleep in. You awake in the morning to the roosters outside, and feel groggy, and not at all rested&lt;span id=&quot;sleep-type&quot;&gt;.&lt;/span&gt;
	&lt;&lt;elseif _restfulness lte 30&gt;&gt;
		The night seems to go on forever, and you just can&#39;t get to sleep. You awake in the morning to the roosters outside, and feel groggy, and not at all rested&lt;span id=&quot;sleep-type&quot;&gt;.&lt;/span&gt;
	&lt;&lt;else&gt;&gt;
		&lt;&lt;print &quot;It&#39;s a regular sort of sleep, and you awake feeling reasonably refreshed&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;switch $tavern.type&gt;&gt;
	&lt;&lt;case &quot;brothel&quot;&gt;&gt;
		&lt;&lt;replace &quot;#sleep-type&quot;&gt;&gt;in spite of the whores moaning.&lt;&lt;/replace&gt;&gt;
	&lt;&lt;case &quot;gambling den&quot;&gt;&gt;
		&lt;&lt;replace &quot;#sleep-type&quot;&gt;&gt;in spite of the commotion whenever something interesting happened at the gambling tables.&lt;&lt;/replace&gt;&gt;
&lt;&lt;/switch&gt;&gt;

&lt;&lt;if $tavern.wealth is &quot;kingly&quot;&gt;&gt;
		&lt;&lt;print &quot;In the morning, you&#39;re awakened to a knock on the door; apparently $tavern.name comes with a complimentary breakfast in bed. You get dressed and open the door, and one of the barmaids comes in wheeling a trolley, upon which is laden with toast, fruits, cured meats, porridge, and all kinds of cheeses with breads.&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.wealth is &quot;aristocratic&quot;&gt;&gt;
		&lt;&lt;print &quot;In the morning, you&#39;re awakened to the sound of a bell. Going downstairs to the bar area, you see that a continental breakfast has been set out for you. $bartender.name is standing behind the counter, pouring a beer which $bartender.heshe hands to you, asking if you slept well.&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.wealth is &quot;wealthy&quot;&gt;&gt;
		&lt;&lt;print &quot;When you wake, you pack your things and head downstairs to see that $bartender.name is waiting there, in case you wanted any breakfast before you left; $bartender.heshe says that there&#39;s hot porridge, breads and cheeses, and fruit if you&#39;d like to pay the nominal fee of one silver for the breakfast.&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.wealth is &quot;modest&quot;&gt;&gt;
		&lt;&lt;print &quot;You head down after packing your things, and see that $bartender.name is sitting at one of the benches, chewing on a hunk of bread with cheese. The $bartender.weight $bartender.manwoman nods at you, and pauses, finishing chewing. When $bartender.heshe does finish, $bartender.heshe tells you that there&#39;s some bread and cheese left, if you want to pay the three copper for it.&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.wealth is &quot;poor&quot;&gt;&gt;
		&lt;&lt;print either(&quot;You make your way down out of the $tavern.wordnoun and see $bartender.name has fallen asleep at a bowl of porridge. From the kitchen, you can smell something burning&quot;,
		&quot;You make your way down, and as you&#39;re leaving $tavern.name, you accidentally knock a cup over. From behind the bar, you hear $bartender.firstname yell out obscenities at you for disturbing $bartender.hisher slumber.&quot;,
		&quot;You start to make your way out of $tavern.name, careful not to disturb the patrons that have fallen asleep at their tables.&quot;, 
		&quot;You smell something burning, and make your way down to check; when you get down to the kitchen of $tavern.name, you find $bartender.firstname sitting, chewing angrily over a bowl of burnt porridge.&quot;)&gt;&gt;
	&lt;&lt;elseif $tavern.wealth is &quot;squalid&quot;&gt;&gt;
		&lt;&lt;print either(&quot;You start to make your way out of the $tavern.cleanliness $tavern.wordnoun, and smell something burning, and make your way down to check; when you get down to the kitchen of $tavern.name, you find $bartender.firstname sitting, chewing angrily over a bowl of burnt porridge.&quot;, &quot;You can&#39;t help but shake the feeling that there&#39;s a smell clinging to your clothes after staying the night at $tavern.name.&quot;)&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/nobr&gt;&gt;</tw-passagedata><tw-passagedata pid="65" name="SpecialBrew" tags="" position="600,850">&lt;&lt;set $specialbrew to either([
	{
	name: &quot;Gnollblood&quot;,
	type: &quot;non-magical mead&quot;,
	cost: 30,
	description: &quot;While the inventor of this recipe is said to have been human, anyone is welcome to make it- if they can survive the trial of getting the ingredients. True to its name, after the mead is sweetened with honey and boiled with a blend of spices, the maker stirs in just enough gnoll&#39;s blood to give the brew a salty, rusty undertone. This conveys no magical benefit, but it&#39;s still quite popular among the wealthy citizens of the local cities. Brewers within the city limits will pay handsomely for fresh gnoll carcasses to keep their blood supply in check.&quot;,
	author: &quot;Jasperine&quot;
	},

	{
	name: &quot;Bragget&quot;,
	type: &quot;goblin &#39;wine&#39;&quot;,
	cost: 34,
	description: &quot;Made from fermented, often rotting cave mushrooms, bragget is the favored drink of any goblin who wants to quickly lose their inhibition. There&#39;s no real recipe to follow- simply throw a handful of fresh mushrooms into a vat of water, forget it for several months, rediscover the vat after a crew of adventurers break into your cave system, and drink it. Effects range from a gleeful, giddy state of inebriation to death from dysentery. Or both.&quot;,
	author: &quot;Jasperine&quot;
	},

	{
	name: &quot;Cobbler&#39;s cream&quot;,
	type: &quot;rotgut&quot;,
	cost: 26,
	description: &quot;Gnomes who dwell along the forest&#39;s edge often send their young to forage for meals in dense, semi-cultivated plots filled with berries, brambles, succulent flowers and herbs of all varieties. Having not yet developed a callous thick enough to endure the thorns, prickles and stings, many young Gnomes often wear carved wooden shoes and heavy leather gaiters to protect themselves. When a young Gnome reaches maturity, however, they are expected to retire their shoes back to the cobbler, where the toes are stuffed full of harvested berries, leaves, mushrooms and whatever else comes to hand. The shoes are then hung from the rafters over a large vat, where steam, time, and the natural yeasts in the porous wood allow droplets of alcoholic liquid to seep through the shoe, and fall into the roiling mixture below. Mixed with rainwater, and served in usually cleaned wooden shoes, the resulting beverage is incredibly potent, with a flavor profile that ranges from incredibly profane to lavender, with notes of sweet sap. Gnomes who consume it often do so in celebratory contexts, and in small quantities. Most others experience temporary blindness and an intense hatred for Gnomes.&quot;,
	author: &quot;MrKHackworth&quot;
	},

	{
	name: &quot;Blood clot&quot;,
	type: &quot;Dwarven sludge&quot;,
	cost: 42,
	description: &quot;This bizarre concoction is a favorite among Dwarves looking to make a dare. Thick and red, it contains a congealed glob of fermented goat milk about the size of a golf ball. An acquired taste, it is reminiscent of fortified wine with a strong hint of copper.&quot;,
	author: &quot;Melance&quot;
	},

	{
	name: &quot;Axegrinder Ale&quot;,
	type: &quot;Dwarvish ale&quot;,
	cost: 34,
	description: &quot;In the right light, this ale takes on a blood red hue. It gives off a strong scent like a floral meadow covered in dew and tastes slightly sour on the way down with a sweaty finish. Dwarves who consume it often become mildly belligerent and take offense the smallest slights. Most others who consume it experience a noticeable uptick in their spirits. Except trolls, who just get angry.&quot;,
	author: &quot;OrkishBlade&quot;
	},

	{
	name: &quot;Bitterbeard Ale&quot;,
	type: &quot;Dwarvish ale&quot;,
	cost: 36,
	description: &quot;This translucent gold ale is topped with a clean white foam and tastes a little pungent and bitter with hints of citrus. Dwarves who consume it tend to brood over hated foes, especially &#39;the one that got away.&#39; Non-dwarves who consume it typically experience a pleasant evening followed by a poor night&#39;s sleep.&quot;,
	author: &quot;OrkishBlade&quot;
	},

	{
	name: &quot;Meadowlark&quot;,
	type: &quot;Human wheat beer&quot;,
	cost: 30,
	description: &quot;In a world full of 750,000-proof Elven cordials and Dwarven stouts so thick you&#39;d think they were bottled mud, sometimes you just need a good beer. Mild, refreshing, and flavorful, Meadowlark is a beer by humans, for humans, which means that just about every halfling from here to the Drypeak Mountains is drinking it. The noble think it crude, the elves think it unimaginative, the dwarves find it cowardly, but the farmers who drop themselves down at a tavern table at the end of the day wouldn&#39;t have anything else.&quot;,
	author: &quot;Val_Ritz&quot;
	},

	{
	name: &quot;Frostbomb&quot;,
	type: &quot;Pale ale&quot;,
	cost: 66,
	description: &quot;The life&#39;s work of a dragonborn brewmaster. Frostbomb is somewhat disconcerting, for a couple of reasons. One, it&#39;s blue. For those who prefer not to consume things that are the color of their cousin Clyde that one time he tried to swallow a carrot whole, that might be a bit of a turn-off. Two, it is absolutely frigid. The steel bottles that it&#39;s shipped in are often coated in a thick rime of frost that must be hacked off before serving, and the cold magic in the brew must be allowed to sit for at least four minutes before it&#39;s warm enough to not be painful going down. All that being said, there isn&#39;t a traveler alive who doesn&#39;t hope to stumble upon a bottle under the counter in a desert bar.&quot;,
	author: &quot;Val_Ritz&quot;
	},

	{
	name: &quot;Steve&#39;s Mead&quot;,
	type: &quot;Mead&quot;,
	cost: 35,
	description: &quot;This bottle of mead might have had a label, once, but it appears to have been torn off. In its place, painted directly on the bottle, are the words &#39;STEVE&#39;S MEAD&#39; in blocky, crude letters. Clearly, Steve is not around to claim his mead, but in his absence the cork appears to be permanently and irrevocably stuck in the mouth of the bottle.&quot;,
	author: &quot;Val_Ritz&quot;
	},

	{
	name: &quot;Self-important Prick&quot;,
	type: &quot;Brown ale&quot;,
	cost: 36,
	description: &quot;The ale inside this bottle isn&#39;t terribly unusual, aside from being harsh and bitter. The true draw is the printing on the bottle, which reads &#39;Self-Important Prick&#39; in white letters. Under the lettering is a rendition of a face--a rendition that changes to reflect whoever the drinker dislikes the most at that particular time. There are allegations that drinking the ale results in heightened animosity toward the depicted person, but it might just be a result of reminding them that that person exists in the first place.&quot;,
	author: &quot;Val_Ritz&quot;
	},

	{
	name: &quot;Deep Grog&quot;,
	type: &quot;Blackest Tot&quot;,
	cost: 44,
	description: &quot;The darkest of naval rum taken from sunken sips mixed with saltwater taken from the pelagic depths of the Elemental Plane of Water. Black and cold, with a syrupy mouth feel. Tastes of brine and molasses with a distinct bitterness. Reserved for first time travelers to The City of Glass, and served as a shot with a still beating fish heart. Also disparagingly known as Aboleth&#39;s Piss.&quot;,
	author: &quot;twocalf&quot;
	},

	{
	name: &quot;Old Polder Genever Gin&quot;,
	type: &quot;Spirit&#39;s Spirits&quot;,
	cost: 49,
	description: &quot;The recipe for this liquor was pulled from the ruins of the necropolis of Polder. Clear or just faintly brown, sweet with juniper and malt. More like a whiskey than a gin. Purportedly aged in oak barrels with a single golden coin taken from the dead city, luck be damned. Said to be able to distract hungry dead by offering shots. Popular gift on Spirt&#39;s Eve.&quot;,
	author: &quot;twocalf&quot;
	},

	{
	name: &quot;Hyperborean Cider&quot;,
	type: &quot;Bottled Sunshine&quot;,
	cost: 46,
	description: &quot;Fermented with juice made from apples collected from the Celestial Plane. Gloriously, radiantly golden, no head, ever, and never sours. Sweet and warm, with hints of clove, cinnamon, and sunrises. You can still get a hangover, don’t believe that myth, and there are few things in the multiverse worse than being hungover on the Celestial Plane. Everyone is singing and everything IS SO VERY BRIGHT.&quot;,
	author: &quot;twocalf&quot;
	},

	{
	name: &quot;Airak&quot;,
	type: &quot;Djinn and Juice&quot;,
	cost: 88,
	description: &quot;Distilled on the Elemental Plane of Air by the Djinn in a process that uses no machinery, but by captive air elementals controlling the temperatures and pressures while the liquid free floats in the air. Clear when poured but will louche when exposed to normal air pressure. Tastes of licorice, anise, and a warm breeze with a slight bitter aftertaste. Makes you lightheaded, maybe literally. Best mixed.&quot;,
	author: &quot;twocalf&quot;
	}
])&gt;&gt;</tw-passagedata><tw-passagedata pid="66" name="Tavern" tags="" position="725,850">&lt;&lt;set $tavern to setup.createBuilding()&gt;&gt;
&lt;&lt;set $tavern.wordnoun to either(&quot;tavern&quot;, &quot;tavern&quot;, &quot;tavern&quot;, &quot;tavern&quot;, &quot;pub&quot;, &quot;pub&quot;, &quot;pub&quot;, &quot;inn&quot;, &quot;inn&quot;, &quot;bar&quot;, &quot;bar&quot;, &quot;bar&quot;, &quot;watering hole&quot;, &quot;drinkery&quot;),
	$tavern.type to either(&quot;quiet and low-key bar&quot;, &quot;regular&quot;, &quot;regular&quot;, &quot;regular&quot;, &quot;regular&quot;, &quot;raucous dive&quot;, &quot;raucous dive&quot;, &quot;raucous dive&quot;, &quot;raucous dive&quot;, &quot;thieves&#39; guild hangout&quot;, &quot;gathering place for a secret society&quot;, &quot;high-end dining club&quot;, &quot;high-end dining club&quot;, &quot;gambling den&quot;, &quot;gambling den&quot;, &quot;$bartender.race only club&quot;, &quot;guild-member&#39;s only club&quot;, &quot;members-only club&quot;, &quot;brothel&quot;, &quot;brothel&quot;),
	$tavern.draw to either(&quot;attractive waitstaff&quot;, &quot;resident bard&quot;, &quot;&lt;&lt;print $tavern.roughness&gt;&gt; atmosphere&quot;, &quot;&lt;&lt;print $tavern.roughness&gt;&gt; atmosphere&quot;, &quot;&lt;&lt;print $tavern.roughness&gt;&gt; atmosphere&quot;, &quot;witty banter with the waitstaff&quot;, &quot;crude jokes the bartender makes&quot;, &quot;proximity to the thieves&#39; guild headquarters&quot;, &quot;warmth inside&quot;, &quot;magic incense which is constantly burning&quot;, &quot;proximity to the brothel&quot;, &quot;proximity to the church&quot;, &quot;location by the river&quot;, &quot;wooden-chopping competition held weekly&quot;, &quot;mahogany stairs&quot;, &quot;clean beds&quot;, &quot;lack of bedbugs&quot;, &quot;magic bedbugs&quot;, &quot;drunk wizard&quot;, &quot;huge fireplace&quot;, &quot;incredible view&quot;, &quot;nice view&quot;),
	$tavern.shortages to [&quot;wine&quot;, &quot;booze&quot;, &quot;grog&quot;, &quot;whiskey&quot;, &quot;mutton&quot;, &quot;lamb&quot;, &quot;carrots&quot;, &quot;mugs&quot;, &quot;forks&quot;, &quot;frogs&quot;, &quot;bread&quot;, &quot;mushrooms&quot;, &quot;salt&quot;, &quot;silver pieces&quot;, &quot;chairs&quot;, &quot;eggs&quot;, &quot;potatoes&quot;]
&gt;&gt;

/* Exclusion code for brothels + churches */
&lt;&lt;if ($tavern.type is &quot;gambling den&quot; &amp;&amp; $tavern.draw is &quot;proximity to the church&quot;)&gt;&gt;
		&lt;&lt;set $tavern.draw to &quot;proximity to the brothel&quot;&gt;&gt;
	&lt;&lt;elseif ($tavern.type is &quot;brothel&quot; &amp;&amp; $tavern.draw is &quot;proximity to the church&quot;)&gt;&gt;
		&lt;&lt;set $tavern.draw to &quot;proximity to the brothel&quot;&gt;&gt;
	&lt;&lt;elseif ($tavern.type is &quot;raucous dive&quot; &amp;&amp; $tavern.draw is &quot;proximity to the church&quot;)&gt;&gt;
		&lt;&lt;set $tavern.draw to &quot;proximity to the brothel&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;

$tavern.sinroll.clamp(1, 100)
$tavern.wealthroll.clamp(1, 100)
$tavern.reputationroll.clamp(1, 100)
$tavern.cleanlinessroll.clamp(1, 100)
$tavern.populationroll.clamp(1, 100)
$tavern.roughnessroll.clamp(1, 100)
$tavern.diversityroll.clamp(1, 100)
$tavern.sizeroll.clamp(1, 100)
$tavern.magicroll.clamp(1, 100)</tw-passagedata><tw-passagedata pid="67" name="TavernDescription" tags="" position="850,850">&lt;&lt;nobr&gt;&gt;
&lt;&lt;switch $tavern.draw&gt;&gt;
	&lt;&lt;case &quot;attractive waitstaff&quot;&gt;&gt;
		&lt;&lt;set _tavernnotable to &quot;You see one of the barmaids talking to a patron, and it&#39;s difficult to convince your eyes there&#39;s a more pleasant sight in the room, until you see another equally attractive barmaid pulling a pint at the bar.&quot;&gt;&gt;
	&lt;&lt;case &quot;resident bard&quot;&gt;&gt;
		&lt;&lt;set _tavernnotable to &quot;You see a bard singing a love song in the corner of the room, and are drawn to his pure, melifluous voice. He&#39;s quite a good singer, and the patrons are nodding along to the song appreciatively.&quot;&gt;&gt;
	&lt;&lt;case &quot;witty banter with the waitstaff&quot;&gt;&gt;
		&lt;&lt;set _tavernnotable to &quot;You see a gruff looking man catcall after one of the barmaids, and she looks over her shoulder, and replies something that you can&#39;t quite make out. Despite this, it&#39;s clear that whatever she said destroyed the man, as his friends burst into laughter while he deflates rather rapidly.&quot;&gt;&gt;
	&lt;&lt;case &quot;crude jokes the bartender makes&quot;&gt;&gt;
		&lt;&lt;set _tavernnotable to &quot;You see the bartender is talking to a &lt;&lt;print either($npc.age)&gt;&gt; &lt;&lt;print either($npc.gender)&gt;&gt;, smiles, and then says something, making $bartender.hisher conversation partner go white as a sheet, and immediately leave the establishment, with $bartender.firstname laughing, calling them &#39;too goody-two-shoes to be able to handle $tavern.name&#39;.&quot;&gt;&gt;
	&lt;&lt;case &quot;proximity to the thieves&#39; guild headquarters&quot;&gt;&gt;
		&lt;&lt;set _tavernnotable to &quot;You can see a sign by the door stating &#39;REPEATED PICKPOCKETING WILL RESULT IN THE THIEVES&#39; GUILD BEING BANNED FROM THESE PREMISES&#39;. Clearly, $tavern.name has an issue with the nearby thieves&#39; guild.&quot;&gt;&gt;
	&lt;&lt;case &quot;warmth inside&quot;&gt;&gt;
		&lt;&lt;set _tavernnotable to &quot;$tavern.name is kept wonderfully toasty, and the warm air makes you comfortable and sleepy&quot;&gt;&gt;
	&lt;&lt;case &quot;magic incense which is constantly burning&quot;&gt;&gt;
		&lt;&lt;set _tavernnotable to &quot;You smell a peculiar aroma, which you can&#39;t quite place, only that it reminds you of the fond days of your childhood, until you see wafts of smoke trailing from behind the bar; there&#39;s a stick of incense burning, clearly at least somewhat magical.&quot;, $tavern.magicroll += 4&gt;&gt;
	&lt;&lt;case &quot;proximity to the brothel&quot;&gt;&gt;
		&lt;&lt;set _tavernnotable to &quot;You saw a sign outside which read &#39;No Soliciting&#39;, but inside, you see a much larger, more insistent sign which read &#39;NO SOLICITING. OF EITHER SORT&#39;. Clearly, $tavern.name has an issue with the nearby whorehouse.&quot;&gt;&gt;
	&lt;&lt;case &quot;proximity to the church&quot;&gt;&gt;
		&lt;&lt;set _tavernnotable to &quot;You see a sign by the door which reads &#39;No proselytising&#39;. Clearly, $tavern.name has an issue with the nearby church.&quot;, $tavern.magicroll += 1&gt;&gt;
	&lt;&lt;case &quot;location by the river&quot;&gt;&gt;
		&lt;&lt;set _tavernnotable to &quot;$tavern.name overlooks a gorgeous river, which you can hear gently rushing by the $tavern.material $tavern.wordnoun inside. A fisherman is sitting at the bar, talking about his day&#39;s catch, which he&#39;s clearly exaggerating.&quot;&gt;&gt;
	&lt;&lt;case &quot;wooden-chopping competition held weekly&quot;&gt;&gt;
		&lt;&lt;set _tavernnotable to &quot;Above the bar is a fearsome axe. And another, and another. On the wall is what looks to be a leaderboard, with names and points next to the names. Upon closer inspection, it&#39;s revealed to be the scores for the wood chopping competition. Clever bartender; you can see the fireplace is well stocked.&quot;&gt;&gt;
	&lt;&lt;case &quot;mahogany stairs&quot;&gt;&gt;
		&lt;&lt;set _tavernnotable to &quot;You see a gorgeous spiral staircase, which presumably leads up to the sleeping quarters. The craftsmanship is astounding, and it&#39;s clearly well loved by staff and patrons alike.&quot;&gt;&gt;
	&lt;&lt;case &quot;clean beds&quot;&gt;&gt;
		&lt;&lt;set _tavernnotable to &quot;You see that the bar has been recently cleaned, and there&#39;s a surprising lack of spittle on the floor of the $tavern.wordnoun.&quot;&gt;&gt;
	&lt;&lt;case &quot;lack of bedbugs&quot;&gt;&gt;
		&lt;&lt;set _tavernnotable to &quot;You see a patron enter the bar from the sleeping quarters. The bartender asks if she slept well, and she nods at the $bartender.weight $bartender.manwoman, saying that she slept very well.&quot;&gt;&gt;
	&lt;&lt;case &quot;magic bedbugs&quot;&gt;&gt;
		&lt;&lt;set _tavernnotable to &quot;You see a patron enter the bar from the sleeping quarters, who&#39;s scratching his arms madly, with a doped up smile upon his face.&quot;, $tavern.magicroll += 4&gt;&gt;
	&lt;&lt;case &quot;drunk wizard&quot;&gt;&gt;
		&lt;&lt;set _tavernnotable to &quot;There&#39;s a thaumaturgist in the corner, who is practising cantrips as he downs another pint. He looks over at you, smiles, and says &#39;You can&#39;t cast drunk if you don&#39;t practice drunk!&#39;&quot;, $tavern.magicroll += 4&gt;&gt;
	&lt;&lt;case &quot;huge fireplace&quot;&gt;&gt;
		&lt;&lt;set _tavernnotable to &quot;You see a huge fireplace in the centre of the $tavern.wordnoun, which fills the surrounding air with a wonderful warmth and aroma due to the pot which hangs above it, contentedly bubbling over the embers.&quot;&gt;&gt;
	&lt;&lt;case &quot;incredible view&quot;&gt;&gt;
		&lt;&lt;set _tavernnotable to &quot;You look out the window, and see that the view is indeed nothing to scoff at; the $tavern.wordnoun is situated on a hill which overlooks the sleepy $town.type of $town.name, and you can make out the specks of people walking about below. It&#39;s an unbelievable location for an inn.&quot;&gt;&gt;
	&lt;&lt;case &quot;nice view&quot;&gt;&gt;
		&lt;&lt;set _tavernnotable to &quot;You look out the window, and see that the view is indeed quite nice; the $tavern.wordnoun is situated on a hill which overlooks the sleepy $town.type of $town.name, and you can make out the specks of people walking about below. It&#39;s a nice location for an inn.&quot;&gt;&gt;
	&lt;&lt;default&gt;&gt;
		&lt;&lt;set _tavernnotable to &quot;There&#39;s two men sitting in the corner, very intent on a thumbwrestling match.&quot;&gt;&gt;
	&lt;&lt;/switch&gt;&gt;

&lt;&lt;switch $tavern.size&gt;&gt;
	&lt;&lt;case &quot;huge&quot;&gt;&gt;
		$tavern.name is just one huge, $tavern.cleanliness room, with a small section of the hall cordoned off as the kitchen and bar area. Off to the side is a spiral staircase, which you would assume leads up to the lodgings.
	&lt;&lt;case &quot;large&quot;&gt;&gt;
		$tavern.name is a large building, with the $tavern.cleanliness bar occupying the ground floor, and the beds for patrons are on the floor directly above you.
	&lt;&lt;case &quot;medium&quot;&gt;&gt;
		&lt;&lt;print either(&quot;$tavern.name is a tall building, but not particularly spacious; the $tavern.cleanliness bar occupies the ground floor, and you see a barmaid carrying a dish down from the stairs; the sign outside said that it had accomodation, so the beds must be on the third floor of the $tavern.material building.&quot;,
		&quot;$tavern.name is clearly a converted house; you can see that a bathroom was originally where the bar is, due to the unmistakable water staining that comes with bathtubs. The tavern is $tavern.cleanliness.&quot;)&gt;&gt;
	&lt;&lt;case &quot;small&quot;&gt;&gt;
		$tavern.name is barely more than a large house; the $tavern.cleanliness bar area is permanently crowded due to a bottleneck preventing barmaids from passing through without having to negotiate through thirsty patrons looking for refills.
	&lt;&lt;case &quot;tiny&quot;&gt;&gt;
		$tavern.name is very obviously a house that&#39;s been converted into a $tavern.wordnoun, probably as a hobby for the owner. It&#39;s unfortunately rather cramped inside, and taller patrons would be at risk of hitting their heads if they were careless inside the tiny $tavern.material building. The tavern is $tavern.cleanliness.
&lt;&lt;/switch&gt;&gt;
&lt;&lt;/nobr&gt;&gt; _tavernnotable</tw-passagedata><tw-passagedata pid="68" name="TavernFlavour" tags="" position="975,850">&lt;&lt;set $tavern.fun to [&quot;A group of commoners is playing horse shoes out back.&quot;,
&quot;The party is surprised to find the country darts league in full swing as they enter. The waitresses are used to the chaos and dodge darts easily. The half ogre bouncer is using lawn darts.&quot;,
&quot;A group of Hill Dwarves are in the middle of a drinking contest, and two of them are passed out already. The Prize is a solid platinum stein.&quot;,
&quot;Wet Chainmail contest!&quot;,
&quot;Four large Barbarians are loudly sledging each other during an arm wrestling competition.&quot;,
&quot;A shy teenage girl is reciting bad poetry in a corner. No one is paying the slightest bit of attention to her.&quot;,
&quot;It&#39;s trivia night! Those scholars from the School of History and the Arts at the University always win, but tonight, we represent and the School of Alchemy will show those smug book-snobs what it means to be a nerd.&quot;,
&quot;A promoter is working his way around the tables looking for challengers to fight the local champion pugilist.&quot;,
&quot;It&#39;s a sausage fest! The place is packed with dwarves eager to devour the all-you-can-eat sausage special.&quot;,
&quot;An over-sized brute is arm-wrestling crushing the hand of everyone in sight.&quot;,
&quot;Some goblins are throwing dice with some animated skeletons at a table in the corner.&quot;,
&quot;A goblin is doing a poor job at cheating at a dice game, while a skeleton is doing an excellent job at cheating.&quot;,
&quot;A 7&#39;2 red dragonborn with a 5&#39; bastard sword is having a drinking contest with a dwarf. The dragonborn has a 4-pint tankard, and is almost managing to keep pace.&quot;,
&quot;A party sits in the corner booth playing cards. All of them are cheating, except the paladin, who, curiously, is winning.&quot;,
&quot;A mountain of a man in barbarian leathers is arm wrestling a small dragon and winning.&quot;,
&quot;An awakened Roper is winning two games of billiards at once.&quot;,
&quot;A group of drunken pixies is playing hide and seek by hiding behind patrons.&quot;,
&quot;The players have stumbled into a regional card championship being held that night. The buy in is huge but so is the pot.&quot;,
&quot;A shady looking gnomish inventor is proudly showing off his latest invention. He calls it a one armed bandit.&quot;,
&quot;A grey haired story teller is sitting near the fire holding a contest. He&#39;ll give a large purse for a story he hasn&#39;t heard yet, but so far no one has won.&quot;]&gt;&gt;

&lt;&lt;set $tavern.entertainment to [
	&quot;A bard is telling a story about the player’s latest act of daring do. He’s embellishing quite a bit. When he recognizes the party he makes a big spectacle.&quot;,
	&quot;A bard is telling the story of the player’s latest exploit. It’s an obvious character assassination.&quot;,
	&quot;A local bardic group, The Rolling Boulders, are performing, and a large crowd of drunken groupies will not stop screaming.&quot;,
	&quot;A beggar offers to sing for a few coppers. You heard him singing to the last table. He&#39;s awful.&quot;,
	&quot;A sassy fortune teller has set up shop in a corner booth. She informs you that she sees a hangover in your near future.&quot;,
	&quot;A stirring rendition of &#39;The Lady and the Faerie Dragon&#39; has the crowd calling for an encore from the minstrels.&quot;,
	&quot;The lute-player catches some undergarments from the crowd and drapes them across the ridiculous horned helm he wears.&quot;,
	&quot;On stage tonight: The Deep Tones. A quartet of dwarves with long beards and deep voices singing a capella favorites from places without light (or proper music).&quot;,
	&quot;On stage tonight: Shaela Windspeaker. An elf-maid singer-songwriter with a bit of a whiny voice who is slowly making her way through her most recent song of protest against the previous and the present centuries of war.&quot;,
	&quot;A nervous show-wizard on the small stage is doing tricks with Prestidigitation for the un-amused patrons.&quot;,
	&quot;There is a pair of musicians warbling well known drinking songs. They have made an impromptu stage out of several tables. One of them seems to be tilting precariously.&quot;]&gt;&gt;

&lt;&lt;set $tavern.patrons to [&quot;A poor farmer is trying to pay his bar tab with a sack of potatoes and a barrel of pickles.&quot;,
	&quot;A sea captain has set up shop at a table and is trying to sell mementos and souvenirs from his latest great voyage of exploration. Birds, exotic coins, tiny mermaids, he has it all. Some of it looks fake though. A tiny bit looks disturbingly real.&quot;,
	&quot;A ranger sits alone in a corner, smoking. A hood covers most of his face. At his feet is a sleeping wolfhound. Everyone is giving him a wide berth.&quot;,
	&quot;A lone Troll is drinking at the end of the bar and softly crying and singing one country ballad after another.&quot;,
	&quot;A stoned magician is fumbling his way through one awful card trick after another.&quot;,
	&quot;A mixed group of Elves are drinking bad wine and holding scented handkerchiefs up to their noses to keep out the stench. One has an obsidian bow strapped to her back.&quot;,
	&quot;Two guards are arguing at a table over who the captain likes more by comparing almost identical spears and claiming to have the better one.&quot;,
	&quot;A sad clown is drinking a beer alone.&quot;,
	&quot;A handsome young woman is holding court among some of her would-be suitors. Her father interrupts, and she stalks off embarrassed.&quot;,
	&quot;Some idiot is having a stag night. His friends are loud and obnoxiously harassing the barmaids.&quot;,
	&quot;It&#39;s ladies night! And it&#39;s not disappointing... A few pretty little things from the weavers&#39; guild are here, a couple of attractive healers from the temple, and the beautiful new town librarian.&quot;,
	&quot;A surly old witch is drinking sherry while stroking the fat grey cat sitting on her lap.&quot;,
	&quot;The barmaid is a marilith, mixing up four drinks at a time.&quot;,
	&quot;The barmaid is a succubus, she seems to be making great tips.&quot;,
	&quot;The attendant in the bathroom is a foul-smelling zombie. He offers you a mint crystal.&quot;,
	&quot;Behind the bar is a gnomish alchemist with a penchant for mixology experiments.&quot;,
	&quot;The toothless mop-hand reminisces with a hobgoblin military has-been over ales about how an otyugh in the loo isn&#39;t as bad as the time a carrion crawler was in there.&quot;,
	&quot;The barmaid is a doppelganger. When she returns to your table with your drinks she has taken the form of one of your party.&quot;,
	&quot;A fat priest is doing an excellent jiggly dance in rhythm with the music. Either that or a gelatinous cube has made it&#39;s way onto the dance floor?&quot;]&gt;&gt;</tw-passagedata><tw-passagedata pid="69" name="TavernGuard" tags="" position="1100,850">&lt;&lt;set _guard to random(1, 100)&gt;&gt;
&lt;&lt;set _brawl to random(1, 100)&gt;&gt;
	&lt;&lt;if $guard.population gt 20&gt;&gt;
		&lt;&lt;set _guard += 10&gt;&gt;
	&lt;&lt;elesif $guard.population gt 15&gt;&gt;
		&lt;&lt;set _guard += 5&gt;&gt;
	&lt;&lt;elseif $guard.population gt 10&gt;&gt;
		&lt;&lt;set _guard += 1&gt;&gt;
	&lt;&lt;elseif $guard.population gt 5 &amp;&amp; $tavern.sizeroll gt 60&gt;&gt;
		&lt;&lt;set _guard -= 7&gt;&gt;
	&lt;&lt;elseif $guard.population gt 5&gt;&gt;
			&lt;&lt;set _guard -= 5&gt;&gt;
	&lt;&lt;elseif $guard.population lte 5 &amp;&amp; $tavern.sizeroll gt 60&gt;&gt;
			&lt;&lt;set _guard -= 15&gt;&gt;
	&lt;&lt;elseif $guard.population lte 5&gt;&gt;
		&lt;&lt;set _guard -= 10&gt;&gt;
		&lt;&lt;/if&gt;&gt;

&lt;&lt;if _guard gte 50&gt;&gt;
		&lt;&lt;set $tavern.guardpresent to true, _brawl -= 20&gt;&gt;
		&lt;&lt;set $TavernGuard to setup.createNPC()&gt;&gt;
	&lt;&lt;elseif _guard lt 50&gt;&gt;
		&lt;&lt;set $tavern.guardpresent to false&gt;&gt;
	&lt;&lt;/if&gt;&gt;


	&lt;&lt;if $tavern.populationroll gt 80&gt;&gt;
		&lt;&lt;set _brawl += 15&gt;&gt;
	&lt;&lt;elseif $tavern.populationroll gt 70&gt;&gt;
		&lt;&lt;set _brawl += 13&gt;&gt;
	&lt;&lt;elseif $tavern.populationroll gt 60&gt;&gt;
		&lt;&lt;set _brawl += 11&gt;&gt;
	&lt;&lt;elseif $tavern.populationroll gt 60&gt;&gt;
		&lt;&lt;set _brawl += 8&gt;&gt;
	&lt;&lt;elseif $tavern.populationroll gt 50&gt;&gt;
		&lt;&lt;set _brawl += 0&gt;&gt;
	&lt;&lt;elseif $tavern.populationroll gt 40&gt;&gt;
		&lt;&lt;set _brawl -= 5&gt;&gt;
	&lt;&lt;elseif $tavern.populationroll gt 30&gt;&gt;
		&lt;&lt;set _brawl -= 15&gt;&gt;
	&lt;&lt;elseif $tavern.populationroll gt 20&gt;&gt;
		&lt;&lt;set _brawl -= 20&gt;&gt;
	&lt;&lt;elseif $tavern.populationroll lte 20&gt;&gt;
		&lt;&lt;set _brawl -= 40&gt;&gt;
&lt;&lt;/if&gt;&gt;
	&lt;&lt;if $tavern.roughnessroll gt 80&gt;&gt;
		&lt;&lt;set _brawl += 15&gt;&gt;
	&lt;&lt;elseif $tavern.roughnessroll gt 70&gt;&gt;
		&lt;&lt;set _brawl += 13&gt;&gt;
	&lt;&lt;elseif $tavern.roughnessroll gt 60&gt;&gt;
		&lt;&lt;set _brawl += 11&gt;&gt;
	&lt;&lt;elseif $tavern.roughnessroll gt 60&gt;&gt;
		&lt;&lt;set _brawl += 8&gt;&gt;
	&lt;&lt;elseif $tavern.roughnessroll gt 50&gt;&gt;
		&lt;&lt;set _brawl += 0&gt;&gt;
	&lt;&lt;elseif $tavern.roughnessroll gt 40&gt;&gt;
		&lt;&lt;set _brawl -= 5&gt;&gt;
	&lt;&lt;elseif $tavern.roughnessroll gt 30&gt;&gt;
		&lt;&lt;set _brawl -= 15&gt;&gt;
	&lt;&lt;elseif $tavern.roughnessroll gt 20&gt;&gt;
		&lt;&lt;set _brawl -= 20&gt;&gt;
	&lt;&lt;elseif $tavern.roughnessroll lte 20&gt;&gt;
		&lt;&lt;set _brawl -= 40&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="70" name="TavernInventory" tags="" position="1225,850">&lt;&lt;set $tavern.inventory to [
    {name: &quot;Crisped Worm and Potatoes&quot;, cost: 3, availability: 1},
    {name: &quot;Frogs on Skewers&quot;, cost: 3, availability: 1},
    {name: &quot;Green Chili Stew&quot;, cost: 3, availability: 1},
    {name: &quot;Grilled Snake and Macadamia&quot;, cost: 3, availability: 1},
    {name: &quot;Humble Pie (tripe or cow heel)&quot;, cost: 3, availability: 1},
    {name: &quot;Lizard Gruel with Nutbread&quot;, cost: 3, availability: 1},
    {name: &quot;Plain porridge&quot;, cost: 2, availability: 1},
    {name: &quot;Spiced porridge&quot;, cost: 3, availability: 1},
    {name: &quot;Pot of cured meats&quot;, cost: 4, availability: 1},
    {name: &quot;Bread and cheese&quot;, cost: 3, availability: 1},
    {name: &quot;Barbecued Gopher Legs&quot;, cost: 6, availability: 1},
    {name: &quot;Bog-Beetle Dumplings&quot;, cost: 6, availability: 1},
    {name: &quot;Bread-bowl stew&quot;, cost: 6, availability: 2},
    {name: &quot;Leg of Mutton and eggs&quot;, cost: 6, availability: 2},
    {name: &quot;Mushroom Stew with Bread&quot;, cost: 6, availability: 2},
    {name: &quot;Rabbit and Baked Pumpkin&quot;, cost: 6, availability: 2},
    {name: &quot;Squash and Fish Soup&quot;, cost: 6, availability: 2},
    {name: &quot;Broiled Salmon and Potatoes&quot;, cost: 30, availability: 2},
    {name: &quot;Cheese Pie and Onion Soup&quot;, cost: 30, availability: 2},
    {name: &quot;Grilled Wild Boar Chops&quot;, cost: 35, availability: 2},
    {name: &quot;Baked Loin of Pork with Gravy&quot;, cost: 80, availability: 3},
    {name: &quot;Beef Steak and Kidney Pie&quot;, cost: 80, availability: 3},
    {name: &quot;Buffaloaf and Honeyed Corn&quot;, cost: 80, availability: 3},
    {name: &quot;Elven Bread&quot;, cost: 80, availability: 3},
    {name: &quot;Honey Braised Boar Ribs&quot;, cost: 80, availability: 3},
    {name: &quot;Pork Chop and Curds&quot;, cost: 80, availability: 3},
    {name: &quot;Rack of Lamb Platter&quot;, cost: 80, availability: 3},
    {name: &quot;Barbecued Tiger Fish and Papaya&quot;, cost: 200, availability: 4},
]&gt;&gt;</tw-passagedata><tw-passagedata pid="71" name="TavernModifiers" tags="" position="100,975">/* ------------------------- NAME ------------------------- */
&lt;&lt;if [&quot;Silver&quot;, &quot;Golden&quot;, &quot;Glorious&quot;, &quot;Beautiful&quot;, &quot;Handsome&quot;, &quot;Lovely&quot;, &quot;Educated&quot;, &quot;Ornate&quot;, &quot;Wealthy&quot;, &quot;Cleanly&quot;, &quot;Jeweled&quot;, &quot;Superior&quot;, &quot;Flawless&quot;, &quot;Exquisite&quot;, &quot;Elegant&quot;, &quot;Fine&quot;].includes($tavern.adjective)&gt;&gt;
		&lt;&lt;set $tavern.wealthroll += 3&gt;&gt;
	&lt;&lt;elseif [&quot;Blighted&quot;, &quot;Withered&quot;, &quot;Lecherous&quot;, &quot;Faulty&quot;, &quot;Cracked&quot;, &quot;Common&quot;].includes($tavern.adjective)&gt;&gt;
		&lt;&lt;set $tavern.wealthroll -= 3&gt;&gt;
&lt;&lt;/if&gt;&gt;

/* ------------------------- BARTENDER RACE -------------------------- */
/* THIS IS IN THE BARTENDER PASSAGE */

/* ------------------------- WEALTH -------------------------- */

	&lt;&lt;if $town.wealthroll gt 95&gt;&gt;
		&lt;&lt;set $tavern.wealthroll += 5, $tavern.lodging *= 1.1, $specialbrew.cost *= 1.2, $tavern.food *= 1.2&gt;&gt;
	&lt;&lt;elseif $town.wealthroll gt 80&gt;&gt;
		&lt;&lt;set $tavern.wealthroll += 3&gt;&gt;
	&lt;&lt;elseif $town.wealthroll gt 70&gt;&gt;
		&lt;&lt;set $tavern.wealthroll += 2&gt;&gt;
	&lt;&lt;elseif $town.wealthroll gt 60&gt;&gt;
		&lt;&lt;set $tavern.wealthroll += 1, $tavern.populationroll += 1&gt;&gt;
	&lt;&lt;elseif $town.wealthroll gt 50&gt;&gt;
		&lt;&lt;set $tavern.wealthroll += 1, $tavern.populationroll += 3&gt;&gt;
	&lt;&lt;elseif $town.wealthroll gt 40&gt;&gt;
		&lt;&lt;set $tavern.wealthroll -= 1, $tavern.populationroll += 2&gt;&gt;
	&lt;&lt;elseif $town.wealthroll gt 30&gt;&gt;
		&lt;&lt;set $tavern.wealthroll -= 2&gt;&gt;
	&lt;&lt;elseif $town.wealthroll gt 20&gt;&gt;
		&lt;&lt;set $tavern.wealthroll -= 3, $tavern.sinroll += 1&gt;&gt;
	&lt;&lt;elseif $town.wealthroll lte 20&gt;&gt;
		&lt;&lt;set $tavern.wealthroll -= 5, $tavern.sinroll += 3, $tavern.populationroll -= 3&gt;&gt;
&lt;&lt;/if&gt;&gt;
/* ------------------------- TYPE -------------------------- */
&lt;&lt;if $tavern.type is &quot;brothel&quot; or $tavern.type is &quot;gambling den&quot;&gt;&gt;
		&lt;&lt;set $tavern.sinroll += 20, $tavern.roughnessroll +=4, $tavern.cleanlinessroll -= 5, $tavern.lodging *= 1.3&gt;&gt;
	&lt;&lt;elseif $tavern.type is &quot;quiet and low-key bar&quot;&gt;&gt;
		&lt;&lt;set $tavern.sinroll -= 15, $tavern.populationroll -= 5, $tavern.roughnessroll -=10, $tavern.cleanlinessroll += 3&gt;&gt;
	&lt;&lt;elseif $tavern.type is &quot;raucous dive&quot;&gt;&gt;
		&lt;&lt;set $tavern.sinroll += 5, $tavern.populationroll += 15, $tavern.roughnessroll +=5, $tavern.cleanlinessroll -= 5&gt;&gt;
	&lt;&lt;elseif $tavern.type is &quot;thieves&#39; guild hangout&quot;&gt;&gt;
		&lt;&lt;set $tavern.sinroll += 15, $tavern.roughnessroll +=5&gt;&gt;
	&lt;&lt;elseif $tavern.type is &quot;high-end dining club&quot; or $tavern.type is &quot;members-only club&quot;&gt;&gt;
		&lt;&lt;set $tavern.sinroll -= 10, $tavern.wealthroll += 5, $tavern.roughnessroll -=10, $tavern.cleanlinessroll += 10, $tavern.food *= 1.3&gt;&gt;
	&lt;&lt;elseif $tavern.type is &quot;gathering place for a secret society&quot;&gt;&gt;
		&lt;&lt;set $tavern.sinroll += 5, $tavern.populationroll -= 5&gt;&gt;
&lt;&lt;/if&gt;&gt;
/* ------------------------- DRAW -------------------------- */
/*&lt;&lt;if $tavern.draw is &quot;attractive waitstaff&quot;&gt;&gt;
		&lt;&lt;set $tavern.roughnessroll += 3, $tavern.sinroll += 1&gt;&gt;
	&lt;&lt;elseif $tavern.draw is &quot;crude jokes the bartender makes&quot;&gt;&gt;
		&lt;&lt;set $tavern.roughnessroll += 3, $tavern.sinroll += 1&gt;&gt;
	&lt;&lt;elseif $tavern.draw is &quot;proximity to the thieves&#39; guild headquarters&quot; or $tavern.draw is &quot;proximity to the brothel&quot;&gt;&gt;
		&lt;&lt;set $tavern.roughnessroll += 1, $tavern.sinroll += 3&gt;&gt;
	&lt;&lt;elseif $tavern.draw is &quot;witty banter with the waitstaff&quot; or $tavern.draw is &quot;proximity to the church&quot; or $tavern.draw is &quot;incredible view&quot; or $tavern.draw is &quot;nice view&quot;&gt;&gt;
		&lt;&lt;set $tavern.roughnessroll -= 1, $tavern.sinroll -= 3, $tavern.cleanlinessroll += 1&gt;&gt;
	&lt;&lt;elseif tavern.draw is &quot;warmth inside&quot; or $tavern.draw is &quot;huge fireplace&quot;&gt;&gt;
		&lt;&lt;set $tavern.roughnessroll -= 2, $tavern.sinroll -= 1, $tavern.cleanlinessroll += 1&gt;&gt;
*/
	&lt;&lt;if $tavern.draw is &quot;lack of bedbugs&quot; or $tavern.draw is &quot;clean beds&quot;&gt;&gt;
		&lt;&lt;set $tavern.roughnessroll -= 4, $tavern.sinroll -= 1, $tavern.cleanlinessroll += 15, $tavern.lodging *= 1.1&gt;&gt;
&lt;&lt;/if&gt;&gt;

/* ---------------------- TAVERN STRUCTURE MATERIAL ----------------------- */
&lt;&lt;if $tavern.material is &quot;hewn rock&quot;&gt;&gt;
		&lt;&lt;set $tavern.roughnessroll += 3&gt;&gt;
	&lt;&lt;elseif $tavern.material is &quot;chiseled stone&quot;&gt;&gt;
		&lt;&lt;set $tavern.roughnessroll -= 1&gt;&gt;
	&lt;&lt;elseif $tavern.material is &quot;marble&quot;&gt;&gt;
		&lt;&lt;set $tavern.cleanlinessroll += 5, $tavern.wealthroll += 6&gt;&gt;
&lt;&lt;/if&gt;&gt;

/* ======================= RENDERS ======================= */
/* ------------------------- WEALTH -------------------------- */

	&lt;&lt;if $tavern.wealthroll gt 95&gt;&gt;
		&lt;&lt;set $tavern.pricemodifier += 4, $tavern.sizeroll += 3, $tavern.cleanlinessroll += 15, $tavern.roughnessroll -= 10, $tavern.lodging *= 1.1, $specialbrew.cost *= 1.2, $tavern.food *= 1.2&gt;&gt;
	&lt;&lt;elseif $tavern.wealthroll gt 80&gt;&gt;
		&lt;&lt;set $tavern.pricemodifier += 3, $tavern.cleanlinessroll += 10&gt;&gt;
	&lt;&lt;elseif $tavern.wealthroll gt 70&gt;&gt;
		&lt;&lt;set $tavern.wealth to &quot;wealthy&quot;, $tavern.pricemodifier += 2, $tavern.cleanlinessroll += 6&gt;&gt;
	&lt;&lt;elseif $tavern.wealthroll gt 60&gt;&gt;
		&lt;&lt;set $tavern.pricemodifier += 1, $tavern.populationroll += 5, $tavern.cleanlinessroll += 4&gt;&gt;
	&lt;&lt;elseif $tavern.wealthroll gt 50&gt;&gt;
		&lt;&lt;set $tavern.populationroll += 5, $tavern.reputation -= 5, $tavern.cleanlinessroll += 2&gt;&gt;
	&lt;&lt;elseif $tavern.wealthroll gt 30&gt;&gt;
		&lt;&lt;set $tavern.pricemodifier -= 1, $tavern.reputation -= 7, $tavern.cleanlinessroll -= 15&gt;&gt;
	&lt;&lt;elseif $tavern.wealthroll lte 30&gt;&gt;
		&lt;&lt;set $tavern.pricemodifier -= 2, $tavern.reputation -= 10, $tavern.cleanlinessroll -= 25&gt;&gt;
&lt;&lt;/if&gt;&gt;

/* ------------------------- SIZE -------------------------- */

	&lt;&lt;if $tavern.sizeroll gt 80&gt;&gt;
		&lt;&lt;set $tavern.population += 5, $tavern.roughnessroll +=3, $tavern.cleanlinessroll -= 2&gt;&gt;
	&lt;&lt;elseif $tavern.sizeroll gt 60&gt;&gt;
		&lt;&lt;set $tavern.population += 4, $tavern.roughnessroll +=1&gt;&gt;
	&lt;&lt;elseif $tavern.sizeroll gt 40&gt;&gt;
		&lt;&lt;set $tavern.population += 3&gt;&gt;
	&lt;&lt;elseif $tavern.sizeroll gt 20&gt;&gt;
		&lt;&lt;set $tavern.population -= 2, $tavern.sinroll -= 5&gt;&gt;
	&lt;&lt;elseif $tavern.sizeroll lte 20&gt;&gt;
		&lt;&lt;set $tavern.sinroll -= 5, $tavern.populationroll -= 5, $tavern.roughnessroll -=3&gt;&gt;
&lt;&lt;/if&gt;&gt;

/* ------------------------- ROUGHNESS -------------------------- */

	&lt;&lt;if $tavern.roughnessroll gt 80&gt;&gt;
		&lt;&lt;set $tavern.population += 3, $tavern.sinroll +=5, $tavern.cleanlinessroll -= 4, $tavern.lodging *= 0.8&gt;&gt;
	&lt;&lt;elseif $tavern.roughnessroll gt 60&gt;&gt;
		&lt;&lt;set $tavern.population += 1, $tavern.sinroll +=3, $tavern.cleanlinessroll -= 2&gt;&gt;
	&lt;&lt;elseif $tavern.roughnessroll gt 50&gt;&gt;
		&lt;&lt;set $tavern.population += 1, $tavern.sinroll -=1&gt;&gt;
	&lt;&lt;elseif $tavern.roughnessroll gt 40&gt;&gt;
		&lt;&lt;set $tavern.population += 2, $tavern.sinroll -=3&gt;&gt;
	&lt;&lt;elseif $tavern.roughnessroll gt 30&gt;&gt;
		&lt;&lt;set $tavern.population -= 5, $tavern.sinroll -=1, $tavern.wealthroll += 1&gt;&gt;
	&lt;&lt;elseif $tavern.roughnessroll gt 20&gt;&gt;
		&lt;&lt;set $tavern.population -= 10, $tavern.sinroll -=3, $tavern.wealthroll -= 1&gt;&gt;
	&lt;&lt;elseif $tavern.roughnessroll lte 20&gt;&gt;
		&lt;&lt;set $tavern.population -= 15, $tavern.sinroll -=5, $tavern.wealthroll -= 3&gt;&gt;
&lt;&lt;/if&gt;&gt;

/* ------------------------- CLEANLINESS -------------------------- */

	&lt;&lt;if $tavern.cleanlinessroll gt 80&gt;&gt;
		&lt;&lt;set $tavern.wealthroll +=3, $tavern.roughnessroll -= 3&gt;&gt;
	&lt;&lt;elseif $tavern.cleanlinessroll gt 70&gt;&gt;
		&lt;&lt;set $tavern.wealthroll +=2, $tavern.roughnessroll -= 3&gt;&gt;
	&lt;&lt;elseif $tavern.cleanlinessroll gt 60&gt;&gt;
		&lt;&lt;set $tavern.wealthroll +=1, $tavern.roughnessroll -= 2&gt;&gt;
	&lt;&lt;elseif $tavern.cleanlinessroll gt 50&gt;&gt;
		&lt;&lt;set $tavern.roughnessroll -= 2&gt;&gt;
	&lt;&lt;elseif $tavern.cleanlinessroll gt 40&gt;&gt;
		&lt;&lt;set $tavern.roughnessroll -= 1&gt;&gt;
	&lt;&lt;elseif $tavern.cleanlinessroll gt 30&gt;&gt;
		&lt;&lt;set $tavern.population -= 1, $tavern.sinroll +=1, $tavern.wealthroll -= 2&gt;&gt;
	&lt;&lt;elseif $tavern.cleanlinessroll gt 20&gt;&gt;
		&lt;&lt;set $tavern.population -= 2, $tavern.sinroll +=3, $tavern.wealthroll -= 4&gt;&gt;
	&lt;&lt;elseif $tavern.cleanlinessroll lte 20&gt;&gt;
		&lt;&lt;set $tavern.population -= 3, $tavern.sinroll +=5, $tavern.wealthroll -= 8&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="72" name="TavernNameGen" tags="" position="225,975">/* ------------------------- TOWN NAME -------------------------- */

&lt;&lt;set $town.nameprefix to either(&quot;Green&quot;, &quot;Elms&quot;, &quot;Oak&quot;, &quot;Fair&quot;, &quot;Farren&quot;, &quot;Tall&quot;, &quot;Nar&quot;, &quot;Alla&quot;, &quot;Lans&quot;, &quot;San&quot;, &quot;Col&quot;, &quot;Fri&quot;, &quot;Plain&quot;, &quot;Hon&quot;, &quot;Far&quot;, &quot;Barrow&quot;, &quot;Shi&quot;, &quot;Mel&quot;, &quot;Mal&quot;, &quot;Bon&quot;, &quot;Bie&quot;, &quot;Can&quot;, &quot;Pol&quot;, &quot;Pan&quot;, &quot;Fald&quot;, &quot;Frior&quot;, &quot;Pol&quot;)&gt;&gt;

&lt;&lt;set $town.namesuffix to either(&quot;dale&quot;, &quot;ten&quot;, &quot;den&quot;, &quot;ven&quot;, &quot;gen&quot;, &quot;len&quot;, &quot;lun&quot;, &quot;stun&quot;, &quot;ville&quot;, &quot;burn&quot;, &quot;view&quot;, &quot;nen&quot;, &quot;lan&quot;, &quot;sed&quot;, &quot;folk&quot;, &quot;ork&quot;, &quot;len&quot;, &quot;pan&quot;, &quot;rel&quot;, &quot;old&quot;, &quot;ten&quot;, &quot;tan&quot;, &quot;lend&quot;, &quot;vorn&quot;, &quot;vant&quot;, &quot;lid&quot;, &quot;lin&quot;)&gt;&gt;

&lt;&lt;set $town.name to $town.nameprefix + $town.namesuffix&gt;&gt;




/* ------------------------- TAVERN NAME -------------------------- */
&lt;&lt;set _tavernnameroll to random(1, 5)&gt;&gt;

&lt;&lt;set $tavern.nounA to either(&quot;Warhorse&quot;, &quot;Horseman&quot;, &quot;Maiden&quot;, &quot;Mage&quot;, &quot;Bachelor&quot;, &quot;King&quot;, &quot;Magistrate&quot;, &quot;Warchief&quot;, &quot;Warrior&quot;, &quot;Mare&quot;, &quot;Wolf&quot;, &quot;Fox&quot;, &quot;Lion&quot;, &quot;Lamb&quot;, &quot;Warden&quot;, &quot;Mule&quot;, &quot;Assassin&quot;, &quot;Swordsman&quot;, &quot;Lady&quot;, &quot;Knight&quot;, &quot;Soldier&quot;, &quot;Wizard&quot;, &quot;Warlock&quot;, &quot;Ranger&quot;, &quot;Bard&quot;, &quot;Druid&quot;, &quot;Monk&quot;, &quot;Paladin&quot;, &quot;Sorcerer&quot;, &quot;Rogue&quot;, &quot;Cleric&quot;, &quot;Bear&quot;, &quot;Goblin&quot;, &quot;Kobold&quot;, &quot;Gnome&quot;, &quot;Halfling&quot;, &quot;Dwarf&quot;, &quot;Fool&quot;, &quot;Virgin&quot;, &quot;Horde&quot;, &quot;Squire&quot;, &quot;Eagle&quot;, &quot;Rooster&quot;, &quot;Piglet&quot;, &quot;Thief&quot;, &quot;Priest&quot;, &quot;Friar&quot;, &quot;Blacksmith&quot;, &quot;Guard&quot;, &quot;Stag&quot;, &quot;Hag&quot;, &quot;Devil&quot;, &quot;Angel&quot;, &quot;Serpent&quot;, &quot;Snake&quot;, &quot;Rat&quot;, &quot;Mouse&quot;, &quot;Bandit&quot;, &quot;Chieftain&quot;, &quot;Griffon&quot;, &quot;Dragon&quot;, &quot;Lizard&quot;, &quot;Pony&quot;, &quot;Baron&quot;, &quot;Heifer&quot;, &quot;Bull&quot;, &quot;Hound&quot;, &quot;Goat&quot;, &quot;Toad&quot;, &quot;Stallion&quot;, &quot;Monster&quot;, &quot;Vermin&quot;, &quot;Beholder&quot;, &quot;Monkey&quot;, &quot;Elephant&quot;, &quot;Boar&quot;, &quot;Beagle&quot;, &quot;Bat&quot;, &quot;Demon&quot;, &quot;Imp&quot;, &quot;Sprite&quot;, &quot;Fey&quot;, &quot;Spirit&quot;, &quot;Bitch&quot;, &quot;Starling&quot;, &quot;Minotaur&quot;, &quot;Barbarian&quot;, &quot;Prophet&quot;, &quot;Merchant&quot;, &quot;Cobbler&quot;, &quot;Unicorn&quot;, &quot;Ogre&quot;, &quot;Nymph&quot;, &quot;Butcher&quot;, &quot;Captain&quot;, &quot;Angler&quot;, &quot;Lover&quot;, &quot;Mason&quot;, &quot;Tinker&quot;, &quot;Whale&quot;)&gt;&gt;

&lt;&lt;if _tavernnameroll is 1&gt;&gt;
	&lt;&lt;set $tavern.adjective to either(&quot;Wayward&quot;, &quot;Quiet&quot;, &quot;Jolly&quot;, &quot;Good&quot;, &quot;Crooked&quot;, &quot;White&quot;, &quot;Gray&quot;, &quot;Blackened&quot;, &quot;Harried&quot;, &quot;Crimson&quot;, &quot;Silver&quot;, &quot;Golden&quot;, &quot;Disturbed&quot;, &quot;Filthy&quot;, &quot;Ugly&quot;, &quot;Bastard&quot;, &quot;Faltering&quot;, &quot;Glorious&quot;, &quot;Beautiful&quot;, &quot;Handsome&quot;, &quot;Wrinkled&quot;, &quot;Unhappy&quot;, &quot;Intelligent&quot;, &quot;Lovely&quot;, &quot;Ignorant&quot;, &quot;Senile&quot;, &quot;Sour&quot;, &quot;Sweet&quot;, &quot;Lonely&quot;, &quot;Green&quot;, &quot;Blind&quot;, &quot;Hungry&quot;, &quot;Worried&quot;, &quot;Educated&quot;, &quot;Stupid&quot;, &quot;Emboldened&quot;, &quot;Honorary&quot;, &quot;Stinky&quot;, &quot;Bottomless&quot;, &quot;Greasy&quot;, &quot;Sloppy&quot;, &quot;Stylish&quot;, &quot;Distressed&quot;, &quot;Harrowed&quot;, &quot;Tormented&quot;, &quot;Mortified&quot;, &quot;Lopsided&quot;, &quot;Broken&quot;, &quot;Moldy&quot;, &quot;Gooey&quot;, &quot;Fermented&quot;, &quot;Blighted&quot;, &quot;Ornate&quot;, &quot;Drowned&quot;, &quot;Murdered&quot;, &quot;Widowed&quot;, &quot;Hanged&quot;, &quot;Angry&quot;, &quot;Lusty&quot;, &quot;Haunted&quot;, &quot;Strong&quot;, &quot;Withered&quot;, &quot;Comely&quot;, &quot;Pious&quot;, &quot;Penitent&quot;, &quot;Patient&quot;, &quot;Drunk&quot;, &quot;Worthy&quot;, &quot;Wealthy&quot;, &quot;Loathsome&quot;, &quot;Weak&quot;, &quot;Miniscule&quot;, &quot;Miniature&quot;, &quot;Enormous&quot;, &quot;Enlarged&quot;, &quot;Engorged&quot;, &quot;Lecherous&quot;, &quot;Despicable&quot;, &quot;Lewd&quot;, &quot;Portly&quot;, &quot;Violent&quot;, &quot;Bumbling&quot;, &quot;Faulty&quot;, &quot;Pristine&quot;, &quot;Cleanly&quot;, &quot;Cracked&quot;, &quot;Splintered&quot;, &quot;Jeweled&quot;, &quot;Superior&quot;, &quot;Flawless&quot;, &quot;Common&quot;, &quot;Exquisite&quot;, &quot;Elegant&quot;, &quot;Fine&quot;, &quot;Dull&quot;, &quot;Brittle&quot;, &quot;Fragile&quot;, &quot;Effeminate&quot;, &quot;Masculine&quot;, &quot;Supine&quot;)&gt;&gt;
&lt;&lt;elseif _tavernnameroll is 2 or _tavernnameroll is 3&gt;&gt;
	&lt;&lt;set $tavern.nounB to either(&quot;Mount&quot;, &quot;Saddle&quot;, &quot;Guild&quot;, &quot;Fangs&quot;, &quot;Man&quot;, &quot;Pardon&quot;, &quot;Pleasure&quot;, &quot;Belt&quot;, &quot;Staff&quot;, &quot;Shield&quot;, &quot;Prince&quot;, &quot;Master&quot;, &quot;Servant&quot;, &quot;Meal&quot;, &quot;Prince&quot;, &quot;Favor&quot;, &quot;Love&quot;, &quot;Word&quot;, &quot;Scribe&quot;, &quot;Apprentice&quot;, &quot;Acolyte&quot;, &quot;Dress&quot;, &quot;Goddess&quot;, &quot;God&quot;, &quot;Gold&quot;, &quot;Purse&quot;, &quot;Trap&quot;, &quot;King&quot;, &quot;Son&quot;, &quot;Sister&quot;, &quot;Mother&quot;, &quot;Daughter&quot;, &quot;Cry&quot;, &quot;Shout&quot;, &quot;Cupboard&quot;, &quot;Pantry&quot;, &quot;Queen&quot;, &quot;Wealth&quot;, &quot;Star&quot;, &quot;Void&quot;, &quot;Woman&quot;, &quot;Man&quot;, &quot;Whore&quot;, &quot;Butcher&quot;, &quot;Anvil&quot;, &quot;Tome&quot;, &quot;Sacrifice&quot;,&quot;Armor&quot;, &quot;Cup&quot;, &quot;Pot&quot;, &quot;Stove&quot;, &quot;Stool&quot;, &quot;Princess&quot;, &quot;Chain&quot;, &quot;Sword&quot;, &quot;Pork&quot;, &quot;Grain&quot;, &quot;Tooth&quot;, &quot;Lance&quot;, &quot;Axe&quot;, &quot;Scabbard&quot;, &quot;Knife&quot;, &quot;Dagger&quot;, &quot;Spear&quot;, &quot;Bow&quot;, &quot;Crossbow&quot;, &quot;Quarterstaff&quot;, &quot;Staff&quot;, &quot;Fire&quot;, &quot;Ice&quot;, &quot;Wind&quot;, &quot;Earth&quot;, &quot;Water&quot;, &quot;Stone&quot;, &quot;Ladle&quot;, &quot;Monastery&quot;, &quot;Chalice&quot;, &quot;Goblet&quot;, &quot;Dungeon&quot;, &quot;Lust&quot;, &quot;Lantern&quot;, &quot;Bone&quot;, &quot;Life&quot;, &quot;Stone&quot;, &quot;Mistress&quot;, &quot;Mind&quot;, &quot;Treasure&quot;, &quot;Barter&quot;, &quot;Armorer&quot;, &quot;Butler&quot;, &quot;Page&quot;, &quot;Tome&quot;, &quot;Feather&quot;, &quot;Shadow&quot;, &quot;Friend&quot;, &quot;Labyrinth&quot;, &quot;Mountain&quot;, &quot;Hope&quot;, &quot;Boot&quot;, &quot;Gauntlet&quot;)&gt;&gt;
&lt;&lt;elseif _tavernnameroll is 4&gt;&gt;
	&lt;&lt;set $tavern.verb to either(&quot;Moping&quot;, &quot;Drowning&quot;, &quot;Hanging&quot;, &quot;Belching&quot;, &quot;Running&quot;, &quot;Walking&quot;, &quot;Hunting&quot;, &quot;Fighting&quot;, &quot;Swinging&quot;, &quot;Breaking&quot;, &quot;Working&quot;, &quot;Fermenting&quot;, &quot;Flowering&quot;, &quot;Worrying&quot;, &quot;Following&quot;, &quot;Flowing&quot;, &quot;Complaining&quot;, &quot;Standing&quot;, &quot;Joking&quot;, &quot;Laughing&quot;, &quot;Panting&quot;, &quot;Boarding&quot;, &quot;Lounging&quot;, &quot;Cutting&quot;, &quot;Singing&quot;, &quot;Staring&quot;, &quot;Goading&quot;, &quot;Disappointing&quot;, &quot;Faltering&quot;, &quot;Binding&quot;, &quot;Winding&quot;, &quot;Sundering&quot;, &quot;Longing&quot;, &quot;Fumbling&quot;, &quot;Bumbling&quot;, &quot;Stumbling&quot;, &quot;Pining&quot;, &quot;Whining&quot;, &quot;Flying&quot;, &quot;Hoarding&quot;, &quot;Whoring&quot;, &quot;Warring&quot;, &quot;Winking&quot;, &quot;Skittering&quot;, &quot;Slithering&quot;, &quot;Snoring&quot;, &quot;Snorting&quot;, &quot;Playing&quot;, &quot;Practicing&quot;, &quot;Grappling&quot;, &quot;Burning&quot;, &quot;Flaming&quot;, &quot;Freezing&quot;, &quot;Poisoning&quot;, &quot;Burying&quot;, &quot;Throwing&quot;, &quot;Sparking&quot;, &quot;Steaming&quot;, &quot;Smiting&quot;, &quot;Chittering&quot;, &quot;Chattering&quot;, &quot;Mumbling&quot;, &quot;Grating&quot;, &quot;Plowing&quot;, &quot;Biting&quot;, &quot;Howling&quot;, &quot;Roaring&quot;, &quot;Shouting&quot;, &quot;Pouring&quot;, &quot;Squeaking&quot;, &quot;Stinging&quot;, &quot;Charging&quot;, &quot;Bleating&quot;, &quot;Stabbing&quot;, &quot;Goring&quot;, &quot;Poking&quot;, &quot;Swallowing&quot;, &quot;Sucking&quot;, &quot;Drinking&quot;, &quot;Sneaking&quot;, &quot;Hiding&quot;, &quot;Slashing&quot;, &quot;Limping&quot;, &quot;Tripping&quot;, &quot;Shifting&quot;, &quot;Sliding&quot;, &quot;Blinding&quot;, &quot;Piercing&quot;, &quot;Bludgeoning&quot;, &quot;Crushing&quot;, &quot;Hopping&quot;, &quot;Thundering&quot;, &quot;Hushing&quot;, &quot;Crying&quot;, &quot;Wailing&quot;, &quot;Mourning&quot;, &quot;Darkening&quot;, &quot;Piling&quot;, &quot;Digging&quot;, &quot;Flinging&quot;)&gt;&gt;
&lt;&lt;elseif _tavernnameroll is 5&gt;&gt;
	&lt;&lt;set $tavern.nounC to either(&quot;Mount&quot;, &quot;Saddle&quot;, &quot;Guild&quot;, &quot;Fangs&quot;, &quot;Man&quot;, &quot;Pardon&quot;, &quot;Pleasure&quot;, &quot;Belt&quot;, &quot;Staff&quot;, &quot;Shield&quot;, &quot;Prince&quot;, &quot;Master&quot;, &quot;Servant&quot;, &quot;Meal&quot;, &quot;Prince&quot;, &quot;Favor&quot;, &quot;Love&quot;, &quot;Word&quot;, &quot;Scribe&quot;, &quot;Apprentice&quot;, &quot;Acolyte&quot;, &quot;Dress&quot;, &quot;Goddess&quot;, &quot;God&quot;, &quot;Gold&quot;, &quot;Purse&quot;, &quot;Trap&quot;, &quot;King&quot;, &quot;Son&quot;, &quot;Sister&quot;, &quot;Mother&quot;, &quot;Daughter&quot;, &quot;Cry&quot;, &quot;Shout&quot;, &quot;Cupboard&quot;, &quot;Pantry&quot;, &quot;Queen&quot;, &quot;Wealth&quot;, &quot;Star&quot;, &quot;Void&quot;, &quot;Woman&quot;, &quot;Man&quot;, &quot;Whore&quot;, &quot;Butcher&quot;, &quot;Anvil&quot;, &quot;Tome&quot;, &quot;Sacrifice&quot;,&quot;Armor&quot;, &quot;Cup&quot;, &quot;Pot&quot;, &quot;Stove&quot;, &quot;Stool&quot;, &quot;Princess&quot;, &quot;Chain&quot;, &quot;Sword&quot;, &quot;Pork&quot;, &quot;Grain&quot;, &quot;Tooth&quot;, &quot;Lance&quot;, &quot;Axe&quot;, &quot;Scabbard&quot;, &quot;Knife&quot;, &quot;Dagger&quot;, &quot;Spear&quot;, &quot;Bow&quot;, &quot;Crossbow&quot;, &quot;Quarterstaff&quot;, &quot;Staff&quot;, &quot;Fire&quot;, &quot;Ice&quot;, &quot;Wind&quot;, &quot;Earth&quot;, &quot;Water&quot;, &quot;Stone&quot;, &quot;Ladle&quot;, &quot;Monastery&quot;, &quot;Chalice&quot;, &quot;Goblet&quot;, &quot;Dungeon&quot;, &quot;Lust&quot;, &quot;Lantern&quot;, &quot;Bone&quot;, &quot;Life&quot;, &quot;Stone&quot;, &quot;Mistress&quot;, &quot;Mind&quot;, &quot;Treasure&quot;, &quot;Barter&quot;, &quot;Armorer&quot;, &quot;Butler&quot;, &quot;Page&quot;, &quot;Tome&quot;, &quot;Feather&quot;, &quot;Shadow&quot;, &quot;Friend&quot;, &quot;Labyrinth&quot;, &quot;Mountain&quot;, &quot;Hope&quot;, &quot;Boot&quot;, &quot;Gauntlet&quot;), $tavern.verb to either(&quot;Moping&quot;, &quot;Drowning&quot;, &quot;Hanging&quot;, &quot;Belching&quot;, &quot;Running&quot;, &quot;Walking&quot;, &quot;Hunting&quot;, &quot;Fighting&quot;, &quot;Swinging&quot;, &quot;Breaking&quot;, &quot;Working&quot;, &quot;Fermenting&quot;, &quot;Flowering&quot;, &quot;Worrying&quot;, &quot;Following&quot;, &quot;Flowing&quot;, &quot;Complaining&quot;, &quot;Standing&quot;, &quot;Joking&quot;, &quot;Laughing&quot;, &quot;Panting&quot;, &quot;Boarding&quot;, &quot;Lounging&quot;, &quot;Cutting&quot;, &quot;Singing&quot;, &quot;Staring&quot;, &quot;Goading&quot;, &quot;Disappointing&quot;, &quot;Faltering&quot;, &quot;Binding&quot;, &quot;Winding&quot;, &quot;Sundering&quot;, &quot;Longing&quot;, &quot;Fumbling&quot;, &quot;Bumbling&quot;, &quot;Stumbling&quot;, &quot;Pining&quot;, &quot;Whining&quot;, &quot;Flying&quot;, &quot;Hoarding&quot;, &quot;Whoring&quot;, &quot;Warring&quot;, &quot;Winking&quot;, &quot;Skittering&quot;, &quot;Slithering&quot;, &quot;Snoring&quot;, &quot;Snorting&quot;, &quot;Playing&quot;, &quot;Practicing&quot;, &quot;Grappling&quot;, &quot;Burning&quot;, &quot;Flaming&quot;, &quot;Freezing&quot;, &quot;Poisoning&quot;, &quot;Burying&quot;, &quot;Throwing&quot;, &quot;Sparking&quot;, &quot;Steaming&quot;, &quot;Smiting&quot;, &quot;Chittering&quot;, &quot;Chattering&quot;, &quot;Mumbling&quot;, &quot;Grating&quot;, &quot;Plowing&quot;, &quot;Biting&quot;, &quot;Howling&quot;, &quot;Roaring&quot;, &quot;Shouting&quot;, &quot;Pouring&quot;, &quot;Squeaking&quot;, &quot;Stinging&quot;, &quot;Charging&quot;, &quot;Bleating&quot;, &quot;Stabbing&quot;, &quot;Goring&quot;, &quot;Poking&quot;, &quot;Swallowing&quot;, &quot;Sucking&quot;, &quot;Drinking&quot;, &quot;Sneaking&quot;, &quot;Hiding&quot;, &quot;Slashing&quot;, &quot;Limping&quot;, &quot;Tripping&quot;, &quot;Shifting&quot;, &quot;Sliding&quot;, &quot;Blinding&quot;, &quot;Piercing&quot;, &quot;Bludgeoning&quot;, &quot;Crushing&quot;, &quot;Hopping&quot;, &quot;Thundering&quot;, &quot;Hushing&quot;, &quot;Crying&quot;, &quot;Wailing&quot;, &quot;Mourning&quot;, &quot;Darkening&quot;, &quot;Piling&quot;, &quot;Digging&quot;, &quot;Flinging&quot;)&gt;&gt;
&lt;&lt;/if&gt;&gt;

/* ---------------------- TAVERN NAMEROLL CODE ----------------------- */

&lt;&lt;switch _tavernnameroll&gt;&gt;
	&lt;&lt;case 1&gt;&gt;
		&lt;&lt;set $tavern.name to &quot;The &quot; + $tavern.adjective + &quot; &quot; + $tavern.nounA&gt;&gt;
	&lt;&lt;case 2&gt;&gt;
    	&lt;&lt;set $tavern.name to &quot;The &quot; + $tavern.nounA + &quot; and &quot; + $tavern.nounB&gt;&gt;
	&lt;&lt;case 3&gt;&gt;
		&lt;&lt;set $tavern.name to &quot;The &quot; + $tavern.nounA + &quot; and the &quot; + $tavern.nounB&gt;&gt;
	&lt;&lt;case 4&gt;&gt;
    	&lt;&lt;set $tavern.name to &quot;The &quot; + $tavern.verb + &quot; &quot; + $tavern.nounA&gt;&gt;
	&lt;&lt;case 5&gt;&gt;
    	&lt;&lt;set $tavern.name to &quot;The &quot; + $tavern.verb + &quot; &quot; + $tavern.nounA + &quot; and the &quot; + $tavern.nounC&gt;&gt;
&lt;&lt;default&gt;&gt;
    &lt;&lt;set $tavern.name to &quot;The &quot; + $tavern.nounA + &quot; Inn&quot;&gt;&gt;
&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="73" name="TavernRenders" tags="render" position="350,975">&lt;&lt;nobr&gt;&gt;
/* ------------------------- WEALTH -------------------------- */
&lt;&lt;if $tavern.wealthroll gt 95&gt;&gt;
		&lt;&lt;set $tavern.wealth to &quot;kingly&quot;&gt;&gt;
	&lt;&lt;elseif $tavernwealthroll gt 80&gt;&gt;
		&lt;&lt;set $tavern.wealth to &quot;aristocratic&quot;&gt;&gt;
	&lt;&lt;elseif $tavernwealthroll gt 70&gt;&gt;
		&lt;&lt;set $tavern.wealth to &quot;wealthy&quot;&gt;&gt;
	&lt;&lt;elseif $tavernwealthroll gt 60&gt;&gt;
		&lt;&lt;set $tavern.wealth to &quot;comfortable&quot;&gt;&gt;
	&lt;&lt;elseif $tavernwealthroll gt 50&gt;&gt;
		&lt;&lt;set $tavern.wealth to &quot;modest&quot;&gt;&gt;
	&lt;&lt;elseif $tavernwealthroll gt 25&gt;&gt;
		&lt;&lt;set $tavern.wealth to &quot;poor&quot;&gt;&gt;
	&lt;&lt;elseif $tavernwealthroll lte 25&gt;&gt;
		&lt;&lt;set $tavern.wealth to &quot;squalid&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;switch $tavern.wealth&gt;&gt;
	&lt;&lt;case &quot;kingly&quot;&gt;&gt;
		&lt;&lt;set $tavern.lodging to 800, $tavern.food to 400&gt;&gt;
&lt;&lt;case &quot;aristocratic&quot;&gt;&gt;
		&lt;&lt;set $tavern.lodging to 400, $tavern.food to 200&gt;&gt;
&lt;&lt;case &quot;wealthy&quot;&gt;&gt;
		&lt;&lt;set $tavern.lodging to 200, $tavern.food to 80&gt;&gt;
&lt;&lt;case &quot;comfortable&quot;&gt;&gt;
		&lt;&lt;set $tavern.lodging to 50, $tavern.food to 40&gt;&gt;
&lt;&lt;case &quot;modest&quot;&gt;&gt;
		&lt;&lt;set $tavern.lodging to 30, $tavern.food to 30&gt;&gt;
&lt;&lt;case &quot;poor&quot;&gt;&gt;
		&lt;&lt;set $tavern.lodging to 10, $tavern.food to 6&gt;&gt;
&lt;&lt;case &quot;squalid&quot;&gt;&gt;
		&lt;&lt;set $tavern.lodging to 7, $tavern.food to 3&gt;&gt;
&lt;&lt;/switch&gt;&gt;

/* ------------------------- SIZE -------------------------- */
&lt;&lt;if $tavern.sizeroll gt 80&gt;&gt;
		&lt;&lt;set $tavern.size to &quot;huge&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.sizeroll gt 60&gt;&gt;
		&lt;&lt;set $tavern.size to &quot;large&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.sizeroll gt 40&gt;&gt;
		&lt;&lt;set $tavern.size to &quot;medium&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.sizeroll gt 20&gt;&gt;
		&lt;&lt;set $tavern.size to &quot;small&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.sizeroll lte 20&gt;&gt;
		&lt;&lt;set $tavern.size to &quot;tiny&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;

/* ------------------------- ROUGHNESS -------------------------- */

	&lt;&lt;if $tavern.roughnessroll gt 80&gt;&gt;
		&lt;&lt;set $tavern.roughness to &quot;bloodthirsty&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.roughnessroll gt 60&gt;&gt;
		&lt;&lt;set $tavern.roughness to &quot;rough&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.roughnessroll gt 50&gt;&gt;
		&lt;&lt;set $tavern.roughness to &quot;alright&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.roughnessroll gt 40&gt;&gt;
		&lt;&lt;set $tavern.roughness to &quot;placid&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.roughnessroll gt 30&gt;&gt;
		&lt;&lt;set $tavern.roughness to &quot;calm&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.roughnessroll gt 20&gt;&gt;
		&lt;&lt;set $tavern.roughness to &quot;tranquil&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.roughnessroll lte 20&gt;&gt;
		&lt;&lt;set $tavern.roughness to &quot;utterly serene&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;

/* ------------------------- CLEANLINESS -------------------------- */

	&lt;&lt;if $tavern.cleanlinessroll gt 80&gt;&gt;
		&lt;&lt;set $tavern.cleanliness to &quot;absolutely spotless&quot;, $tavern.bedcleanliness to &quot;perfectly prepared, with fresh sheets and a lemon scent in the air of the room&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.cleanlinessroll gt 70&gt;&gt;
		&lt;&lt;set $tavern.cleanliness to &quot;spotless&quot;, $tavern.bedcleanliness to &quot;freshly cleaned and neat&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.cleanlinessroll gt 60&gt;&gt;
		&lt;&lt;set $tavern.cleanliness to &quot;hygienic&quot;, $tavern.bedcleanliness to &quot;tidy and neat&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.cleanlinessroll gt 50&gt;&gt;
		&lt;&lt;set $tavern.cleanliness to &quot;decently hygienic&quot;, $tavern.bedcleanliness to &quot;reasonably clean&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.cleanlinessroll gt 40&gt;&gt;
		&lt;&lt;set $tavern.cleanliness to &quot;slightly grubby&quot;, $tavern.bedcleanliness to &quot;somewhat tidy&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.cleanlinessroll gt 30&gt;&gt;
		&lt;&lt;set $tavern.cleanliness to &quot;quite dirty&quot;, $tavern.bedcleanliness to &quot;disgusting&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.cleanlinessroll gt 20&gt;&gt;
		&lt;&lt;set $tavern.cleanliness to &quot;rather filthy&quot;, $tavern.bedcleanliness to &quot;teeming with rats&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.cleanlinessroll lte 20&gt;&gt;
		&lt;&lt;set $tavern.cleanliness to &quot;absolutely putrid&quot;, $tavern.bedcleanliness to &quot;festering with bugs&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;


/* ------------------------- SIN -------------------------- */

	&lt;&lt;if $tavern.sinroll gt 80&gt;&gt;
		&lt;&lt;set $tavern.sin to &quot;corrupt&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.sinroll gt 70&gt;&gt;
		&lt;&lt;set $tavern.sin to &quot;venal&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.sinroll gt 60&gt;&gt;
		&lt;&lt;set $tavern.sin to &quot;sleazy&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.sinroll gt 50&gt;&gt;
		&lt;&lt;set $tavern.sin to &quot;seedy&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.sinroll gt 40 &amp;&amp; $tavern.roughness gt 60&gt;&gt;
		&lt;&lt;set $tavern.sin to &quot;surprisingly trustworthy&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.sinroll gt 40&gt;&gt;
		&lt;&lt;set $tavern.sin to &quot;trustworthy&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.sinroll gt 30 &amp;&amp; $tavern.roughness gt 60&gt;&gt;
		&lt;&lt;set $tavern.sin to &quot;surprisingly reliable&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.sinroll gt 30&gt;&gt;
		&lt;&lt;set $tavern.sin to &quot;reliable&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.sinroll lte 20 &amp;&amp; $tavern.roughness gt 60&gt;&gt;
		&lt;&lt;set $tavern.sin to &quot;surprisingly honest&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.sinroll lte 20&gt;&gt;
		&lt;&lt;set $tavern.sin to &quot;honest&quot;&gt;&gt;
	&lt;&lt;else&gt;&gt;
		&lt;&lt;set $tavern.sin to &quot;reasonably trustworthy&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;


/* ------------------------- DIVERSITY -------------------------- */

	&lt;&lt;if $tavern.diversityroll gt 80&gt;&gt;
		&lt;&lt;set $tavern.diversity to &quot;a very diverse crowd, with no clear majority of one race&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.diversityroll gt 70 &amp;&amp; $tavern.roughnessroll gt 70&gt;&gt;
		&lt;&lt;set $tavern.diversity to &quot;a rather diverse crowd, the only common factor being their love of weaponry&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.diversityroll gt 70&gt;&gt;
		&lt;&lt;set $tavern.diversity to &quot;a rather diverse crowd&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.diversityroll gt 60&gt;&gt;
		&lt;&lt;set $tavern.diversity to &quot;a pretty diverse crowd, the majority being $bartender.raceplural&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.diversityroll gt 50&gt;&gt;
		&lt;&lt;set $tavern.diversity to &quot;a relatively diverse crowd, the majority being $bartender.raceplural&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.diversityroll gt 40&gt;&gt;
		&lt;&lt;set $tavern.diversity to &quot;a pretty diverse crowd, most being $bartender.raceplural&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.diversityroll gt 30 &amp;&amp; $tavern.roughnessroll gt 70&gt;&gt;
		&lt;&lt;set $tavern.diversity to &quot;$bartender.raceplural, mostly, and it&#39;s clear that they like it that way&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.diversityroll gt 30&gt;&gt;
		&lt;&lt;set $tavern.diversity to &quot;$bartender.raceplural for the most part&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.diversityroll gt 20 &amp;&amp; $tavern.roughnessroll gt 70&gt;&gt;
		&lt;&lt;set $tavern.diversity to &quot;mostly $bartender.raceplural, and it&#39;s very obvious that they like it that way&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.diversityroll gt 20&gt;&gt;
		&lt;&lt;set $tavern.diversity to &quot;mostly $bartender.raceplural&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.diversityroll lte 20 &amp;&amp; $tavern.roughnessroll gt 70&gt;&gt;
		&lt;&lt;set $tavern.diversity to &quot;almost all $bartender.raceplural, and they are extremely hostile to non-$bartender.raceplural&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.diversityroll lte 20&gt;&gt;
		&lt;&lt;set $tavern.diversity to &quot;next to all are $bartender.raceplural&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;


/* ------------------------- REPUTATION -------------------------- */

&lt;&lt;if $tavern.reputationroll gt 80&gt;&gt;
		&lt;&lt;set $tavern.reputation to &quot;famous&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.reputationroll gt 60&gt;&gt;
		&lt;&lt;set $tavern.reputation to &quot;well known&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.reputationroll gt 40&gt;&gt;
		&lt;&lt;set $tavern.reputation to &quot;famous-ish&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.reputationroll gt 20&gt;&gt;
		&lt;&lt;set $tavern.reputation to &quot;reviled&quot;&gt;&gt;
	&lt;&lt;elseif $tavern.reputationroll lte 20&gt;&gt;
		&lt;&lt;set $tavern.reputation to &quot;infamous&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/nobr&gt;&gt;</tw-passagedata><tw-passagedata pid="74" name="Bonds" tags="" position="475,975">&lt;&lt;set $bond to [&quot;I would die to recover an ancient artifact of my faith that was lost long ago.&quot;,
&quot;I will someday get revenge on the corrupt temple hierarchy who branded me a heretic.&quot;,
&quot;I owe me life to the priest &lt;&lt;print $name.man.pluck()&gt;&gt; who took me in when my parents died.&quot;,
&quot;Everything I do is for the common people.&quot;,
&quot;I will do anything to protect the temple where I served.&quot;,
&quot;I seek to preserve a sacred text that my enemies consider heretical and seek to destroy.&quot;,
&quot;I fleeced the wrong person, a lord called &lt;&lt;print $name.man.pluck()&gt;&gt;, and must work to ensure that he never crosses paths with me or those I care about.&quot;,
&quot;I owe everything to my mentor &lt;&lt;print $name.man.pluck()&gt;&gt;--a horrible person who&#39;s probably rotting in jail somewhere.&quot;,
&quot;Somewhere out there I have a child, litte &lt;&lt;print $name.man.pluck()&gt;&gt;, who doesn&#39;t know me. I&#39;m going to try and make the world better for him.&quot;,
&quot;I come from a noble family, and one day I&#39;ll reclaim my lands and title from those who stole them from me.&quot;,
&quot;A powerful person, Lord &lt;&lt;print $name.man.pluck()&gt;&gt;, killed someone I love. Some day soon, I&#39;ll have my revenge.&quot;,
&quot;I swindled and ruined a person who didn&#39;t deserve it, and now I seek to atone for my misdeeds but might never be able to forgive myself.&quot;,
&quot;I&#39;m trying to pay off an old debt I owe to a generous benefactor.&quot;,
&quot;My ill-gotten gains go to support my family.&quot;,
&quot;Something important was taken from me, and I aim to steal it back.&quot;,
&quot;I will become the greatest thief that ever lived.&quot;,
&quot;I&#39;m guilty of a terrible crime. I hope I can redeem myself for it.&quot;,
&quot;Someone I loved died because of a mistake I made. That will never happen again.&quot;,
&quot;My instrument is my most treasured possession, and it reminds me of someone I love.&quot;,
&quot;Someone stole my precious instrument, and someday I&#39;ll get it back.&quot;,
&quot;I want to be famous, whatever it takes.&quot;,
&quot;I idolize a hero of the old tales and measure my deeds against that person&#39;s.&quot;,
&quot;I will do anything to prove myself superior to my hated rival.&quot;,
&quot;I would do anything for the other members of my old party.&quot;,
&quot;I have a family, but I have no idea where they are.  One day, I hope to see them again.&quot;,
&quot;I worked the land, I love the land, and I will protect the land.&quot;,
&quot;A proud noble once gave me a horrible beating, and I will take my revenge on any bully I encounter.&quot;,
&quot;My tools are symbols of my past life, and I carry them so that I will never forget my roots.&quot;,
&quot;I protect those who cannot protect themselves.&quot;,
&quot;I wish my childhood sweetheart had come with me to pursue my destiny.&quot;,
&quot;The workshop where I learned my trade is the most important place in the world to me.&quot;,
&quot;I created a great work for someone, and then found them unworthy to receive it; I&#39;m still looking for someone worthy.&quot;,
&quot;I owe my guild a great debt for forging me into the person I am today.&quot;,
&quot;I pursue wealth to secure someone&#39;s love.&quot;,
&quot;One day I will return to my guild and prove that I am the greatest artisan of them all.&quot;,
&quot;I will get revenge on the evil forces that destroyed my place of business and ruined my livelihood.&quot;,
&quot;Nothing is more important than the other members of my hermitage, order, or association.&quot;,
&quot;I entered seclusion to hide from the ones who might still be hunting me. I must someday confront them.&quot;,
&quot;I&#39;m still seeking the enlightenment I pursued in my seclusion, and it still eludes me.&quot;,
&quot;I entered seclusion because I loved someone I could not have.&quot;,
&quot;Should my discovery come to light, it could bring ruin to the world.&quot;,
&quot;My isolation gave me great insight into a great evil that only I can destroy.&quot;,
&quot;I will face any challenge to win the approval of my family.&quot;,
&quot;My house&#39;s alliance with another noble family must be sustained at all costs.&quot;,
&quot;Nothing is more important that the other members of my family.&quot;,
&quot;I am in love with the heir of a family that my family despises.&quot;,
&quot;My loyalty to my sovereign is unwavering.&quot;,
&quot;The common folk must see me as a hero of the people.&quot;,
&quot;My family, clan, or tribe is the most important thing in my life, even when they are far from me.&quot;,
&quot;An injury to the unspoiled wilderness of my home is an injury to me.&quot;,
&quot;I will bring terrible wrath down on the evildoers who destroyed my homeland.&quot;,
&quot;I am the last of my tribe, and it is up to me to ensure their names enter legend.&quot;,
&quot;I suffer awful visions of a coming disaster and will do anything to prevent it.&quot;,
&quot;It is my duty to provide children to sustain my tribe.&quot;,
&quot;It is my duty to protect my students.&quot;,
&quot;I have an ancient text that holds terrible secrets that must not fall into the wrong hands.&quot;,
&quot;I work to preserve a library, university, scriptorium, or monastery.&quot;,
&quot;My life&#39;s work is a series of tomes related to a specific field of lore.&quot;,
&quot;I&#39;ve been searching my whole life for the answer to a certain question.&quot;,
&quot;I sold my soul for knowledge; I hope to do great deeds and win it back.&quot;,
&quot;I&#39;m loyal to my captain first, everything else second.&quot;,
&quot;The ship is most important--crewmates and captains come and go.&quot;,
&quot;I&#39;ll always remember my first ship.&quot;,
&quot;In a harbor town, I have a paramour whose eyes nearly stole me from the sea.&quot;,
&quot;I was cheated of my fair share of the profits, and I want to get my due.&quot;,
&quot;Ruthless pirates murdered my captain and crewmates, plundered our ship, and left me to die. Vengeance will be mine.&quot;,
&quot;I would lay down my life for the people I served with.&quot;,
&quot;Someone saved my life on the battlefield. To this day, I will never leave a friend behind.&quot;,
&quot;My honor is my life.&quot;,
&quot;I&#39;ll never forget the crushing defeat my company suffered or the enemies who dealt it.&quot;,
&quot;Those who fight beside me are those worth dying for.&quot;,
&quot;I fight for those who cannot fight for themselves.&quot;,
&quot;My town or city is my home, and I&#39;ll fight to defend it.&quot;,
&quot;I sponsor an orphanage to keep others from enduring what I was forced to endure.&quot;,
&quot;I owe my survival to another urchin who taught me to live on the streets.&quot;,
&quot;I owe a debt I can never repay to the person who took pity on me.&quot;,
&quot;I escaped my life of poverty by robbing an important person, and I&#39;m wanted for it.&quot;,
&quot;No one else is going to have to endure the hardships I&#39;ve been through.&quot;]&gt;&gt;</tw-passagedata><tw-passagedata pid="75" name="Building" tags="" position="600,975">&lt;&lt;set $building to {
  	material: [&quot;wooden&quot;, &quot;wooden&quot;, &quot;wooden&quot;, &quot;wooden&quot;, &quot;wooden&quot;, &quot;stone&quot;, &quot;stone&quot;, &quot;stone&quot;, &quot;stone&quot;, &quot;hewn rock&quot;, &quot;chiseled stone&quot;],
    outside: [&quot;a horse grazing on the bushes nearby&quot;, &quot;a rusted shovel near a somewhat overgrown flowerbed&quot;, &quot;a well with an old rope, but no bucket to go on the end&quot;, &quot;a dog panting by the door&quot;, &quot;a cat lazily lounging in the shade&quot;, &quot;a muddy pair of boots by the door&quot;, &quot;a sign from the local paper which reads &#39;$newspaperheadline&#39;&quot;],
    disrepair: [&quot;dilapidated&quot;, &quot;ruined&quot;, &quot;old&quot;, &quot;somewhat rickety&quot;, &quot;well-loved&quot;, &quot;well-kept&quot;, &quot;brand new&quot;],
    purpose: [&quot;home&quot;, &quot;barber&quot;, &quot;alchemist&#39;s shop&quot;, &quot;blacksmithery&quot;, &quot;temple&quot;, &quot;tannery&quot;, &quot;butchery&quot;, &quot;library&quot;]
}&gt;&gt;</tw-passagedata><tw-passagedata pid="76" name="Counter" tags="" position="725,975">&lt;&lt;set $npccounter to [$bartender, $blacksmith]&gt;&gt;
&lt;&lt;set $buildingcounter to [$tavern, $smithy]&gt;&gt;</tw-passagedata><tw-passagedata pid="77" name="Environment" tags="" position="850,975">&lt;&lt;set $environment to {

}&gt;&gt;</tw-passagedata><tw-passagedata pid="78" name="NPC" tags="" position="975,975">/* Legacy code */
&lt;&lt;set $npc to {
	lastname: $name.last.pluck(),
	gender: [&quot;man&quot;, &quot;woman&quot;],
	race: [&quot;human&quot;, &quot;human&quot;, &quot;human&quot;, &quot;human&quot;, &quot;human&quot;, &quot;human&quot;, &quot;half-elf&quot;, &quot;half-elf&quot;, &quot;elf&quot;, &quot;elf&quot;, &quot;dwarf&quot;, &quot;dwarf&quot;, &quot;gnome&quot;, &quot;halfling&quot;, &quot;half-orc&quot;, &quot;dragonborn&quot;, &quot;tiefling&quot;],
	age: [&quot;childlike&quot;, &quot;rather young&quot;, &quot;eighteen year old&quot;, &quot;surprisingly young&quot;, &quot;relatively young&quot;, &quot;relatively young&quot;, &quot;middle aged&quot;, &quot;middle aged&quot;, &quot;middle aged&quot;, &quot;middle aged&quot;, &quot;mid aged&quot;, &quot;relatively old&quot;, &quot;sun wizened&quot;, &quot;quite old&quot;, &quot;ancient&quot;],
	height: [&quot;tiny&quot;, &quot;short&quot;, &quot;slightly below average height&quot;, &quot;rather average height&quot;, &quot;slightly above average height&quot;, &quot;tall&quot;, &quot;tall&quot;, &quot;tall&quot;, &quot;giraffe-like&quot;],
	weight: [&quot;waif-like&quot;, &quot;thin&quot;, &quot;skinny&quot;, &quot;skinny&quot;, &quot;wiry&quot;, &quot;thin&quot;, &quot;stocky&quot;, &quot;beefy&quot;, &quot;muscular&quot;, &quot;slightly underweight&quot;, &quot;slightly overweight&quot;, &quot;slightly overweight&quot;, &quot;round&quot;, &quot;tubby&quot;, &quot;portly&quot;],
	haircolour: [&quot;brunette&quot;, &quot;brunette&quot;, &quot;brown&quot;, &quot;brownish&quot;, &quot;muddy&quot;, &quot;blonde&quot;, &quot;blonde&quot;, &quot;white&quot;, &quot;black&quot;, &quot;black&quot;],
	hairtype: [&quot;thick&quot;, &quot;wispy&quot;, &quot;straight&quot;, &quot;straight&quot;, &quot;wavy&quot;, &quot;wavy&quot;, &quot;curly&quot;, &quot;wiry&quot;, &quot;oily&quot;, &quot;lush&quot;, &quot;poofy&quot;, &quot;long&quot;, &quot;braided&quot;, &quot;very long&quot;, &quot;greasy&quot;, &quot;unruly&quot;, &quot;unusually styled&quot;, &quot;short cropped hair&quot;, &quot;a shaved head&quot;],
	scar: [&quot;a jagged scar&quot;, &quot;a dark purple scar&quot;, &quot;an angry red scar&quot;, &quot;a long, thin scar running up the arm&quot;, &quot;a scar on the eye&quot;, &quot;a scar around the neck&quot;, &quot;a scar on the throat&quot;, &quot;a fiery red scar&quot;, &quot;a finger missing&quot;, &quot;two fingers missing&quot;],
	tattoo: [&quot;a dagger tattoo&quot;, &quot;an arrow tattoo&quot;, &quot;an anchor tattoo&quot;, &quot;a skull tattoo&quot;, &quot;a pair of crossed bones tattoo&quot;, &quot;a snake tattoo&quot;, &quot;a scorpion tattoo&quot;, &quot;a spider web tattoo&quot;, &quot;a heart tattoo&quot;, &quot;a ring of thorns tattoo&quot;, &quot;a mermaid tattoo&quot;, &quot;a dragon tattoo&quot;],
	class: [&quot;barbarian&quot;, &quot;bard&quot;, &quot;cleric&quot;, &quot;druid&quot;, &quot;fighter&quot;, &quot;monk&quot;, &quot;rogue&quot;, &quot;ranger&quot;, &quot;paladin&quot;, &quot;sorcerer&quot;, &quot;warlock&quot;, &quot;wizard&quot;],
	profession: [&quot;Actor&quot;, &quot;Advocate&quot;, &quot;Advisor&quot;, &quot;Animal handler&quot;, &quot;Apothecary&quot;, &quot;Architect&quot;, &quot;Archivist&quot;, &quot;Armorer&quot;, &quot;Astrologer&quot;, &quot;Baker&quot;, &quot;Banker&quot;, &quot;Barber&quot;, &quot;Barkeep&quot;, &quot;Blacksmith&quot;, &quot;Bookseller&quot;, &quot;Brewer&quot;, &quot;Bricklayer&quot;, &quot;Brothel keeper&quot;, &quot;Buccaneer&quot;, &quot;Butcher&quot;, &quot;Caravanner&quot;, &quot;Carpenter&quot;, &quot;Cartographer&quot;, &quot;Chandler&quot;, &quot;Chef&quot;, &quot;Clock maker&quot;, &quot;Cobbler&quot;, &quot;Cook&quot;, &quot;Counselor&quot;, &quot;Courtesan&quot;, &quot;Courtier&quot;, &quot;Cowherd&quot;, &quot;Dancer&quot;, &quot;Diplomat&quot;, &quot;Distiller&quot;, &quot;Diver&quot;, &quot;Farmer&quot;, &quot;Fisherman&quot;, &quot;Fishmonger&quot;, &quot;Gardener&quot;, &quot;General&quot;, &quot;Gladiator&quot;, &quot;Glovemaker&quot;, &quot;Goldsmith&quot;, &quot;Grocer&quot;, &quot;Guardsman&quot;, &quot;Guildmaster&quot;, &quot;Hatmaker&quot;, &quot;Healer&quot;, &quot;Herald&quot;, &quot;Herbalist&quot;, &quot;Hermit&quot;, &quot;Historian&quot;, &quot;Hunter&quot;, &quot;Ice seller&quot;, &quot;Innkeeper&quot;, &quot;Inventor&quot;, &quot;Jailer&quot;, &quot;Jester&quot;, &quot;Jeweler&quot;, &quot;Judge&quot;, &quot;Knight&quot;, &quot;Lady&quot;, &quot;Leatherworker&quot;, &quot;Librarian&quot;, &quot;Linguist&quot;, &quot;Locksmith&quot;, &quot;Lord&quot;, &quot;Lumberjack&quot;, &quot;Mason&quot;, &quot;Masseur&quot;, &quot;Merchant&quot;, &quot;Messenger&quot;, &quot;Midwife&quot;, &quot;Miller&quot;, &quot;Miner&quot;, &quot;Minister&quot;, &quot;Minstrel&quot;, &quot;Monk&quot;, &quot;Mortician&quot;, &quot;Necromancer&quot;, &quot;Noble&quot;, &quot;Nun&quot;, &quot;Nurse&quot;, &quot;Officer&quot;, &quot;Painter&quot;, &quot;Patissier&quot;, &quot;Perfumer&quot;, &quot;Philosopher&quot;, &quot;Physician&quot;, &quot;Pilgrim&quot;, &quot;Potter&quot;, &quot;Priest&quot;, &quot;Privateer&quot;, &quot;Professor&quot;, &quot;Roofer&quot;, &quot;Ropemaker&quot;, &quot;Rugmaker&quot;, &quot;Saddler&quot;, &quot;Sailor&quot;, &quot;Scabbard maker&quot;, &quot;Sculptor&quot;, &quot;Scavenger&quot;, &quot;Scholar&quot;, &quot;Seamstress&quot;, &quot;Servant&quot;, &quot;Shaman&quot;, &quot;Shepherd&quot;, &quot;Ship&#39;s captain&quot;, &quot;Silversmith&quot;, &quot;Slave&quot;, &quot;Slaver&quot;, &quot;Smith&quot;, &quot;Soldier&quot;, &quot;Spice Merchant&quot;, &quot;Squire&quot;, &quot;Stablehand&quot;, &quot;Stevedore&quot;, &quot;Stonemason&quot;, &quot;Steward&quot;, &quot;Street seller&quot;, &quot;Street sweeper&quot;, &quot;Student&quot;, &quot;Surgeon&quot;, &quot;Surveyor&quot;, &quot;Sailor&quot;, &quot;Tanner&quot;, &quot;Tavernkeeper&quot;, &quot;Tax collector&quot;, &quot;Teacher&quot;, &quot;Thatcher&quot;, &quot;Thief&quot;, &quot;Torturer&quot;, &quot;Town crier&quot;, &quot;Toymaker&quot;, &quot;Vendor&quot;, &quot;Veterinarian&quot;, &quot;Vintner&quot;, &quot;Weaver&quot;, &quot;Wetnurse&quot;, &quot;Woodcarver&quot;, &quot;Wood seller&quot;, &quot;Wrestler&quot;, &quot;Writer&quot;],
	trait: [&quot;fidgets&quot;, &quot;drinks too much&quot;, &quot;eats too much&quot;, &quot;swears often&quot;, &quot;has poor hygiene&quot;, &quot;cannot resist flirting&quot;, &quot;cannot stop staring at you&quot;, &quot;sweats profusely and easily&quot;, &quot;is a habitual liar&quot;, &quot;embellishes the truth&quot;, &quot;exaggerates details&quot;, &quot;has a short temper&quot;, &quot;is melodramatic&quot;, &quot;gossips about the most mundane things&quot;, &quot;cannot resist a juicy secret&quot;, &quot;chews with an open mouth&quot;, &quot;often sniffs audibly&quot;, &quot;is incredibly gullible&quot;, &quot;is skeptical of everything&quot;, &quot;paces about incessantly&quot;, &quot;makes poor eye contact&quot;],
	currentmood: [&quot;annoyed&quot;, &quot;scared&quot;, &quot;relaxed&quot;, &quot;concerned&quot;, &quot;bemused&quot;, &quot;stressed&quot;, &quot;amused&quot;, &quot;content&quot;, &quot;distracted&quot;],
	idle: [&quot;sitting, with a piece of bread in hand&quot;, &quot;sitting, mug in hand&quot;, &quot;poring over some map&quot;, &quot;reading some letter intently&quot;, &quot;reading a book&quot;, &quot;shuffling a pack of cards&quot;, &quot;chewing on a piece of hay&quot;, &quot;sharpening a knife&quot;, &quot;buffing a piece of armour&quot;, &quot;polishing a shield&quot;, &quot;sharpening the blade on a fearsome looking dagger&quot;, &quot;cutting an apple into bite sized pieces&quot;, &quot;biting into an apple&quot;, &quot;eating an apple while looking at some book&quot;, &quot;eating a hunk of cheese while reading a book&quot;, &quot;sipping out of a huge mug while reading a book&quot;],
	reading: [&quot;a piece of history- my forefather&#39;s journal, detailing his life in $town.name when it was just a settlement.&quot;, &quot;my journal, from many years ago.&quot;, &quot;my mother&#39;s journal, from just before she disappeared&quot;, &quot;a document which I received by postboy two days ago... I believe it is in code, and somebody is trying to tell me something.&quot;, &quot;a traitor&#39;s memoirs, extremely rare... I thought it would be a good laugh, but some of what he says is concerningly accurate.&quot;, &quot;some sort of spell, though I don&#39;t know how to read it.&quot;, &quot;a document I bought at the flea market; it looks to be a set of instructions on how to make a golem.&quot;, &quot;a book which I bought, believing it to be blank, and suitable for a journal. However, now there&#39;s this strange foreign script that I can&#39;t read in it.&quot;, &quot;a book that I bought as a gift for my mother, who loves beautiful covers, despite not being able to read.&quot;, &quot;a supposedly blank book, but every time I open it, different words appear in a strange language.&quot;]
}&gt;&gt;

&lt;&lt;set $lord to setup.createNPC()&gt;&gt;</tw-passagedata><tw-passagedata pid="79" name="Names" tags="" position="1100,975">/* ------------------------- NAMES -------------------------- */
&lt;&lt;set $name to {
	last: [&quot;Alder&quot;, &quot;Ash&quot;, &quot;Ashdown&quot;, &quot;Atwood&quot;, &quot;Barnes&quot;, &quot;Becker&quot;, &quot;Berry&quot;, &quot;Briar&quot;, &quot;Briggs&quot;, &quot;Brock&quot;, &quot;Brook&quot;, &quot;Bundy&quot;, &quot;Burnside&quot;, &quot;Burroughs&quot;, &quot;Bush&quot;, &quot;Butcher&quot;, &quot;Butler&quot;, &quot;Clay&quot;, &quot;Court&quot;, &quot;Cox&quot;, &quot;Croft&quot;, &quot;Cross&quot;, &quot;Crump&quot;, &quot;Dale&quot;, &quot;Deane&quot;, &quot;Delaney&quot;, &quot;Dike&quot;, &quot;Dodd&quot;, &quot;Ford&quot;, &quot;Forrest&quot;, &quot;Fox&quot;, &quot;Freeman&quot;, &quot;Garside&quot;, &quot;Gorsuch&quot;, &quot;Graves&quot;, &quot;Green&quot;, &quot;Greeves&quot;, &quot;Gross&quot;, &quot;Grove&quot;, &quot;Grover&quot;, &quot;Hall&quot;, &quot;Hawthorne&quot;, &quot;Hazel&quot;, &quot;Head&quot;, &quot;Heather&quot;, &quot;Hill&quot;, &quot;Holley&quot;, &quot;Holmes&quot;, &quot;Holt&quot;, &quot;Homer&quot;, &quot;Hooke&quot;, &quot;Hope&quot;, &quot;House&quot;, &quot;Howe&quot;, &quot;Hume&quot;, &quot;Hyde&quot;, &quot;Johnston&quot;, &quot;Kaye&quot;, &quot;Keats&quot;, &quot;Kerry&quot;, &quot;Kirk&quot;, &quot;Lamb&quot;, &quot;Layne&quot;, &quot;Lea&quot;, &quot;Lowell&quot;, &quot;March&quot;, &quot;Marsh&quot;, &quot;Marshal&quot;, &quot;Martin&quot;, &quot;May&quot;, &quot;Millerchip&quot;, &quot;Mills&quot;, &quot;Moore&quot;, &quot;Newby&quot;, &quot;Paine&quot;, &quot;Paxton&quot;, &quot;Perrin&quot;, &quot;Pike&quot;, &quot;Pitt&quot;, &quot;Preacher&quot;, &quot;Provost&quot;, &quot;Purple&quot;, &quot;Ridge&quot;, &quot;Rock&quot;, &quot;Rose&quot;, &quot;Rowen&quot;, &quot;Sangster&quot;, &quot;Sellers&quot;, &quot;Shaw&quot;, &quot;Short&quot;, &quot;Thorne&quot;, &quot;Underwood&quot;, &quot;Walsh&quot;, &quot;Wells&quot;, &quot;West&quot;, &quot;Whitney&quot;, &quot;Wilde&quot;, &quot;Wood&quot;, &quot;Wragge&quot;, &quot;Wynne&quot;],
	man: [&quot;Aaryn&quot;, &quot;Aaro&quot;, &quot;Aarus&quot;, &quot;Abramus&quot;, &quot;Abrahm&quot;, &quot;Abyl&quot;, &quot;Abelus&quot;, &quot;Adannius&quot;, &quot;Adanno&quot;, &quot;Aedam&quot;, &quot;Adym&quot;, &quot;Adamus&quot;, &quot;Aedrian&quot;, &quot;Aedrio&quot;, &quot;Aedyn&quot;, &quot;Aidyn&quot;, &quot;Aelijah&quot;, &quot;Elyjah&quot;, &quot;Aendro&quot;, &quot;Androe&quot;, &quot;Aenry&quot;, &quot;Hynroe&quot;, &quot;Hynrus&quot;, &quot;Aethan&quot;, &quot;Aethyn&quot;, &quot;Aevan&quot;, &quot;Evyn&quot;, &quot;Evanus&quot;, &quot;Alecks&quot;, &quot;Alyx&quot;, &quot;Alexandyr&quot;, &quot;Xandyr&quot;, &quot;Alyn&quot;, &quot;Alaen&quot;, &quot;Andrus&quot;, &quot;Aendrus&quot;, &quot;Anglo&quot;, &quot;Aenglo&quot;, &quot;Anglus&quot;, &quot;Antony&quot;, &quot;Antonyr&quot;, &quot;Astyn&quot;, &quot;Astinus&quot;, &quot;Axelus&quot;, &quot;Axyl&quot;, &quot;Benjamyn&quot;, &quot;Benjamyr&quot;, &quot;Braidyn&quot;, &quot;Brydus&quot;, &quot;Braddeus&quot;, &quot;Brandyn&quot;, &quot;Braendyn&quot;, &quot;Bryus&quot;, &quot;Bryne&quot;, &quot;Bryn&quot;, &quot;Branus&quot;, &quot;Caeleb&quot;, &quot;Caelyb&quot;, &quot;Caerlos&quot;, &quot;Carlus&quot;, &quot;Cameryn&quot;, &quot;Camerus&quot;, &quot;Cartus&quot;, &quot;Caertero&quot;, &quot;Charlus&quot;, &quot;Chaerles&quot;, &quot;Chyrles&quot;, &quot;Christophyr&quot;, &quot;Christo&quot;, &quot;Chrystian&quot;, &quot;Chrystan&quot;, &quot;Connorus&quot;, &quot;Connyr&quot;, &quot;Daemian&quot;, &quot;Damyan&quot;, &quot;Daenyel&quot;, &quot;Danyel&quot;, &quot;Davyd&quot;, &quot;Daevo&quot;, &quot;Dominac&quot;, &quot;Dylaen&quot;, &quot;Dylus&quot;, &quot;Elius&quot;, &quot;Aeli&quot;, &quot;Elyas&quot;, &quot;Helius&quot;, &quot;Helian&quot;, &quot;Emilyan&quot;, &quot;Emilanus&quot;, &quot;Emmanus&quot;, &quot;Emynwell&quot;, &quot;Ericus&quot;, &quot;Eryc&quot;, &quot;Eryck&quot;, &quot;Ezekius&quot;, &quot;Zeckus&quot;, &quot;Ezekio&quot;, &quot;Ezrus&quot;, &quot;Yzra&quot;, &quot;Gabrael&quot;, &quot;Gaebriel&quot;, &quot;Gael&quot;, &quot;Gayl&quot;, &quot;Gayel&quot;, &quot;Gaeus&quot;, &quot;Gavyn&quot;, &quot;Gaevyn&quot;, &quot;Goshwa&quot;, &quot;Joshoe&quot;, &quot;Graysus&quot;, &quot;Graysen&quot;, &quot;Gwann&quot;, &quot;Ewan&quot;, &quot;Gwyllam&quot;, &quot;Gwyllem&quot;, &quot;Haddeus&quot;, &quot;Hudsyn&quot;, &quot;Haesoe&quot;, &quot;Haesys&quot;, &quot;Haesus&quot;, &quot;Handus&quot;, &quot;Handyr&quot;, &quot;Hantus&quot;, &quot;Huntyr&quot;, &quot;Haroldus&quot;, &quot;Haryld&quot;, &quot;Horgus&quot;, &quot;Horus&quot;, &quot;Horys&quot;, &quot;Horyce&quot;, &quot;Hosea&quot;, &quot;Hosius&quot;, &quot;Iaen&quot;, &quot;Yan&quot;, &quot;Ianus&quot;, &quot;Ivaen&quot;, &quot;Yvan&quot;, &quot;Jaecoby&quot;, &quot;Jaecob&quot;, &quot;Jaeden&quot;, &quot;Jaedyn&quot;, &quot;Jaeremiah&quot;, &quot;Jeremus&quot;, &quot;Jasyn&quot;, &quot;Jaesen&quot;, &quot;Jaxon&quot;, &quot;Jaxyn&quot;, &quot;Jaxus&quot;, &quot;Johnus&quot;, &quot;Jonus&quot;, &quot;Jonaeth&quot;, &quot;Jonathyn&quot;, &quot;Jordus&quot;, &quot;Jordyn&quot;, &quot;Josaeth&quot;, &quot;Josephus&quot;, &quot;Josaeus&quot;, &quot;Josayah&quot;, &quot;Jovanus&quot;, &quot;Giovan&quot;, &quot;Julyan&quot;, &quot;Julyo&quot;, &quot;Jyck&quot;, &quot;Jaeck&quot;, &quot;Jacus&quot;, &quot;Kaevin&quot;, &quot;Kevyn&quot;, &quot;Vinkus&quot;, &quot;Laevi&quot;, &quot;Levy&quot;, &quot;Levius&quot;, &quot;Landyn&quot;, &quot;Laendus&quot;, &quot;Leo&quot;, &quot;Leonus&quot;, &quot;Leonaerdo&quot;, &quot;Leonyrdo&quot;, &quot;Lynardus&quot;, &quot;Lincon&quot;, &quot;Lyncon&quot;, &quot;Linconus&quot;, &quot;Logaen&quot;, &quot;Logus&quot;, &quot;Louis&quot;, &quot;Lucius&quot;, &quot;Lucae&quot;, &quot;Lucaen&quot;, &quot;Lucaes&quot;, &quot;Lucoe&quot;, &quot;Lucus&quot;, &quot;Lyam&quot;, &quot;Maeson&quot;, &quot;Masyn&quot;, &quot;Maetho&quot;, &quot;Mathoe&quot;, &quot;Matteus&quot;, &quot;Matto&quot;, &quot;Maxus&quot;, &quot;Maximus&quot;, &quot;Maximo&quot;, &quot;Maxymer&quot;, &quot;Mychael&quot;, &quot;Mygwell&quot;, &quot;Miglus&quot;, &quot;Mythro&quot;, &quot;Mithrus&quot;, &quot;Naemo&quot;, &quot;Naethyn&quot;, &quot;Nathanus&quot;, &quot;Naethynel&quot;, &quot;Nicholaes&quot;, &quot;Nycholas&quot;, &quot;Nicholys&quot;, &quot;Nicolus&quot;, &quot;Nolyn&quot;, &quot;Nolanus&quot;, &quot;Olivyr&quot;, &quot;Alivyr&quot;, &quot;Olivus&quot;, &quot;Oscarus&quot;, &quot;Oscoe&quot;, &quot;Raen&quot;, &quot;Ryn&quot;, &quot;Robertus&quot;, &quot;Robett&quot;, &quot;Bertus&quot;, &quot;Romyn&quot;, &quot;Romanus&quot;, &quot;Ryderus&quot;, &quot;Ridyr&quot;, &quot;Samwell&quot;, &quot;Saemuel&quot;, &quot;Santegus&quot;, &quot;Santaegus&quot;, &quot;Sybasten&quot;, &quot;Bastyen&quot;, &quot;Tago&quot;, &quot;Aemo&quot;, &quot;Tagus&quot;, &quot;Theodorus&quot;, &quot;Theodus&quot;, &quot;Thaeodore&quot;, &quot;Thomys&quot;, &quot;Thomas&quot;, &quot;Tommus&quot;, &quot;Tylus&quot;, &quot;Tilyr&quot;, &quot;Uwyn&quot;, &quot;Oewyn&quot;, &quot;Victor&quot;, &quot;Victyr&quot;, &quot;Victorus&quot;, &quot;Vincynt&quot;, &quot;Vyncent&quot;, &quot;Vincentus&quot;, &quot;Wyttus&quot;, &quot;Wyaett&quot;, &quot;Xavius&quot;, &quot;Havius&quot;, &quot;Xavyer&quot;, &quot;Yago&quot;, &quot;Tyago&quot;, &quot;Tyego&quot;, &quot;Ysaac&quot;, &quot;Aisaac&quot;, &quot;Ysaiah&quot;, &quot;Aisiah&quot;, &quot;Siahus&quot;, &quot;Zacharus&quot;, &quot;Zachar&quot;, &quot;Zachaery&quot;],
	woman: [&quot;Abigayl&quot;, &quot;Aebria&quot;, &quot;Aeobreia&quot;, &quot;Breia&quot;, &quot;Aedria&quot;, &quot;Aodreia&quot;, &quot;Dreia&quot;, &quot;Aeliya&quot;, &quot;Aliya&quot;, &quot;Aella&quot;, &quot;Aemilya&quot;, &quot;Aemma&quot;, &quot;Aemy&quot;, &quot;Amy&quot;, &quot;Ami&quot;, &quot;Aeria&quot;, &quot;Arya&quot;, &quot;Aeva&quot;, &quot;Aevelyn&quot;, &quot;Evylann&quot;, &quot;Alaexa&quot;, &quot;Alyxa&quot;, &quot;Alina&quot;, &quot;Aelina&quot;, &quot;Aelinea&quot;, &quot;Allisann&quot;, &quot;Allysann&quot;, &quot;Alyce&quot;, &quot;Alys&quot;, &quot;Alysea&quot;, &quot;Alyssia&quot;, &quot;Aelyssa&quot;, &quot;Amelya&quot;, &quot;Maelya&quot;, &quot;Andreya&quot;, &quot;Aendrea&quot;, &quot;Arianna&quot;, &quot;Aryanna&quot;, &quot;Arielle&quot;, &quot;Aryell&quot;, &quot;Ariella&quot;, &quot;Ashlena&quot;, &quot;Aurora&quot;, &quot;Avaery&quot;, &quot;Avyrie&quot;, &quot;Bella&quot;, &quot;Baella&quot;, &quot;Brooklinea&quot;, &quot;Bryanna&quot;, &quot;Brynna&quot;, &quot;Brinna&quot;, &quot;Caemila&quot;, &quot;Chloe&quot;, &quot;Chloeia&quot;, &quot;Claira&quot;, &quot;Clayre&quot;, &quot;Clayra&quot;, &quot;Delyla&quot;, &quot;Dalyla&quot;, &quot;Elisybeth&quot;, &quot;Aelisabeth&quot;, &quot;Ellia&quot;, &quot;Ellya&quot;, &quot;Elyana&quot;, &quot;Eliana&quot;, &quot;Eva&quot;, &quot;Falyne&quot;, &quot;Genaesis&quot;, &quot;Genaesys&quot;, &quot;Gianna&quot;, &quot;Jianna&quot;, &quot;Janna&quot;, &quot;Graece&quot;, &quot;Grassa&quot;, &quot;Haenna&quot;, &quot;Hanna&quot;, &quot;Halya&quot;, &quot;Harperia&quot;, &quot;Peria&quot;, &quot;Hazyl&quot;, &quot;Hazel&quot;, &quot;Jasmyne&quot;, &quot;Jasmine&quot;, &quot;Jocelyne&quot;, &quot;Joceline&quot;, &quot;Celine&quot;, &quot;Kaelia&quot;, &quot;Kaelya&quot;, &quot;Kathryne&quot;, &quot;Kathrine&quot;, &quot;Kayla&quot;, &quot;Kaila&quot;, &quot;Kymber&quot;, &quot;Kimbera&quot;, &quot;Layla&quot;, &quot;Laylanna&quot;, &quot;Leia&quot;, &quot;Leya&quot;, &quot;Leah&quot;, &quot;Lilia&quot;, &quot;Lylia&quot;, &quot;Luna&quot;, &quot;Maedisa&quot;, &quot;Maelania&quot;, &quot;Melania&quot;, &quot;Maya&quot;, &quot;Mya&quot;, &quot;Myla&quot;, &quot;Milae&quot;, &quot;Naomi&quot;, &quot;Naome&quot;, &quot;Natalya&quot;, &quot;Talya&quot;, &quot;Nathylie&quot;, &quot;Nataliae&quot;, &quot;Thalia&quot;, &quot;Nicola&quot;, &quot;Nikola&quot;, &quot;Nycola&quot;, &quot;Olivya&quot;, &quot;Alivya&quot;, &quot;Penelope&quot;, &quot;Paenelope&quot;, &quot;Pynelope&quot;, &quot;Rianna&quot;, &quot;Ryanna&quot;, &quot;Ruby&quot;, &quot;Ryla&quot;, &quot;Samaentha&quot;, &quot;Samytha&quot;, &quot;Sara&quot;, &quot;Sarah&quot;, &quot;Savannia&quot;, &quot;Scarletta&quot;, &quot;Sharlotta&quot;, &quot;Caerlotta&quot;, &quot;Sophya&quot;, &quot;Stella&quot;, &quot;Stylla&quot;, &quot;Valentyna&quot;, &quot;Valerya&quot;, &quot;Valeria&quot;, &quot;Valia&quot;, &quot;Valea&quot;, &quot;Victorya&quot;, &quot;Vilettia&quot;, &quot;Ximena&quot;, &quot;Imaena&quot;, &quot;Ysabel&quot;, &quot;Zoe&quot;, &quot;Zoeia&quot;, &quot;Zoea&quot;, &quot;Zoesia&quot;],
	maleelf: [&quot;Adran&quot;,
&quot;Aelar&quot;,
&quot;Aerdeth&quot;,
&quot;Ahvain&quot;,
&quot;Aramil&quot;,
&quot;Arannis&quot;,
&quot;Aust&quot;,
&quot;Azaki&quot;,
&quot;Beiro&quot;,
&quot;Berrian&quot;,
&quot;Caeldrim&quot;,
&quot;Carric&quot;,
&quot;Dayereth&quot;,
&quot;Dreali&quot;,
&quot;Efieril&quot;,
&quot;Eiravel&quot;,
&quot;Enialis&quot;,
&quot;Erdan&quot;,
&quot;Erevan&quot;,
&quot;Fivin&quot;,
&quot;Galinndan&quot;,
&quot;Gennal&quot;,
&quot;Hadarai&quot;,
&quot;Halimath&quot;,
&quot;Heian&quot;,
&quot;Himo&quot;,
&quot;Immeral&quot;,
&quot;Ivellios&quot;,
&quot;Korfel&quot;,
&quot;Lamlis&quot;,
&quot;Laucian&quot;,
&quot;Lucan&quot;,
&quot;Mindartis&quot;,
&quot;Naal&quot;,
&quot;Nutae&quot;,
&quot;Paelias&quot;,
&quot;Peren&quot;,
&quot;Quarion&quot;,
&quot;Riardon&quot;,
&quot;Rolen&quot;,
&quot;Soveliss&quot;,
&quot;Suhnae&quot;,
&quot;Thamior&quot;,
&quot;Tharivol&quot;,
&quot;Theren&quot;,
&quot;Theriatis&quot;,
&quot;Thervan&quot;,
&quot;Uthemar&quot;,
&quot;Vanuath&quot;,
&quot;Varis&quot;],
	femaleelf: [&quot;Adria&quot;,
&quot;Ahinar&quot;,
&quot;Althaea&quot;,
&quot;Anastrianna&quot;,
&quot;Andraste&quot;,
&quot;Antinua&quot;,
&quot;Arara&quot;,
&quot;Baelitae&quot;,
&quot;Bethrynna&quot;,
&quot;Birel&quot;,
&quot;Caelynn&quot;,
&quot;Chaedi&quot;,
&quot;Claira&quot;,
&quot;Dara&quot;,
&quot;Drusilia&quot;,
&quot;Elama&quot;,
&quot;Enna&quot;,
&quot;Faral&quot;,
&quot;Felosial&quot;,
&quot;Hatae&quot;,
&quot;Ielenia&quot;,
&quot;Ilanis&quot;,
&quot;Irann&quot;,
&quot;Jarsali&quot;,
&quot;Jelenneth&quot;,
&quot;Keyleth&quot;,
&quot;Leshanna&quot;,
&quot;Lia&quot;,
&quot;Maiathah&quot;,
&quot;Malquis&quot;,
&quot;Meriele&quot;,
&quot;Mialee&quot;,
&quot;Myathethil&quot;,
&quot;Naivara&quot;,
&quot;Quelenna&quot;,
&quot;Quillathe&quot;,
&quot;Ridaro&quot;,
&quot;Sariel&quot;,
&quot;Shanairla&quot;,
&quot;Shava&quot;,
&quot;Silaqui&quot;,
&quot;Sumnes&quot;,
&quot;Theirastra&quot;,
&quot;Thiala&quot;,
&quot;Tiaathque&quot;,
&quot;Traulam&quot;,
&quot;Vadania&quot;,
&quot;Valanthe&quot;,
&quot;Valna&quot;,
&quot;Xanaphia&quot;],
	femaledwarf: [&quot;Anbera&quot;,
&quot;Artin&quot;,
&quot;Audhild&quot;,
&quot;Balifra&quot;,
&quot;Barbena&quot;,
&quot;Bardryn&quot;,
&quot;Bolhild&quot;,
&quot;Dagnal&quot;,
&quot;Dafifi&quot;,
&quot;Delre&quot;,
&quot;Diesa&quot;,
&quot;Hdeth&quot;,
&quot;Eridred&quot;,
&quot;Falkrann&quot;,
&quot;Fallthra&quot;,
&quot;Finelien&quot;,
&quot;Gillydd&quot;,
&quot;Gunnloa&quot;,
&quot;Gurdis&quot;,
&quot;Helgret&quot;,
&quot;Helja&quot;,
&quot;Hihna&quot;,
&quot;Illde&quot;,
&quot;Jarana&quot;,
&quot;Kathra&quot;,
&quot;Kilia&quot;,
&quot;Kristryd&quot;,
&quot;Liftrasa&quot;,
&quot;Marastyr&quot;,
&quot;Mardred&quot;,
&quot;Morana&quot;,
&quot;Nalaed&quot;,
&quot;Nora&quot;,
&quot;Nurkara&quot;,
&quot;Orifi&quot;,
&quot;Ovina&quot;,
&quot;Riswynn&quot;,
&quot;Sannl&quot;,
&quot;Therlin&quot;,
&quot;Thodris&quot;,
&quot;Torbera&quot;,
&quot;Tordrid&quot;,
&quot;Torgga&quot;,
&quot;Urshar&quot;,
&quot;Valida&quot;,
&quot;Vistra&quot;,
&quot;Vonana&quot;,
&quot;Werydd&quot;,
&quot;Whurdred&quot;,
&quot;Yurgunn&quot;],
	maledwarf: [&quot;Adrik&quot;,
&quot;Alberich&quot;,
&quot;Baern&quot;,
&quot;Barendd&quot;,
&quot;Beloril&quot;,
&quot;Brottor&quot;,
&quot;Dain&quot;,
&quot;Dalgal&quot;,
&quot;Darrak&quot;,
&quot;Delg&quot;,
&quot;Duergath&quot;,
&quot;Dworic&quot;,
&quot;Eberk&quot;,
&quot;Einkil&quot;,
&quot;Elaim&quot;,
&quot;Erias&quot;,
&quot;Fallond&quot;,
&quot;Fargrim&quot;,
&quot;Gardain&quot;,
&quot;Garur&quot;,
&quot;Gimgen&quot;,
&quot;Gimurt&quot;,
&quot;Harbek&quot;,
&quot;Kildrak&quot;,
&quot;Kilvar&quot;,
&quot;Morgran&quot;,
&quot;Morkral&quot;,
&quot;Nalral&quot;,
&quot;Nordak&quot;,
&quot;Nuraval&quot;,
&quot;Oloric&quot;,
&quot;Olunt&quot;,
&quot;Orsik&quot;,
&quot;Oskar&quot;,
&quot;Rangfim&quot;,
&quot;Reirak&quot;,
&quot;Rurik&quot;,
&quot;Taklinn&quot;,
&quot;Thoradin&quot;,
&quot;Thorin&quot;,
&quot;Thradal&quot;,
&quot;Tordek&quot;,
&quot;Traubon&quot;,
&quot;Travok&quot;,
&quot;Ulfgar&quot;,
&quot;Urain&quot;,
&quot;Veit&quot;,
&quot;Vonbin&quot;,
&quot;Vondal&quot;,
&quot;Whurbin&quot;],
maletiefling: [&quot;Abad&quot;,
&quot;Ahrun&quot;,
&quot;Akwmn&quot;,
&quot;Anmon&quot;,
&quot;Andram&quot;,
&quot;Astar&quot;,
&quot;Bmam&quot;,
&quot;Barakas&quot;,
&quot;Bathin&quot;,
&quot;Cann&quot;,
&quot;Chem&quot;,
&quot;Chner&quot;,
&quot;Cressel&quot;,
&quot;Danmkos&quot;,
&quot;Ekmnon&quot;,
&quot;Euron&quot;,
&quot;Fennz&quot;,
&quot;Forcas&quot;,
&quot;Habor&quot;,
&quot;Iados&quot;,
&quot;Kauon&quot;,
&quot;Leucs&quot;,
&quot;Manmen&quot;,
&quot;Mantus&quot;,
&quot;Marbas&quot;,
&quot;Melech&quot;,
&quot;Merihim&quot;,
&quot;Modean&quot;,
&quot;Mordai&quot;,
&quot;Mormo&quot;,
&quot;Morthos&quot;,
&quot;Nicor&quot;,
&quot;Nirgel&quot;,
&quot;Oriax&quot;,
&quot;Paynon&quot;,
&quot;Pelaios&quot;,
&quot;Purson&quot;,
&quot;Qemud&quot;,
&quot;Raam&quot;,
&quot;Rimmon&quot;,
&quot;Sammal&quot;,
&quot;Skamos&quot;,
&quot;Tethren&quot;,
&quot;Thamuz&quot;,
&quot;Therai&quot;,
&quot;Valafar&quot;,
&quot;Vassago&quot;,
&quot;Xappan&quot;,
&quot;Zepar&quot;,
&quot;Zephan&quot;],
femaletiefling: [&quot;Akta&quot;,
&quot;Anakis&quot;,
&quot;Armara&quot;,
&quot;Astaro&quot;,
&quot;Aym&quot;,
&quot;Azza&quot;,
&quot;Beleth&quot;,
&quot;Bryseis&quot;,
&quot;Bune&quot;,
&quot;Criella&quot;,
&quot;Damaia&quot;,
&quot;Decarabia&quot;,
&quot;Ea&quot;,
&quot;Gadreel&quot;,
&quot;Gomory&quot;,
&quot;Hecat&quot;,
&quot;Ishte&quot;,
&quot;Jezebeth&quot;,
&quot;Kali&quot;,
&quot;Kalista&quot;,
&quot;Kasdeya&quot;,
&quot;Lerissa&quot;,
&quot;Lilith&quot;,
&quot;Makaria&quot;,
&quot;Manea&quot;,
&quot;Markosian&quot;,
&quot;Mastema&quot;,
&quot;Namnah&quot;,
&quot;Nemem&quot;,
&quot;Nija&quot;,
&quot;Orianna&quot;,
&quot;Osah&quot;,
&quot;Phelaia&quot;,
&quot;Prosperine&quot;,
&quot;Purah&quot;,
&quot;Pyra&quot;,
&quot;Pyranna&quot;,
&quot;Ronobe&quot;,
&quot;Ronwe&quot;,
&quot;Seddit&quot;,
&quot;Seere&quot;,
&quot;Sekhmet&quot;,
&quot;Semyaza&quot;,
&quot;Shava&quot;,
&quot;Shax&quot;,
&quot;Sorath&quot;,
&quot;Uzza&quot;,
&quot;Vapula&quot;,
&quot;Vepar&quot;,
&quot;Verin&quot;],
maleorc: [&quot;Argran&quot;,
&quot;Braak&quot;,
&quot;Brug&quot;,
&quot;Cagak&quot;,
&quot;Dench&quot;,
&quot;Dorn&quot;,
&quot;Dren&quot;,
&quot;Druuk&quot;,
&quot;Feng&quot;,
&quot;Gell&quot;,
&quot;Gnarsh&quot;,
&quot;Grurnbar&quot;,
&quot;Gubrash&quot;,
&quot;Hagren&quot;,
&quot;Henk&quot;,
&quot;Hogar&quot;,
&quot;Holg&quot;,
&quot;Imsh&quot;,
&quot;Karash&quot;,
&quot;Karg&quot;,
&quot;Keth&quot;,
&quot;Korag&quot;,
&quot;Krusk&quot;,
&quot;Lubash&quot;,
&quot;Megged&quot;,
&quot;Mhurren&quot;,
&quot;Mhflord&quot;,
&quot;Morg&quot;,
&quot;Nil&quot;,
&quot;Nybarg&quot;,
&quot;Odorr&quot;,
&quot;Ohr&quot;,
&quot;Rendar&quot;,
&quot;Resh&quot;,
&quot;Ront&quot;,
&quot;Rrath&quot;,
&quot;Sark&quot;,
&quot;Scrag&quot;,
&quot;Sheggen&quot;,
&quot;Shump&quot;,
&quot;Tanglar&quot;,
&quot;Tarak&quot;,
&quot;Thrag&quot;,
&quot;Thokk&quot;,
&quot;Trag&quot;,
&quot;Ugarth&quot;,
&quot;Varg&quot;,
&quot;Vilberg&quot;,
&quot;Yurk&quot;,
&quot;Zed&quot;],
femaleorc: [&quot;Arha&quot;,
&quot;Baggi&quot;,
&quot;Bendoo&quot;,
&quot;Bilga&quot;,
&quot;Brakka&quot;,
&quot;Creega&quot;,
&quot;Drenna&quot;,
&quot;Ekk&quot;,
&quot;Emen&quot;,
&quot;Engong&quot;,
&quot;Fistula&quot;,
&quot;Gaaki&quot;,
&quot;Gorga&quot;,
&quot;Grai&quot;,
&quot;Greeba&quot;,
&quot;Grigi&quot;,
&quot;Gynk&quot;,
&quot;Hrathy&quot;,
&quot;Huru&quot;,
&quot;Ilga&quot;,
&quot;Kabbarg&quot;,
&quot;Kansif&quot;,
&quot;Lagazi&quot;,
&quot;Lexre&quot;,
&quot;Murgen&quot;,
&quot;Murook&quot;,
&quot;Myev&quot;,
&quot;Nagarette&quot;,
&quot;Neega&quot;,
&quot;Nella&quot;,
&quot;Nogu&quot;,
&quot;Oolah&quot;,
&quot;Ootah&quot;,
&quot;Ovak&quot;,
&quot;Ownka&quot;,
&quot;Puyet&quot;,
&quot;Reeza&quot;,
&quot;Shautha&quot;,
&quot;Silgre&quot;,
&quot;Sutha&quot;,
&quot;Tagga&quot;,
&quot;Tawar&quot;,
&quot;Tomph&quot;,
&quot;Ubada&quot;,
&quot;Vanchu&quot;,
&quot;Vola&quot;,
&quot;Volen&quot;,
&quot;Vorka&quot;,
&quot;Yevelda&quot;,
&quot;Zagga&quot;],
malehalfling: [&quot;Alton&quot;,
&quot;Ander&quot;,
&quot;Bernie&quot;,
&quot;Bobbin&quot;,
&quot;Cade&quot;,
&quot;Callus&quot;,
&quot;Corrin&quot;,
&quot;Dannad&quot;,
&quot;Danniel&quot;,
&quot;Eddie&quot;,
&quot;Egart&quot;,
&quot;Eldon&quot;,
&quot;Errich&quot;,
&quot;Fildo&quot;,
&quot;Finnan&quot;,
&quot;Franklin&quot;,
&quot;Garret&quot;,
&quot;Garth&quot;,
&quot;Gilbert&quot;,
&quot;Gob&quot;,
&quot;Harol&quot;,
&quot;Igor&quot;,
&quot;Jasper&quot;,
&quot;Keith&quot;,
&quot;Kevin&quot;,
&quot;Lazam&quot;,
&quot;Lerry&quot;,
&quot;Lindal&quot;,
&quot;Lyle&quot;,
&quot;Merric&quot;,
&quot;Mican&quot;,
&quot;Milo&quot;,
&quot;Morrin&quot;,
&quot;Nebin&quot;,
&quot;Nevil&quot;,
&quot;Osborn&quot;,
&quot;Ostran&quot;,
&quot;Oswalt&quot;,
&quot;Perrin&quot;,
&quot;Poppy&quot;,
&quot;Reed&quot;,
&quot;Roscoe&quot;,
&quot;Sam&quot;,
&quot;Shardon&quot;,
&quot;Tye&quot;,
&quot;Ulmo&quot;,
&quot;Wellby&quot;,
&quot;Wendel&quot;,
&quot;Wenner&quot;,
&quot;Wes&quot;],
femalehalfling: [&quot;Alain&quot;,
&quot;Andry&quot;,
&quot;Anne&quot;,
&quot;Bella&quot;,
&quot;Blossom&quot;,
&quot;Bree&quot;,
&quot;Callie&quot;,
&quot;Chenna&quot;,
&quot;Cora&quot;,
&quot;Dee&quot;,
&quot;Dell&quot;,
&quot;Eida&quot;,
&quot;Eran&quot;,
&quot;Euphamia&quot;,
&quot;Georgina&quot;,
&quot;Gynnie&quot;,
&quot;Harriet&quot;,
&quot;Jasmine&quot;,
&quot;Jillian&quot;,
&quot;Jo&quot;,
&quot;Kithri&quot;,
&quot;Lavinia&quot;,
&quot;Lidda&quot;,
&quot;Maegan&quot;,
&quot;Marigold&quot;,
&quot;Merla&quot;,
&quot;Myria&quot;,
&quot;Nedda&quot;,
&quot;Nikki&quot;,
&quot;Nora&quot;,
&quot;Olivia&quot;,
&quot;Paela&quot;,
&quot;Pearl&quot;,
&quot;Pennie&quot;,
&quot;Philomena&quot;,
&quot;Portia&quot;,
&quot;Robbie&quot;,
&quot;Rose&quot;,
&quot;Saral&quot;,
&quot;Seraphina&quot;,
&quot;Shaena&quot;,
&quot;Stacee&quot;,
&quot;Tawna&quot;,
&quot;Thea&quot;,
&quot;Trym&quot;,
&quot;Tyna&quot;,
&quot;Vani&quot;,
&quot;Verna&quot;,
&quot;Wella&quot;,
&quot;Willow&quot;],
maledragonborn: [&quot;Adrex&quot;,
&quot;Arjhan&quot;,
&quot;Azzakh&quot;,
&quot;Balasar&quot;,
&quot;Baradad&quot;,
&quot;Bharash&quot;,
&quot;Bidreked&quot;,
&quot;Dadalan&quot;,
&quot;Dazzazn&quot;,
&quot;Direcris&quot;,
&quot;Donaar&quot;,
&quot;Fax&quot;,
&quot;Gargax&quot;,
&quot;Ghesh&quot;,
&quot;Gorbundus&quot;,
&quot;Greethen&quot;,
&quot;Heskan&quot;,
&quot;Hirrathak&quot;,
&quot;Illdrex&quot;,
&quot;Kaladan&quot;,
&quot;Kerkad&quot;,
&quot;Kiirith&quot;,
&quot;Kriv&quot;,
&quot;Maagog&quot;,
&quot;Medrash&quot;,
&quot;Mehen&quot;,
&quot;Mozikth&quot;,
&quot;Mreksh&quot;,
&quot;Mugrunden&quot;,
&quot;Nadarr&quot;,
&quot;Nithther&quot;,
&quot;Norkruuth&quot;,
&quot;Nykkan&quot;,
&quot;Pandjed&quot;,
&quot;Patrin&quot;,
&quot;Pijjink&quot;,
&quot;Quarethon&quot;,
&quot;Rathkran&quot;,
&quot;Rhogar&quot;,
&quot;Rivaan&quot;,
&quot;Sethrekar&quot;,
&quot;Shamash&quot;,
&quot;Shedinn&quot;,
&quot;Srorthen&quot;,
&quot;Tarhun&quot;,
&quot;Torinn&quot;,
&quot;Trynnicus&quot;,
&quot;Valorean&quot;,
&quot;Vrondiss&quot;,
&quot;Zedaar&quot;],
femaledragonborn: [&quot;Akra&quot;,
&quot;Aasathra&quot;,
&quot;Antrara&quot;,
&quot;Arava&quot;,
&quot;Biri&quot;,
&quot;Blendaeth&quot;,
&quot;Burana&quot;,
&quot;Chassath&quot;,
&quot;Daar&quot;,
&quot;Dentratha&quot;,
&quot;Doudra&quot;,
&quot;Driindar&quot;,
&quot;Eggren&quot;,
&quot;Farideh&quot;,
&quot;Findex&quot;,
&quot;Furrele&quot;,
&quot;Gesrethe&quot;,
&quot;Gilkass&quot;,
&quot;Harann&quot;,
&quot;Havilar&quot;,
&quot;Hethress&quot;,
&quot;Hillanot&quot;,
&quot;Jaxi&quot;,
&quot;Jezean&quot;,
&quot;Jheri&quot;,
&quot;Kadana&quot;,
&quot;Kava&quot;,
&quot;Koflnn&quot;,
&quot;Megren&quot;,
&quot;Mijira&quot;,
&quot;Mishann&quot;,
&quot;Nala&quot;,
&quot;Nuthra&quot;,
&quot;Perra&quot;,
&quot;Pogranix&quot;,
&quot;Pyxrin&quot;,
&quot;Quespa&quot;,
&quot;Raiann&quot;,
&quot;Rezena&quot;,
&quot;Ruloth&quot;,
&quot;Saphara&quot;,
&quot;Savaran&quot;,
&quot;Sora&quot;,
&quot;Surina&quot;,
&quot;Synthrin&quot;,
&quot;Tatyan&quot;,
&quot;Thava&quot;,
&quot;Uadflt&quot;,
&quot;Vezera&quot;,
&quot;Zykrofl&quot;]
}
&gt;&gt;</tw-passagedata><tw-passagedata pid="80" name="Town" tags="" position="1225,975">&lt;&lt;set $town to {
	race: either([&quot;human&quot;, &quot;human&quot;, &quot;human&quot;, &quot;human&quot;, &quot;dwarf&quot;, &quot;dwarf&quot;, &quot;dwarf&quot;, &quot;elf&quot;, &quot;elf&quot;, &quot;half-orc&quot;, &quot;half-elf&quot;]),
	wealthroll: random(1, 100),
	reputationroll: random(1, 100),
	sinroll: random(1, 100),
	diversityroll: random(1, 100),
	magicroll: random(0, 35),
	sizeroll: random(0, 100)
}&gt;&gt;

/* Town Population Roller */
&lt;&lt;set _townpopulationroll to random(1, 10)&gt;&gt;
	&lt;&lt;if _townpopulationroll gt 8&gt;&gt;
		&lt;&lt;set $town.population to random(3001, 6000), $town.type to &quot;city&quot;, $town.wealthroll += 5, $town.reputationroll += 5, $town.sinroll += 15, $town.diversityroll += 10&gt;&gt;
	&lt;&lt;elseif _townpopulationroll gt 5&gt;&gt;
		&lt;&lt;set $town.population to random(1001, 3000), $town.type to &quot;town&quot;, $town.wealthroll += 3, $town.reputationroll += 2, $town.sinroll += 5, $town.diversityroll += 4&gt;&gt;
	&lt;&lt;elseif _townpopulationroll gt 2&gt;&gt;
		&lt;&lt;set $town.population to random(301, 1000), $town.type to &quot;village&quot;, $town.wealthroll += 2, $town.reputationroll -= 2, $town.sinroll -= 3, $town.diversityroll -= 4&gt;&gt;
	&lt;&lt;elseif _townpopulationroll lte 2&gt;&gt;
		&lt;&lt;set $town.population to random(30, 300), $town.type to &quot;hamlet&quot;, $town.wealthroll -= 2, $town.reputationroll -= 12, $town.sinroll -= 15, $town.diversityroll -= 12&gt;&gt;
	&lt;&lt;/if&gt;&gt;

/* Town Location Roller */
&lt;&lt;set _townpotentiallocation to [&quot;Seacoast&quot;, &quot;Forest&quot;, &quot;Hills&quot;, &quot;Plains&quot;, &quot;Mountains&quot;, &quot;River Coast&quot;, &quot;Seacoast&quot;, &quot;Forest&quot;, &quot;Hills&quot;, &quot;Plains&quot;, &quot;Mountains&quot;, &quot;River Coast&quot;, &quot;Jungle&quot;, &quot;Volcanic Field&quot;, &quot;Seacoast&quot;, &quot;Forest&quot;, &quot;Hills&quot;, &quot;Plains&quot;, &quot;Mountains&quot;, &quot;River Coast&quot;, &quot;Tundra&quot;, &quot;Ice Sheet&quot;, &quot;Seacoast&quot;, &quot;Desert&quot;, &quot;Hills&quot;, &quot;Plains&quot;, &quot;Mountains&quot;, &quot;River Coast&quot;, &quot;Wasteland&quot;, &quot;Oasis&quot;]&gt;&gt;
&lt;&lt;set _terrainroll to random(1, 6)&gt;&gt;
	&lt;&lt;if _terrainroll lte 3&gt;&gt;
		  &lt;&lt;set $town.terrain to &quot;temperate&quot;, $town.location to _townpotentiallocation[random(0, 5)]&gt;&gt;
	  &lt;&lt;elseif _terrainroll is 4&gt;&gt;
		  &lt;&lt;set $town.terrain to &quot;temperate&quot;, $town.location to _townpotentiallocation[random(6, 13)]&gt;&gt;
	  &lt;&lt;elseif _terrainroll is 5&gt;&gt;
		  &lt;&lt;set $town.terrain to &quot;temperate&quot;, $town.location to _townpotentiallocation[random(14, 21)]&gt;&gt;
	  &lt;&lt;elseif _terrainroll is 6&gt;&gt;
		  &lt;&lt;set $town.terrain to &quot;temperate&quot;, $town.location to _townpotentiallocation[random(22, 29)]&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="81" name="TownRenders" tags="render" position="100,1100">&lt;&lt;if $town.population gt 3000&gt;&gt;
    &lt;&lt;set $town.type to &quot;city&quot;&gt;&gt;
  &lt;&lt;elseif $town.population gt 1000&gt;&gt;
    &lt;&lt;set $town.type to &quot;town&quot;&gt;&gt;
  &lt;&lt;elseif $town.population gt 300&gt;&gt;
    &lt;&lt;set $town.type to &quot;village&quot;&gt;&gt;
  &lt;&lt;elseif $town.population gt 30&gt;&gt;
    &lt;&lt;set $town.type to &quot;hamlet&quot;&gt;&gt;
  &lt;&lt;elseif $town.population lte 30&gt;&gt;
    &lt;&lt;set $town.type to &quot;hamlet&quot;, $town.population to 30&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata></tw-storydata></div>
	<script id="script-sugarcube" type="text/javascript">
	/*! SugarCube JS */
	if(document.documentElement.getAttribute("data-init")==="loading"){!function(window,document,jQuery,undefined){"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),_slicedToArray=function(){function e(e,t){var r=[],a=!0,n=!1,i=undefined;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);a=!0);}catch(e){n=!0,i=e}finally{try{!a&&s.return&&s.return()}finally{if(n)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},errorPrologRegExp=/^(?:(?:uncaught\s+(?:exception:\s+)?)?error:\s+)+/i,Alert=function(){function e(e,t,r,a){var n="fatal"===e,i="Apologies! "+(n?"A fatal":"An")+" error has occurred.";i+=n?" Aborting.":" You may be able to continue, but some parts may not work properly.",null==t&&null==r||(i+="\n\nError",null!=t&&(i+=" ["+t+"]"),i+=null!=r?": "+r.replace(errorPrologRegExp,"")+".":": unknown error."),"object"===(void 0===a?"undefined":_typeof(a))&&a.stack&&(i+="\n\nStack Trace:\n"+a.stack),window.alert(i)}function t(t,r,a){e(null,t,r,a)}function r(t,r,a){e("fatal",t,r,a)}return function(e){window.onerror=function(a,n,i,o,s){"complete"===document.readyState?t(null,a,s):(r(null,a,s),window.onerror=e,"function"==typeof window.onerror&&window.onerror.apply(this,arguments))}}(window.onerror),Object.freeze(Object.defineProperties({},{error:{value:t},fatal:{value:r}}))}(),Patterns=function(){var e=function(){var e=new Map([[" ","\\u0020"],["\f","\\f"],["\n","\\n"],["\r","\\r"],["\t","\\t"],["\v","\\v"],[" ","\\u00a0"],[" ","\\u1680"],["᠎","\\u180e"],[" ","\\u2000"],[" ","\\u2001"],[" ","\\u2002"],[" ","\\u2003"],[" ","\\u2004"],[" ","\\u2005"],[" ","\\u2006"],[" ","\\u2007"],[" ","\\u2008"],[" ","\\u2009"],[" ","\\u200a"],["\u2028","\\u2028"],["\u2029","\\u2029"],[" ","\\u202f"],[" ","\\u205f"],["　","\\u3000"],["\ufeff","\\ufeff"]]),t=/\s/,r="";return e.forEach(function(e,a){t.test(a)||(r+=e)}),r?"[\\s"+r+"]":"\\s"}(),t="[0-9A-Z_a-z\\-\\u00c0-\\u00d6\\u00d8-\\u00f6\\u00f8-\\u00ff\\u0150\\u0170\\u0151\\u0171]",r=t.replace("\\-",""),a="("+t+"+)\\(([^\\)\\|\\n]+)\\):",n="("+t+"+):([^;\\|\\n]+);",i="((?:\\."+t+"+)+);",o="((?:#"+t+"+)+);",s=a+"|"+n+"|"+i+"|"+o;return Object.freeze({space:e,spaceNoTerminator:"[\\u0020\\f\\t\\v\\u00a0\\u1680\\u180e\\u2000-\\u200a\\u202f\\u205f\\u3000\\ufeff]",lineTerminator:"[\\n\\r\\u2028\\u2029]",anyLetter:t,anyLetterStrict:r,identifierFirstChar:"[$A-Z_a-z]",identifier:"[$A-Z_a-z][$0-9A-Z_a-z]*",variableSigil:"[$_]",variable:"[$_][$A-Z_a-z][$0-9A-Z_a-z]*",macroName:"[A-Za-z][\\w-]*|[=-]",cssImage:"\\[[<>]?[Ii][Mm][Gg]\\[(?:\\s|\\S)*?\\]\\]+",inlineCss:s,url:"(?:file|https?|mailto|ftp|javascript|irc|news|data):[^\\s'\"]+"})}();!function(){function e(e,t){var n=String(e);switch(t){case"start":return n&&r.test(n)?n.replace(r,""):n;case"end":return n&&a.test(n)?n.replace(a,""):n;default:throw new Error('_trimFrom called with incorrect where parameter value: "'+t+'"')}}function t(e,t){var r=Number.parseInt(e,10)||0;if(r<1)return"";var a=void 0===t?"":String(t);for(""===a&&(a=" ");a.length<r;){var n=a.length,i=r-n;a+=n>i?a.slice(0,i):a}return a.length>r&&(a=a.slice(0,r)),a}var r=/^[\s\u00A0\uFEFF][\s\u00A0\uFEFF]*/,a=/[\s\u00A0\uFEFF][\s\u00A0\uFEFF]*$/;Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.includes called on null or undefined");if(0===arguments.length)return!1;var e=this.length>>>0;if(0===e)return!1;var t=arguments[0],r=Number(arguments[1])||0;for(r<0&&(r=Math.max(0,e+r));r<e;++r){var a=this[r];if(t===a||t!==t&&a!==a)return!0}return!1}}),String.prototype.padStart||Object.defineProperty(String.prototype,"padStart",{configurable:!0,writable:!0,value:function(e,r){if(null==this)throw new TypeError("String.prototype.padStart called on null or undefined");var a=String(this),n=a.length,i=Number.parseInt(e,10);return i<=n?a:t(i-n,r)+a}}),String.prototype.padEnd||Object.defineProperty(String.prototype,"padEnd",{configurable:!0,writable:!0,value:function(e,r){if(null==this)throw new TypeError("String.prototype.padEnd called on null or undefined");var a=String(this),n=a.length,i=Number.parseInt(e,10);return i<=n?a:a+t(i-n,r)}}),String.prototype.trimStart||Object.defineProperty(String.prototype,"trimStart",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimStart called on null or undefined");return e(this,"start")}}),String.prototype.trimLeft||Object.defineProperty(String.prototype,"trimLeft",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimLeft called on null or undefined");return e(this,"start")}}),String.prototype.trimEnd||Object.defineProperty(String.prototype,"trimEnd",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimEnd called on null or undefined");return e(this,"end")}}),String.prototype.trimRight||Object.defineProperty(String.prototype,"trimRight",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimRight called on null or undefined");return e(this,"end")}})}(),function(){function _random(){var e=void 0,t=void 0;switch(arguments.length){case 0:throw new Error("_random called with insufficient parameters");case 1:e=0,t=arguments[0];break;default:e=arguments[0],t=arguments[1]}if(e>t){var r=[t,e];e=r[0],t=r[1]}return Math.floor(_nativeMathRandom()*(t-e+1))+e}function _randomIndex(e,t){var r=void 0,a=void 0;switch(t.length){case 1:r=0,a=e-1;break;case 2:r=0,a=Math.trunc(t[1]);break;default:r=Math.trunc(t[1]),a=Math.trunc(t[2])}return Number.isNaN(r)?r=0:!Number.isFinite(r)||r>=e?r=e-1:r<0&&(r=e+r)<0&&(r=0),Number.isNaN(a)?a=0:!Number.isFinite(a)||a>=e?a=e-1:a<0&&(a=e+a)<0&&(a=e-1),_random(r,a)}function _getCodePointStartAndEnd(e,t){var r=e.charCodeAt(t);if(Number.isNaN(r))return{char:"",start:-1,end:-1};if(r<55296||r>57343)return{char:e.charAt(t),start:t,end:t};if(r>=55296&&r<=56319){var a=t+1;if(a>=e.length)throw new Error("high surrogate without trailing low surrogate");var n=e.charCodeAt(a);if(n<56320||n>57343)throw new Error("high surrogate without trailing low surrogate");return{char:e.charAt(t)+e.charAt(a),start:t,end:a}}if(0===t)throw new Error("low surrogate without leading high surrogate");var i=t-1,o=e.charCodeAt(i);if(o<55296||o>56319)throw new Error("low surrogate without leading high surrogate");return{char:e.charAt(i)+e.charAt(t),start:i,end:t}}var _nativeMathRandom=Math.random;Object.defineProperty(Array,"random",{configurable:!0,writable:!0,value:function(e){if(null==e||"object"!==(void 0===e?"undefined":_typeof(e))||!Object.prototype.hasOwnProperty.call(e,"length"))throw new TypeError("Array.random array parameter must be an array or array-lke object");var t=e.length>>>0;if(0!==t){return e[0===arguments.length?_random(0,t-1):_randomIndex(t,Array.prototype.slice.call(arguments,1))]}}}),Object.defineProperty(Array.prototype,"concatUnique",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.concatUnique called on null or undefined");var e=Array.from(this);if(0===arguments.length)return e;var t=Array.prototype.reduce.call(arguments,function(e,t){return e.concat(t)},[]),r=t.length;if(0===r)return e;for(var a=Array.prototype.indexOf,n=Array.prototype.push,i=0;i<r;++i){var o=t[i];-1===a.call(e,o)&&n.call(e,o)}return e}}),Object.defineProperty(Array.prototype,"count",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.count called on null or undefined");for(var e=Array.prototype.indexOf,t=arguments[0],r=Number(arguments[1])||0,a=0;-1!==(r=e.call(this,t,r));)++a,++r;return a}}),Object.defineProperty(Array.prototype,"delete",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.delete called on null or undefined");if(0===arguments.length)return[];if(0==this.length>>>0)return[];for(var e=Array.prototype.indexOf,t=Array.prototype.push,r=Array.prototype.splice,a=Array.prototype.concat.apply([],arguments),n=[],i=0,o=a.length;i<o;++i)for(var s=a[i],u=0;-1!==(u=e.call(this,s,u));)t.apply(n,r.call(this,u,1));return n}}),Object.defineProperty(Array.prototype,"deleteAt",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.deleteAt called on null or undefined");if(0===arguments.length)return[];var e=this.length>>>0;if(0===e)return[];for(var t=Array.prototype.splice,r=[].concat(_toConsumableArray(new Set(Array.prototype.concat.apply([],arguments).map(function(t){return t<0?Math.max(0,e+t):t})).values())),a=[].concat(_toConsumableArray(r)).sort(function(e,t){return t-e}),n=[],i=0,o=r.length;i<o;++i)n[i]=this[r[i]];for(var s=0,u=a.length;s<u;++s)t.call(this,a[s],1);return n}}),Object.defineProperty(Array.prototype,"flatten",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.flatten called on null or undefined");return Array.prototype.reduce.call(this,function(e,t){return e.concat(Array.isArray(t)?t.flatten():t)},[])}}),Object.defineProperty(Array.prototype,"includesAll",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.includesAll called on null or undefined");if(1===arguments.length)return Array.isArray(arguments[0])?Array.prototype.includesAll.apply(this,arguments[0]):Array.prototype.includes.apply(this,arguments);for(var e=0,t=arguments.length;e<t;++e)if(!Array.prototype.some.call(this,function(e){return e===this.val||e!==e&&this.val!==this.val},{val:arguments[e]}))return!1;return!0}}),Object.defineProperty(Array.prototype,"includesAny",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.includesAny called on null or undefined");if(1===arguments.length)return Array.isArray(arguments[0])?Array.prototype.includesAny.apply(this,arguments[0]):Array.prototype.includes.apply(this,arguments);for(var e=0,t=arguments.length;e<t;++e)if(Array.prototype.some.call(this,function(e){return e===this.val||e!==e&&this.val!==this.val},{val:arguments[e]}))return!0;return!1}}),Object.defineProperty(Array.prototype,"pluck",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.pluck called on null or undefined");var e=this.length>>>0;if(0!==e){var t=0===arguments.length?_random(0,e-1):_randomIndex(e,[].concat(Array.prototype.slice.call(arguments)));return Array.prototype.splice.call(this,t,1)[0]}}}),Object.defineProperty(Array.prototype,"pluckMany",{configurable:!0,writable:!0,value:function(e){if(null==this)throw new TypeError("Array.prototype.pluckMany called on null or undefined");var t=this.length>>>0;if(0===t)return[];var r=Math.trunc(e);if(!Number.isInteger(r))throw new Error("Array.prototype.pluckMany want parameter must be an integer");if(r<1)return[];r>t&&(r=t);var a=Array.prototype.splice,n=[],i=t-1;do{n.push(a.call(this,_random(0,i--),1)[0])}while(n.length<r);return n}}),Object.defineProperty(Array.prototype,"pushUnique",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.pushUnique called on null or undefined");var e=arguments.length;if(0===e)return this.length>>>0;for(var t=Array.prototype.indexOf,r=Array.prototype.push,a=0;a<e;++a){var n=arguments[a];-1===t.call(this,n)&&r.call(this,n)}return this.length>>>0}}),Object.defineProperty(Array.prototype,"random",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.random called on null or undefined");var e=this.length>>>0;if(0!==e){return this[0===arguments.length?_random(0,e-1):_randomIndex(e,[].concat(Array.prototype.slice.call(arguments)))]}}}),Object.defineProperty(Array.prototype,"randomMany",{configurable:!0,writable:!0,value:function(e){if(null==this)throw new TypeError("Array.prototype.randomMany called on null or undefined");var t=this.length>>>0;if(0===t)return[];var r=Math.trunc(e);if(!Number.isInteger(r))throw new Error("Array.prototype.randomMany want parameter must be an integer");if(r<1)return[];r>t&&(r=t);var a=new Map,n=[],i=t-1;do{var o=void 0;do{o=_random(0,i)}while(a.has(o));a.set(o,!0),n.push(this[o])}while(n.length<r);return n}}),Object.defineProperty(Array.prototype,"shuffle",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.shuffle called on null or undefined");var e=this.length>>>0;if(0===e)return this;for(var t=e-1;t>0;--t){var r=Math.floor(_nativeMathRandom()*(t+1));if(t!==r){var a=this[t];this[t]=this[r],this[r]=a}}return this}}),Object.defineProperty(Array.prototype,"unshiftUnique",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.unshiftUnique called on null or undefined");var e=arguments.length;if(0===e)return this.length>>>0;for(var t=Array.prototype.indexOf,r=Array.prototype.unshift,a=0;a<e;++a){var n=arguments[a];-1===t.call(this,n)&&r.call(this,n)}return this.length>>>0}}),Object.defineProperty(Function.prototype,"partial",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Function.prototype.partial called on null or undefined");var e=Array.prototype.slice,t=this,r=e.call(arguments,0);return function(){for(var a=[],n=0,i=0;i<r.length;++i)a.push(r[i]===undefined?arguments[n++]:r[i]);return t.apply(this,a.concat(e.call(arguments,n)))}}}),Object.defineProperty(Math,"clamp",{configurable:!0,writable:!0,value:function(e,t,r){var a=Number(e);return Number.isNaN(a)?NaN:a.clamp(t,r)}}),Object.defineProperty(Math,"easeInOut",{configurable:!0,writable:!0,value:function(e){return 1-(Math.cos(Number(e)*Math.PI)+1)/2}}),Object.defineProperty(Number.prototype,"clamp",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Number.prototype.clamp called on null or undefined");if(2!==arguments.length)throw new Error("Number.prototype.clamp called with an incorrect number of parameters");var e=Number(arguments[0]),t=Number(arguments[1]);if(e>t){var r=[t,e];e=r[0],t=r[1]}return Math.min(Math.max(this,e),t)}}),RegExp.escape||function(){var e=/[\\^$*+?.()|[\]{}]/g,t=new RegExp(e.source);Object.defineProperty(RegExp,"escape",{configurable:!0,writable:!0,value:function(r){var a=String(r);return a&&t.test(a)?a.replace(e,"\\$&"):a}})}(),function(){var e=/{(\d+)(?:,([+-]?\d+))?}/g,t=new RegExp(e.source);Object.defineProperty(String,"format",{configurable:!0,writable:!0,value:function(r){function a(e,t,r){if(!t)return e;var a=Math.abs(t)-e.length;if(a<1)return e;var n=String(r).repeat(a);return t<0?e+n:n+e}if(arguments.length<2)return 0===arguments.length?"":r;var n=2===arguments.length&&Array.isArray(arguments[1])?[].concat(_toConsumableArray(arguments[1])):Array.prototype.slice.call(arguments,1);return 0===n.length?r:t.test(r)?(e.lastIndex=0,r.replace(e,function(e,t,r){var i=n[t];if(null==i)return"";for(;"function"==typeof i;)i=i();switch(void 0===i?"undefined":_typeof(i)){case"string":break;case"object":i=JSON.stringify(i);break;default:i=String(i)}return a(i,r?Number.parseInt(r,10):0," ")})):r}})}(),Object.defineProperty(String.prototype,"contains",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.contains called on null or undefined");return-1!==String.prototype.indexOf.apply(this,arguments)}}),Object.defineProperty(String.prototype,"count",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.count called on null or undefined");var e=String(arguments[0]||"");if(""===e)return 0;for(var t=String.prototype.indexOf,r=e.length,a=Number(arguments[1])||0,n=0;-1!==(a=t.call(this,e,a));)++n,a+=r;return n}}),Object.defineProperty(String.prototype,"splice",{configurable:!0,writable:!0,value:function(e,t,r){if(null==this)throw new TypeError("String.prototype.splice called on null or undefined");var a=this.length>>>0;if(0===a)return"";var n=Number(e);Number.isSafeInteger(n)?n<0&&(n+=a)<0&&(n=0):n=0,n>a&&(n=a);var i=Number(t);(!Number.isSafeInteger(i)||i<0)&&(i=0);var o=this.slice(0,n);return void 0!==r&&(o+=r),n+i<a&&(o+=this.slice(n+i)),o}}),Object.defineProperty(String.prototype,"splitOrEmpty",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.splitOrEmpty called on null or undefined");return""===String(this)?[]:String.prototype.split.apply(this,arguments)}}),Object.defineProperty(String.prototype,"toLocaleUpperFirst",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.toLocaleUpperFirst called on null or undefined");var e=String(this),t=_getCodePointStartAndEnd(e,0),r=t.char,a=t.end;return-1===a?"":r.toLocaleUpperCase()+e.slice(a+1)}}),Object.defineProperty(String.prototype,"toUpperFirst",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.toUpperFirst called on null or undefined");var e=String(this),t=_getCodePointStartAndEnd(e,0),r=t.char,a=t.end;return-1===a?"":r.toUpperCase()+e.slice(a+1)}}),Object.defineProperty(Date.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:date)",this.toISOString()]}}),Object.defineProperty(Function.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:eval)","("+this.toString()+")"]}}),Object.defineProperty(Map.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:map)",[].concat(_toConsumableArray(this))]}}),Object.defineProperty(RegExp.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:eval)",this.toString()]}}),Object.defineProperty(Set.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:set)",[].concat(_toConsumableArray(this))]}}),Object.defineProperty(JSON,"reviveWrapper",{configurable:!0,writable:!0,value:function(e,t){if("string"!=typeof e)throw new TypeError("JSON.reviveWrapper code parameter must be a string");return["(revive:eval)",[e,t]]}}),Object.defineProperty(JSON,"_real_parse",{value:JSON.parse}),Object.defineProperty(JSON,"parse",{configurable:!0,writable:!0,value:function value(text,reviver){return JSON._real_parse(text,function(key,val){var value=val;if(Array.isArray(value)&&2===value.length)switch(value[0]){case"(revive:set)":value=new Set(value[1]);break;case"(revive:map)":value=new Map(value[1]);break;case"(revive:date)":value=new Date(value[1]);break;case"(revive:eval)":try{if(Array.isArray(value[1])){var $ReviveData$=value[1][1];value=eval(value[1][0])}else value=eval(value[1])}catch(e){}}else if("string"==typeof value&&"@@revive@@"===value.slice(0,10))try{value=eval(value.slice(10))}catch(e){}if("function"==typeof reviver)try{value=reviver(key,value)}catch(e){}return value})}}),Object.defineProperty(Array.prototype,"contains",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.contains called on null or undefined");return Array.prototype.includes.apply(this,arguments)}}),Object.defineProperty(Array.prototype,"containsAll",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.containsAll called on null or undefined");return Array.prototype.includesAll.apply(this,arguments)}}),Object.defineProperty(Array.prototype,"containsAny",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.containsAny called on null or undefined");return Array.prototype.includesAny.apply(this,arguments)}}),Object.defineProperty(String.prototype,"readBracketedList",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.readBracketedList called on null or undefined");for(var e=new RegExp("(?:\\[\\[((?:\\s|\\S)*?)\\]\\])|([^\"'\\s]\\S*)","gm"),t=[],r=void 0;null!==(r=e.exec(this));)r[1]?t.push(r[1]):r[2]&&t.push(r[2]);return t}})}();var Browser=function(){var e=navigator.userAgent.toLowerCase(),t=e.includes("windows phone"),r=Object.freeze({Android:!t&&e.includes("android"),BlackBerry:/blackberry|bb10/.test(e),iOS:!t&&/ip(?:hone|ad|od)/.test(e),Windows:t||e.includes("iemobile"),any:function(){return r.Android||r.BlackBerry||r.iOS||r.Windows}}),a=!r.Windows&&!/khtml|trident|edge/.test(e)&&e.includes("gecko"),n=!e.includes("opera")&&/msie|trident/.test(e),i=n?function(){var t=/(?:msie\s+|rv:)(\d+\.\d)/.exec(e);return t?Number(t[1]):0}():null,o=e.includes("opera")||e.includes(" opr/"),s=o?function(){var t=new RegExp((/khtml|chrome/.test(e)?"opr":"version")+"\\/(\\d+\\.\\d+)"),r=t.exec(e);return r?Number(r[1]):0}():null;return Object.freeze({userAgent:e,isMobile:r,isGecko:a,isIE:n,ieVersion:i,isOpera:o,operaVersion:s})}(),Has=function(){var e=function(){try{return"function"==typeof document.createElement("audio").canPlayType}catch(e){}return!1}(),t=function(){try{return"Blob"in window&&"File"in window&&"FileList"in window&&"FileReader"in window&&!Browser.isMobile.any()&&(!Browser.isOpera||Browser.operaVersion>=15)}catch(e){}return!1}(),r=function(){try{return"geolocation"in navigator&&"function"==typeof navigator.geolocation.getCurrentPosition&&"function"==typeof navigator.geolocation.watchPosition}catch(e){}return!1}(),a=function(){try{return"MutationObserver"in window&&"function"==typeof window.MutationObserver}catch(e){}return!1}(),n=function(){try{return"performance"in window&&"function"==typeof window.performance.now}catch(e){}return!1}();return Object.freeze({audio:e,fileAPI:t,geolocation:r,mutationObserver:a,performance:n})}(),_ref3=function(){function e(t){if("object"!==(void 0===t?"undefined":_typeof(t))||null===t)return t;if(t instanceof String)return String(t);if(t instanceof Number)return Number(t);if(t instanceof Boolean)return Boolean(t);if("function"==typeof t.clone)return t.clone(!0);if(t.nodeType&&"function"==typeof t.cloneNode)return t.cloneNode(!0);var r=void 0;return t instanceof Array?r=new Array(t.length):t instanceof Date?r=new Date(t.getTime()):t instanceof Map?(r=new Map,t.forEach(function(t,a){return r.set(a,e(t))})):t instanceof RegExp?r=new RegExp(t):t instanceof Set?(r=new Set,t.forEach(function(t){return r.add(e(t))})):r=Object.create(Object.getPrototypeOf(t)),Object.keys(t).forEach(function(a){return r[a]=e(t[a])}),r}function t(e){for(var t=document.createDocumentFragment(),r=document.createElement("p"),a=void 0;null!==(a=e.firstChild);){if(a.nodeType===Node.ELEMENT_NODE){switch(a.nodeName.toUpperCase()){case"BR":if(null!==a.nextSibling&&a.nextSibling.nodeType===Node.ELEMENT_NODE&&"BR"===a.nextSibling.nodeName.toUpperCase()){e.removeChild(a.nextSibling),e.removeChild(a),t.appendChild(r),r=document.createElement("p");continue}if(!r.hasChildNodes()){e.removeChild(a);continue}break;case"ADDRESS":case"ARTICLE":case"ASIDE":case"BLOCKQUOTE":case"CENTER":case"DIV":case"DL":case"FIGURE":case"FOOTER":case"FORM":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"HEADER":case"HR":case"MAIN":case"NAV":case"OL":case"P":case"PRE":case"SECTION":case"TABLE":case"UL":r.hasChildNodes()&&(t.appendChild(r),r=document.createElement("p")),t.appendChild(a);continue}}r.appendChild(a)}r.hasChildNodes()&&t.appendChild(r),e.appendChild(t)}function r(){try{return document.activeElement||null}catch(e){return null}}function a(e,t,r){var a="object"===(void 0===e?"undefined":_typeof(e))?e:document.getElementById(e);if(null==a)return null;var n=Array.isArray(t)?t:[t];jQuery(a).empty();for(var i=0,o=n.length;i<o;++i)if(Story.has(n[i]))return new Wikifier(a,Story.get(n[i]).processText().trim()),a;if(null!=r){var s=String(r).trim();""!==s&&new Wikifier(a,s)}return a}function n(e,t,r){var a=jQuery(document.createElement("div")),n=jQuery(document.createElement("button")),i=jQuery(document.createElement("pre")),o=L10n.get("errorTitle")+": "+(t||"unknown error");return n.addClass("error-toggle").ariaClick({label:L10n.get("errorToggle")},function(){n.hasClass("enabled")?(n.removeClass("enabled"),i.attr({"aria-hidden":!0,hidden:"hidden"})):(n.addClass("enabled"),i.removeAttr("aria-hidden hidden"))}).appendTo(a),jQuery(document.createElement("span")).addClass("error").text(o).appendTo(a),jQuery(document.createElement("code")).text(r).appendTo(i),i.addClass("error-source").attr({"aria-hidden":!0,hidden:"hidden"}).appendTo(a),a.addClass("error-view").appendTo(e),console.warn(o+"\n\t"+r.replace(/\n/g,"\n\t")),!1}function i(e,t){var r=i;switch(void 0===e?"undefined":_typeof(e)){case"number":if(Number.isNaN(e))return t;break;case"object":if(null===e)return t;if(Array.isArray(e))return e.map(function(e){return r(e,t)}).join(", ");if(e instanceof Set)return[].concat(_toConsumableArray(e)).map(function(e){return r(e,t)}).join(", ");if(e instanceof Map){return"{ "+[].concat(_toConsumableArray(e)).map(function(e){var a=_slicedToArray(e,2),n=a[0],i=a[1];return r(n,t)+" → "+r(i,t)}).join(", ")+" }"}return e instanceof Date?e.toLocaleString():"function"==typeof e.toString?e.toString():Object.prototype.toString.call(e);case"function":case"undefined":return t}return String(e)}return Object.freeze(Object.defineProperties({},{clone:{value:e},convertBreaks:{value:t},safeActiveElement:{value:r},setPageElement:{value:a},throwError:{value:n},toStringOrDefault:{value:i}}))}(),clone=_ref3.clone,convertBreaks=_ref3.convertBreaks,safeActiveElement=_ref3.safeActiveElement,setPageElement=_ref3.setPageElement,throwError=_ref3.throwError,toStringOrDefault=_ref3.toStringOrDefault;!function(){function e(e){13!==e.which&&32!==e.which||(e.preventDefault(),jQuery(safeActiveElement()||this).trigger("click"))}function t(e){return function(){var t=jQuery(this);t.is("[aria-pressed]")&&t.attr("aria-pressed","true"===t.attr("aria-pressed")?"false":"true"),e.apply(this,arguments)}}function r(e){return t(function(){jQuery(this).off(".aria-clickable").removeAttr("tabindex aria-controls aria-pressed").not("a,button").removeAttr("role").end().filter("button").prop("disabled",!0),e.apply(this,arguments)})}jQuery.fn.extend({ariaClick:function(a,n){if(0===this.length||0===arguments.length)return this;var i=a,o=n;return null==o&&(o=i,i=undefined),i=jQuery.extend({namespace:undefined,one:!1,selector:undefined,data:undefined,controls:undefined,pressed:undefined,label:undefined},i),"string"!=typeof i.namespace?i.namespace="":"."!==i.namespace[0]&&(i.namespace="."+i.namespace),"boolean"==typeof i.pressed&&(i.pressed=i.pressed?"true":"false"),this.filter("button").prop("type","button"),this.not("a,button").attr("role","button"),this.attr("tabindex",0),null!=i.controls&&this.attr("aria-controls",i.controls),null!=i.pressed&&this.attr("aria-pressed",i.pressed),null!=i.label&&this.attr({"aria-label":i.label,title:i.label}),this.not("button").on("keypress.aria-clickable"+i.namespace,i.selector,e),this.on("click.aria-clickable"+i.namespace,i.selector,i.data,i.one?r(o):t(o)),this}})}(),function(){jQuery.extend({wikiWithOptions:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];if(0!==r.length){var n=document.createDocumentFragment();r.forEach(function(t){return new Wikifier(n,t,e)});var i=[].concat(_toConsumableArray(n.querySelectorAll(".error"))).map(function(e){return e.textContent.replace(errorPrologRegExp,"")});if(i.length>0)throw new Error(i.join("; "))}},wiki:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];this.wikiWithOptions.apply(this,[undefined].concat(t))}}),jQuery.fn.extend({wikiWithOptions:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];if(0===this.length||0===r.length)return this;var n=document.createDocumentFragment();return r.forEach(function(t){return new Wikifier(n,t,e)}),this.append(n),this},wiki:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.wikiWithOptions.apply(this,[undefined].concat(t))}})}();var Util=function(){function e(e){return Object.freeze(Object.assign(Object.create(null),e))}function t(e){return Object.prototype.toString.call(e).slice(8,-1)}function r(e){var t=void 0;switch(void 0===e?"undefined":_typeof(e)){case"number":t=e;break;case"string":t=Number(e);break;default:return!1}return!Number.isNaN(t)&&Number.isFinite(t)}function a(e){return"boolean"==typeof e||"string"==typeof e&&("true"===e||"false"===e)}function n(e){return String(e).trim().replace(/[^\w\s\u2013\u2014-]+/g,"").replace(/[_\s\u2013\u2014-]+/g,"-").toLocaleLowerCase()}function i(e){if(null==e)return"";var t=String(e);return t&&p.test(t)?t.replace(f,function(e){return g[e]}):t}function o(e){if(null==e)return"";var t=String(e);return t&&v.test(t)?t.replace(m,function(e){return y[e.toLowerCase()]}):t}function s(e,t){var r=String(e),a=Math.trunc(t),n=r.charCodeAt(a);if(Number.isNaN(n))return{char:"",start:-1,end:-1};var i={char:r.charAt(a),start:a,end:a};if(n<55296||n>57343)return i;if(n>=55296&&n<=56319){var o=a+1;if(o>=r.length)return i;var s=r.charCodeAt(o);return s<56320||s>57343?i:(i.char=i.char+r.charAt(o),i.end=o,i)}if(0===a)return i;var u=a-1,l=r.charCodeAt(u);return l<55296||l>56319?i:(i.char=r.charAt(u)+i.char,i.start=u,i)}function u(){return b.now()}function l(e){var t=w.exec(String(e));if(null===t)throw new SyntaxError('invalid time value syntax: "'+e+'"');var r=Number(t[1]);if(1===t[2].length&&(r*=1e3),Number.isNaN(r)||!Number.isFinite(r))throw new RangeError('invalid time value: "'+e+'"');return r}function c(e){if("number"!=typeof e||Number.isNaN(e)||!Number.isFinite(e)){var r=void 0;switch(void 0===e?"undefined":_typeof(e)){case"string":r='"'+e+'"';break;case"number":r=String(e);break;default:r=t(e)}throw new Error("invalid milliseconds: "+r)}return e+"ms"}function d(e){if(!e.includes("-"))switch(e){case"bgcolor":return"backgroundColor";case"float":return"cssFloat";default:return e}return("-ms-"===e.slice(0,4)?e.slice(1):e).split("-").map(function(e,t){return 0===t?e:e.toUpperFirst()}).join("")}function h(e){var t=document.createElement("a"),r=Object.create(null);t.href=e,t.search&&t.search.replace(/^\?/,"").splitOrEmpty(/(?:&(?:amp;)?|;)/).forEach(function(e){var t=e.split("="),a=_slicedToArray(t,2),n=a[0],i=a[1];r[n]=i});var a=t.host&&"/"!==t.pathname[0]?"/"+t.pathname:t.pathname;return{href:t.href,protocol:t.protocol,host:t.host,hostname:t.hostname,port:t.port,path:""+a+t.search,pathname:a,query:t.search,search:t.search,queries:r,searches:r,hash:t.hash}}var f=/[&<>"'`]/g,p=new RegExp(f.source),g=Object.freeze({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"}),m=/&(?:amp|#38|#x26|lt|#60|#x3c|gt|#62|#x3e|quot|#34|#x22|apos|#39|#x27|#96|#x60);/gi,v=new RegExp(m.source,"i"),y=Object.freeze({"&amp;":"&","&#38;":"&","&#x26;":"&","&lt;":"<","&#60;":"<","&#x3c;":"<","&gt;":">","&#62;":">","&#x3e;":">","&quot;":'"',"&#34;":'"',"&#x22;":'"',"&apos;":"'","&#39;":"'","&#x27;":"'","&#96;":"`","&#x60;":"`"}),b=Has.performance?performance:Date,w=/^([+-]?(?:\d*\.)?\d+)([Mm]?[Ss])$/;return Object.freeze(Object.defineProperties({},{toEnum:{value:e},toStringTag:{value:t},isNumeric:{value:r},isBoolean:{value:a},slugify:{value:n},escape:{value:i},unescape:{value:o},charAndPosAt:{value:s},fromCssTime:{value:l},toCssTime:{value:c},fromCssProperty:{value:d},parseUrl:{value:h},now:{value:u},random:{value:Math.random},entityEncode:{value:i},entityDecode:{value:o},
evalExpression:{value:function(){return Scripting.evalJavaScript.apply(Scripting,arguments)}},evalStatements:{value:function(){return Scripting.evalJavaScript.apply(Scripting,arguments)}}}))}(),SimpleAudio=function(){function e(){return g}function t(e){g=!!e,l("mute",g)}function r(){return f}function a(e){f=Math.clamp(e,.2,5),l("rate",f)}function n(){return p}function i(e){p=Math.clamp(e,0,1),l("volume",p)}function o(){l("stop")}function s(e,t){if("function"!=typeof t)throw new Error("callback parameter must be a function");h.set(e,t)}function u(e){h.delete(e)}function l(e,t){h.forEach(function(r){return r(e,t)})}function c(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return new(Function.prototype.bind.apply(m,[null].concat(t)))}function d(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return new(Function.prototype.bind.apply(v,[null].concat(t)))}var h=new Map,f=1,p=1,g=!1,m=function(){function e(t){if(_classCallCheck(this,e),Array.isArray(t))this._create(t);else{if(!(t instanceof e))throw new Error("sources parameter must be an array of either URLs or source objects");this._copy(t)}}return _createClass(e,[{key:"_create",value:function(t){if(!Array.isArray(t)||0===t.length)throw new Error("sources parameter must be an array of either URLs or source objects");var r=/^data:\s*audio\/([^;,]+)\s*[;,]/i,a=/\.([^.\/\\]+)$/,n=e.getType,i=[],o=document.createElement("audio");if(t.forEach(function(e){var t=null;switch(void 0===e?"undefined":_typeof(e)){case"string":var s=void 0;if("data:"===e.slice(0,5)){if(null===(s=r.exec(e)))throw new Error("source data URI missing media type")}else if(null===(s=a.exec(Util.parseUrl(e).pathname)))throw new Error("source URL missing file extension");var u=n(s[1]);null!==u&&(t={src:e,type:u});break;case"object":if(null===e)throw new Error("source object cannot be null");if(!e.hasOwnProperty("src"))throw new Error('source object missing required "src" property');if(!e.hasOwnProperty("format"))throw new Error('source object missing required "format" property');var l=n(e.format);null!==l&&(t={src:e.src,type:l});break;default:throw new Error("invalid source value (type: "+(void 0===e?"undefined":_typeof(e))+")")}if(null!==t){var c=document.createElement("source");c.src=t.src,c.type=Browser.isOpera?t.type.replace(/;.*$/,""):t.type,o.appendChild(c),i.push(t)}}),!o.hasChildNodes())if(Browser.isIE)o.src=undefined;else{var s=document.createElement("source");s.src=undefined,s.type=undefined,o.appendChild(s)}this._finalize(o,i,clone(t))}},{key:"_copy",value:function(t){if(!(t instanceof e))throw new Error("original parameter must be an instance of AudioWrapper");this._finalize(t.audio.cloneNode(!0),clone(t.sources),clone(t.originalSources))}},{key:"_finalize",value:function(e,t,r){var a=this;Object.defineProperties(this,{audio:{configurable:!0,value:e},sources:{configurable:!0,value:Object.freeze(t)},originalSources:{configurable:!0,value:Object.freeze(r)},_error:{writable:!0,value:!1},_faderId:{writable:!0,value:null},_mute:{writable:!0,value:!1},_rate:{writable:!0,value:1},_volume:{writable:!0,value:1}}),jQuery(this.audio).on("loadstart",function(){return a._error=!1}).on("error",function(){return a._error=!0}).find("source:last-of-type").on("error",function(){return a._trigger("error")}),SimpleAudio.subscribe(this,function(e){if(!a.audio)return void SimpleAudio.unsubscribe(a);switch(e){case"mute":a._updateAudioMute();break;case"rate":a._updateAudioRate();break;case"stop":a.stop();break;case"volume":a._updateAudioVolume()}}),this.load()}},{key:"_trigger",value:function(e){jQuery(this.audio).triggerHandler(e)}},{key:"clone",value:function(){return new e(this)}},{key:"destroy",value:function(){SimpleAudio.unsubscribe(this);var e=this.audio;if(e){for(this.fadeStop(),this.stop(),jQuery(e).off();e.hasChildNodes();)e.removeChild(e.firstChild);e.load(),this._error=!0,delete this.audio,delete this.sources,delete this.originalSources}}},{key:"_updateAudioMute",value:function(){this.audio&&(this.audio.muted=this._mute||SimpleAudio.mute)}},{key:"_updateAudioRate",value:function(){this.audio&&(this.audio.playbackRate=this._rate*SimpleAudio.rate)}},{key:"_updateAudioVolume",value:function(){this.audio&&(this.audio.volume=this._volume*SimpleAudio.volume)}},{key:"hasSource",value:function(){return this.sources.length>0}},{key:"hasNoData",value:function(){return!this.audio||this.audio.readyState===HTMLMediaElement.HAVE_NOTHING}},{key:"hasMetadata",value:function(){return!!this.audio&&this.audio.readyState>=HTMLMediaElement.HAVE_METADATA}},{key:"hasSomeData",value:function(){return!!this.audio&&this.audio.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA}},{key:"hasData",value:function(){return!!this.audio&&this.audio.readyState===HTMLMediaElement.HAVE_ENOUGH_DATA}},{key:"isFailed",value:function(){return this._error}},{key:"isLoading",value:function(){return!!this.audio&&this.audio.networkState===HTMLMediaElement.NETWORK_LOADING}},{key:"isPlaying",value:function(){return!!this.audio&&!(this.audio.ended||this.audio.paused||!this.hasSomeData())}},{key:"isPaused",value:function(){return!!this.audio&&(this.audio.paused&&(this.audio.duration===1/0||this.audio.currentTime>0)&&!this.audio.ended)}},{key:"isEnded",value:function(){return!this.audio||this.audio.ended}},{key:"isFading",value:function(){return null!==this._faderId}},{key:"isMuted",value:function(){return this._mute}},{key:"isLooped",value:function(){return!!this.audio&&this.audio.loop}},{key:"load",value:function(){this.audio&&("auto"!==this.audio.preload&&(this.audio.preload="auto"),this.isLoading()||this.audio.load())}},{key:"play",value:function(){this.audio&&this.audio.play()}},{key:"pause",value:function(){this.audio&&this.audio.pause()}},{key:"stop",value:function(){this.audio&&(this.pause(),this.time=0,this._trigger(":stop"))}},{key:"fadeWithDuration",value:function(e,t,r){var a=this;if(this.audio){this.fadeStop();var n=Math.clamp(null==r?this.volume:r,0,1),i=Math.clamp(t,0,1);n!==i&&(this.volume=n,jQuery(this.audio).off("timeupdate.AudioWrapper:fadeWithDuration").one("timeupdate.AudioWrapper:fadeWithDuration",function(){var t=void 0,r=void 0;n<i?(t=n,r=i):(t=i,r=n);var o=Number(e);o<1&&(o=1);var s=(i-n)/(o/.025);a._faderId=setInterval(function(){if(!a.isPlaying())return void a.fadeStop();a.volume=Math.clamp(a.volume+s,t,r),0===a.volume&&a.pause(),a.volume===i&&(a.fadeStop(),a._trigger(":fade"))},25)}),this.play())}}},{key:"fade",value:function(e,t){this.fadeWithDuration(5,e,t)}},{key:"fadeIn",value:function(){this.fade(1)}},{key:"fadeOut",value:function(){this.fade(0)}},{key:"fadeStop",value:function(){null!==this._faderId&&(clearInterval(this._faderId),this._faderId=null)}},{key:"on",value:function(t,r){if(this.audio){if("function"!=typeof r)throw new Error("listener parameter must be a function");var a=e._events,n=t.trim().splitOrEmpty(/\s+/).map(function(e){var t=e.split(".",1)[0];if(!a.hasOwnProperty(t))throw new Error('unknown event "'+t+'"; valid: '+Object.keys(a).join(", "));return e.replace(t,a[t])+".AudioWrapperEvent"}).join(" ");if(""===n)throw new Error('invalid eventNames parameter "'+t+'"');return jQuery(this.audio).on(n,r),this}}},{key:"one",value:function(t,r){if(this.audio){if("function"!=typeof r)throw new Error("listener parameter must be a function");var a=e._events,n=t.trim().splitOrEmpty(/\s+/).map(function(e){var t=e.split(".",1)[0];if(!a.hasOwnProperty(t))throw new Error('unknown event "'+t+'"; valid: '+Object.keys(a).join(", "));return e.replace(t,a[t])+".AudioWrapperEvent"}).join(" ");if(""===n)throw new Error('invalid eventNames parameter "'+t+'"');return jQuery(this.audio).one(n,r),this}}},{key:"off",value:function(t,r){if(this.audio){if(r&&"function"!=typeof r)throw new Error("listener parameter must be a function");if(!t)return jQuery(this.audio).off(".AudioWrapperEvent",r);var a=e._events,n=t.trim().splitOrEmpty(/\s+/).map(function(e){var t=e.split(".",1)[0];if(t){if(!a.hasOwnProperty(t))throw new Error('unknown event "'+t+'"; valid: '+Object.keys(a).join(", "));return e.replace(t,a[t])+".AudioWrapperEvent"}return e+".AudioWrapperEvent"}).join(" ");if(""===n)throw new Error('invalid eventNames parameter "'+t+'"');return jQuery(this.audio).off(n,r),this}}},{key:"duration",get:function(){return this.audio?this.audio.duration:NaN}},{key:"ended",get:function(){return!this.audio||this.audio.ended}},{key:"loop",get:function(){return!!this.audio&&this.audio.loop},set:function(e){this.audio&&(this.audio.loop=!!e)}},{key:"mute",get:function(){return this._mute},set:function(e){this._mute=!!e,this._updateAudioMute()}},{key:"paused",get:function(){return!!this.audio&&this.audio.paused}},{key:"rate",get:function(){return this._rate},set:function(e){this._rate=Math.clamp(e,.2,5),this._updateAudioRate()}},{key:"remaining",get:function(){return this.audio?this.audio.duration-this.audio.currentTime:NaN}},{key:"time",get:function(){return this.audio?this.audio.currentTime:NaN},set:function(e){var t=this;if(this.audio)try{this.audio.currentTime=e}catch(r){jQuery(this.audio).off("loadedmetadata.AudioWrapper:time").one("loadedmetadata.AudioWrapper:time",function(){return t.audio.currentTime=e})}}},{key:"volume",get:function(){return this._volume},set:function(e){this._volume=Math.clamp(e,0,1),this._updateAudioVolume()}}],[{key:"_verifyType",value:function(t){if(!t||!Has.audio)return null;var r=e._types;if(!r.hasOwnProperty(t)){var a=document.createElement("audio");r[t]=""!==a.canPlayType(t).replace(/^no$/i,"")}return r[t]?t:null}},{key:"getType",value:function(t){if(!t||!Has.audio)return null;var r=e.formats,a=t.toLowerCase(),n=r.hasOwnProperty(a)?r[a]:"audio/"+a;return e._verifyType(n)}},{key:"canPlayFormat",value:function(t){return null!==e.getType(t)}},{key:"canPlayType",value:function(t){return null!==e._verifyType(t)}}]),e}();Object.defineProperties(m,{formats:{value:{aac:"audio/aac",caf:"audio/x-caf","x-caf":"audio/x-caf",mp3:'audio/mpeg; codecs="mp3"',mpeg:'audio/mpeg; codecs="mp3"',m4a:"audio/mp4",mp4:"audio/mp4","x-m4a":"audio/mp4","x-mp4":"audio/mp4",oga:"audio/ogg",ogg:"audio/ogg",opus:'audio/ogg; codecs="opus"',wav:"audio/wav",wave:"audio/wav",weba:"audio/webm",webm:"audio/webm"}},_types:{value:{}},_events:{value:Object.freeze({canplay:"canplaythrough",end:"ended",error:"error",fade:":fade",pause:"pause",play:"playing",rate:"ratechange",seek:"seeked",stop:":stop",volume:"volumechange"})}});var v=function(){function e(t){var r=this;_classCallCheck(this,e),Object.defineProperties(this,{tracks:{configurable:!0,value:[]},queue:{configurable:!0,value:[]},current:{writable:!0,value:null},_rate:{writable:!0,value:1},_volume:{writable:!0,value:1},_mute:{writable:!0,value:!1},_loop:{writable:!0,value:!1},_shuffle:{writable:!0,value:!1}}),Array.isArray(t)?t.forEach(function(e){return r.add(e)}):t instanceof e&&t.tracks.forEach(function(e){return r.add(e)})}return _createClass(e,[{key:"add",value:function(e){var t=this;if(null==e||"object"!==(void 0===e?"undefined":_typeof(e)))throw new Error("track parameter must be an object");var r=void 0,a=void 0,n=void 0,i=void 0;if(e instanceof m)r=!0,a=e.clone(),n=e.volume,i=e.rate;else{if(!e.hasOwnProperty("track"))throw new Error('track object missing required "track" property');if(!(e.track instanceof m))throw new Error('track object\'s "track" property must be an AudioWrapper object');r=e.hasOwnProperty("copy")&&e.copy,a=r?e.track.clone():e.track,n=e.hasOwnProperty("volume")?e.volume:e.track.volume,i=e.hasOwnProperty("rate")?e.rate:e.track.rate}a.stop(),a.loop=!1,a.mute=!1,a.volume=n,a.rate=i,a.on("end.AudioListEvent",function(){return t._onEnd()}),this.tracks.push({copy:r,track:a,volume:n,rate:i})}},{key:"destroy",value:function(){this.stop(),this.tracks.filter(function(e){return e.copy}).forEach(function(e){return e.track.destroy()}),delete this.tracks,delete this.queue}},{key:"isPlaying",value:function(){return null!==this.current&&this.current.track.isPlaying()}},{key:"isEnded",value:function(){return 0===this.queue.length&&(null===this.current||this.current.track.isEnded())}},{key:"isPaused",value:function(){return null===this.current||this.current.track.isPaused()}},{key:"isMuted",value:function(){return this._mute}},{key:"isLooped",value:function(){return this._loop}},{key:"isShuffled",value:function(){return this._shuffle}},{key:"play",value:function(){(null!==this.current&&!this.current.track.isEnded()||(0===this.queue.length&&this._buildList(),this._next()))&&this.current.track.play()}},{key:"pause",value:function(){null!==this.current&&this.current.track.pause()}},{key:"stop",value:function(){null!==this.current&&(this.current.track.stop(),this.current=null),this.queue.splice(0)}},{key:"skip",value:function(){this._next()?this.current.track.play():this._loop&&this.play()}},{key:"fadeWithDuration",value:function(e,t,r){if(0===this.queue.length&&this._buildList(),null!==this.current&&!this.current.track.isEnded()||this._next()){var a=Math.clamp(t,0,1)*this.current.volume,n=void 0;null!=r&&(n=Math.clamp(r,0,1)*this.current.volume),this.current.track.fadeWithDuration(e,a,n),this._volume=t}}},{key:"fade",value:function(e,t){this.fadeWithDuration(5,e,t)}},{key:"fadeIn",value:function(){this.fade(1)}},{key:"fadeOut",value:function(){this.fade(0)}},{key:"_next",value:function(){return null!==this.current&&this.current.track.stop(),0===this.queue.length?(this.current=null,!1):(this.current=this.queue.shift(),!this.current.track.hasSource()||this.current.track.isFailed()?this._next():(this.current.track.mute=this._mute,this.current.track.rate=this.rate*this.current.rate,this.current.track.volume=this.volume*this.current.volume,!0))}},{key:"_onEnd",value:function(){if(0===this.queue.length){if(!this._loop)return;this._buildList()}this._next()&&this.current.track.play()}},{key:"_buildList",value:function(){var e;this.queue.splice(0),(e=this.queue).push.apply(e,_toConsumableArray(this.tracks)),0!==this.queue.length&&this._shuffle&&(this.queue.shuffle(),this.queue.length>1&&this.queue[0]===this.current&&this.queue.push(this.queue.shift()))}},{key:"duration",get:function(){return this.tracks.map(function(e){return e.track.duration}).reduce(function(e,t){return e+t},0)}},{key:"loop",get:function(){return this._loop},set:function(e){this._loop=!!e}},{key:"mute",get:function(){return this._mute},set:function(e){this._mute=!!e,null!==this.current&&(this.current.track.mute=this._mute)}},{key:"rate",get:function(){return this._rate},set:function(e){this._rate=Math.clamp(e,.2,5),null!==this.current&&(this.current.track.rate=this.rate*this.current.rate)}},{key:"remaining",get:function(){var e=this.queue.map(function(e){return e.track.duration}).reduce(function(e,t){return e+t},0);return null!==this.current&&(e+=this.current.track.remaining),e}},{key:"shuffle",get:function(){return this._shuffle},set:function(e){this._shuffle=!!e}},{key:"time",get:function(){return this.duration-this.remaining}},{key:"volume",get:function(){return this._volume},set:function(e){this._volume=Math.clamp(e,0,1),null!==this.current&&(this.current.track.volume=this.volume*this.current.volume)}}]),e}();return Object.freeze(Object.defineProperties({},{mute:{get:e,set:t},rate:{get:r,set:a},volume:{get:n,set:i},stop:{value:o},subscribe:{value:s},unsubscribe:{value:u},publish:{value:l},create:{value:c},createList:{value:d}}))}(),SimpleStore=function(){function e(e,a){if(r)return r.create(e,a);for(var n=0;n<t.length;++n)if(t[n].init(e,a))return r=t[n],r.create(e,a);throw new Error("no valid storage adapters found")}var t=[],r=null;return Object.freeze(Object.defineProperties({},{adapters:{value:t},create:{value:e}}))}();SimpleStore.adapters.push(function(){function e(){function e(e){try{var t=window[e],r="_sc_"+String(Date.now());t.setItem(r,r);var a=t.getItem(r)===r;return t.removeItem(r),a}catch(e){}return!1}return r=e("localStorage")&&e("sessionStorage")}function t(e,t){if(!r)throw new Error("adapter not initialized");return new a(e,t)}var r=!1,a=function(){function e(t,r){_classCallCheck(this,e);var a=t+".",n=null,i=null;r?(n=window.localStorage,i="localStorage"):(n=window.sessionStorage,i="sessionStorage"),Object.defineProperties(this,{_engine:{value:n},_prefix:{value:a},_prefixRe:{value:new RegExp("^"+RegExp.escape(a))},name:{value:i},id:{value:t},persistent:{value:!!r}})}return _createClass(e,[{key:"size",value:function(){return this.keys().length}},{key:"keys",value:function(){for(var e=[],t=0;t<this._engine.length;++t){var r=this._engine.key(t);this._prefixRe.test(r)&&e.push(r.replace(this._prefixRe,""))}return e}},{key:"has",value:function(e){return!("string"!=typeof e||!e)&&this._engine.hasOwnProperty(this._prefix+e)}},{key:"get",value:function(t){if("string"!=typeof t||!t)return null;var r=this._engine.getItem(this._prefix+t);return null==r?null:e._deserialize(r)}},{key:"set",value:function(t,r){if("string"!=typeof t||!t)return!1;try{this._engine.setItem(this._prefix+t,e._serialize(r))}catch(e){throw/quota[_\s]?(?:exceeded|reached)/i.test(e.name)&&(e.message=this.name+" quota exceeded"),e}return!0}},{key:"delete",value:function(e){return!("string"!=typeof e||!e)&&(this._engine.removeItem(this._prefix+e),!0)}},{key:"clear",value:function(){for(var e=this.keys(),t=0,r=e.length;t<r;++t)this.delete(e[t]);return!0}},{key:"length",get:function(){return this.keys().length}}],[{key:"_serialize",value:function(e){return LZString.compressToUTF16(JSON.stringify(e))}},{key:"_deserialize",value:function(e){return JSON.parse(LZString.decompressFromUTF16(e))}}]),e}();return Object.freeze(Object.defineProperties({},{init:{value:e},create:{value:t}}))}()),SimpleStore.adapters.push(function(){function e(e){try{var t="_sc_"+String(Date.now());o._setCookie(t,o._serialize(t),undefined),i=o._deserialize(o._getCookie(t))===t,o._setCookie(t,undefined,n)}catch(e){i=!1}return i&&r(e),i}function t(e,t){if(!i)throw new Error("adapter not initialized");return new o(e,t)}function r(e){if(""!==document.cookie)for(var t=e+".",r=new RegExp("^"+RegExp.escape(t)),i=e+"!.",s=e+"*.",u=/\.(?:state|rcWarn)$/,l=document.cookie.split(/;\s*/),c=0;c<l.length;++c){var d=l[c].split("="),h=decodeURIComponent(d[0]);if(r.test(h)){var f=decodeURIComponent(d[1]);""!==f&&function(){var e=!u.test(h);o._setCookie(h,undefined,n),o._setCookie(h.replace(r,function(){return e?i:s}),f,e?a:undefined)}()}}}var a="Tue, 19 Jan 2038 03:14:07 GMT",n="Thu, 01 Jan 1970 00:00:00 GMT",i=!1,o=function(){function e(t,r){_classCallCheck(this,e);var a=t+(r?"!":"*")+".";Object.defineProperties(this,{_prefix:{value:a},_prefixRe:{value:new RegExp("^"+RegExp.escape(a))},name:{value:"cookie"},id:{value:t},persistent:{value:!!r}})}return _createClass(e,[{key:"size",value:function(){return this.keys().length}},{key:"keys",value:function(){if(""===document.cookie)return[];for(var e=document.cookie.split(/;\s*/),t=[],r=0;r<e.length;++r){var a=e[r].split("="),n=decodeURIComponent(a[0]);if(this._prefixRe.test(n)){""!==decodeURIComponent(a[1])&&t.push(n.replace(this._prefixRe,""))}}return t}},{key:"has",value:function(t){return!("string"!=typeof t||!t)&&null!==e._getCookie(this._prefix+t)}},{key:"get",value:function(t){if("string"!=typeof t||!t)return null;var r=e._getCookie(this._prefix+t);return null===r?null:e._deserialize(r)}},{key:"set",value:function(t,r){if("string"!=typeof t||!t)return!1;try{if(e._setCookie(this._prefix+t,e._serialize(r),this.persistent?a:undefined),!this.has(t))throw new Error("unknown validation error during set")}catch(e){throw e.message="cookie error: "+e.message,e}return!0}},{key:"delete",value:function(t){if("string"!=typeof t||!t||!this.has(t))return!1;try{if(e._setCookie(this._prefix+t,undefined,n),this.has(t))throw new Error("unknown validation error during delete")}catch(e){throw e.message="cookie error: "+e.message,e}return!0}},{key:"clear",value:function(){for(var e=this.keys(),t=0,r=e.length;t<r;++t)this.delete(e[t]);return!0}},{key:"length",get:function(){return this.keys().length}}],[{key:"_getCookie",value:function(e){if(!e||""===document.cookie)return null;for(var t=document.cookie.split(/;\s*/),r=0;r<t.length;++r){var a=t[r].split("=");if(e===decodeURIComponent(a[0])){return decodeURIComponent(a[1])||null}}return null}},{key:"_setCookie",value:function(e,t,r){if(e){var a=encodeURIComponent(e)+"=";null!=t&&(a+=encodeURIComponent(t)),null!=r&&(a+="; expires="+r),a+="; path=/",document.cookie=a}}},{key:"_serialize",value:function(e){return LZString.compressToBase64(JSON.stringify(e))}},{key:"_deserialize",value:function(e){return JSON.parse(LZString.decompressFromBase64(e))}}]),e}();return Object.freeze(Object.defineProperties({},{init:{value:e},create:{value:t}}))}());var DebugView=function(){return function(){function e(t,r,a,n){_classCallCheck(this,e),Object.defineProperties(this,{parent:{value:t},view:{value:document.createElement("span")},break:{value:document.createElement("wbr")}}),jQuery(this.view).attr({title:n,"aria-label":n,"data-type":null!=r?r:"","data-name":null!=a?a:""}).addClass("debug"),jQuery(this.break).addClass("debug hidden"),this.parent.appendChild(this.view),this.parent.appendChild(this.break)}return _createClass(e,[{key:"append",value:function(e){return jQuery(this.view).append(e),this}},{key:"modes",value:function(e){if(null==e){var t={};return this.view.className.splitOrEmpty(/\s+/).forEach(function(e){"debug"!==e&&(t[e]=!0)}),t}if("object"===(void 0===e?"undefined":_typeof(e)))return Object.keys(e).forEach(function(t){this[e[t]?"addClass":"removeClass"](t)},jQuery(this.view)),this;throw new Error("DebugView.prototype.modes options parameter must be an object or null/undefined")}},{key:"remove",value:function(){var e=jQuery(this.view);this.view.hasChildNodes()&&e.contents().appendTo(this.parent),e.remove(),jQuery(this.break).remove()}},{key:"output",get:function(){return this.view}},{key:"type",get:function(){return this.view.getAttribute("data-type")},set:function(e){this.view.setAttribute("data-type",null!=e?e:"")}},{key:"name",get:function(){return this.view.getAttribute("data-name")},set:function(e){this.view.setAttribute("data-name",null!=e?e:"")}},{key:"title",get:function(){return this.view.title},set:function(e){this.view.title=e}}],[{key:"isEnabled",value:function(){return"enabled"===jQuery(document.documentElement).attr("data-debug-view")}},{key:"enable",value:function(){jQuery(document.documentElement).attr("data-debug-view","enabled"),jQuery.event.trigger(":debugviewupdate")}},{key:"disable",value:function(){jQuery(document.documentElement).removeAttr("data-debug-view"),jQuery.event.trigger(":debugviewupdate")}},{key:"toggle",value:function(){"enabled"===jQuery(document.documentElement).attr("data-debug-view")?e.disable():e.enable()}}]),e}()}(),PRNGWrapper=function(){return function(){function e(t,r){_classCallCheck(this,e),Object.defineProperties(this,new Math.seedrandom(t,r,function(e,t){return{_prng:{value:e},seed:{writable:!0,value:t},pull:{writable:!0,value:0},random:{value:function(){return++this.pull,this._prng()}}}}))}return _createClass(e,null,[{key:"marshal",value:function(e){if(!e||!e.hasOwnProperty("seed")||!e.hasOwnProperty("pull"))throw new Error("PRNG is missing required data");return{seed:e.seed,pull:e.pull}}},{key:"unmarshal",value:function(t){if(!t||!t.hasOwnProperty("seed")||!t.hasOwnProperty("pull"))throw new Error("PRNG object is missing required data");for(var r=new e(t.seed,!1),a=t.pull;a>0;--a)r.random();return r}}]),e}()}(),StyleWrapper=function(){var e=new RegExp(Patterns.cssImage,"g"),t=new RegExp(Patterns.cssImage);return function(){function r(e){if(_classCallCheck(this,r),null==e)throw new TypeError("StyleWrapper style parameter must be an HTMLStyleElement object");Object.defineProperties(this,{style:{value:e}})}return _createClass(r,[{key:"isEmpty",value:function(){return 0===this.style.cssRules.length}},{key:"set",value:function(e){this.clear(),this.add(e)}},{key:"add",value:function(r){var a=r;t.test(a)&&(e.lastIndex=0,a=a.replace(e,function(e){var t=Wikifier.helpers.parseSquareBracketedMarkup({source:e,matchStart:0});if(t.hasOwnProperty("error")||t.pos<e.length)return e;var r=t.source;if("data:"!==r.slice(0,5)&&Story.has(r)){var a=Story.get(r);a.tags.includes("Twine.image")&&(r=a.text)}return'url("'+r.replace(/"/g,"%22")+'")'})),this.style.styleSheet?this.style.styleSheet.cssText+=a:this.style.appendChild(document.createTextNode(a))}},{key:"clear",value:function(){this.style.styleSheet?this.style.styleSheet.cssText="":jQuery(this.style).empty()}}]),r}()}(),Diff=function(){function e(t,a){for(var n=Object.prototype.toString,i=t instanceof Array,o=[].concat(Object.keys(t),Object.keys(a)).sort().filter(function(e,t,r){return 0===t||r[t-1]!==e}),s={},u=void 0,l=function(e){return e===u},c=0,d=o.length;c<d;++c){var h=o[c],f=t[h],p=a[h];if(t.hasOwnProperty(h))if(a.hasOwnProperty(h)){if(f===p)continue;if((void 0===f?"undefined":_typeof(f))===(void 0===p?"undefined":_typeof(p)))if("function"==typeof f)f.toString()!==p.toString()&&(s[h]=[r.Copy,p]);else if("object"!==(void 0===f?"undefined":_typeof(f))||null===f)s[h]=[r.Copy,p];else{var g=n.call(f),m=n.call(p);if(g===m)if(f instanceof Date)Number(f)!==Number(p)&&(s[h]=[r.Copy,clone(p)]);else if(f instanceof Map)s[h]=[r.Copy,clone(p)];else if(f instanceof RegExp)f.toString()!==p.toString()&&(s[h]=[r.Copy,clone(p)]);else if(f instanceof Set)s[h]=[r.Copy,clone(p)];else if("[object Object]"!==g)s[h]=[r.Copy,clone(p)];else{var v=e(f,p);null!==v&&(s[h]=v)}else s[h]=[r.Copy,clone(p)]}else s[h]=[r.Copy,"object"!==(void 0===p?"undefined":_typeof(p))||null===p?p:clone(p)]}else if(i&&Util.isNumeric(h)){var y=Number(h);if(!u){u="";do{u+="~"}while(o.some(l));s[u]=[r.SpliceArray,y,y]}y<s[u][1]&&(s[u][1]=y),y>s[u][2]&&(s[u][2]=y)}else s[h]=r.Delete;else s[h]=[r.Copy,"object"!==(void 0===p?"undefined":_typeof(p))||null===p?p:clone(p)]}return Object.keys(s).length>0?s:null}function t(e,a){for(var n=Object.keys(a||{}),i=clone(e),o=0,s=n.length;o<s;++o){var u=n[o],l=a[u];if(l===r.Delete)delete i[u];else if(l instanceof Array)switch(l[0]){case r.SpliceArray:i.splice(l[1],l[2]-l[1]+1);break;case r.Copy:i[u]=clone(l[1]);break;case r.CopyDate:i[u]=new Date(l[1])}else i[u]=t(i[u],l)}return i}var r=Util.toEnum({Delete:0,SpliceArray:1,Copy:2,CopyDate:3});return Object.freeze(Object.defineProperties({},{Op:{value:r},diff:{value:e},patch:{value:t}}))}(),L10n=function(){function e(){r()}function t(e,t){if(!e)return"";var r=function(e){var t=void 0;return e.some(function(e){return!!l10nStrings.hasOwnProperty(e)&&(t=e,!0)}),t}(Array.isArray(e)?e:[e]);if(!r)return"";for(var i=l10nStrings[r],o=0;n.test(i);){if(++o>50)throw new Error("L10n.get exceeded maximum replacement iterations, probable infinite loop");a.lastIndex=0,i=i.replace(a,function(e){var r=e.slice(1,-1);return t&&t.hasOwnProperty(r)?t[r]:l10nStrings.hasOwnProperty(r)?l10nStrings[r]:void 0})}return i}function r(){strings&&Object.keys(strings).length>0&&Object.keys(l10nStrings).forEach(function(e){try{var t=void 0;switch(e){case"identity":t=strings.identity;break;case"aborting":t=strings.aborting;break;case"cancel":t=strings.cancel;break;case"close":t=strings.close;break;case"ok":t=strings.ok;break;case"errorTitle":t=strings.errors.title;break;case"errorNonexistentPassage":t=strings.errors.nonexistentPassage;break;case"errorSaveMissingData":t=strings.errors.saveMissingData;break;case"errorSaveIdMismatch":t=strings.errors.saveIdMismatch;break;case"warningDegraded":t=strings.warnings.degraded;break;case"debugViewTitle":t=strings.debugView.title;break;case"debugViewToggle":t=strings.debugView.toggle;break;case"uiBarToggle":t=strings.uiBar.toggle;break;case"uiBarBackward":t=strings.uiBar.backward;break;case"uiBarForward":t=strings.uiBar.forward;break;case"uiBarJumpto":t=strings.uiBar.jumpto;break;case"jumptoTitle":t=strings.jumpto.title;break;case"jumptoTurn":t=strings.jumpto.turn;break;case"jumptoUnavailable":t=strings.jumpto.unavailable;break;case"savesTitle":t=strings.saves.title;break;case"savesDisallowed":t=strings.saves.disallowed;break;case"savesEmptySlot":t=strings.saves.emptySlot;break;case"savesIncapable":t=strings.saves.incapable;break;case"savesLabelAuto":t=strings.saves.labelAuto;break;case"savesLabelDelete":t=strings.saves.labelDelete;break;case"savesLabelExport":t=strings.saves.labelExport;break;case"savesLabelImport":t=strings.saves.labelImport;break;case"savesLabelLoad":t=strings.saves.labelLoad;break;case"savesLabelClear":t=strings.saves.labelClear;break;case"savesLabelSave":t=strings.saves.labelSave;break;case"savesLabelSlot":t=strings.saves.labelSlot;break;case"savesSavedOn":t=strings.saves.savedOn;break;case"savesUnavailable":t=strings.saves.unavailable;break;case"savesUnknownDate":t=strings.saves.unknownDate;break;case"settingsTitle":t=strings.settings.title;break;case"settingsOff":t=strings.settings.off;break;case"settingsOn":t=strings.settings.on;break;case"settingsReset":t=strings.settings.reset;break;case"restartTitle":t=strings.restart.title;break;case"restartPrompt":t=strings.restart.prompt;break;case"shareTitle":t=strings.share.title;break;case"autoloadTitle":t=strings.autoload.title;break;case"autoloadCancel":t=strings.autoload.cancel;break;case"autoloadOk":t=strings.autoload.ok;break;case"autoloadPrompt":t=strings.autoload.prompt;break;case"macroBackText":t=strings.macros.back.text;break;case"macroReturnText":t=strings.macros.return.text}t&&(l10nStrings[e]=t.replace(/%\w+%/g,function(e){return"{"+e.slice(1,-1)+"}"}))}catch(e){}})}var a=/\{\w+\}/g,n=new RegExp(a.source);return Object.freeze(Object.defineProperties({},{init:{value:e},get:{value:t}}))}(),strings={errors:{},warnings:{},debugView:{},uiBar:{},jumpto:{},saves:{},settings:{},restart:{},share:{},autoload:{},macros:{back:{},return:{}}},l10nStrings={identity:"game",aborting:"Aborting",cancel:"Cancel",close:"Close",ok:"OK",errorTitle:"Error",errorToggle:"Toggle the error view",errorNonexistentPassage:'the passage "{passage}" does not exist',errorSaveMissingData:"save is missing required data. Either the loaded file is not a save or the save has become corrupted",errorSaveIdMismatch:"save is from the wrong {identity}",_warningIntroLacking:"Your browser either lacks or has disabled",_warningOutroDegraded:", so this {identity} is running in a degraded mode. You may be able to continue, however, some parts may not work properly.",warningNoWebStorage:"{_warningIntroLacking} the Web Storage API{_warningOutroDegraded}",warningDegraded:"{_warningIntroLacking} some of the capabilities required by this {identity}{_warningOutroDegraded}",debugBarNoWatches:"— no watches set —",debugBarAddWatch:"Add watch",debugBarDeleteWatch:"Delete watch",debugBarWatchAll:"Watch all",debugBarWatchNone:"Delete all",debugBarLabelAdd:"Add",debugBarLabelWatch:"Watch",debugBarLabelTurn:"Turn",debugBarLabelViews:"Views",debugBarViewsToggle:"Toggle the debug views",debugBarWatchToggle:"Toggle the watch panel",uiBarToggle:"Toggle the UI bar",uiBarBackward:"Go backward within the {identity} history",uiBarForward:"Go forward within the {identity} history",uiBarJumpto:"Jump to a specific point within the {identity} history",jumptoTitle:"Jump To",jumptoTurn:"Turn",jumptoUnavailable:"No jump points currently available…",savesTitle:"Saves",savesDisallowed:"Saving has been disallowed on this passage.",savesEmptySlot:"— slot empty —",savesIncapable:"{_warningIntroLacking} the capabilities required to support saves, so saves have been disabled for this session.",savesLabelAuto:"Autosave",savesLabelDelete:"Delete",savesLabelExport:"Save to Disk…",savesLabelImport:"Load from Disk…",savesLabelLoad:"Load",savesLabelClear:"Delete All",savesLabelSave:"Save",savesLabelSlot:"Slot",savesSavedOn:"Saved on",savesUnavailable:"No save slots found…",savesUnknownDate:"unknown",settingsTitle:"Settings",settingsOff:"Off",settingsOn:"On",settingsReset:"Reset to Defaults",restartTitle:"Restart",restartPrompt:"Are you sure that you want to restart? Unsaved progress will be lost.",shareTitle:"Share",autoloadTitle:"Autoload",
autoloadCancel:"Go to start",autoloadOk:"Load autosave",autoloadPrompt:"An autosave exists. Load it now or go to the start?",macroBackText:"Back",macroReturnText:"Return"},Config=function(){function e(){throw new Error("Config.history.mode has been deprecated and is no longer used by SugarCube, please remove it from your code")}function t(){throw new Error("Config.history.tracking has been deprecated, use Config.history.maxStates instead")}return Object.seal({debug:!1,addVisitedLinkClass:!1,cleanupWikifierOutput:!1,loadDelay:0,history:Object.seal({controls:!0,maxStates:100,get mode(){e()},set mode(t){e()},get tracking(){t()},set tracking(e){t()}}),macros:Object.seal({ifAssignmentError:!0,maxLoopIterations:1e3}),navigation:Object.seal({override:undefined}),passages:Object.seal({descriptions:undefined,displayTitles:!1,nobr:!1,start:undefined,transitionOut:undefined}),saves:Object.seal({autoload:undefined,autosave:undefined,id:"untitled-story",isAllowed:undefined,onLoad:undefined,onSave:undefined,slots:8,version:undefined}),ui:Object.seal({stowBarInitially:800,updateStoryElements:!0}),transitionEndEventName:function(){for(var e=new Map([["transition","transitionend"],["MSTransition","msTransitionEnd"],["WebkitTransition","webkitTransitionEnd"],["MozTransition","transitionend"]]),t=[].concat(_toConsumableArray(e.keys())),r=document.createElement("div"),a=0;a<t.length;++a)if(r.style[t[a]]!==undefined)return e.get(t[a]);return""}()})}(),State=function(){function e(){session.delete("state"),W=[],R=c(),F=-1,B=[],V=null===V?null:new PRNGWrapper(V.seed,!1)}function t(){if(session.has("state")){var e=session.get("state");return null!=e&&(a(e),!0)}return!1}function r(e){var t={index:F};return e?t.history=clone(W):t.delta=T(W),B.length>0&&(t.expired=[].concat(_toConsumableArray(B))),null!==V&&(t.seed=V.seed),t}function a(e,t){if(null==e)throw new Error("state object is null or undefined");if(!e.hasOwnProperty(t?"history":"delta")||0===e[t?"history":"delta"].length)throw new Error("state object has no history or history is empty");if(!e.hasOwnProperty("index"))throw new Error("state object has no index");if(null!==V&&!e.hasOwnProperty("seed"))throw new Error("state object has no seed, but PRNG is enabled");if(null===V&&e.hasOwnProperty("seed"))throw new Error("state object has seed, but PRNG is disabled");W=t?clone(e.history):P(e.delta),F=e.index,B=e.hasOwnProperty("expired")?[].concat(_toConsumableArray(e.expired)):[],e.hasOwnProperty("seed")&&(V.seed=e.seed),g(F)}function n(){return r(!0)}function i(e){return a(e,!0)}function o(){return B}function s(){return B.length+v()}function u(){return B.concat(W.slice(0,v()).map(function(e){return e.title}))}function l(e){return null!=e&&""!==e&&(!!B.includes(e)||!!W.slice(0,v()).some(function(t){return t.title===e}))}function c(e,t){return{title:null==e?"":String(e),variables:null==t?{}:clone(t)}}function d(){return R}function h(){return F}function f(){return R.title}function p(){return R.variables}function g(e){if(null==e)throw new Error("moment activation attempted with null or undefined");switch(void 0===e?"undefined":_typeof(e)){case"object":R=clone(e);break;case"number":if(b())throw new Error("moment activation attempted with index on empty history");if(e<0||e>=y())throw new RangeError("moment activation attempted with out-of-bounds index; need [0, "+(y()-1)+"], got "+e);R=clone(W[e]);break;default:throw new TypeError('moment activation attempted with a "'+(void 0===e?"undefined":_typeof(e))+'"; must be an object or valid history stack index')}return null!==V&&(V=PRNGWrapper.unmarshal({seed:V.seed,pull:R.pull})),session.set("state",r()),jQuery.event.trigger(":historyupdate"),R}function m(){return W}function v(){return F+1}function y(){return W.length}function b(){return 0===W.length}function w(){return W.length>0?W[F]:null}function k(){return W.length>0?W[W.length-1]:null}function S(){return W.length>0?W[0]:null}function E(e){return b()||e<0||e>F?null:W[e]}function x(e){if(b())return null;var t=1+(e?Math.abs(e):0);return t>v()?null:W[v()-t]}function j(e){if(b()||null==e||""===e)return!1;for(var t=F;t>=0;--t)if(W[t].title===e)return!0;return!1}function C(e){if(v()<y()&&W.splice(v(),y()-v()),W.push(c(e,R.variables)),V&&(k().pull=V.pull),Config.history.maxStates>0)for(;y()>Config.history.maxStates;)B.push(W.shift().title);return F=y()-1,g(F),v()}function O(e){return!(null==e||e<0||e>=y()||e===F)&&(F=e,g(F),!0)}function A(e){return null!=e&&0!==e&&O(F+e)}function T(e){if(!Array.isArray(e))return null;if(0===e.length)return[];for(var t=[clone(e[0])],r=1,a=e.length;r<a;++r)t.push(Diff.diff(e[r-1],e[r]));return t}function P(e){if(!Array.isArray(e))return null;if(0===e.length)return[];for(var t=[clone(e[0])],r=1,a=e.length;r<a;++r)t.push(Diff.patch(t[r-1],e[r]));return t}function _(e,t){if(!b()){var r=void 0;throw r="the Story JavaScript",new Error("State.initPRNG must be called during initialization, within either "+r+" or the StoryInit special passage")}V=new PRNGWrapper(e,t),R.pull=V.pull}function N(){return V?V.random():Math.random()}function D(){U={},TempVariables=U}function M(){return U}function I(e){var t=Q(e);if(null!==t){for(var r=t.names,a=t.store,n=0,i=r.length;n<i;++n){if(void 0===a[r[n]])return;a=a[r[n]]}return a}}function L(e,t){var r=Q(e);if(null===r)return!1;for(var a=r.names,n=a.pop(),i=r.store,o=0,s=a.length;o<s;++o){if(void 0===i[a[o]])return!1;i=i[a[o]]}return i[n]=t,!0}function Q(e){for(var t={store:"$"===e[0]?State.variables:State.temporary,names:[]},r=e,a=void 0;null!==(a=z.exec(r));)r=r.slice(a[0].length),a[1]?t.names.push(a[1]):a[2]?t.names.push(a[2]):a[3]?t.names.push(a[3]):a[4]?t.names.push(a[4]):a[5]?t.names.push(I(a[5])):a[6]&&t.names.push(Number(a[6]));return""===r?t:null}var W=[],R=c(),F=-1,B=[],V=null,U={},z=new RegExp("^(?:"+Patterns.variableSigil+"("+Patterns.identifier+")|\\.("+Patterns.identifier+")|\\[(?:(?:\"((?:\\\\.|[^\"\\\\])+)\")|(?:'((?:\\\\.|[^'\\\\])+)')|("+Patterns.variableSigil+Patterns.identifierFirstChar+".*)|(\\d+))\\])");return Object.freeze(Object.defineProperties({},{reset:{value:e},restore:{value:t},marshalForSave:{value:n},unmarshalForSave:{value:i},expired:{get:o},turns:{get:s},passages:{get:u},hasPlayed:{value:l},active:{get:d},activeIndex:{get:h},passage:{get:f},variables:{get:p},history:{get:m},length:{get:v},size:{get:y},isEmpty:{value:b},current:{get:w},top:{get:k},bottom:{get:S},index:{value:E},peek:{value:x},has:{value:j},create:{value:C},goTo:{value:O},go:{value:A},deltaEncode:{value:T},deltaDecode:{value:P},initPRNG:{value:_},random:{value:N},clearTemporary:{value:D},temporary:{get:M},getVar:{value:I},setVar:{value:L},restart:{value:function(){return Engine.restart()}},backward:{value:function(){return Engine.backward()}},forward:{value:function(){return Engine.forward()}},display:{value:function(){return Engine.display.apply(Engine,arguments)}},show:{value:function(){return Engine.show.apply(Engine,arguments)}},play:{value:function(){return Engine.play.apply(Engine,arguments)}}}))}(),Scripting=function(){function addAccessibleClickHandler(e,t,r,a,n){if(arguments.length<2)throw new Error("addAccessibleClickHandler insufficient number of parameters");var i=void 0,o=void 0;if("function"==typeof t?(i=t,o={namespace:a,one:!!r}):(i=r,o={namespace:n,one:!!a,selector:t}),"function"!=typeof i)throw new TypeError("addAccessibleClickHandler handler parameter must be a function");return jQuery(e).ariaClick(o,i)}function insertElement(e,t,r,a,n,i){var o=jQuery(document.createElement(t));return r&&o.attr("id",r),a&&o.addClass(a),i&&o.attr("title",i),n&&o.text(n),e&&o.appendTo(e),o[0]}function insertText(e,t){jQuery(e).append(document.createTextNode(t))}function removeChildren(e){jQuery(e).empty()}function removeElement(e){jQuery(e).remove()}function fade(e,t){function r(){i+=.05*n,a(o,Math.easeInOut(i)),(1===n&&i>=1||-1===n&&i<=0)&&(e.style.visibility="in"===t.fade?"visible":"hidden",o.parentNode.replaceChild(e,o),o=null,window.clearInterval(s),t.onComplete&&t.onComplete())}function a(e,t){e.style.zoom=1,e.style.filter="alpha(opacity="+Math.floor(100*t)+")",e.style.opacity=t}var n="in"===t.fade?1:-1,i=void 0,o=e.cloneNode(!0),s=void 0;e.parentNode.replaceChild(o,e),"in"===t.fade?(i=0,o.style.visibility="visible"):i=1,a(o,i),s=window.setInterval(r,25)}function scrollWindowTo(e,t){function r(){l+=n,window.scroll(0,i+u*(s*Math.easeInOut(l))),l>=1&&window.clearInterval(c)}function a(e){for(var t=0;e.offsetParent;)t+=e.offsetTop,e=e.offsetParent;return t}var n=null!=t?Number(t):.1;Number.isNaN(n)||!Number.isFinite(n)||n<0?n=.1:n>1&&(n=1);var i=window.scrollY?window.scrollY:document.body.scrollTop,o=function(e){var t=a(e),r=t+e.offsetHeight,n=window.scrollY?window.scrollY:document.body.scrollTop,i=window.innerHeight?window.innerHeight:document.body.clientHeight,o=n+i;return t>=n&&r>o&&e.offsetHeight<i?t-(i-e.offsetHeight)+20:t}(e),s=Math.abs(i-o),u=i>o?-1:1,l=0,c=void 0;c=window.setInterval(r,25)}function either(){if(0!==arguments.length)return Array.prototype.concat.apply([],arguments).random()}function hasVisited(){if(0===arguments.length)throw new Error("hasVisited called with insufficient parameters");if(State.isEmpty())return!1;for(var e=Array.prototype.concat.apply([],arguments),t=State.passages,r=0,a=e.length;r<a;++r)if(!t.includes(e[r]))return!1;return!0}function lastVisited(){if(0===arguments.length)throw new Error("lastVisited called with insufficient parameters");if(State.isEmpty())return-1;for(var e=Array.prototype.concat.apply([],arguments),t=State.passages,r=t.length-1,a=State.turns,n=0,i=e.length;n<i&&a>-1;++n){var o=t.lastIndexOf(e[n]);a=Math.min(a,-1===o?-1:r-o)}return a}function passage(){return State.passage}function previous(){var e=State.passages;if(arguments.length>0){var t=Number(arguments[0]);if(!Number.isSafeInteger(t)||t<1)throw new RangeError("previous offset parameter must be a positive integer greater than zero");return e.length>t?e[e.length-1-t]:""}for(var r=e.length-2;r>=0;--r)if(e[r]!==State.passage)return e[r];return""}function random(){var e=void 0,t=void 0;switch(arguments.length){case 0:throw new Error("random called with insufficient parameters");case 1:e=0,t=Math.trunc(arguments[0]);break;default:e=Math.trunc(arguments[0]),t=Math.trunc(arguments[1])}if(!Number.isInteger(e))throw new Error("random min parameter must be an integer");if(!Number.isInteger(t))throw new Error("random max parameter must be an integer");if(e>t){var r=[t,e];e=r[0],t=r[1]}return Math.floor(State.random()*(t-e+1))+e}function randomFloat(){var e=void 0,t=void 0;switch(arguments.length){case 0:throw new Error("randomFloat called with insufficient parameters");case 1:e=0,t=Number(arguments[0]);break;default:e=Number(arguments[0]),t=Number(arguments[1])}if(Number.isNaN(e)||!Number.isFinite(e))throw new Error("randomFloat min parameter must be a number");if(Number.isNaN(t)||!Number.isFinite(t))throw new Error("randomFloat max parameter must be a number");if(e>t){var r=[t,e];e=r[0],t=r[1]}return State.random()*(t-e)+e}function tags(){if(0===arguments.length)return Story.get(State.passage).tags.slice(0);for(var e=Array.prototype.concat.apply([],arguments),t=[],r=0,a=e.length;r<a;++r)t=t.concat(Story.get(e[r]).tags);return t}function temporary(){return State.temporary}function time(){return null===Engine.lastPlay?0:Util.now()-Engine.lastPlay}function turns(){return State.turns}function variables(){return State.variables}function visited(){if(State.isEmpty())return 0;for(var e=Array.prototype.concat.apply([],0===arguments.length?[State.passage]:arguments),t=State.passages,r=State.turns,a=0,n=e.length;a<n&&r>0;++a)r=Math.min(r,t.count(e[a]));return r}function visitedTags(){if(0===arguments.length)throw new Error("visitedTags called with insufficient parameters");if(State.isEmpty())return 0;for(var e=Array.prototype.concat.apply([],arguments),t=e.length,r=State.passages,a=new Map,n=0,i=0,o=r.length;i<o;++i){var s=r[i];if(a.has(s))a.get(s)&&++n;else{var u=Story.get(s).tags;if(u.length>0){for(var l=0,c=0;c<t;++c)u.includes(e[c])&&++l;l===t?(++n,a.set(s,!0)):a.set(s,!1)}}}return n}function evalJavaScript(code,output){return function(code,output){return eval(code)}.call(output?{output:output}:null,String(code),output)}function evalTwineScript(code,output){return function(code,output){return eval(code)}.call(output?{output:output}:null,parse(String(code)),output)}var _ref8=function(){function e(e){return e.reduce(function(e,t){return e=e.then(t)},Promise.resolve())}function t(e){return Util.parseUrl(e).path.replace(/^[^\w]+|[^\w]+$/g,"").replace(/[^\w]+/g,"-").toLocaleLowerCase()}function r(){function r(e){return new Promise(function(r,a){jQuery(document.createElement("script")).one("load abort error",function(e){jQuery(e.target).off(),"load"===e.type?r(e.target):a(e.target)}).appendTo(document.head).attr({id:"script-imported-"+t(e),type:"text/javascript",src:e})})}for(var a=arguments.length,n=Array(a),i=0;i<a;i++)n[i]=arguments[i];return Promise.all(n.map(function(t){return Array.isArray(t)?e(t.map(function(e){return function(){return r(e)}})):r(t)}))}function a(){function r(e){return new Promise(function(r,a){jQuery(document.createElement("link")).one("load abort error",function(e){jQuery(e.target).off(),"load"===e.type?r(e.target):a(e.target)}).appendTo(document.head).attr({id:"style-imported-"+t(e),rel:"stylesheet",href:e})})}for(var a=arguments.length,n=Array(a),i=0;i<a;i++)n[i]=arguments[i];return Promise.all(n.map(function(t){return Array.isArray(t)?e(t.map(function(e){return function(){return r(e)}})):r(t)}))}return{importScripts:r,importStyles:a}}(),importScripts=_ref8.importScripts,importStyles=_ref8.importStyles,parse=function(){function e(e){if(0!==r.lastIndex)throw new RangeError("Scripting.parse last index is non-zero at start");for(var n=e,i=void 0;null!==(i=r.exec(n));)if(i[5]){var o=i[5];if("$"===o||"_"===o)continue;if(a.test(o))o=o[0];else if("is"===o){var s=r.lastIndex,u=n.slice(s);/^\s+not\b/.test(u)&&(n=n.splice(s,u.search(/\S/)),o="isnot")}t.hasOwnProperty(o)&&(n=n.splice(i.index,o.length,t[o]),r.lastIndex+=t[o].length-o.length)}return n}var t=Object.freeze({$:"State.variables.",_:"State.temporary.",to:"=",eq:"==",neq:"!=",is:"===",isnot:"!==",gt:">",gte:">=",lt:"<",lte:"<=",and:"&&",or:"||",not:"!",def:'"undefined" !== typeof',ndef:'"undefined" === typeof'}),r=new RegExp(["(\"\"|'')",'("(?:\\\\.|[^"\\\\])+")',"('(?:\\\\.|[^'\\\\])+')","([=+\\-*\\/%<>&\\|\\^~!?:,;\\(\\)\\[\\]{}]+)","([^\"'=+\\-*\\/%<>&\\|\\^~!?:,;\\(\\)\\[\\]{}\\s]+)"].join("|"),"g"),a=new RegExp("^"+Patterns.variable);return e}();return Object.freeze(Object.defineProperties({},{parse:{value:parse},evalJavaScript:{value:evalJavaScript},evalTwineScript:{value:evalTwineScript}}))}(),Wikifier=function(){var e=0,t=function(){function t(r,a,n){_classCallCheck(this,t),t.Parser.Profile.isEmpty()&&t.Parser.Profile.compile(),Object.defineProperties(this,{source:{value:String(a)},options:{writable:!0,value:Object.assign({profile:"all"},n)},nextMatch:{writable:!0,value:0},output:{writable:!0,value:null},_rawArgs:{writable:!0,value:""}}),null==r?this.output=document.createDocumentFragment():r.jquery?this.output=r[0]:this.output=r;try{++e,this.subWikify(this.output),1===e&&Config.cleanupWikifierOutput&&convertBreaks(this.output)}finally{--e}}return _createClass(t,[{key:"subWikify",value:function(e,r,a){var n=this.output,i=void 0;this.output=e,null!=a&&"object"===(void 0===a?"undefined":_typeof(a))&&(i=this.options,this.options=Object.assign({},this.options,a));var o=t.Parser.Profile.get(this.options.profile),s=r?new RegExp("(?:"+r+")",this.options.ignoreTerminatorCase?"gim":"gm"):null,u=void 0,l=void 0;do{if(o.parserRegExp.lastIndex=this.nextMatch,s&&(s.lastIndex=this.nextMatch),l=o.parserRegExp.exec(this.source),(u=s?s.exec(this.source):null)&&(!l||u.index<=l.index))return u.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,u.index),this.matchStart=u.index,this.matchLength=u[0].length,this.matchText=u[0],this.nextMatch=s.lastIndex,this.output=n,void(i&&(this.options=i));if(l){l.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,l.index),this.matchStart=l.index,this.matchLength=l[0].length,this.matchText=l[0],this.nextMatch=o.parserRegExp.lastIndex;for(var c=void 0,d=1,h=l.length;d<h;++d)if(l[d]){c=d-1;break}if(o.parsers[c].handler(this),null!=TempState.break)break}}while(u||l);null==TempState.break?this.nextMatch<this.source.length&&(this.outputText(this.output,this.nextMatch,this.source.length),this.nextMatch=this.source.length):this.output.lastChild&&this.output.lastChild.nodeType===Node.ELEMENT_NODE&&"BR"===this.output.lastChild.nodeName.toUpperCase()&&jQuery(this.output.lastChild).remove(),this.output=n,i&&(this.options=i)}},{key:"outputText",value:function(e,t,r){jQuery(e).append(document.createTextNode(this.source.substring(t,r)))}},{key:"rawArgs",value:function(){return this._rawArgs}},{key:"fullArgs",value:function(){return Scripting.parse(this._rawArgs)}}],[{key:"wikifyEval",value:function(e){var r=document.createDocumentFragment();new t(r,e);var a=r.querySelector(".error");if(null!==a)throw new Error(a.textContent.replace(errorPrologRegExp,""));return r}},{key:"createInternalLink",value:function(e,t,r,a){var n=jQuery(document.createElement("a"));return null!=t&&(n.attr("data-passage",t),Story.has(t)?(n.addClass("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(t)&&n.addClass("link-visited")):n.addClass("link-broken"),n.ariaClick({one:!0},function(){"function"==typeof a&&a(),Engine.play(t)})),r&&n.append(document.createTextNode(r)),e&&n.appendTo(e),n[0]}},{key:"createExternalLink",value:function(e,t,r){var a=jQuery(document.createElement("a")).attr("target","_blank").addClass("link-external").text(r).appendTo(e);return null!=t&&a.attr({href:t,tabindex:0}),a[0]}},{key:"isExternalLink",value:function(e){return!Story.has(e)&&(new RegExp("^"+Patterns.url,"gim").test(e)||/[\/.?#]/.test(e))}}]),t}();return Object.defineProperty(t,"Parser",{value:function(){function e(){return d}function t(e){if("object"!==(void 0===e?"undefined":_typeof(e)))throw new Error("Wikifier.Parser.add parser parameter must be an object");if(!e.hasOwnProperty("name"))throw new Error('parser object missing required "name" property');if("string"!=typeof e.name)throw new Error('parser object "name" property must be a string');if(!e.hasOwnProperty("match"))throw new Error('parser object missing required "match" property');if("string"!=typeof e.match)throw new Error('parser object "match" property must be a string');if(!e.hasOwnProperty("handler"))throw new Error('parser object missing required "handler" property');if("function"!=typeof e.handler)throw new Error('parser object "handler" property must be a function');if(e.hasOwnProperty("profiles")&&!Array.isArray(e.profiles))throw new Error('parser object "profiles" property must be an array');if(n(e.name))throw new Error('cannot clobber existing parser "'+e.name+'"');d.push(e)}function r(e){var t=d.find(function(t){return t.name===e});t&&d.delete(t)}function a(){return 0===d.length}function n(e){return!!d.find(function(t){return t.name===e})}function i(e){return d.find(function(t){return t.name===e})||null}function o(){return h}function s(){var e=d,t=e.filter(function(e){return!Array.isArray(e.profiles)||e.profiles.includes("core")});return h=Object.freeze({all:{parsers:e,parserRegExp:new RegExp(e.map(function(e){return"("+e.match+")"}).join("|"),"gm")},core:{parsers:t,parserRegExp:new RegExp(t.map(function(e){return"("+e.match+")"}).join("|"),"gm")}})}function u(){return"object"!==(void 0===h?"undefined":_typeof(h))||0===Object.keys(h).length}function l(e){if("object"!==(void 0===h?"undefined":_typeof(h))||!h.hasOwnProperty(e))throw new Error('nonexistent parser profile "'+e+'"');return h[e]}function c(e){return"object"===(void 0===h?"undefined":_typeof(h))&&h.hasOwnProperty(e)}var d=[],h=void 0;return Object.freeze(Object.defineProperties({},{parsers:{get:e},add:{value:t},delete:{value:r},isEmpty:{value:a},has:{value:n},get:{value:i},Profile:{value:Object.freeze(Object.defineProperties({},{profiles:{get:o},compile:{value:s},isEmpty:{value:u},has:{value:c},get:{value:l}}))}}))}()}),Object.defineProperties(t,{helpers:{value:{}},getValue:{value:State.getVar},setValue:{value:State.setVar},parse:{value:Scripting.parse},evalExpression:{value:Scripting.evalTwineScript},evalStatements:{value:Scripting.evalTwineScript},textPrimitives:{value:Patterns}}),Object.defineProperties(t.helpers,{inlineCss:{value:function(){function e(e){var r={classes:[],id:"",styles:{}},a=void 0;do{t.lastIndex=e.nextMatch;var n=t.exec(e.source);a=n&&n.index===e.nextMatch,a&&(n[1]?r.styles[Util.fromCssProperty(n[1])]=n[2].trim():n[3]?r.styles[Util.fromCssProperty(n[3])]=n[4].trim():n[5]?r.classes=r.classes.concat(n[5].slice(1).split(/\./)):n[6]&&(r.id=n[6].slice(1).split(/#/).pop()),e.nextMatch=t.lastIndex)}while(a);return r}var t=new RegExp(Patterns.inlineCss,"gm");return e}()},evalText:{value:function(e){var t=void 0;try{t=Scripting.evalTwineScript(e),null==t||"function"==typeof t?t=e:(t=String(t),/\[(?:object(?:\s+[^\]]+)?|native\s+code)\]/.test(t)&&(t=e))}catch(r){t=e}return t}},evalPassageId:{value:function(e){return null==e||Story.has(e)?e:t.helpers.evalText(e)}},hasBlockContext:{value:function(e){for(var t="function"==typeof window.getComputedStyle,r=e.length-1;r>=0;--r){var a=e[r];switch(a.nodeType){case Node.ELEMENT_NODE:var n=a.nodeName.toUpperCase();if("BR"===n)return!0;var i=t?window.getComputedStyle(a,null):a.currentStyle;if(i&&i.display){if("none"===i.display)continue;return"block"===i.display}switch(n){case"ADDRESS":case"ARTICLE":case"ASIDE":case"BLOCKQUOTE":case"CENTER":case"DIV":case"DL":case"FIGURE":case"FOOTER":case"FORM":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"HEADER":case"HR":case"MAIN":case"NAV":case"OL":case"P":case"PRE":case"SECTION":case"TABLE":case"UL":return!0}return!1;case Node.COMMENT_NODE:continue;default:return!1}}return!0}},createShadowSetterCallback:{value:function(){function e(){if(!n&&!(n=t.Parser.get("macro")))throw new Error('cannot find "macro" parser');return n}function r(){for(var t=n||e(),r=new Set,a=t.context;null!==a;a=a.parent)a._shadows&&a._shadows.forEach(function(e){return r.add(e)});return[].concat(_toConsumableArray(r))}function a(e){var t={};return r().forEach(function(e){var r=e.slice(1),a="$"===e[0]?State.variables:State.temporary;t[e]=a[r]}),function(){var r=Object.keys(t),a=r.length>0?{}:null;try{return r.forEach(function(e){var r=e.slice(1),n="$"===e[0]?State.variables:State.temporary;n.hasOwnProperty(r)&&(a[r]=n[r]),n[r]=t[e]}),Scripting.evalJavaScript(e)}finally{r.forEach(function(e){var r=e.slice(1),n="$"===e[0]?State.variables:State.temporary;t[e]=n[r],a.hasOwnProperty(r)?n[r]=a[r]:delete n[r]})}}}var n=null;return a}()},parseSquareBracketedMarkup:{value:function(e){function t(){return c>=e.source.length?s:e.source[c]}function r(t){return t<1||c+t>=e.source.length?s:e.source[c+t]}function a(){return{error:String.format.apply(String,arguments),pos:c}}function n(){l=c}function i(t){var r=e.source.slice(l,c).trim();if(""===r)throw new Error("malformed wiki "+(f?"link":"image")+", empty "+t+" component");"link"===t&&"~"===r[0]?(u.forceInternal=!0,u.link=r.slice(1)):u[t]=r,l=c}function o(e){++c;e:for(;;){switch(t()){case"\\":++c;var r=t();if(r!==s&&"\n"!==r)break;case s:case"\n":return s;case e:break e}++c}return c}var s=-1,u={},l=e.matchStart,c=l+1,d=void 0,h=void 0,f=void 0,p=void 0;if("["===(p=t()))f=u.isLink=!0;else{switch(f=!1,p){case"<":u.align="left",++c;break;case">":u.align="right",++c}if(!/^[Ii][Mm][Gg]$/.test(e.source.slice(c,c+3)))return a("malformed square-bracketed wiki markup");c+=3,u.isImage=!0}if("["!==function(){return c>=e.source.length?s:e.source[c++]}())return a("malformed wiki {0}",f?"link":"image");d=1,h=0,n();try{e:for(;;){switch(p=t()){case s:case"\n":return a("unterminated wiki {0}",f?"link":"image");case'"':if(o(p)===s)return a("unterminated double quoted string in wiki {0}",f?"link":"image");break;case"'":if((4===h||3===h&&f)&&o(p)===s)return a("unterminated single quoted string in wiki {0}",f?"link":"image");break;case"|":0===h&&(i(f?"text":"title"),++l,h=1);break;case"-":0===h&&">"===r(1)&&(i(f?"text":"title"),++c,l+=2,h=1);break;case"<":0===h&&"-"===r(1)&&(i(f?"link":"source"),++c,l+=2,h=2);break;case"[":if(-1===h)return a("unexpected left square bracket '['");++d,1===d&&(n(),++l);break;case"]":if(0===--d){switch(h){case 0:case 1:i(f?"link":"source"),h=3;break;case 2:i(f?"text":"title"),h=3;break;case 3:f?(i("setter"),h=-1):(i("link"),h=4);break;case 4:i("setter"),h=-1}if(++c,"]"===t()){++c;break e}--c}}++c}}catch(e){return a(e.message)}return u.pos=c,u}}}),t}();!function(){function e(e){this.lookahead.lastIndex=e.matchStart;var t=this.lookahead.exec(e.source);t&&t.index===e.matchStart&&(e.nextMatch=this.lookahead.lastIndex,jQuery(document.createDocumentFragment()).append(t[1]).appendTo(e.output))}Wikifier.Parser.add({name:"quoteByBlock",profiles:["block"],match:"^<<<\\n",terminator:"^<<<\\n",handler:function(e){if(!Wikifier.helpers.hasBlockContext(e.output.childNodes))return void jQuery(e.output).append(document.createTextNode(e.matchText));e.subWikify(jQuery(document.createElement("blockquote")).appendTo(e.output).get(0),this.terminator)}}),Wikifier.Parser.add({name:"quoteByLine",profiles:["block"],match:"^>+",lookahead:/^>+/gm,terminator:"\\n",handler:function(e){if(!Wikifier.helpers.hasBlockContext(e.output.childNodes))return void jQuery(e.output).append(document.createTextNode(e.matchText));var t=[e.output],r=0,a=e.matchLength,n=void 0,i=void 0;do{if(a>r)for(i=r;i<a;++i)t.push(jQuery(document.createElement("blockquote")).appendTo(t[t.length-1]).get(0));else if(a<r)for(i=r;i>a;--i)t.pop();r=a,e.subWikify(t[t.length-1],this.terminator),jQuery(document.createElement("br")).appendTo(t[t.length-1]),this.lookahead.lastIndex=e.nextMatch;var o=this.lookahead.exec(e.source);n=o&&o.index===e.nextMatch,n&&(a=o[0].length,e.nextMatch+=o[0].length)}while(n)}}),Wikifier.Parser.add({name:"macro",profiles:["core"],match:"<<",lookahead:new RegExp("<<(/?"+Patterns.macroName+")(?:\\s*)((?:(?:\"(?:\\\\.|[^\"\\\\])*\")|(?:'(?:\\\\.|[^'\\\\])*')|(?:\\[(?:[<>]?[Ii][Mm][Gg])?\\[[^\\r\\n]*?\\]\\]+)|[^>]|(?:>(?!>)))*)>>","gm"),argsPattern:["(``)","`((?:\\\\.|[^`\\\\])+)`","(\"\"|'')",'("(?:\\\\.|[^"\\\\])+")',"('(?:\\\\.|[^'\\\\])+')","(\\[(?:[<>]?[Ii][Mm][Gg])?\\[[^\\r\\n]*?\\]\\]+)","([^`\"'\\s]+)","(`|\"|')"].join("|"),working:{source:"",name:"",arguments:"",index:0},context:null,handler:function(e){var t=this.lookahead.lastIndex=e.matchStart;if(this.parseTag(e)){var r=e.nextMatch,a=this.working.source,n=this.working.name,i=this.working.arguments,o=void 0;try{if(!(o=Macro.get(n))){if(Macro.tags.has(n)){var s=Macro.tags.get(n);return throwError(e.output,"child tag <<"+n+">> was found outside of a call to its parent macro"+(1===s.length?"":"s")+" <<"+s.join(">>, <<")+">>",e.source.slice(t,e.nextMatch))}return throwError(e.output,"macro <<"+n+">> does not exist",e.source.slice(t,e.nextMatch))}var u=null;if(o.hasOwnProperty("tags")&&!(u=this.parseBody(e,o)))return e.nextMatch=r,throwError(e.output,"cannot find a closing tag for macro <<"+n+">>",e.source.slice(t,e.nextMatch)+"…");if("function"!=typeof o.handler)return throwError(e.output,"macro <<"+n+">> handler function "+(o.hasOwnProperty("handler")?"is not a function":"does not exist"),e.source.slice(t,e.nextMatch));var l=u?u[0].args:this.createArgs(i,o.hasOwnProperty("skipArgs")&&!!o.skipArgs||o.hasOwnProperty("skipArg0")&&!!o.skipArg0);if(o.hasOwnProperty("_MACRO_API")){this.context=new MacroContext({macro:o,name:n,args:l,payload:u,source:a,parent:this.context,parser:e});try{o.handler.call(this.context)}finally{this.context=this.context.parent}}else{var c=e._rawArgs;e._rawArgs=i;try{o.handler(e.output,n,l,e,u)}finally{e._rawArgs=c}}}catch(r){return throwError(e.output,"cannot execute "+(o&&o.isWidget?"widget":"macro")+" <<"+n+">>: "+r.message,e.source.slice(t,e.nextMatch))}finally{this.working.source="",this.working.name="",this.working.arguments="",this.working.index=0}}else e.outputText(e.output,e.matchStart,e.nextMatch)},parseTag:function(e){var t=this.lookahead.exec(e.source);return!(!t||t.index!==e.matchStart||!t[1])&&(e.nextMatch=this.lookahead.lastIndex,this.working.source=e.source.slice(t.index,this.lookahead.lastIndex),this.working.name=t[1],this.working.arguments=t[2],this.working.index=t.index,!0)},parseBody:function(e,t){for(var r=this.working.name,a="/"+r,n="end"+r,i=!!Array.isArray(t.tags)&&t.tags,o=[],s=t.hasOwnProperty("skipArgs")&&t.skipArgs,u=t.hasOwnProperty("skipArg0")&&t.skipArg0,l=-1,c=1,d=this.working.source,h=this.working.name,f=this.working.arguments,p=e.nextMatch;-1!==(e.matchStart=e.source.indexOf(this.match,e.nextMatch));)if(this.parseTag(e)){var g=this.working.source,m=this.working.name,v=this.working.arguments,y=this.working.index,b=e.nextMatch;switch(m){case r:++c;break;case n:case a:--c;break;default:if(1===c&&i)for(var w=0,k=i.length;w<k;++w)m===i[w]&&(o.push({source:d,name:h,arguments:f,args:this.createArgs(f,s||0===o.length&&u),contents:e.source.slice(p,y)}),d=g,h=m,f=v,p=b)}if(0===c){o.push({source:d,name:h,arguments:f,args:this.createArgs(f,s||0===o.length&&u),contents:e.source.slice(p,y)}),l=b;break}}else this.lookahead.lastIndex=e.nextMatch=e.matchStart+this.match.length;return-1!==l?(e.nextMatch=l,o):null},createArgs:function(e,t){var r=t?[]:this.parseArgs(e);return Object.defineProperties(r,{raw:{value:e},full:{value:Scripting.parse(e)}}),r},parseArgs:function(e){for(var t=new RegExp(this.argsPattern,"gm"),r=[],a=new RegExp("^"+Patterns.variable),n=void 0;null!==(n=t.exec(e));){var i=void 0;if(n[1])i=undefined;else if(n[2]){i=n[2];try{i=Scripting.evalTwineScript(i)}catch(e){throw new Error('unable to parse macro argument "'+i+'": '+e.message)}}else if(n[3])i="";else if(n[4]){i=n[4];try{i=Scripting.evalJavaScript(i)}catch(e){throw new Error("unable to parse macro argument '"+i+"': "+e.message)}}else if(n[5]){i=n[5];try{i=Scripting.evalJavaScript(i)}catch(e){throw new Error('unable to parse macro argument "'+i+'": '+e.message)}}else if(n[6]){i=n[6];var o=Wikifier.helpers.parseSquareBracketedMarkup({source:i,matchStart:0});if(o.hasOwnProperty("error"))throw new Error('unable to parse macro argument "'+i+'": '+o.error);if(o.pos<i.length)throw new Error('unable to parse macro argument "'+i+'": unexpected character(s) "'+i.slice(o.pos)+'" (pos: '+o.pos+")");o.isLink?(i={isLink:!0},i.count=o.hasOwnProperty("text")?2:1,i.link=Wikifier.helpers.evalPassageId(o.link),i.text=o.hasOwnProperty("text")?Wikifier.helpers.evalText(o.text):i.link,i.external=!o.forceInternal&&Wikifier.isExternalLink(i.link),i.setFn=o.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(o.setter)):null):o.isImage&&(i=function(e){var t={source:e,isImage:!0};if("data:"!==e.slice(0,5)&&Story.has(e)){var r=Story.get(e);r.tags.includes("Twine.image")&&(t.source=r.text,t.passage=r.title)}return t}(Wikifier.helpers.evalPassageId(o.source)),o.hasOwnProperty("align")&&(i.align=o.align),o.hasOwnProperty("title")&&(i.title=Wikifier.helpers.evalText(o.title)),o.hasOwnProperty("link")&&(i.link=Wikifier.helpers.evalPassageId(o.link),i.external=!o.forceInternal&&Wikifier.isExternalLink(i.link)),i.setFn=o.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(o.setter)):null)}else if(n[7])if(i=n[7],a.test(i))i=State.getVar(i);else if(/^(?:settings|setup)[.[]/.test(i))try{i=Scripting.evalTwineScript(i)}catch(e){throw new Error('unable to parse macro argument "'+i+'": '+e.message)}else if("null"===i)i=null;else if("undefined"===i)i=undefined;else if("true"===i)i=!0;else if("false"===i)i=!1;else{var s=Number(i);Number.isNaN(s)||(i=s)}else if(n[8]){var u=void 0;switch(n[8]){case"`":u="backquote expression";break;case'"':u="double quoted string";break;case"'":u="single quoted string"}
throw new Error("unterminated "+u+" in macro argument string")}r.push(i)}return r}}),Wikifier.Parser.add({name:"prettyLink",profiles:["core"],match:"\\[\\[[^[]",handler:function(e){var t=Wikifier.helpers.parseSquareBracketedMarkup(e);if(t.hasOwnProperty("error"))return void e.outputText(e.output,e.matchStart,e.nextMatch);e.nextMatch=t.pos;var r=Wikifier.helpers.evalPassageId(t.link),a=t.hasOwnProperty("text")?Wikifier.helpers.evalText(t.text):r,n=t.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(t.setter)):null,i=(Config.debug?new DebugView(e.output,"wiki-link","[[link]]",e.source.slice(e.matchStart,e.nextMatch)):e).output;t.forceInternal||!Wikifier.isExternalLink(r)?Wikifier.createInternalLink(i,r,a,n):Wikifier.createExternalLink(i,r,a)}}),Wikifier.Parser.add({name:"urlLink",profiles:["core"],match:Patterns.url,handler:function(e){e.outputText(Wikifier.createExternalLink(e.output,e.matchText),e.matchStart,e.nextMatch)}}),Wikifier.Parser.add({name:"image",profiles:["core"],match:"\\[[<>]?[Ii][Mm][Gg]\\[",handler:function(e){var t=Wikifier.helpers.parseSquareBracketedMarkup(e);if(t.hasOwnProperty("error"))return void e.outputText(e.output,e.matchStart,e.nextMatch);e.nextMatch=t.pos;var r=void 0;Config.debug&&(r=new DebugView(e.output,"wiki-image",t.hasOwnProperty("link")?"[img[][link]]":"[img[]]",e.source.slice(e.matchStart,e.nextMatch)),r.modes({block:!0}));var a=t.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(t.setter)):null,n=(Config.debug?r:e).output,i=void 0;if(t.hasOwnProperty("link")){var o=Wikifier.helpers.evalPassageId(t.link);n=t.forceInternal||!Wikifier.isExternalLink(o)?Wikifier.createInternalLink(n,o,null,a):Wikifier.createExternalLink(n,o),n.classList.add("link-image")}if(n=jQuery(document.createElement("img")).appendTo(n).get(0),i=Wikifier.helpers.evalPassageId(t.source),"data:"!==i.slice(0,5)&&Story.has(i)){var s=Story.get(i);s.tags.includes("Twine.image")&&(n.setAttribute("data-passage",s.title),i=s.text)}n.src=i,t.hasOwnProperty("title")&&(n.title=Wikifier.helpers.evalText(t.title)),t.hasOwnProperty("align")&&(n.align=t.align)}}),Wikifier.Parser.add({name:"monospacedByBlock",profiles:["block"],match:"^\\{\\{\\{\\n",lookahead:/^\{\{\{\n((?:^[^\n]*\n)+?)(^\}\}\}$\n?)/gm,handler:function(e){this.lookahead.lastIndex=e.matchStart;var t=this.lookahead.exec(e.source);if(t&&t.index===e.matchStart){var r=jQuery(document.createElement("pre"));jQuery(document.createElement("code")).text(t[1]).appendTo(r),r.appendTo(e.output),e.nextMatch=this.lookahead.lastIndex}}}),Wikifier.Parser.add({name:"formatByChar",profiles:["core"],match:"''|//|__|\\^\\^|~~|==|\\{\\{\\{",handler:function(e){switch(e.matchText){case"''":e.subWikify(jQuery(document.createElement("strong")).appendTo(e.output).get(0),"''");break;case"//":e.subWikify(jQuery(document.createElement("em")).appendTo(e.output).get(0),"//");break;case"__":e.subWikify(jQuery(document.createElement("u")).appendTo(e.output).get(0),"__");break;case"^^":e.subWikify(jQuery(document.createElement("sup")).appendTo(e.output).get(0),"\\^\\^");break;case"~~":e.subWikify(jQuery(document.createElement("sub")).appendTo(e.output).get(0),"~~");break;case"==":e.subWikify(jQuery(document.createElement("s")).appendTo(e.output).get(0),"==");break;case"{{{":var t=/\{\{\{((?:.|\n)*?)\}\}\}/gm;t.lastIndex=e.matchStart;var r=t.exec(e.source);r&&r.index===e.matchStart&&(jQuery(document.createElement("code")).text(r[1]).appendTo(e.output),e.nextMatch=t.lastIndex)}}}),Wikifier.Parser.add({name:"customStyle",profiles:["core"],match:"@@",terminator:"@@",blockRegExp:/\s*\n/gm,handler:function(e){var t=Wikifier.helpers.inlineCss(e);this.blockRegExp.lastIndex=e.nextMatch;var r=this.blockRegExp.exec(e.source),a=r&&r.index===e.nextMatch,n=jQuery(document.createElement(a?"div":"span")).appendTo(e.output);0===t.classes.length&&""===t.id&&0===Object.keys(t.styles).length?n.addClass("marked"):(t.classes.forEach(function(e){return n.addClass(e)}),""!==t.id&&n.attr("id",t.id),n.css(t.styles)),a?(e.nextMatch+=r[0].length,e.subWikify(n[0],"\\n?"+this.terminator)):e.subWikify(n[0],this.terminator)}}),Wikifier.Parser.add({name:"verbatimText",profiles:["core"],match:'"{3}|<[Nn][Oo][Ww][Ii][Kk][Ii]>',lookahead:/(?:"{3}((?:.|\n)*?)"{3})|(?:<[Nn][Oo][Ww][Ii][Kk][Ii]>((?:.|\n)*?)<\/[Nn][Oo][Ww][Ii][Kk][Ii]>)/gm,handler:function(e){this.lookahead.lastIndex=e.matchStart;var t=this.lookahead.exec(e.source);t&&t.index===e.matchStart&&(e.nextMatch=this.lookahead.lastIndex,jQuery(document.createElement("span")).addClass("verbatim").text(t[1]||t[2]).appendTo(e.output))}}),Wikifier.Parser.add({name:"horizontalRule",profiles:["core"],match:"^----+$\\n?|<[Hh][Rr]\\s*/?>\\n?",handler:function(e){jQuery(document.createElement("hr")).appendTo(e.output)}}),Wikifier.Parser.add({name:"emdash",profiles:["core"],match:"--",handler:function(e){jQuery(document.createTextNode("—")).appendTo(e.output)}}),Wikifier.Parser.add({name:"doubleDollarSign",profiles:["core"],match:"\\${2}",handler:function(e){jQuery(document.createTextNode("$")).appendTo(e.output)}}),Wikifier.Parser.add({name:"nakedVariable",profiles:["core"],match:Patterns.variable+"(?:(?:\\."+Patterns.identifier+")|(?:\\[\\d+\\])|(?:\\[\"(?:\\\\.|[^\"\\\\])+\"\\])|(?:\\['(?:\\\\.|[^'\\\\])+'\\])|(?:\\["+Patterns.variable+"\\]))*",handler:function(e){var t=toStringOrDefault(State.getVar(e.matchText),null);null===t?jQuery(document.createTextNode(e.matchText)).appendTo(e.output):new Wikifier((Config.debug?new DebugView(e.output,"variable",e.matchText,e.matchText):e).output,t)}}),Wikifier.Parser.add({name:"heading",profiles:["block"],match:"^!{1,6}",terminator:"\\n",handler:function(e){if(!Wikifier.helpers.hasBlockContext(e.output.childNodes))return void jQuery(e.output).append(document.createTextNode(e.matchText));e.subWikify(jQuery(document.createElement("h"+e.matchLength)).appendTo(e.output).get(0),this.terminator)}}),Wikifier.Parser.add({name:"table",profiles:["block"],match:"^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",lookahead:/^\|([^\n]*)\|([fhck]?)$/gm,rowTerminator:"\\|(?:[cfhk]?)$\\n?",cellPattern:"(?:\\|([^\\n\\|]*)\\|)|(\\|[cfhk]?$\\n?)",cellTerminator:"(?:\\u0020*)\\|",rowTypes:{c:"caption",f:"tfoot",h:"thead","":"tbody"},handler:function(e){if(!Wikifier.helpers.hasBlockContext(e.output.childNodes))return void jQuery(e.output).append(document.createTextNode(e.matchText));var t=jQuery(document.createElement("table")).appendTo(e.output).get(0),r=[],a=null,n=null,i=0,o=void 0;e.nextMatch=e.matchStart;do{this.lookahead.lastIndex=e.nextMatch;var s=this.lookahead.exec(e.source);if(o=s&&s.index===e.nextMatch){var u=s[2];"k"===u?(t.className=s[1],e.nextMatch+=s[0].length+1):(u!==a&&(a=u,n=jQuery(document.createElement(this.rowTypes[u])).appendTo(t)),"c"===a?(n.css("caption-side",0===i?"top":"bottom"),e.nextMatch+=1,e.subWikify(n[0],this.rowTerminator)):this.rowHandler(e,jQuery(document.createElement("tr")).appendTo(n).get(0),r),++i)}}while(o)},rowHandler:function(e,t,r){var a=this,n=new RegExp(this.cellPattern,"gm"),i=0,o=1,s=void 0;do{n.lastIndex=e.nextMatch;var u=n.exec(e.source);if(s=u&&u.index===e.nextMatch){if("~"===u[1]){var l=r[i];l&&(++l.rowCount,l.$element.attr("rowspan",l.rowCount).css("vertical-align","middle")),e.nextMatch=u.index+u[0].length-1}else if(">"===u[1])++o,e.nextMatch=u.index+u[0].length-1;else{if(u[2]){e.nextMatch=u.index+u[0].length;break}!function(){++e.nextMatch;for(var n=Wikifier.helpers.inlineCss(e),s=!1,u=!1,l=void 0;" "===e.source.substr(e.nextMatch,1);)s=!0,++e.nextMatch;"!"===e.source.substr(e.nextMatch,1)?(l=jQuery(document.createElement("th")).appendTo(t),++e.nextMatch):l=jQuery(document.createElement("td")).appendTo(t),r[i]={rowCount:1,$element:l},o>1&&(l.attr("colspan",o),o=1),e.subWikify(l[0],a.cellTerminator)," "===e.matchText.substr(e.matchText.length-2,1)&&(u=!0),n.classes.forEach(function(e){return l.addClass(e)}),""!==n.id&&l.attr("id",n.id),s&&u?n.styles["text-align"]="center":s?n.styles["text-align"]="right":u&&(n.styles["text-align"]="left"),l.css(n.styles),e.nextMatch=e.nextMatch-1}()}++i}}while(s)}}),Wikifier.Parser.add({name:"list",profiles:["block"],match:"^(?:(?:\\*+)|(?:#+))",lookahead:/^(?:(\*+)|(#+))/gm,terminator:"\\n",handler:function(e){if(!Wikifier.helpers.hasBlockContext(e.output.childNodes))return void jQuery(e.output).append(document.createTextNode(e.matchText));e.nextMatch=e.matchStart;var t=[e.output],r=null,a=0,n=void 0,i=void 0;do{this.lookahead.lastIndex=e.nextMatch;var o=this.lookahead.exec(e.source);if(n=o&&o.index===e.nextMatch){var s=o[2]?"ol":"ul",u=o[0].length;if(e.nextMatch+=o[0].length,u>a)for(i=a;i<u;++i)t.push(jQuery(document.createElement(s)).appendTo(t[t.length-1]).get(0));else if(u<a)for(i=a;i>u;--i)t.pop();else u===a&&s!==r&&(t.pop(),t.push(jQuery(document.createElement(s)).appendTo(t[t.length-1]).get(0)));a=u,r=s,e.subWikify(jQuery(document.createElement("li")).appendTo(t[t.length-1]).get(0),this.terminator)}}while(n)}}),Wikifier.Parser.add({name:"commentByBlock",profiles:["core"],match:"(?:/(?:%|\\*))|(?:\x3c!--)",lookahead:/(?:\/(%|\*)(?:(?:.|\n)*?)\1\/)|(?:<!--(?:(?:.|\n)*?)-->)/gm,handler:function(e){this.lookahead.lastIndex=e.matchStart;var t=this.lookahead.exec(e.source);t&&t.index===e.matchStart&&(e.nextMatch=this.lookahead.lastIndex)}}),Wikifier.Parser.add({name:"lineContinuation",profiles:["core"],match:"\\\\"+Patterns.spaceNoTerminator+"*(?:\\n|$)|(?:^|\\n)"+Patterns.spaceNoTerminator+"*\\\\",handler:function(e){e.nextMatch=e.matchStart+e.matchLength}}),Wikifier.Parser.add({name:"lineBreak",profiles:["core"],match:"\\n|<[Bb][Rr]\\s*/?>",handler:function(e){e.options.nobr||jQuery(document.createElement("br")).appendTo(e.output)}}),Wikifier.Parser.add({name:"htmlCharacterReference",profiles:["core"],match:"(?:(?:&#?[0-9A-Za-z]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9A-Fa-f]|1D[C-Fc-f][0-9A-Fa-f]|20[D-Fd-f][0-9A-Fa-f]|FE2[0-9A-Fa-f])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[0-9A-Za-z]{2,8};)",handler:function(e){jQuery(document.createDocumentFragment()).append(e.matchText).appendTo(e.output)}}),Wikifier.Parser.add({name:"xmlProlog",profiles:["core"],match:"<\\?[Xx][Mm][Ll][^>]*\\?>",handler:function(e){e.nextMatch=e.matchStart+e.matchLength}}),Wikifier.Parser.add({name:"verbatimHtml",profiles:["core"],match:"<[Hh][Tt][Mm][Ll]>",lookahead:/<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/gm,handler:e}),Wikifier.Parser.add({name:"verbatimSvgTag",profiles:["core"],match:"<[Ss][Vv][Gg][^>]*>",lookahead:/(<[Ss][Vv][Gg][^>]*>(?:.|\n)*?<\/[Ss][Vv][Gg]>)/gm,handler:e}),Wikifier.Parser.add({name:"verbatimScriptTag",profiles:["core"],match:"<[Ss][Cc][Rr][Ii][Pp][Tt][^>]*>",lookahead:/(<[Ss][Cc][Rr][Ii][Pp][Tt]*>(?:.|\n)*?<\/[Ss][Cc][Rr][Ii][Pp][Tt]>)/gm,handler:e}),Wikifier.Parser.add({name:"styleTag",profiles:["core"],match:"<[Ss][Tt][Yy][Ll][Ee][^>]*>",lookahead:/(<[Ss][Tt][Yy][Ll][Ee]*>)((?:.|\n)*?)(<\/[Ss][Tt][Yy][Ll][Ee]>)/gm,imageMarkup:new RegExp(Patterns.cssImage,"g"),hasImageMarkup:new RegExp(Patterns.cssImage),handler:function(e){this.lookahead.lastIndex=e.matchStart;var t=this.lookahead.exec(e.source);if(t&&t.index===e.matchStart){e.nextMatch=this.lookahead.lastIndex;var r=t[2];this.hasImageMarkup.test(r)&&(this.imageMarkup.lastIndex=0,r=r.replace(this.imageMarkup,function(e){var t=Wikifier.helpers.parseSquareBracketedMarkup({source:e,matchStart:0});if(t.hasOwnProperty("error")||t.pos<e.length)return e;var r=t.source;if("data:"!==r.slice(0,5)&&Story.has(r)){var a=Story.get(r);a.tags.includes("Twine.image")&&(r=a.text)}return'url("'+r.replace(/"/g,"%22")+'")'})),jQuery(document.createDocumentFragment()).append(t[1]+r+t[3]).appendTo(e.output)}}}),Wikifier.Parser.add({name:"htmlTag",profiles:["core"],match:"<\\w+(?:\\s+[^\\u0000-\\u001F\\u007F-\\u009F\\s\"'>\\/=]+(?:\\s*=\\s*(?:\"[^\"]*?\"|'[^']*?'|[^\\s\"'=<>`]+))?)*\\s*\\/?>",tagPattern:"<(\\w+)",voidElements:["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"],nobrElements:["colgroup","datalist","dl","figure","ol","optgroup","select","table","tbody","tfoot","thead","tr","ul"],handler:function(e){var t=new RegExp(this.tagPattern).exec(e.matchText),r=t&&t[1],a=r&&r.toLowerCase();if(a){var n=this.voidElements.includes(a)||e.matchText.endsWith("/>"),i=this.nobrElements.includes(a),o=void 0,s=void 0;if(!n){o="<\\/"+a+"\\s*>";var u=new RegExp(o,"gim");u.lastIndex=e.matchStart,s=u.exec(e.source)}if(!n&&!s)return throwError(e.output,"cannot find a closing tag for HTML <"+r+">",e.matchText+"…");var l=e.output,c=document.createElement(e.output.tagName),d=void 0;for(c.innerHTML=e.matchText;c.firstChild;)c=c.firstChild;try{this.processAttributeDirectives(c)}catch(t){return throwError(e.output,"<"+a+">: "+t.message,e.matchText+"…")}c.hasAttribute("data-passage")&&(this.processDataAttributes(c),Config.debug&&(d=new DebugView(e.output,"html-"+a,a,e.matchText),d.modes({block:"img"===a,nonvoid:s}),l=d.output)),s&&(e.subWikify(c,o,{ignoreTerminatorCase:!0,nobr:i}),d&&jQuery(c).find(".debug.block").length>0&&d.modes({block:!0})),l.appendChild(c)}},processAttributeDirectives:function(e){[].concat(_toConsumableArray(e.attributes)).forEach(function(t){var r=t.name,a=t.value,n="@"===r[0];if(n||r.startsWith("sc-eval:")){var i=r.slice(n?1:8),o=void 0;try{o=Scripting.evalTwineScript(a)}catch(e){throw new Error('bad evaluation from attribute directive "'+r+'": '+e.message)}try{e.setAttribute(i,o),e.removeAttribute(r)}catch(e){throw new Error('cannot transform attribute directive "'+r+'" into attribute "'+i+'"')}}})},processDataAttributes:function(e){var t=e.getAttribute("data-passage");if(null!=t){var r=Wikifier.helpers.evalPassageId(t);if(r!==t&&(t=r,e.setAttribute("data-passage",r)),""!==t)if("IMG"===e.tagName.toUpperCase())"data:"!==t.slice(0,5)&&Story.has(t)&&(t=Story.get(t),t.tags.includes("Twine.image")&&(e.src=t.text.trim()));else{var a=e.getAttribute("data-setter"),n=void 0;null!=a&&""!==(a=String(a).trim())&&(n=Wikifier.helpers.createShadowSetterCallback(Scripting.parse(a))),Story.has(t)?(e.classList.add("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(t)&&e.classList.add("link-visited")):e.classList.add("link-broken"),jQuery(e).ariaClick({one:!0},function(){"function"==typeof n&&n.call(this),Engine.play(t)})}}}})}();var Macro=function(){function e(t,r,n){if(Array.isArray(t))return void t.forEach(function(t){return e(t,r,n)});if(!h.test(t))throw new Error('invalid macro name "'+t+'"');if(a(t))throw new Error("cannot clobber existing macro <<"+t+">>");if(u(t))throw new Error("cannot clobber child tag <<"+t+">> of parent macro"+(1===d[t].length?"":"s")+" <<"+d[t].join(">>, <<")+">>");try{if("object"===(void 0===r?"undefined":_typeof(r)))c[t]=n?clone(r):r;else{if(!a(r))throw new Error("cannot create alias of nonexistent macro <<"+r+">>");c[t]=n?clone(c[r]):c[r]}Object.defineProperty(c,t,{writable:!1}),c[t]._MACRO_API=!0}catch(e){throw"TypeError"===e.name?new Error("cannot clobber protected macro <<"+t+">>"):new Error("unknown error when attempting to add macro <<"+t+">>: ["+e.name+"] "+e.message)}if(c[t].hasOwnProperty("tags"))if(null==c[t].tags)o(t);else{if(!Array.isArray(c[t].tags))throw new Error('bad value for "tags" property of macro <<'+t+">>");o(t,c[t].tags)}}function t(e){if(Array.isArray(e))return void e.forEach(function(e){return t(e)});if(a(e)){c[e].hasOwnProperty("tags")&&s(e);try{Object.defineProperty(c,e,{writable:!0}),delete c[e]}catch(t){throw new Error("unknown error removing macro <<"+e+">>: "+t.message)}}else if(u(e))throw new Error("cannot remove child tag <<"+e+">> of parent macro <<"+d[e]+">>")}function r(){return 0===Object.keys(c).length}function a(e){return c.hasOwnProperty(e)}function n(e){var t=null;return a(e)&&"function"==typeof c[e].handler?t=c[e]:macros.hasOwnProperty(e)&&"function"==typeof macros[e].handler&&(t=macros[e]),t}function i(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"init";Object.keys(c).forEach(function(t){"function"==typeof c[t][e]&&c[t][e](t)}),Object.keys(macros).forEach(function(t){"function"==typeof macros[t][e]&&macros[t][e](t)})}function o(e,t){if(!e)throw new Error("no parent specified");for(var r=["/"+e,"end"+e],n=[].concat(r,Array.isArray(t)?t:[]),i=0;i<n.length;++i){var o=n[i];if(a(o))throw new Error("cannot register tag for an existing macro");u(o)?d[o].includes(e)||(d[o].push(e),d[o].sort()):d[o]=[e]}}function s(e){if(!e)throw new Error("no parent specified");Object.keys(d).forEach(function(t){var r=d[t].indexOf(e);-1!==r&&(1===d[t].length?delete d[t]:d[t].splice(r,1))})}function u(e){return d.hasOwnProperty(e)}function l(e){return u(e)?d[e]:null}var c={},d={},h=new RegExp("^(?:"+Patterns.macroName+")$");return Object.freeze(Object.defineProperties({},{add:{value:e},delete:{value:t},isEmpty:{value:r},has:{value:a},get:{value:n},init:{value:i},tags:{value:Object.freeze(Object.defineProperties({},{register:{value:o},unregister:{value:s},has:{value:u},get:{value:l}}))},evalStatements:{value:function(){return Scripting.evalJavaScript.apply(Scripting,arguments)}}}))}(),MacroContext=function(){return function(){function e(t){_classCallCheck(this,e);var r=Object.assign({parent:null,macro:null,name:"",args:null,payload:null,parser:null,source:""},t);if(null===r.macro||""===r.name||null===r.parser)throw new TypeError("context object missing required properties");Object.defineProperties(this,{self:{value:r.macro},name:{value:r.name},args:{value:r.args},payload:{value:r.payload},source:{value:r.source},parent:{value:r.parent},parser:{value:r.parser},_output:{value:r.parser.output},_shadows:{writable:!0,value:null},_debugView:{writable:!0,value:null},_debugViewEnabled:{writable:!0,value:Config.debug}})}return _createClass(e,[{key:"contextHas",value:function(e){for(var t=this;null!==(t=t.parent);)if(e(t))return!0;return!1}},{key:"contextSelect",value:function(e){for(var t=this;null!==(t=t.parent);)if(e(t))return t;return null}},{key:"contextSelectAll",value:function(e){for(var t=[],r=this;null!==(r=r.parent);)e(r)&&t.push(r);return t}},{key:"addShadow",value:function(){var e=this;this._shadows||(this._shadows=new Set);for(var t=new RegExp("^"+Patterns.variable+"$"),r=arguments.length,a=Array(r),n=0;n<r;n++)a[n]=arguments[n];a.flatten().forEach(function(r){if("string"!=typeof r)throw new TypeError("variable name must be a string; type: "+(void 0===r?"undefined":_typeof(r)));if(!t.test(r))throw new Error('invalid variable name "'+r+'"');e._shadows.add(r)})}},{key:"createShadowWrapper",value:function(e,t,r){var a=this,n=void 0;return"function"==typeof e&&(n={},this.shadowView.forEach(function(e){var t=e.slice(1),r="$"===e[0]?State.variables:State.temporary;n[e]=r[t]})),function(){for(var i=arguments.length,o=Array(i),s=0;s<i;s++)o[s]=arguments[s];if("function"==typeof r&&r.apply(this,o),"function"==typeof e){var u=Object.keys(n),l=u.length>0?{}:null,c=Wikifier.Parser.get("macro"),d=void 0;try{u.forEach(function(e){var t=e.slice(1),r="$"===e[0]?State.variables:State.temporary;r.hasOwnProperty(t)&&(l[t]=r[t]),r[t]=n[e]}),d=c.context,c.context=a,e.apply(this,o)}finally{d!==undefined&&(c.context=d),u.forEach(function(e){var t=e.slice(1),r="$"===e[0]?State.variables:State.temporary;n[e]=r[t],l.hasOwnProperty(t)?r[t]=l[t]:delete r[t]})}}"function"==typeof t&&t.apply(this,o)}}},{key:"createDebugView",value:function(e,t){return this._debugView=new DebugView(this._output,"macro",e||this.name,t||this.source),null!==this.payload&&this.payload.length>0&&this._debugView.modes({nonvoid:!0}),this._debugViewEnabled=!0,this._debugView}},{key:"removeDebugView",value:function(){null!==this._debugView&&(this._debugView.remove(),this._debugView=null),this._debugViewEnabled=!1}},{key:"error",value:function(e,t){return throwError(this._output,"<<"+this.name+">>: "+e,t||this.source)}},{key:"output",get:function(){return this._debugViewEnabled?this.debugView.output:this._output}},{key:"shadows",get:function(){return[].concat(_toConsumableArray(this._shadows))}},{key:"shadowView",get:function(){var e=new Set;return this.contextSelectAll(function(e){return e._shadows}).forEach(function(t){return t._shadows.forEach(function(t){return e.add(t)})}),[].concat(_toConsumableArray(e))}},{key:"debugView",get:function(){return this._debugViewEnabled?null!==this._debugView?this._debugView:this.createDebugView():null}}]),e}()}();!function(){if(Macro.add("capture",{skipArgs:!0,tags:null,handler:function(){if(0===this.args.raw.length)return this.error("no story/temporary variable list specified");var e={};try{for(var t=new RegExp("("+Patterns.variable+")","g"),r=void 0;null!==(r=t.exec(this.args.raw));){var a=r[1],n=a.slice(1),i="$"===a[0]?State.variables:State.temporary;i.hasOwnProperty(n)&&(e[n]=i[n]),this.addShadow(a)}new Wikifier(this.output,this.payload[0].contents)}finally{this.shadows.forEach(function(t){var r=t.slice(1),a="$"===t[0]?State.variables:State.temporary;e.hasOwnProperty(r)?a[r]=e[r]:delete a[r]})}}}),Macro.add("set",{skipArgs:!0,handler:function(){if(0===this.args.full.length)return this.error("no expression specified");try{Scripting.evalJavaScript(this.args.full)}catch(e){return this.error("bad evaluation: "+("object"===(void 0===e?"undefined":_typeof(e))?e.message:e))}Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("unset",{skipArgs:!0,handler:function(){if(0===this.args.full.length)return this.error("no story/temporary variable list specified");for(var e=new RegExp("State\\.(variables|temporary)\\.("+Patterns.identifier+")","g"),t=void 0;null!==(t=e.exec(this.args.full));){var r=State[t[1]],a=t[2];r.hasOwnProperty(a)&&delete r[a]}Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("remember",{skipArgs:!0,handler:function(){if(0===this.args.full.length)return this.error("no expression specified");try{Scripting.evalJavaScript(this.args.full)}catch(e){return this.error("bad evaluation: "+("object"===(void 0===e?"undefined":_typeof(e))?e.message:e))}for(var e=storage.get("remember")||{},t=new RegExp("State\\.variables\\.("+Patterns.identifier+")","g"),r=void 0;null!==(r=t.exec(this.args.full));){var a=r[1];e[a]=State.variables[a]}if(!storage.set("remember",e))return this.error("unknown error, cannot remember: "+this.args.raw);Config.debug&&this.debugView.modes({hidden:!0})},init:function(){var e=storage.get("remember");e&&Object.keys(e).forEach(function(t){return State.variables[t]=e[t]})}}),Macro.add("forget",{skipArgs:!0,handler:function(){if(0===this.args.full.length)return this.error("no story variable list specified");for(var e=storage.get("remember"),t=new RegExp("State\\.variables\\.("+Patterns.identifier+")","g"),r=void 0,a=!1;null!==(r=t.exec(this.args.full));){var n=r[1];State.variables.hasOwnProperty(n)&&delete State.variables[n],e&&e.hasOwnProperty(n)&&(a=!0,delete e[n])}if(a&&!storage.set("remember",e))return this.error("unknown error, cannot update remember store");Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("run","set"),Macro.add("script",{skipArgs:!0,tags:null,handler:function(){var e=document.createDocumentFragment();try{Scripting.evalJavaScript(this.payload[0].contents,e),Config.debug&&this.createDebugView(this.name,this.source+this.payload[0].contents+"<</"+this.name+">>")}catch(e){return this.error("bad evaluation: "+("object"===(void 0===e?"undefined":_typeof(e))?e.message:e),this.source+this.payload[0].contents+"<</"+this.name+">>")}e.hasChildNodes()&&this.output.appendChild(e)}}),Macro.add("include",{handler:function(){if(0===this.args.length)return this.error("no passage specified");var e=void 0;if(e="object"===_typeof(this.args[0])?this.args[0].link:this.args[0],!Story.has(e))return this.error('passage "'+e+'" does not exist');Config.debug&&this.debugView.modes({block:!0}),e=Story.get(e);var t=void 0;t=this.args[1]?jQuery(document.createElement(this.args[1])).addClass(e.domId+" macro-"+this.name).attr("data-passage",e.title).appendTo(this.output):jQuery(this.output),t.wiki(e.processText())}}),Macro.add("nobr",{skipArgs:!0,tags:null,handler:function(){new Wikifier(this.output,this.payload[0].contents.replace(/^\n+|\n+$/g,"").replace(/\n+/g," "))}}),Macro.add(["print","=","-"],{skipArgs:!0,handler:function(){if(0===this.args.full.length)return this.error("no expression specified");try{var e=toStringOrDefault(Scripting.evalJavaScript(this.args.full),null);null!==e&&new Wikifier(this.output,"-"===this.name?Util.escape(e):e)}catch(e){return this.error("bad evaluation: "+("object"===(void 0===e?"undefined":_typeof(e))?e.message:e))}}}),Macro.add("silently",{skipArgs:!0,tags:null,handler:function(){var e=document.createDocumentFragment();if(new Wikifier(e,this.payload[0].contents.trim()),Config.debug)this.debugView.modes({hidden:!0}),this.output.appendChild(e);else{var t=[].concat(_toConsumableArray(e.querySelectorAll(".error"))).map(function(e){return e.textContent});if(t.length>0)return this.error("error"+(1===t.length?"":"s")+" within contents ("+t.join("; ")+")",this.source+this.payload[0].contents+"<</"+this.name+">>")}}}),Macro.add("display","include"),Macro.add("if",{skipArgs:!0,tags:["elseif","else"],handler:function(){var e=void 0;try{var t=this.payload.length;for(e=0;e<t;++e)switch(this.payload[e].name){case"else":if(this.payload[e].args.raw.length>0)return/^\s*if\b/i.test(this.payload[e].args.raw)?this.error('whitespace is not allowed between the "else" and "if" in <<elseif>> clause'+(e>0?" (#"+e+")":"")):this.error("<<else>> does not accept a conditional expression (perhaps you meant to use <<elseif>>), invalid: "+this.payload[e].args.raw);if(e+1!==t)return this.error("<<else>> must be the final clause");break;default:if(0===this.payload[e].args.full.length)return this.error("no conditional expression specified for <<"+this.payload[e].name+">> clause"+(e>0?" (#"+e+")":""));if(Config.macros.ifAssignmentError&&/[^!=&^|<>*\/%+-]=[^=]/.test(this.payload[e].args.full))return this.error("assignment operator found within <<"+this.payload[e].name+">> clause"+(e>0?" (#"+e+")":"")+" (perhaps you meant to use an equality operator: ==, ===, eq, is), invalid: "+this.payload[e].args.raw)}var r=Scripting.evalJavaScript,a=!1;for(e=0;e<t;++e){if(Config.debug&&this.createDebugView(this.payload[e].name,this.payload[e].source).modes({nonvoid:!1}),"else"===this.payload[e].name||r(this.payload[e].args.full)){a=!0,new Wikifier(this.output,this.payload[e].contents);break}Config.debug&&this.debugView.modes({hidden:!0,invalid:!0})}if(Config.debug){for(++e;e<t;++e)this.createDebugView(this.payload[e].name,this.payload[e].source).modes({nonvoid:!1,hidden:!0,invalid:!0});this.createDebugView("/"+this.name,"<</"+this.name+">>").modes({nonvoid:!1,hidden:!a,invalid:!a})}}catch(t){return this.error("bad conditional expression in <<"+(0===e?"if":"elseif")+">> clause"+(e>0?" (#"+e+")":"")+": "+("object"===(void 0===t?"undefined":_typeof(t))?t.message:t))}}}),Macro.add("switch",{skipArg0:!0,tags:["case","default"],handler:function(){if(0===this.args.full.length)return this.error("no expression specified");var e=this.payload.length;if(1===e)return this.error("no cases specified");var t=void 0;for(t=1;t<e;++t)switch(this.payload[t].name){case"default":if(this.payload[t].args.length>0)return this.error("<<default>> does not accept values, invalid: "+this.payload[t].args.raw);if(t+1!==e)return this.error("<<default>> must be the final case");break;default:if(0===this.payload[t].args.length)return this.error("no value(s) specified for <<"+this.payload[t].name+">> (#"+t+")")}var r=void 0;try{r=Scripting.evalJavaScript(this.args.full)}catch(e){return this.error("bad evaluation: "+("object"===(void 0===e?"undefined":_typeof(e))?e.message:e))}var a=this.debugView,n=!1;for(Config.debug&&a.modes({nonvoid:!1,hidden:!0}),t=1;t<e;++t){if(Config.debug&&this.createDebugView(this.payload[t].name,this.payload[t].source).modes({nonvoid:!1}),"default"===this.payload[t].name||this.payload[t].args.some(function(e){return e===r})){n=!0,new Wikifier(this.output,this.payload[t].contents);break}Config.debug&&this.debugView.modes({hidden:!0,invalid:!0})}if(Config.debug){for(++t;t<e;++t)this.createDebugView(this.payload[t].name,this.payload[t].source).modes({nonvoid:!1,hidden:!0,invalid:!0});a.modes({nonvoid:!1,hidden:!0,invalid:!n}),this.createDebugView("/"+this.name,"<</"+this.name+">>").modes({nonvoid:!1,hidden:!0,invalid:!n})}}}),Macro.add("for",{skipArgs:!0,tags:null,_hasRangeRe:new RegExp("^\\S.*?\\s+range\\s+\\S.*?$"),_rangeRe:new RegExp("^(?:State\\.(variables|temporary)\\.("+Patterns.identifier+")\\s*,\\s*)?State\\.(variables|temporary)\\.("+Patterns.identifier+")\\s+range\\s+(\\S.*?)$"),_3PartRe:/^([^;]*?)\s*;\s*([^;]*?)\s*;\s*([^;]*?)$/,handler:function(){var e=this.args.full.trim(),t=this.payload[0].contents.replace(/\n$/,"");if(0===e.length)this.self._handleFor.call(this,t,null,!0,null);else if(this.self._hasRangeRe.test(e)){var r=e.match(this.self._rangeRe);if(null===r)return this.error("invalid range form syntax, format: [index ,] value range collection");this.self._handleForRange.call(this,t,{type:r[1],name:r[2]},{type:r[3],name:r[4]},r[5])}else{var a=void 0,n=void 0,i=void 0;if(-1===e.indexOf(";")){if(/^\S+\s+in\s+\S+/i.test(e))return this.error("invalid syntax, for…in is not supported; see: for…range");if(/^\S+\s+of\s+\S+/i.test(e))return this.error("invalid syntax, for…of is not supported; see: for…range");n=e}else{var o=e.match(this.self._3PartRe);if(null===o)return this.error("invalid 3-part conditional form syntax, format: [init] ; [condition] ; [post]");a=o[1],n=o[2].trim(),i=o[3],0===n.length&&(n=!0)}this.self._handleFor.call(this,t,a,n,i)}},_handleFor:function(e,t,r,a){var n=Scripting.evalJavaScript,i=!0,o=Config.macros.maxLoopIterations;Config.debug&&this.debugView.modes({block:!0});try{if(TempState.break=null,t)try{n(t)}catch(e){return this.error("bad init expression: "+("object"===(void 0===e?"undefined":_typeof(e))?e.message:e))}for(;n(r);){if(--o<0)return this.error("exceeded configured maximum loop iterations ("+Config.macros.maxLoopIterations+")");if(new Wikifier(this.output,i?e.replace(/^\n/,""):e),i&&(i=!1),null!=TempState.break)if(1===TempState.break)TempState.break=null;else if(2===TempState.break){TempState.break=null;break}if(a)try{n(a)}catch(e){return this.error("bad post expression: "+("object"===(void 0===e?"undefined":_typeof(e))?e.message:e))}}}catch(e){return this.error("bad conditional expression: "+("object"===(void 0===e?"undefined":_typeof(e))?e.message:e))}finally{TempState.break=null}},_handleForRange:function(e,t,r,a){var n=!0,i=void 0;try{i=this.self._toRangeList(a)}catch(e){return this.error(e.message)}Config.debug&&this.debugView.modes({block:!0});try{TempState.break=null;for(var o=0;o<i.length;++o)if(t.name&&(State[t.type][t.name]=i[o][0]),State[r.type][r.name]=i[o][1],new Wikifier(this.output,n?e.replace(/^\n/,""):e),n&&(n=!1),null!=TempState.break)if(1===TempState.break)TempState.break=null;else if(2===TempState.break){TempState.break=null;break}}catch(e){return this.error("object"===(void 0===e?"undefined":_typeof(e))?e.message:e)}finally{TempState.break=null}},_toRangeList:function(e){var t=Scripting.evalJavaScript,r=void 0;try{r=t("{"===e[0]?"("+e+")":e)}catch(e){if("object"!==(void 0===e?"undefined":_typeof(e)))throw new Error("bad range expression: "+e);throw e.message="bad range expression: "+e.message,e}var a=void 0;switch(void 0===r?"undefined":_typeof(r)){case"string":a=[];for(var n=0;n<r.length;){var i=Util.charAndPosAt(r,n);a.push([n,i.char]),n=1+i.end}break;case"object":if(Array.isArray(r))a=r.map(function(e,t){return[t,e]});else if(r instanceof Set)a=[].concat(_toConsumableArray(r)).map(function(e,t){return[t,e]});else if(r instanceof Map)a=[].concat(_toConsumableArray(r.entries()));else{if("Object"!==Util.toStringTag(r))throw new Error("unsupported range expression type: "+Util.toStringTag(r));a=Object.keys(r).map(function(e){return[e,r[e]]})}break;default:
throw new Error("unsupported range expression type: "+(void 0===r?"undefined":_typeof(r)))}return a}}),Macro.add(["break","continue"],{skipArgs:!0,handler:function(){if(!this.contextHas(function(e){return"for"===e.name}))return this.error("must only be used in conjunction with its parent macro <<for>>");TempState.break="continue"===this.name?1:2,Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add(["button","link"],{isAsync:!0,tags:null,handler:function(){var e=this;if(0===this.args.length)return this.error("no "+("button"===this.name?"button":"link")+" text specified");Config.debug&&this.createDebugView(this.name,this.source+this.payload[0].contents+"<</"+this.name+">>");var t=jQuery(document.createElement("button"===this.name?"button":"a")),r=void 0;if("object"===_typeof(this.args[0]))if(this.args[0].isImage){var a=jQuery(document.createElement("img")).attr("src",this.args[0].source).appendTo(t);this.args[0].hasOwnProperty("passage")&&a.attr("data-passage",this.args[0].passage),this.args[0].hasOwnProperty("title")&&a.attr("title",this.args[0].title),this.args[0].hasOwnProperty("align")&&a.attr("align",this.args[0].align),this.args[0].hasOwnProperty("link")&&(r=this.args[0].link),r=this.args[0].link}else t.append(document.createTextNode(this.args[0].text)),r=this.args[0].link;else t.wikiWithOptions({profile:"core"},this.args[0]),r=this.args.length>1?this.args[1]:undefined;null!=r?(t.attr("data-passage",r),Story.has(r)?(t.addClass("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(r)&&t.addClass("link-visited")):t.addClass("link-broken")):t.addClass("link-internal"),t.addClass("macro-"+this.name).ariaClick({namespace:".macros",one:null!=r},this.createShadowWrapper(""!==this.payload[0].contents?function(){return Wikifier.wikifyEval(e.payload[0].contents.trim())}:null,null!=r?function(){return Engine.play(r)}:null)).appendTo(this.output)}}),Macro.add("checkbox",{handler:function(){if(this.args.length<3){var e=[];return this.args.length<1&&e.push("variable name"),this.args.length<2&&e.push("unchecked value"),this.args.length<3&&e.push("checked value"),this.error("no "+e.join(" or ")+" specified")}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var t=this.args[0].trim();if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var r=Util.slugify(t),a=this.args[1],n=this.args[2],i=document.createElement("input");jQuery(i).attr({id:this.name+"-"+r,name:this.name+"-"+r,type:"checkbox",tabindex:0}).addClass("macro-"+this.name).on("change",function(){State.setVar(t,this.checked?n:a)}).appendTo(this.output),this.args.length>3&&"checked"===this.args[3]?(i.checked=!0,State.setVar(t,n)):State.setVar(t,a)}}),Macro.add(["linkappend","linkprepend","linkreplace"],{isAsync:!0,tags:null,handler:function(){var e=this;if(0===this.args.length)return this.error("no link text specified");Config.debug&&this.createDebugView(this.name,this.source+this.payload[0].contents+"<</"+this.name+">>");var t=jQuery(document.createElement("a")),r=jQuery(document.createElement("span")),a=this.args.length>1&&/^(?:transition|t8n)$/.test(this.args[1]);t.wikiWithOptions({profile:"core"},this.args[0]).addClass("link-internal macro-"+this.name).ariaClick({namespace:".macros",one:!0},this.createShadowWrapper(function(){if("linkreplace"===e.name?t.remove():t.wrap('<span class="macro-'+e.name+'"></span>').replaceWith(function(){return t.html()}),""!==e.payload[0].contents){var n=document.createDocumentFragment();new Wikifier(n,e.payload[0].contents),r.append(n)}a&&setTimeout(function(){return r.removeClass("macro-"+e.name+"-in")},Engine.minDomActionDelay)})).appendTo(this.output),r.addClass("macro-"+this.name+"-insert"),a&&r.addClass("macro-"+this.name+"-in"),"linkprepend"===this.name?r.insertBefore(t):r.insertAfter(t)}}),Macro.add("radiobutton",{handler:function(){if(this.args.length<2){var e=[];return this.args.length<1&&e.push("variable name"),this.args.length<2&&e.push("checked value"),this.error("no "+e.join(" or ")+" specified")}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var t=this.args[0].trim();if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var r=Util.slugify(t),a=this.args[1],n=document.createElement("input");TempState.hasOwnProperty(this.name)||(TempState[this.name]={}),TempState[this.name].hasOwnProperty(r)||(TempState[this.name][r]=0),jQuery(n).attr({id:this.name+"-"+r+"-"+TempState[this.name][r]++,name:this.name+"-"+r,type:"radio",tabindex:0}).addClass("macro-"+this.name).on("change",function(){this.checked&&State.setVar(t,a)}).appendTo(this.output),this.args.length>2&&"checked"===this.args[2]&&(n.checked=!0,State.setVar(t,a))}}),Macro.add("textarea",{handler:function(){if(this.args.length<2){var e=[];return this.args.length<1&&e.push("variable name"),this.args.length<2&&e.push("default value"),this.error("no "+e.join(" or ")+" specified")}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var t=this.args[0].trim();if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');Config.debug&&this.debugView.modes({block:!0});var r=Util.slugify(t),a=this.args[1],n="autofocus"===this.args[2],i=document.createElement("textarea");jQuery(i).attr({id:this.name+"-"+r,name:this.name+"-"+r,rows:4,tabindex:0}).addClass("macro-"+this.name).on("change",function(){State.setVar(t,this.value)}).appendTo(this.output),State.setVar(t,a),i.textContent=a,n&&(i.setAttribute("autofocus","autofocus"),postdisplay["#autofocus:"+i.id]=function(e){delete postdisplay[e],setTimeout(function(){return i.focus()},Engine.minDomActionDelay)})}}),Macro.add("textbox",{handler:function(){if(this.args.length<2){var e=[];return this.args.length<1&&e.push("variable name"),this.args.length<2&&e.push("default value"),this.error("no "+e.join(" or ")+" specified")}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var t=this.args[0].trim();if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');Config.debug&&this.debugView.modes({block:!0});var r=Util.slugify(t),a=this.args[1],n=document.createElement("input"),i=!1,o=void 0;this.args.length>3?(o=this.args[2],i="autofocus"===this.args[3]):this.args.length>2&&("autofocus"===this.args[2]?i=!0:o=this.args[2]),"object"===(void 0===o?"undefined":_typeof(o))&&(o=o.link),jQuery(n).attr({id:this.name+"-"+r,name:this.name+"-"+r,type:"text",tabindex:0}).addClass("macro-"+this.name).on("change",function(){State.setVar(t,this.value)}).on("keypress",function(e){13===e.which&&(e.preventDefault(),State.setVar(t,this.value),null!=o&&Engine.play(o))}).appendTo(this.output),State.setVar(t,a),n.value=a,i&&(n.setAttribute("autofocus","autofocus"),postdisplay["#autofocus:"+n.id]=function(e){delete postdisplay[e],setTimeout(function(){return n.focus()},Engine.minDomActionDelay)})}}),Macro.add("click","link"),Macro.add("actions",{handler:function(){for(var e=jQuery(document.createElement("ul")).addClass(this.name).appendTo(this.output),t=0;t<this.args.length;++t){var r=void 0,a=void 0,n=void 0,i=void 0;"object"===_typeof(this.args[t])?this.args[t].isImage?(n=jQuery(document.createElement("img")).attr("src",this.args[t].source),this.args[t].hasOwnProperty("passage")&&n.attr("data-passage",this.args[t].passage),this.args[t].hasOwnProperty("title")&&n.attr("title",this.args[t].title),this.args[t].hasOwnProperty("align")&&n.attr("align",this.args[t].align),r=this.args[t].link,i=this.args[t].setFn):(a=this.args[t].text,r=this.args[t].link,i=this.args[t].setFn):a=r=this.args[t],State.variables.hasOwnProperty("#actions")&&State.variables["#actions"].hasOwnProperty(r)&&State.variables["#actions"][r]||jQuery(Wikifier.createInternalLink(jQuery(document.createElement("li")).appendTo(e),r,null,function(e,t){return function(){State.variables.hasOwnProperty("#actions")||(State.variables["#actions"]={}),State.variables["#actions"][e]=!0,"function"==typeof t&&t()}}(r,i))).addClass("macro-"+this.name).append(n||document.createTextNode(a))}}}),Macro.add(["back","return"],{handler:function(){if(this.args.length>1)return this.error("too many arguments specified, check the documentation for details");var e=-1,t=void 0,r=void 0,a=void 0;if(1===this.args.length&&("object"===_typeof(this.args[0])?this.args[0].isImage?(a=jQuery(document.createElement("img")).attr("src",this.args[0].source),this.args[0].hasOwnProperty("passage")&&a.attr("data-passage",this.args[0].passage),this.args[0].hasOwnProperty("title")&&a.attr("title",this.args[0].title),this.args[0].hasOwnProperty("align")&&a.attr("align",this.args[0].align),this.args[0].hasOwnProperty("link")&&(t=this.args[0].link)):1===this.args[0].count?t=this.args[0].link:(r=this.args[0].text,t=this.args[0].link):1===this.args.length&&(r=this.args[0])),null==t){for(var n=State.length-2;n>=0;--n)if(State.history[n].title!==State.passage){e=n,t=State.history[n].title;break}if(null==t&&"return"===this.name)for(var i=State.expired.length-1;i>=0;--i)if(State.expired[i]!==State.passage){t=State.expired[i];break}}else{if(!Story.has(t))return this.error('passage "'+t+'" does not exist');if("back"===this.name){for(var o=State.length-2;o>=0;--o)if(State.history[o].title===t){e=o;break}if(-1===e)return this.error('cannot find passage "'+t+'" in the current story history')}}if(null==t)return this.error("cannot find passage");var s=void 0;s="back"!==this.name||-1!==e?jQuery(document.createElement("a")).addClass("link-internal").ariaClick({one:!0},"return"===this.name?function(){return Engine.play(t)}:function(){return Engine.goTo(e)}):jQuery(document.createElement("span")).addClass("link-disabled"),s.addClass("macro-"+this.name).append(a||document.createTextNode(r||L10n.get("macro"+this.name.toUpperFirst()+"Text"))).appendTo(this.output)}}),Macro.add("choice",{handler:function(){if(0===this.args.length)return this.error("no passage specified");var e=State.passage,t=void 0,r=void 0,a=void 0,n=void 0;if(1===this.args.length?"object"===_typeof(this.args[0])?this.args[0].isImage?(a=jQuery(document.createElement("img")).attr("src",this.args[0].source),this.args[0].hasOwnProperty("passage")&&a.attr("data-passage",this.args[0].passage),this.args[0].hasOwnProperty("title")&&a.attr("title",this.args[0].title),this.args[0].hasOwnProperty("align")&&a.attr("align",this.args[0].align),t=this.args[0].link,n=this.args[0].setFn):(r=this.args[0].text,t=this.args[0].link,n=this.args[0].setFn):r=t=this.args[0]:(t=this.args[0],r=this.args[1]),State.variables.hasOwnProperty("#choice")&&State.variables["#choice"].hasOwnProperty(e)&&State.variables["#choice"][e])return void jQuery(document.createElement("span")).addClass("link-disabled macro-"+this.name).attr("tabindex",-1).append(a||document.createTextNode(r)).appendTo(this.output);jQuery(Wikifier.createInternalLink(this.output,t,null,function(){State.variables.hasOwnProperty("#choice")||(State.variables["#choice"]={}),State.variables["#choice"][e]=!0,"function"==typeof n&&n()})).addClass("macro-"+this.name).append(a||document.createTextNode(r))}}),Macro.add(["addclass","toggleclass"],{handler:function(){if(this.args.length<2){var e=[];return this.args.length<1&&e.push("selector"),this.args.length<2&&e.push("class names"),this.error("no "+e.join(" or ")+" specified")}var t=jQuery(this.args[0]);if(0===t.length)return this.error('no elements matched the selector "'+this.args[0]+'"');switch(this.name){case"addclass":t.addClass(this.args[1].trim());break;case"toggleclass":t.toggleClass(this.args[1].trim())}}}),Macro.add("removeclass",{handler:function(){if(0===this.args.length)return this.error("no selector specified");var e=jQuery(this.args[0]);if(0===e.length)return this.error('no elements matched the selector "'+this.args[0]+'"');this.args.length>1?e.removeClass(this.args[1].trim()):e.removeClass()}}),Macro.add("copy",{handler:function(){if(0===this.args.length)return this.error("no selector specified");var e=jQuery(this.args[0]);if(0===e.length)return this.error('no elements matched the selector "'+this.args[0]+'"');jQuery(this.output).append(e.html())}}),Macro.add(["append","prepend","replace"],{tags:null,handler:function(){if(0===this.args.length)return this.error("no selector specified");var e=jQuery(this.args[0]);if(0===e.length)return this.error('no elements matched the selector "'+this.args[0]+'"');if(""!==this.payload[0].contents){var t=document.createDocumentFragment();switch(new Wikifier(t,this.payload[0].contents),this.name){case"replace":e.empty();case"append":e.append(t);break;case"prepend":e.prepend(t)}}else"replace"===this.name&&e.empty()}}),Macro.add("remove",{handler:function(){if(0===this.args.length)return this.error("no selector specified");var e=jQuery(this.args[0]);if(0===e.length)return this.error('no elements matched the selector "'+this.args[0]+'"');e.remove()}}),Has.audio){var e=Object.freeze([":not",":all",":looped",":muted",":paused",":playing"]);Macro.add("audio",{handler:function(){if(this.args.length<2){var e=[];return this.args.length<1&&e.push("track or group IDs"),this.args.length<2&&e.push("actions"),this.error("no "+e.join(" or ")+" specified")}var t=Macro.get("cacheaudio").tracks,r=[];try{var a=function e(r){var a=r.id,o=void 0;switch(a){case":all":o=n;break;case":looped":o=n.filter(function(e){return t[e].isLooped()});break;case":muted":o=n.filter(function(e){return t[e].isMuted()});break;case":paused":o=n.filter(function(e){return t[e].isPaused()});break;case":playing":o=n.filter(function(e){return t[e].isPlaying()});break;default:o=":"===a[0]?i[a]:[a]}if(r.hasOwnProperty("not")){var s=r.not.map(function(t){return e(t)}).flatten();o=o.filter(function(e){return!s.includes(e)})}return o},n=Object.freeze(Object.keys(t)),i=Macro.get("cacheaudio").groups;this.self.parseIds(String(this.args[0]).trim()).forEach(function(e){r.push.apply(r,_toConsumableArray(a(e)))}),r.forEach(function(e){if(!t.hasOwnProperty(e))throw new Error('track "'+e+'" does not exist')})}catch(e){return this.error(e.message)}for(var o=this.args.slice(1),s=void 0,u=void 0,l=void 0,c=void 0,d=void 0,h=void 0,f=5,p=void 0,g=void 0;o.length>0;){var m=o.shift();switch(m){case"play":case"pause":case"stop":s=m;break;case"fadein":s="fade",h=1;break;case"fadeout":s="fade",h=0;break;case"fadeto":if(0===o.length)return this.error("fadeto missing required level value");if(s="fade",g=o.shift(),h=Number.parseFloat(g),Number.isNaN(h)||!Number.isFinite(h))return this.error("cannot parse fadeto: "+g);break;case"fadeoverto":if(o.length<2){var v=[];return o.length<1&&v.push("seconds"),o.length<2&&v.push("level"),this.error("fadeoverto missing required "+v.join(" and ")+" value"+(v.length>1?"s":""))}if(s="fade",g=o.shift(),f=Number.parseFloat(g),Number.isNaN(f)||!Number.isFinite(f))return this.error("cannot parse fadeoverto: "+g);if(g=o.shift(),h=Number.parseFloat(g),Number.isNaN(h)||!Number.isFinite(h))return this.error("cannot parse fadeoverto: "+g);break;case"volume":if(0===o.length)return this.error("volume missing required level value");if(g=o.shift(),u=Number.parseFloat(g),Number.isNaN(u)||!Number.isFinite(u))return this.error("cannot parse volume: "+g);break;case"mute":case"unmute":l="mute"===m;break;case"time":if(0===o.length)return this.error("time missing required seconds value");if(g=o.shift(),c=Number.parseFloat(g),Number.isNaN(c)||!Number.isFinite(c))return this.error("cannot parse time: "+g);break;case"loop":case"unloop":d="loop"===m;break;case"goto":if(0===o.length)return this.error("goto missing required passage title");if(g=o.shift(),p="object"===(void 0===g?"undefined":_typeof(g))?g.link:g,!Story.has(p))return this.error('passage "'+p+'" does not exist');break;default:return this.error("unknown action: "+m)}}try{r.forEach(function(e){var r=t[e];switch(null!=u&&(r.volume=u),null!=c&&(r.time=c),null!=l&&(r.mute=l),null!=d&&(r.loop=d),null!=p&&r.one("end",function(){return Engine.play(p)}),s){case"play":r.play();break;case"pause":r.pause();break;case"stop":r.stop();break;case"fade":r.fadeWithDuration(f,h)}}),Config.debug&&this.createDebugView()}catch(e){return this.error("error executing audio action: "+e.message)}},parseIds:function(e){for(var t=[],r=/:?[^\s:()]+/g,a=void 0;null!==(a=r.exec(e));){var n=a[0];if(":not"===n){if(0===t.length)throw new Error('invalid negation: no group ID preceded ":not()"');var i=t[t.length-1];if(":"!==i.id[0])throw new Error('invalid negation of track "'+i.id+'": only groups may be negated with ":not()"');var o=function(e,t){var r=/\S/g,a=/[()]/g,n=void 0;if(r.lastIndex=t,null===(n=r.exec(e))||"("!==n[0])throw new Error('invalid ":not()" syntax: missing parentheticals');a.lastIndex=r.lastIndex;for(var i=r.lastIndex,o={str:"",nextMatch:-1},s=1;null!==(n=a.exec(e));)if("("===n[0]?++s:--s,s<1){o.nextMatch=a.lastIndex,o.str=e.slice(i,o.nextMatch-1);break}return o}(e,r.lastIndex);if(-1===o.nextMatch)throw new Error('unknown error parsing ":not()"');r.lastIndex=o.nextMatch,i.not=this.parseIds(o.str)}else t.push({id:n})}return t}}),Macro.add("cacheaudio",{tracks:{},groups:{},handler:function(){if(this.args.length<2){var e=[];return this.args.length<1&&e.push("track ID"),this.args.length<2&&e.push("sources"),this.error("no "+e.join(" or ")+" specified")}var t=String(this.args[0]).trim();if(/^:|\s/.test(t))return this.error('invalid track ID "'+t+'": track IDs may not start with a colon or contain whitespace');var r=/^format:\s*([\w-]+)\s*;\s*(\S.*)$/i,a=void 0;try{a=SimpleAudio.create(this.args.slice(1).map(function(e){var t=r.exec(e);return null===t?e:{format:t[1],src:t[2]}}))}catch(e){return this.error('error during track initialization for "'+t+'": '+e.message)}if(Config.debug&&!a.hasSource())return this.error('no supported audio sources found for "'+t+'"');var n=this.self.tracks;n.hasOwnProperty(t)&&n[t].destroy(),n[t]=a,Config.debug&&this.createDebugView()}}),Macro.add("createaudiogroup",{tags:["track"],handler:function(){if(0===this.args.length)return this.error("no group ID specified");var t=String(this.args[0]).trim();if(/^[^:]|\s/.test(t))return this.error('invalid group ID "'+t+'": group IDs must start with a colon and may not contain whitespace');if(e.includes(t))return this.error('cannot clobber special group ID "'+t+'"');if(1===this.payload.length)return this.error("no tracks defined via <<track>>");Config.debug&&this.debugView.modes({nonvoid:!1,hidden:!0});for(var r=Macro.get("cacheaudio").tracks,a=[],n=1,i=this.payload.length;n<i;++n){if(this.payload[n].args.length<1)return this.error("no track ID specified");var o=String(this.payload[n].args[0]).trim();if(!r.hasOwnProperty(o))return this.error('track "'+o+'" does not exist');a.push(o),Config.debug&&this.createDebugView(this.payload[n].name,this.payload[n].source).modes({nonvoid:!1,hidden:!0})}var s=Macro.get("cacheaudio").groups;s.hasOwnProperty(t)&&delete s[t],s[t]=a,this.createDebugView("/"+this.name,"<</"+this.name+">>").modes({nonvoid:!1,hidden:!0})}}),Macro.add("createplaylist",{tags:["track"],lists:{},handler:function(){if(0===this.args.length)return this.error("no list ID specified");var e=Macro.get("playlist");if(null!==e.from&&"createplaylist"!==e.from)return this.error("a playlist has already been defined with <<setplaylist>>");var t=Macro.get("cacheaudio").tracks,r=String(this.args[0]).trim();if(/^:|\s/.test(r))return this.error('invalid list ID "'+r+'": list IDs may not start with a colon or contain whitespace');if(1===this.payload.length)return this.error("no tracks defined via <<track>>");Config.debug&&this.debugView.modes({nonvoid:!1,hidden:!0});for(var a=SimpleAudio.createList(),n=1,i=this.payload.length;n<i;++n){if(this.payload[n].args.length<2){var o=[];return this.payload[n].args.length<1&&o.push("track ID"),this.payload[n].args.length<2&&o.push("actions"),this.error("no "+o.join(" or ")+" specified")}var s=String(this.payload[n].args[0]).trim();if(!t.hasOwnProperty(s))return this.error('track "'+s+'" does not exist');for(var u=this.payload[n].args.slice(1),l=!1,c=void 0;u.length>0;){var d=u.shift(),h=void 0;switch(d){case"copy":l=!0;break;case"rate":u.length>0&&u.shift();break;case"volume":if(0===u.length)return this.error("volume missing required level value");if(h=u.shift(),c=Number.parseFloat(h),Number.isNaN(c)||!Number.isFinite(c))return this.error("cannot parse volume: "+h);break;default:return this.error("unknown action: "+d)}}var f=t[s];a.add({copy:l,track:f,volume:null!=c?c:f.volume}),Config.debug&&this.createDebugView(this.payload[n].name,this.payload[n].source).modes({nonvoid:!1,hidden:!0})}var p=this.self.lists;p.hasOwnProperty(r)&&p[r].destroy(),p[r]=a,null===e.from&&(e.from="createplaylist"),this.createDebugView("/"+this.name,"<</"+this.name+">>").modes({nonvoid:!1,hidden:!0})}}),Macro.add("masteraudio",{handler:function(){if(0===this.args.length)return this.error("no actions specified");for(var e=this.args.slice(0),t=!1,r=void 0,a=void 0;e.length>0;){var n=e.shift(),i=void 0;switch(n){case"stop":t=!0;break;case"mute":case"unmute":r="mute"===n;break;case"volume":if(0===e.length)return this.error("volume missing required level value");if(i=e.shift(),a=Number.parseFloat(i),Number.isNaN(a)||!Number.isFinite(a))return this.error("cannot parse volume: "+i);break;default:return this.error("unknown action: "+n)}}try{null!=r&&(SimpleAudio.mute=r),null!=a&&(SimpleAudio.volume=a),t&&SimpleAudio.stop(),Config.debug&&this.createDebugView()}catch(e){return this.error("error executing master audio action: "+e.message)}}}),Macro.add("playlist",{from:null,handler:function(){var e=this.self.from;if(null===e)return this.error("no playlists have been created");var t=void 0,r=void 0;if("createplaylist"===e){if(this.args.length<2){var a=[];return this.args.length<1&&a.push("list ID"),this.args.length<2&&a.push("actions"),this.error("no "+a.join(" or ")+" specified")}var n=Macro.get("createplaylist").lists,i=String(this.args[0]).trim();if(!n.hasOwnProperty(i))return this.error('playlist "'+i+'" does not exist');t=n[i],r=this.args.slice(1)}else{if(0===this.args.length)return this.error("no actions specified");t=Macro.get("setplaylist").list,r=this.args.slice(0)}for(var o=void 0,s=void 0,u=void 0,l=void 0,c=void 0,d=void 0,h=5,f=void 0;r.length>0;){var p=r.shift();switch(p){case"play":case"pause":case"stop":case"skip":o=p;break;case"fadein":o="fade",d=1;break;case"fadeout":o="fade",d=0;break;case"fadeto":if(0===r.length)return this.error("fadeto missing required level value");if(o="fade",f=r.shift(),d=Number.parseFloat(f),Number.isNaN(d)||!Number.isFinite(d))return this.error("cannot parse fadeto: "+f);break;case"fadeoverto":if(r.length<2){var g=[];return r.length<1&&g.push("seconds"),r.length<2&&g.push("level"),this.error("fadeoverto missing required "+g.join(" and ")+" value"+(g.length>1?"s":""))}if(o="fade",f=r.shift(),h=Number.parseFloat(f),Number.isNaN(h)||!Number.isFinite(h))return this.error("cannot parse fadeoverto: "+f);if(f=r.shift(),d=Number.parseFloat(f),Number.isNaN(d)||!Number.isFinite(d))return this.error("cannot parse fadeoverto: "+f);break;case"volume":if(0===r.length)return this.error("volume missing required level value");if(f=r.shift(),s=Number.parseFloat(f),Number.isNaN(s)||!Number.isFinite(s))return this.error("cannot parse volume: "+f);break;case"mute":case"unmute":u="mute"===p;break;case"loop":case"unloop":l="loop"===p;break;case"shuffle":case"unshuffle":c="shuffle"===p;break;default:return this.error("unknown action: "+p)}}try{switch(null!=s&&(t.volume=s),null!=u&&(t.mute=u),null!=l&&(t.loop=l),null!=c&&(t.shuffle=c),o){case"play":t.play();break;case"pause":t.pause();break;case"stop":t.stop();break;case"skip":t.skip();break;case"fade":t.fadeWithDuration(h,d)}Config.debug&&this.createDebugView()}catch(e){return this.error("error playing audio: "+e.message)}}}),Macro.add("removeplaylist",{handler:function(){if(0===this.args.length)return this.error("no list ID specified");var e=Macro.get("createplaylist").lists,t=String(this.args[0]).trim();if(!e.hasOwnProperty(t))return this.error('playlist "'+t+'" does not exist');e[t].destroy(),delete e[t],Config.debug&&this.createDebugView()}}),Macro.add("waitforaudio",{skipArgs:!0,queue:[],handler:function(){function e(){if(0===t.length)return LoadScreen.unlock(r);var a=t.shift();if(a.hasData())return e();a.one("canplay.waitforaudio error.waitforaudio",function(){jQuery(this).off(".waitforaudio"),e()}).load()}var t=this.self.queue,r=void 0;t.length>0||(this.self.fillQueue(t),t.length>0&&(r=LoadScreen.lock(),e()))},fillQueue:function(e){var t=Macro.get("cacheaudio").tracks;Object.keys(t).forEach(function(r){return e.push(t[r])});var r=Macro.get("createplaylist").lists;if(Object.keys(r).map(function(e){return r[e].tracks}).flatten().filter(function(e){return e.copy}).forEach(function(t){return e.push(t.track)}),Macro.has("setplaylist")){var a=Macro.get("setplaylist").list;null!==a&&a.tracks.forEach(function(t){return e.push(t.track)})}}}),Macro.add("setplaylist",{list:null,handler:function(){if(0===this.args.length)return this.error("no track ID(s) specified");var e=Macro.get("playlist");if(null!==e.from&&"setplaylist"!==e.from)return this.error("playlists have already been defined with <<createplaylist>>");var t=this.self,r=Macro.get("cacheaudio").tracks;null!==t.list&&t.list.destroy(),t.list=SimpleAudio.createList();for(var a=0;a<this.args.length;++a){var n=this.args[a];if(!r.hasOwnProperty(n))return this.error('track "'+n+'" does not exist');t.list.add(r[n])}null===e.from&&(e.from="setplaylist"),Config.debug&&this.createDebugView()}}),Macro.add("stopallaudio",{skipArgs:!0,handler:function(){var e=Macro.get("cacheaudio").tracks;Object.keys(e).forEach(function(t){return e[t].stop()}),Config.debug&&this.createDebugView()}})}else Macro.add(["audio","cacheaudio","createaudiogroup","createplaylist","masteraudio","playlist","removeplaylist","waitforaudio","setplaylist","stopallaudio"],{skipArgs:!0,handler:function(){}});Macro.add("goto",{handler:function(){if(0===this.args.length)return this.error("no passage specified");var e=void 0;if(e="object"===_typeof(this.args[0])?this.args[0].link:this.args[0],!Story.has(e))return this.error('passage "'+e+'" does not exist');setTimeout(function(){return Engine.play(e)},Engine.minDomActionDelay)}}),Macro.add("repeat",{isAsync:!0,tags:null,timers:new Set,handler:function(){var e=this;if(0===this.args.length)return this.error("no time value specified");var t=void 0;try{t=Math.max(Engine.minDomActionDelay,Util.fromCssTime(this.args[0]))}catch(e){return this.error(e.message)}Config.debug&&this.debugView.modes({block:!0});var r=this.args.length>1&&/^(?:transition|t8n)$/.test(this.args[1]),a=jQuery(document.createElement("span")).addClass("macro-"+this.name).appendTo(this.output);this.self.registerInterval(this.createShadowWrapper(function(){var t=document.createDocumentFragment();new Wikifier(t,e.payload[0].contents);var n=a;r&&(n=jQuery(document.createElement("span")).addClass("macro-repeat-insert macro-repeat-in").appendTo(n)),n.append(t),r&&setTimeout(function(){return n.removeClass("macro-repeat-in")},Engine.minDomActionDelay)}),t)},registerInterval:function(e,t){var r=this;if("function"!=typeof e)throw new TypeError("callback parameter must be a function");var a=State.turns,n=this.timers,i=null;i=setInterval(function(){if(a!==State.turns)return clearInterval(i),void n.delete(i);var t=void 0;try{TempState.break=null,TempState.hasOwnProperty("repeatTimerId")&&(t=TempState.repeatTimerId),TempState.repeatTimerId=i,e.call(r)}finally{void 0!==t?TempState.repeatTimerId=t:delete TempState.repeatTimerId,TempState.break=null}},t),n.add(i),prehistory.hasOwnProperty("#repeat-timers-cleanup")||(prehistory["#repeat-timers-cleanup"]=function(e){delete prehistory[e],n.forEach(function(e){return clearInterval(e)}),n.clear()})}}),Macro.add("stop",{skipArgs:!0,handler:function(){if(!TempState.hasOwnProperty("repeatTimerId"))return this.error("must only be used in conjunction with its parent macro <<repeat>>");var e=Macro.get("repeat").timers,t=TempState.repeatTimerId;clearInterval(t),e.delete(t),TempState.break=2,Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("timed",{isAsync:!0,tags:["next"],timers:new Set,handler:function(){if(0===this.args.length)return this.error("no time value specified in <<timed>>");var e=[];try{e.push({name:this.name,source:this.source,delay:Math.max(Engine.minDomActionDelay,Util.fromCssTime(this.args[0])),content:this.payload[0].contents})}catch(e){return this.error(e.message+" in <<timed>>")}if(this.payload.length>1){var t=void 0;try{var r=void 0;for(t=1,r=this.payload.length;t<r;++t)e.push({name:this.payload[t].name,source:this.payload[t].source,delay:0===this.payload[t].args.length?e[e.length-1].delay:Math.max(Engine.minDomActionDelay,Util.fromCssTime(this.payload[t].args[0])),content:this.payload[t].contents})}catch(e){return this.error(e.message+" in <<next>> (#"+t+")")}}Config.debug&&this.debugView.modes({block:!0});var a=this.args.length>1&&/^(?:transition|t8n)$/.test(this.args[1]),n=jQuery(document.createElement("span")).addClass("macro-"+this.name).appendTo(this.output);this.self.registerTimeout(this.createShadowWrapper(function(e){var t=document.createDocumentFragment();new Wikifier(t,e.content);var r=n;Config.debug&&"next"===e.name&&(r=jQuery(new DebugView(r[0],"macro",e.name,e.source).output)),a&&(r=jQuery(document.createElement("span")).addClass("macro-timed-insert macro-timed-in").appendTo(r)),r.append(t),a&&setTimeout(function(){return r.removeClass("macro-timed-in")},Engine.minDomActionDelay)}),e)},registerTimeout:function(e,t){if("function"!=typeof e)throw new TypeError("callback parameter must be a function");var r=State.turns,a=this.timers,n=null,i=t.shift(),o=function o(){if(a.delete(n),r===State.turns){var s=i;null!=(i=t.shift())&&(n=setTimeout(o,i.delay),a.add(n)),e.call(this,s)}};n=setTimeout(o,i.delay),a.add(n),prehistory.hasOwnProperty("#timed-timers-cleanup")||(prehistory["#timed-timers-cleanup"]=function(e){delete prehistory[e],a.forEach(function(e){return clearTimeout(e)}),a.clear()})}}),Macro.add("widget",{tags:null,handler:function(){if(0===this.args.length)return this.error("no widget name specified");var e=this.args[0];if(Macro.has(e)){if(!Macro.get(e).isWidget)return this.error('cannot clobber existing macro "'+e+'"');Macro.delete(e)}try{Macro.add(e,{isWidget:!0,handler:function(e){return function(){var t=void 0;try{State.variables.hasOwnProperty("args")&&(t=State.variables.args),State.variables.args=[].concat(_toConsumableArray(this.args)),State.variables.args.raw=this.args.raw,State.variables.args.full=this.args.full,this.addShadow("$args");var r=document.createDocumentFragment(),a=[];if(new Wikifier(r,e),Array.from(r.querySelectorAll(".error")).forEach(function(e){a.push(e.textContent)}),0!==a.length)return this.error("error"+(a.length>1?"s":"")+" within widget contents ("+a.join("; ")+")");this.output.appendChild(r)}catch(e){return this.error("cannot execute widget: "+e.message)}finally{void 0!==t?State.variables.args=t:delete State.variables.args}}}(this.payload[0].contents)}),Config.debug&&this.createDebugView(this.name,this.source+this.payload[0].contents+"<</"+this.name+">>")}catch(t){return this.error('cannot create widget macro "'+e+'": '+t.message)}}})}();var Dialog=function(){function e(){m=function(){var e=void 0;try{var t=document.createElement("p"),r=document.createElement("div");t.style.width="100%",t.style.height="200px",r.style.position="absolute",r.style.left="0px",r.style.top="0px",r.style.width="100px",r.style.height="100px",r.style.visibility="hidden",r.style.overflow="hidden",r.appendChild(t),document.body.appendChild(r);var a=t.offsetWidth;r.style.overflow="auto";var n=t.offsetWidth;a===n&&(n=r.clientWidth),document.body.removeChild(r),e=a-n}catch(e){}return e||17}()
;var e=jQuery(document.createDocumentFragment()).append('<div id="ui-overlay" class="ui-close"></div><div id="ui-dialog" tabindex="0" role="dialog" aria-labelledby="ui-dialog-title"><div id="ui-dialog-titlebar"><h1 id="ui-dialog-title"></h1><button id="ui-dialog-close" class="ui-close" tabindex="0" aria-label="'+L10n.get("close")+'"></button></div><div id="ui-dialog-body"></div></div>');d=jQuery(e.find("#ui-overlay").get(0)),h=jQuery(e.find("#ui-dialog").get(0)),f=jQuery(e.find("#ui-dialog-title").get(0)),p=jQuery(e.find("#ui-dialog-body").get(0)),e.insertBefore("#store-area")}function t(e){return h.hasClass("open")&&(!e||e.splitOrEmpty(/\s+/).every(function(e){return p.hasClass(e)}))}function r(e,t){return p.empty().removeClass(),null!=t&&p.addClass(t),f.empty().append((null!=e?String(e):"")||" "),p.get(0)}function a(){return p.get(0)}function n(){var e;return(e=p).append.apply(e,arguments),Dialog}function i(){var e;return(e=p).wiki.apply(e,arguments),Dialog}function o(e,t,r,a,n){return jQuery(e).ariaClick(function(e){e.preventDefault(),"function"==typeof r&&r(e),s(t,n),"function"==typeof a&&a(e)})}function s(e,r){var a=jQuery.extend({top:50},e),n=a.top;t()||(g=safeActiveElement()),jQuery(document.documentElement).attr("data-dialog","open"),d.addClass("open"),null!==p[0].querySelector("img")&&p.imagesLoaded().always(function(){return l({data:{top:n}})}),jQuery("body>:not(script,#store-area,#ui-bar,#ui-overlay,#ui-dialog)").attr("tabindex",-3).attr("aria-hidden",!0),jQuery("#ui-bar,#story").find("[tabindex]:not([tabindex^=-])").attr("tabindex",-2).attr("aria-hidden",!0);var i=c(n);return h.css(i).addClass("open").focus(),jQuery(window).on("resize.dialog-resize",null,{top:n},jQuery.throttle(40,l)),Has.mutationObserver?(v=new MutationObserver(function(e){for(var t=0;t<e.length;++t)if("childList"===e[t].type){l({data:{top:n}});break}}),v.observe(p[0],{childList:!0,subtree:!0})):p.on("DOMNodeInserted.dialog-resize DOMNodeRemoved.dialog-resize",null,{top:n},jQuery.throttle(40,l)),jQuery(document).on("click.dialog-close",".ui-close",{closeFn:r},u).on("keypress.dialog-close",".ui-close",function(e){13!==e.which&&32!==e.which||jQuery(this).trigger("click")}),setTimeout(function(){return jQuery.event.trigger(":dialogopen")},Engine.minDomActionDelay),Dialog}function u(e){return jQuery(document).off(".dialog-close"),v?(v.disconnect(),v=null):p.off(".dialog-resize"),jQuery(window).off(".dialog-resize"),h.removeClass("open").css({left:"",right:"",top:"",bottom:""}),jQuery("#ui-bar,#story").find("[tabindex=-2]").removeAttr("aria-hidden").attr("tabindex",0),jQuery("body>[tabindex=-3]").removeAttr("aria-hidden").removeAttr("tabindex"),f.empty(),p.empty().removeClass(),d.removeClass("open"),jQuery(document.documentElement).removeAttr("data-dialog"),null!==g&&(jQuery(g).focus(),g=null),e&&e.data&&"function"==typeof e.data.closeFn&&e.data.closeFn(e),setTimeout(function(){return jQuery.event.trigger(":dialogclose")},Engine.minDomActionDelay),Dialog}function l(e){var t=e&&e.data&&void 0!==e.data.top?e.data.top:50;"block"===h.css("display")&&(h.css({display:"none"}),h.css(jQuery.extend({display:""},c(t))))}function c(e){var t=null!=e?e:50,r=jQuery(window),a={left:"",right:"",top:"",bottom:""};h.css(a);var n=r.width()-h.outerWidth(!0)-1,i=r.height()-h.outerHeight(!0)-1;return n<=32+m&&(i-=m),i<=32+m&&(n-=m),a.left=a.right=n<=32?16:n/2>>0,a.top=i<=32?a.bottom=16:i/2>t?t:a.bottom=i/2>>0,Object.keys(a).forEach(function(e){""!==a[e]&&(a[e]+="px")}),a}var d=null,h=null,f=null,p=null,g=null,m=0,v=null;return Object.freeze(Object.defineProperties({},{init:{value:e},isOpen:{value:t},setup:{value:r},body:{value:a},append:{value:n},wiki:{value:i},addClickHandler:{value:o},open:{value:s},close:{value:u},resize:{value:function(e){return l("object"===(void 0===e?"undefined":_typeof(e))?{data:e}:undefined)}}}))}(),Engine=function(){function e(){jQuery("#init-no-js,#init-lacking").remove(),function(){var e=jQuery(document.createDocumentFragment()),t=Story.has("StoryInterface")&&Story.get("StoryInterface").text.trim();if(t){if(UIBar.destroy(),jQuery(document.head).find("#style-core-display").remove(),e.append(t),0===e.find("#passages").length)throw new Error('no element with ID "passages" found within "StoryInterface" special passage')}else e.append('<div id="story" role="main"><div id="passages"></div></div>');e.insertBefore("#store-area")}(),S=new StyleWrapper(function(){return jQuery(document.createElement("style")).attr({id:"style-aria-outlines",type:"text/css"}).appendTo(document.head).get(0)}()),jQuery(document).on("mousedown.aria-outlines keydown.aria-outlines",function(e){return"keydown"===e.type?m():g()})}function t(){if(Story.has("StoryInit"))try{var e=Wikifier.wikifyEval(Story.get("StoryInit").text);if(Config.debug){var t=new DebugView(document.createDocumentFragment(),"special","StoryInit","StoryInit");t.modes({hidden:!0}),t.append(e),k=t.output}}catch(e){console.error(e),Alert.error("StoryInit",e.message)}if(Config.history.maxStates=Math.max(0,Config.history.maxStates),Number.isSafeInteger(Config.history.maxStates)||(Config.history.maxStates=100),1===Config.history.maxStates&&(Config.history.controls=!1),null==Config.passages.start)throw new Error("starting passage not selected");if(!Story.has(Config.passages.start))throw new Error('starting passage ("'+Config.passages.start+'") not found');if(jQuery(document.documentElement).focus(),State.restore())h();else{var r=!0;switch(_typeof(Config.saves.autoload)){case"boolean":Config.saves.autoload&&Save.autosave.ok()&&Save.autosave.has()&&(r=!Save.autosave.load());break;case"string":"prompt"===Config.saves.autoload&&Save.autosave.ok()&&Save.autosave.has()&&(r=!1,UI.buildDialogAutoload(),UI.open());break;case"function":Save.autosave.ok()&&Save.autosave.has()&&Config.saves.autoload()&&(r=!Save.autosave.load())}r&&f(Config.passages.start)}}function r(){LoadScreen.show(),window.scroll(0,0),State.reset(),jQuery.event.trigger(":enginerestart"),window.location.reload()}function a(){return b}function n(){return b===v.Idle}function i(){return b!==v.Idle}function o(){return b===v.Rendering}function s(){return w}function u(e){var t=State.goTo(e);return t&&h(),t}function l(e){var t=State.go(e);return t&&h(),t}function c(){return l(-1)}function d(){return l(1)}function h(){return f(State.passage,!0)}function f(e,t){var r=e;b=v.Playing,TempState={},State.clearTemporary();var a=void 0,n=void 0;if("function"==typeof Config.navigation.override)try{var i=Config.navigation.override(r);i&&(r=i)}catch(e){}var o=Story.get(r);if(jQuery.event.trigger({type:":passageinit",passage:o}),Object.keys(prehistory).forEach(function(e){"function"==typeof prehistory[e]&&prehistory[e].call(this,e)},o),t||State.create(o.title),w=Util.now(),document.body.className&&(document.body.className=""),Object.keys(predisplay).forEach(function(e){"function"==typeof predisplay[e]&&predisplay[e].call(this,e)},o),Story.has("PassageReady"))try{a=Wikifier.wikifyEval(Story.get("PassageReady").text)}catch(e){console.error(e),Alert.error("PassageReady",e.message)}b=v.Rendering;var s=jQuery(o.render()),u=document.getElementById("passages");if(u.hasChildNodes()&&("number"==typeof Config.passages.transitionOut||"string"==typeof Config.passages.transitionOut&&""!==Config.passages.transitionOut&&""!==Config.transitionEndEventName?[].concat(_toConsumableArray(u.childNodes)).forEach(function(e){var t=jQuery(e);if(e.nodeType===Node.ELEMENT_NODE&&t.hasClass("passage")){if(t.hasClass("passage-out"))return;t.attr("id","out-"+t.attr("id")).addClass("passage-out"),"string"==typeof Config.passages.transitionOut?t.on(Config.transitionEndEventName,function(e){e.originalEvent.propertyName===Config.passages.transitionOut&&t.remove()}):setTimeout(function(){return t.remove()},Math.max(y,Config.passages.transitionOut))}else t.remove()}):jQuery(u).empty()),s.addClass("passage-in").appendTo(u),setTimeout(function(){return s.removeClass("passage-in")},y),Config.passages.displayTitles&&o.title!==Config.passages.start&&(document.title=o.title+" | "+Story.title),window.scroll(0,0),b=v.Playing,Story.has("PassageDone"))try{n=Wikifier.wikifyEval(Story.get("PassageDone").text)}catch(e){console.error(e),Alert.error("PassageDone",e.message)}if(jQuery.event.trigger({type:":passagedisplay",passage:o}),Object.keys(postdisplay).forEach(function(e){"function"==typeof postdisplay[e]&&postdisplay[e].call(this,e)},o),Config.ui.updateStoryElements&&UIBar.setStoryElements(),Config.debug){var l=void 0;null!=a&&(l=new DebugView(document.createDocumentFragment(),"special","PassageReady","PassageReady"),l.modes({hidden:!0}),l.append(a),s.prepend(l.output)),null!=n&&(l=new DebugView(document.createDocumentFragment(),"special","PassageDone","PassageDone"),l.modes({hidden:!0}),l.append(n),s.append(l.output)),1===State.turns&&null!=k&&s.prepend(k)}switch(g(),jQuery("#story").find("a[href]:not(.link-external)").addClass("link-external").end().find("a,link,button,input,select,textarea").not("[tabindex]").attr("tabindex",0),_typeof(Config.saves.autosave)){case"boolean":Config.saves.autosave&&Save.autosave.save();break;case"string":o.tags.includes(Config.saves.autosave)&&Save.autosave.save();break;case"object":Array.isArray(Config.saves.autosave)&&o.tags.some(function(e){return Config.saves.autosave.includes(e)})&&Save.autosave.save()}return jQuery.event.trigger({type:":passageend",passage:o}),b=v.Idle,w=Util.now(),s[0]}function p(e,t,r){var a=!1;switch(r){case undefined:break;case"replace":case"back":a=!0;break;default:throw new Error('Engine.display option parameter called with obsolete value "'+r+'"; please notify the developer')}f(e,a)}function g(){S.set("*:focus{outline:none}")}function m(){S.clear()}var v=Util.toEnum({Idle:"idle",Playing:"playing",Rendering:"rendering"}),y=40,b=v.Idle,w=null,k=null,S=null;return Object.freeze(Object.defineProperties({},{States:{value:v},minDomActionDelay:{value:y},init:{value:e},start:{value:t},restart:{value:r},state:{get:a},isIdle:{value:n},isPlaying:{value:i},isRendering:{value:o},lastPlay:{get:s},goTo:{value:u},go:{value:l},backward:{value:c},forward:{value:d},show:{value:h},play:{value:f},display:{value:p}}))}(),Passage=function(){var e=void 0;e=/^(?:debug|nobr|passage|widget|twine\..*)$/i;return function(){function t(r,a){var n=this;_classCallCheck(this,t),Object.defineProperties(this,{title:{value:Util.unescape(r)},element:{value:a||null},tags:{value:Object.freeze(a&&a.hasAttribute("tags")?a.getAttribute("tags").trim().splitOrEmpty(/\s+/).sort().filter(function(e,t,r){return 0===t||r[t-1]!==e}):[])},_excerpt:{writable:!0,value:null}}),Object.defineProperties(this,{domId:{value:"passage-"+Util.slugify(this.title)},classes:{value:Object.freeze(0===this.tags.length?[]:function(){return n.tags.filter(function(t){return!e.test(t)}).map(function(e){return Util.slugify(e)})}())}})}return _createClass(t,[{key:"description",value:function(){var e=Config.passages.descriptions;if(null!=e)switch(void 0===e?"undefined":_typeof(e)){case"boolean":if(e)return this.title;break;case"object":if(e instanceof Map&&e.has(this.title))return e.get(this.title);if(e.hasOwnProperty(this.title))return e[this.title];break;case"function":var r=e.call(this);if(r)return r;break;default:throw new TypeError("Config.passages.descriptions must be a boolean, object, or function")}return null===this._excerpt&&(this._excerpt=t.getExcerptFromText(this.text)),this._excerpt}},{key:"processText",value:function(){var e=this.text;return this.tags.includes("Twine.image")?e="[img["+e+"]]":(Config.passages.nobr||this.tags.includes("nobr"))&&(e=e.replace(/^\n+|\n+$/g,"").replace(/\n+/g," ")),e}},{key:"render",value:function(){var e=this,r=this.tags.length>0?this.tags.join(" "):null,a=document.createElement("div");return jQuery(a).attr({id:this.domId,"data-passage":this.title,"data-tags":r}).addClass("passage "+this.className),jQuery(document.body).attr("data-tags",r).addClass(this.className),jQuery(document.documentElement).attr("data-tags",r),jQuery.event.trigger({type:":passagestart",content:a,passage:this}),Object.keys(prerender).forEach(function(t){"function"==typeof prerender[t]&&prerender[t].call(e,a,t)}),Story.has("PassageHeader")&&new Wikifier(a,Story.get("PassageHeader").processText()),new Wikifier(a,this.processText()),Story.has("PassageFooter")&&new Wikifier(a,Story.get("PassageFooter").processText()),jQuery.event.trigger({type:":passagerender",content:a,passage:this}),Object.keys(postrender).forEach(function(t){"function"==typeof postrender[t]&&postrender[t].call(e,a,t)}),this._excerpt=t.getExcerptFromNode(a),a}},{key:"className",get:function(){return this.classes.join(" ")}},{key:"text",get:function(){if(null==this.element){var e=Util.escape(this.title);return'<span class="error" title="'+e+'">'+L10n.get("errorTitle")+": "+L10n.get("errorNonexistentPassage",{passage:e})+"</span>"}return this.element.textContent.replace(/\r/g,"")}}],[{key:"getExcerptFromNode",value:function(e,t){if(!e.hasChildNodes())return"";var r=e.textContent.trim();if(""!==r){var a=new RegExp("(\\S+(?:\\s+\\S+){0,"+(t>0?t-1:7)+"})");r=r.replace(/\s+/g," ").match(a)}return r?r[1]+"…":"…"}},{key:"getExcerptFromText",value:function(e,t){if(""===e)return"";var r=new RegExp("(\\S+(?:\\s+\\S+){0,"+(t>0?t-1:7)+"})"),a=e.replace(/<<.*?>>/g," ").replace(/<.*?>/g," ").trim().replace(/^\s*\|.*\|.*?$/gm,"").replace(/\[[<>]?img\[[^\]]*\]\]/g,"").replace(/\[\[([^|\]]*)(?:|[^\]]*)?\]\]/g,"$1").replace(/^\s*!+(.*?)$/gm,"$1").replace(/'{2}|\/{2}|_{2}|@{2}/g,"").trim().replace(/\s+/g," ").match(r);return a?a[1]+"…":"…"}}]),t}()}(),Save=function(){function e(){if("cookie"===storage.name)return a(),Config.saves.autosave=undefined,Config.saves.slots=0,!1;Config.saves.slots=Math.max(0,Config.saves.slots),Number.isSafeInteger(Config.saves.slots)||(Config.saves.slots=8);var e=r(),t=!1;Array.isArray(e)&&(e={autosave:null,slots:e},t=!0),Config.saves.slots!==e.slots.length&&(Config.saves.slots<e.slots.length?(e.slots.reverse(),e.slots=e.slots.filter(function(e){return!(null===e&&this.count>0)||(--this.count,!1)},{count:e.slots.length-Config.saves.slots}),e.slots.reverse()):Config.saves.slots>e.slots.length&&x(e.slots,Config.saves.slots-e.slots.length),t=!0),O(e.autosave)&&(t=!0);for(var n=0;n<e.slots.length;++n)O(e.slots[n])&&(t=!0);return j(e)&&(storage.delete("saves"),t=!1),t&&C(e),P=e.slots.length-1,!0}function t(){return{autosave:null,slots:x([],Config.saves.slots)}}function r(){var e=storage.get("saves");return null===e?t():e}function a(){return storage.delete("saves"),!0}function n(){return i()||d()}function i(){return"cookie"!==storage.name&&void 0!==Config.saves.autosave}function o(){return null!==r().autosave}function s(){return r().autosave}function u(){var e=r();return null!==e.autosave&&T(e.autosave)}function l(e,t){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return!1;var a=r(),n={title:e||Story.get(State.passage).description(),date:Date.now()};return null!=t&&(n.metadata=t),a.autosave=A(n),C(a)}function c(){var e=r();return e.autosave=null,C(e)}function d(){return"cookie"!==storage.name&&-1!==P}function h(){return P+1}function f(){if(!d())return 0;for(var e=r(),t=0,a=0,n=e.slots.length;a<n;++a)null!==e.slots[a]&&++t;return t}function p(){return 0===f()}function g(e){if(e<0||e>P)return!1;var t=r();return!(e>=t.slots.length||null===t.slots[e])}function m(e){if(e<0||e>P)return null;var t=r();return e>=t.slots.length?null:t.slots[e]}function v(e){if(e<0||e>P)return!1;var t=r();return!(e>=t.slots.length||null===t.slots[e])&&T(t.slots[e])}function y(e,t,a){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return UI.alert(L10n.get("savesDisallowed")),!1;if(e<0||e>P)return!1;var n=r();if(e>=n.slots.length)return!1;var i={title:t||Story.get(State.passage).description(),date:Date.now()};return null!=a&&(i.metadata=a),n.slots[e]=A(i),C(n)}function b(e){if(e<0||e>P)return!1;var t=r();return!(e>=t.slots.length)&&(t.slots[e]=null,C(t))}function w(e,t){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return void UI.alert(L10n.get("savesDisallowed"));var r=null==e?Story.domId:Util.slugify(e),a=r+"-"+function(){var e=new Date,t=e.getMonth()+1,r=e.getDate(),a=e.getHours(),n=e.getMinutes(),i=e.getSeconds();return t<10&&(t="0"+t),r<10&&(r="0"+r),a<10&&(a="0"+a),n<10&&(n="0"+n),i<10&&(i="0"+i),""+e.getFullYear()+t+r+"-"+a+n+i}()+".save",n=null==t?{}:{metadata:t},i=LZString.compressToBase64(JSON.stringify(A(n)));saveAs(new Blob([i],{type:"text/plain;charset=UTF-8"}),a)}function k(e){var t=e.target.files[0],r=new FileReader;jQuery(r).on("load",function(e){var r=e.currentTarget;if(r.result){var a=void 0;try{a=JSON.parse(/\.json$/i.test(t.name)||/^\{/.test(r.result)?r.result:LZString.decompressFromBase64(r.result))}catch(e){}T(a)}}),r.readAsText(t)}function S(e){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return UI.alert(L10n.get("savesDisallowed")),null;var t=null==e?{}:{metadata:e};return LZString.compressToBase64(JSON.stringify(A(t)))}function E(e){var t=void 0;try{t=JSON.parse(LZString.decompressFromBase64(e))}catch(e){}return T(t)?t.metadata:null}function x(e,t){for(var r=0;r<t;++r)e.push(null);return e}function j(e){for(var t=e.slots,r=!0,a=0,n=t.length;a<n;++a)if(null!==t[a]){r=!1;break}return null===e.autosave&&r}function C(e){return j(e)?(storage.delete("saves"),!0):storage.set("saves",e)}function O(e){if(null==e||"object"!==(void 0===e?"undefined":_typeof(e)))return!1;var t=!1;return e.hasOwnProperty("state")&&e.state.hasOwnProperty("delta")&&e.state.hasOwnProperty("index")||(e.hasOwnProperty("data")?(delete e.mode,e.state={delta:State.deltaEncode(e.data)},delete e.data):e.state.hasOwnProperty("delta")?e.state.hasOwnProperty("index")||delete e.state.mode:(delete e.state.mode,e.state.delta=State.deltaEncode(e.state.history),delete e.state.history),e.state.index=e.state.delta.length-1,t=!0),e.state.hasOwnProperty("rseed")&&(e.state.seed=e.state.rseed,delete e.state.rseed,e.state.delta.forEach(function(e,t,r){r[t].hasOwnProperty("rcount")&&(r[t].pull=r[t].rcount,delete r[t].rcount)}),t=!0),(e.state.hasOwnProperty("expired")&&"number"==typeof e.state.expired||e.state.hasOwnProperty("unique")||e.state.hasOwnProperty("last"))&&(e.state.hasOwnProperty("expired")&&"number"==typeof e.state.expired&&delete e.state.expired,(e.state.hasOwnProperty("unique")||e.state.hasOwnProperty("last"))&&(e.state.expired=[],e.state.hasOwnProperty("unique")&&(e.state.expired.push(e.state.unique),delete e.state.unique),e.state.hasOwnProperty("last")&&(e.state.expired.push(e.state.last),delete e.state.last)),t=!0),t}function A(e){if(null!=e&&"object"!==(void 0===e?"undefined":_typeof(e)))throw new Error("supplemental parameter must be an object");var t=Object.assign({},e,{id:Config.saves.id,state:State.marshalForSave()});return Config.saves.version&&(t.version=Config.saves.version),"function"==typeof Config.saves.onSave&&Config.saves.onSave(t),t.state.delta=State.deltaEncode(t.state.history),delete t.state.history,t}function T(e){try{if(O(e),!e||!e.hasOwnProperty("id")||!e.hasOwnProperty("state"))throw new Error(L10n.get("errorSaveMissingData"));if(e.state.history=State.deltaDecode(e.state.delta),delete e.state.delta,"function"==typeof Config.saves.onLoad&&Config.saves.onLoad(e),e.id!==Config.saves.id)throw new Error(L10n.get("errorSaveIdMismatch"));State.unmarshalForSave(e.state),Engine.show()}catch(e){return UI.alert(e.message.toUpperFirst()+".</p><p>"+L10n.get("aborting")+"."),!1}return!0}var P=-1;return Object.freeze(Object.defineProperties({},{init:{value:e},get:{value:r},clear:{value:a},ok:{value:n},autosave:{value:Object.freeze(Object.defineProperties({},{ok:{value:i},has:{value:o},get:{value:s},load:{value:u},save:{value:l},delete:{value:c}}))},slots:{value:Object.freeze(Object.defineProperties({},{ok:{value:d},length:{get:h},isEmpty:{value:p},count:{value:f},has:{value:g},get:{value:m},load:{value:v},save:{value:y},delete:{value:b}}))},export:{value:w},import:{value:k},serialize:{value:S},deserialize:{value:E}}))}(),Setting=function(){function e(){if(storage.has("options")){var e=storage.get("options");null!==e&&(window.SugarCube.settings=settings=Object.assign(t(),e)),r(),storage.delete("options")}a(),g.forEach(function(e){if(e.hasOwnProperty("onInit")){var t={name:e.name,value:settings[e.name],default:e.default};e.hasOwnProperty("list")&&(t.list=e.list),e.onInit.call(t)}})}function t(){return Object.create(null)}function r(){var e=t();return Object.keys(settings).length>0&&g.filter(function(e){return e.type!==m.Header&&settings[e.name]!==e.default}).forEach(function(t){return e[t.name]=settings[t.name]}),0===Object.keys(e).length?(storage.delete("settings"),!0):storage.set("settings",e)}function a(){var e=t(),r=storage.get("settings")||t();g.filter(function(e){return e.type!==m.Header}).forEach(function(t){return e[t.name]=t.default}),window.SugarCube.settings=settings=Object.assign(e,r)}function n(){return window.SugarCube.settings=settings=t(),storage.delete("settings"),!0}function i(e){if(0===arguments.length)n(),a();else{if(null==e||!h(e))throw new Error('nonexistent setting "'+e+'"');var t=f(e);t.type!==m.Header&&(settings[e]=t.default)}return r()}function o(e,t){g.forEach(e,t)}function s(e,t,r){if(arguments.length<3){var a=[];throw arguments.length<1&&a.push("type"),arguments.length<2&&a.push("name"),arguments.length<3&&a.push("definition"),new Error("missing parameters, no "+a.join(" or ")+" specified")}if("object"!==(void 0===r?"undefined":_typeof(r)))throw new TypeError("definition parameter must be an object");if(h(t))throw new Error('cannot clobber existing setting "'+t+'"');var n={type:e,name:t,label:null==r.label?"":String(r.label).trim()};switch(e){case m.Header:break;case m.Toggle:n.default=!!r.default;break;case m.List:if(!r.hasOwnProperty("list"))throw new Error("no list specified");if(!Array.isArray(r.list))throw new TypeError("list must be an array");if(0===r.list.length)throw new Error("list must not be empty");if(n.list=Object.freeze(r.list),null==r.default)n.default=r.list[0];else{var i=r.list.indexOf(r.default);if(-1===i)throw new Error("list does not contain default");n.default=r.list[i]}break;default:throw new Error("unknown Setting type: "+e)}"function"==typeof r.onInit&&(n.onInit=Object.freeze(r.onInit)),"function"==typeof r.onChange&&(n.onChange=Object.freeze(r.onChange)),g.push(Object.freeze(n))}function u(e,t){s(m.Header,e,{label:t})}function l(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];s.apply(undefined,[m.Toggle].concat(t))}function c(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];s.apply(undefined,[m.List].concat(t))}function d(){return 0===g.length}function h(e){return g.some(function(t){return t.name===e})}function f(e){return g.find(function(t){return t.name===e})}function p(e){h(e)&&delete settings[e];for(var t=0;t<g.length;++t)if(g[t].name===e){g.splice(t,1),p(e);break}}var g=[],m=Util.toEnum({Header:0,Toggle:1,List:2});return Object.freeze(Object.defineProperties({},{Types:{value:m},init:{value:e},create:{value:t},save:{value:r},load:{value:a},clear:{value:n},reset:{value:i},forEach:{value:o},add:{value:s},addHeader:{value:u},addToggle:{value:l},addList:{value:c},isEmpty:{value:d},has:{value:h},get:{value:f},delete:{value:p}}))}(),Story=function(){function e(){function e(e){if(e.tags.includesAny(a))throw new Error('starting passage "'+e.title+'" contains illegal tags; invalid: "'+e.tags.filter(function(e){return a.includes(e)}).sort().join('", "')+'"')}function t(e){if(n.includes(e.title)&&e.tags.includesAny(a))throw new Error('special passage "'+e.title+'" contains illegal tags; invalid: "'+e.tags.filter(function(e){return a.includes(e)}).sort().join('", "')+'"')}var a=["widget"],n=["PassageDone","PassageFooter","PassageHeader","PassageReady","StoryAuthor","StoryBanner","StoryCaption","StoryInit","StoryMenu","StoryShare","StorySubtitle"],i=jQuery("#store-area>tw-storydata"),o=i.attr("startnode")||"";Config.passages.start=null,Config.debug=/\bdebug\b/.test(i.attr("options")),i.children("style").each(function(e){d.push(new Passage("tw-user-style-"+e,this))}),i.children("script").each(function(e){h.push(new Passage("tw-user-script-"+e,this))}),i.children('tw-passagedata:not([tags~="Twine.private"],[tags~="annotation"])').each(function(){var r=jQuery(this),a=r.attr("pid")||"",n=new Passage(r.attr("name"),this);a===o&&""!==o?(Config.passages.start=n.title,e(n),c[n.title]=n):n.tags.includes("widget")?f.push(n):(t(n),c[n.title]=n)}),g=i.attr("ifid"),r(Util.unescape("Eigengrau&#39;s Essential Establishment Generator")),Config.saves.id=Story.domId}function t(){!function(){var e=document.createElement("style");new StyleWrapper(e).add(d.map(function(e){return e.text.trim()}).join("\n")),jQuery(e).appendTo(document.head).attr({id:"style-story",type:"text/css"})}();for(var e=0;e<h.length;++e)try{Scripting.evalJavaScript(h[e].text)}catch(t){console.error(t),Alert.error(h[e].title,"object"===(void 0===t?"undefined":_typeof(t))?t.message:t)}for(var t=0;t<f.length;++t)try{Wikifier.wikifyEval(f[t].processText())}catch(e){console.error(e),Alert.error(f[t].title,"object"===(void 0===e?"undefined":_typeof(e))?e.message:e)}}function r(e){if(null==e||""===e)throw new Error("story title cannot be null or empty");document.title=p=Util.unescape(e),m=Util.slugify(p)}function a(){return p}function n(){return m}function i(){return g}function o(e){var t=void 0===e?"undefined":_typeof(e);switch(t){case"number":case"string":return c.hasOwnProperty(String(e));case"boolean":case"function":t="a "+t;break;case"undefined":break;default:t=null===e?"null":"an "+t}throw new TypeError("Story.has title parameter cannot be "+t)}function s(e){var t=void 0===e?"undefined":_typeof(e);switch(t){case"number":case"string":var r=String(e);return c.hasOwnProperty(r)?c[r]:new Passage(r||"(unknown)");case"boolean":case"function":t="a "+t;break;case"undefined":break;default:t=null===e?"null":"an "+t}throw new TypeError("Story.get title parameter cannot be "+t)}function u(e,t){for(var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"title",a=Object.keys(c),n=[],i=0;i<a.length;++i){var o=c[a[i]];if(o.hasOwnProperty(e))switch(_typeof(o[e])){case"undefined":break;case"object":for(var s=0,u=o[e].length;s<u;++s)if(o[e][s]==t){n.push(o);break}break;default:o[e]==t&&n.push(o)}}return n.sort(function(e,t){return e[r]==t[r]?0:e[r]<t[r]?-1:1}),n}function l(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"title";if("function"!=typeof e)throw new Error("Story.lookupWith filter parameter must be a function");for(var r=Object.keys(c),a=[],n=0;n<r.length;++n){var i=c[r[n]];e(i)&&a.push(i)}return a.sort(function(e,r){return e[t]==r[t]?0:e[t]<r[t]?-1:1}),a}var c={},d=[],h=[],f=[],p="",g="",m="";return Object.freeze(Object.defineProperties({},{passages:{value:c},styles:{value:d},scripts:{value:h},widgets:{value:f},load:{value:e},init:{value:t},title:{get:a},domId:{get:n},ifId:{get:i},has:{value:o},get:{value:s},lookup:{value:u},lookupWith:{value:l}}))}(),UI=function(){function e(e,t){var r=t,a=Config.debug,n=Config.cleanupWikifierOutput;Config.debug=!1,Config.cleanupWikifierOutput=!1;try{null==r&&(r=document.createElement("ul"));var i=document.createDocumentFragment();new Wikifier(i,Story.get(e).processText().trim());var o=[].concat(_toConsumableArray(i.querySelectorAll(".error"))).map(function(e){return e.textContent.replace(errorPrologRegExp,"")});if(o.length>0)throw new Error(o.join("; "));for(;i.hasChildNodes();){var s=i.firstChild;if(s.nodeType===Node.ELEMENT_NODE&&"A"===s.nodeName.toUpperCase()){var u=document.createElement("li");r.appendChild(u),u.appendChild(s)}else i.removeChild(s)}}finally{Config.cleanupWikifierOutput=n,Config.debug=a}return r}function t(e){jQuery(Dialog.setup("Alert","alert")).append("<p>"+e+'</p><ul class="buttons"><li><button id="alert-ok" class="ui-close">'+L10n.get(["alertOk","ok"])+"</button></li></ul>");for(var t=arguments.length,r=Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];Dialog.open.apply(Dialog,r)}function r(){u(),Dialog.open.apply(Dialog,arguments)}function a(){l(),Dialog.open.apply(Dialog,arguments)}function n(){c(),Dialog.open.apply(Dialog,arguments)}function i(){d(),Dialog.open.apply(Dialog,arguments)}function o(){h(),Dialog.open.apply(Dialog,arguments)}function s(){return jQuery(Dialog.setup(L10n.get("autoloadTitle"),"autoload")).append("<p>"+L10n.get("autoloadPrompt")+'</p><ul class="buttons"><li><button id="autoload-ok" class="ui-close">'+L10n.get(["autoloadOk","ok"])+'</button></li><li><button id="autoload-cancel" class="ui-close">'+L10n.get(["autoloadCancel","cancel"])+"</button></li></ul>"),jQuery(document).one("click.autoload",".ui-close",function(e){var t="autoload-ok"===e.target.id;jQuery(document).one(":dialogclose",function(){t&&Save.autosave.load()||Engine.play(Config.passages.start)})}),!0}function u(){var e=document.createElement("ul");jQuery(Dialog.setup(L10n.get("jumptoTitle"),"jumpto list")).append(e);for(var t=State.expired.length,r=State.size-1;r>=0;--r)if(r!==State.activeIndex){var a=Story.get(State.history[r].title);a&&a.tags.includes("bookmark")&&jQuery(document.createElement("li")).append(jQuery(document.createElement("a")).ariaClick({one:!0},function(e){return function(){return jQuery(document).one(":dialogclose",function(){return Engine.goTo(e)})}}(r)).addClass("ui-close").text(L10n.get("jumptoTurn")+" "+(t+r+1)+": "+a.description())).appendTo(e)}e.hasChildNodes()||jQuery(e).append("<li><a><em>"+L10n.get("jumptoUnavailable")+"</em></a></li>")}function l(){return jQuery(Dialog.setup(L10n.get("restartTitle"),"restart")).append("<p>"+L10n.get("restartPrompt")+'</p><ul class="buttons"><li><button id="restart-ok">'+L10n.get(["restartOk","ok"])+'</button></li><li><button id="restart-cancel" class="ui-close">'+L10n.get(["restartCancel","cancel"])+"</button></li></ul>").find("#restart-ok").ariaClick({one:!0},function(){jQuery(document).one(":dialogclose",function(){return Engine.restart()}),Dialog.close()}),!0}function c(){function e(e,t,r,a){var n=jQuery(document.createElement("button")).attr("id","saves-"+e).html(r);return t&&n.addClass(t),a?n.ariaClick(a):n.prop("disabled",!0),jQuery(document.createElement("li")).append(n)}var r=jQuery(Dialog.setup(L10n.get("savesTitle"),"saves")),a=Save.ok();if(a&&r.append(function(){function e(e,t,r,a,n){var i=jQuery(document.createElement("button")).attr("id","saves-"+e+"-"+a).addClass(e).html(r);return t&&i.addClass(t),n?"auto"===a?i.ariaClick({label:r+" "+L10n.get("savesLabelAuto")},function(){return n()}):i.ariaClick({label:r+" "+L10n.get("savesLabelSlot")+" "+(a+1)},function(){return n(a)}):i.prop("disabled",!0),i}var t=Save.get(),r=jQuery(document.createElement("tbody"));if(Save.autosave.ok()){var a=jQuery(document.createElement("td")),n=jQuery(document.createElement("td")),i=jQuery(document.createElement("td")),o=jQuery(document.createElement("td"));jQuery(document.createElement("b")).attr({title:L10n.get("savesLabelAuto"),"aria-label":L10n.get("savesLabelAuto")}).text("A").appendTo(a),t.autosave?(n.append(e("load","ui-close",L10n.get("savesLabelLoad"),"auto",function(){jQuery(document).one(":dialogclose",function(){return Save.autosave.load()})})),jQuery(document.createElement("div")).text(t.autosave.title).appendTo(i),jQuery(document.createElement("div")).addClass("datestamp").html(t.autosave.date?L10n.get("savesSavedOn")+" "+new Date(t.autosave.date).toLocaleString():L10n.get("savesSavedOn")+" <em>"+L10n.get("savesUnknownDate")+"</em>").appendTo(i),o.append(e("delete",null,L10n.get("savesLabelDelete"),"auto",function(){Save.autosave.delete(),c()}))):(n.append(e("load",null,L10n.get("savesLabelLoad"),"auto")),jQuery(document.createElement("em")).text(L10n.get("savesEmptySlot")).appendTo(i),i.addClass("empty"),o.append(e("delete",null,L10n.get("savesLabelDelete"),"auto"))),jQuery(document.createElement("tr")).append(a).append(n).append(i).append(o).appendTo(r)}for(var s=0,u=t.slots.length;s<u;++s){
var l=jQuery(document.createElement("td")),d=jQuery(document.createElement("td")),h=jQuery(document.createElement("td")),f=jQuery(document.createElement("td"));l.append(document.createTextNode(s+1)),t.slots[s]?(d.append(e("load","ui-close",L10n.get("savesLabelLoad"),s,function(e){jQuery(document).one(":dialogclose",function(){return Save.slots.load(e)})})),jQuery(document.createElement("div")).text(t.slots[s].title).appendTo(h),jQuery(document.createElement("div")).addClass("datestamp").html(t.slots[s].date?L10n.get("savesSavedOn")+" "+new Date(t.slots[s].date).toLocaleString():L10n.get("savesSavedOn")+" <em>"+L10n.get("savesUnknownDate")+"</em>").appendTo(h),f.append(e("delete",null,L10n.get("savesLabelDelete"),s,function(e){Save.slots.delete(e),c()}))):(d.append(e("save","ui-close",L10n.get("savesLabelSave"),s,Save.slots.save)),jQuery(document.createElement("em")).text(L10n.get("savesEmptySlot")).appendTo(h),h.addClass("empty"),f.append(e("delete",null,L10n.get("savesLabelDelete"),s))),jQuery(document.createElement("tr")).append(l).append(d).append(h).append(f).appendTo(r)}return jQuery(document.createElement("table")).attr("id","saves-list").append(r)}()),a||Has.fileAPI){var n=jQuery(document.createElement("ul")).addClass("buttons").appendTo(r);return Has.fileAPI&&(n.append(e("export","ui-close",L10n.get("savesLabelExport"),function(){return Save.export()})),n.append(e("import",null,L10n.get("savesLabelImport"),function(){return r.find("#saves-import-file").trigger("click")})),jQuery(document.createElement("input")).css({display:"block",visibility:"hidden",position:"fixed",left:"-9999px",top:"-9999px",width:"1px",height:"1px"}).attr({type:"file",id:"saves-import-file",tabindex:-1,"aria-hidden":!0}).on("change",function(e){jQuery(document).one(":dialogclose",function(){return Save.import(e)}),Dialog.close()}).appendTo(r)),a&&n.append(e("clear",null,L10n.get("savesLabelClear"),Save.autosave.has()||!Save.slots.isEmpty()?function(){Save.clear(),c()}:null)),!0}return t(L10n.get("savesIncapable")),!1}function d(){var e=jQuery(Dialog.setup(L10n.get("settingsTitle"),"settings"));return Setting.forEach(function(t){if(t.type===Setting.Types.Header){var r=t.name,a=Util.slugify(r),n=jQuery(document.createElement("div")),i=jQuery(document.createElement("h2")),o=jQuery(document.createElement("p"));return n.attr("id","header-body-"+a).append(i).append(o).appendTo(e),i.attr("id","header-heading-"+a).wiki(r),void o.attr("id","header-label-"+a).wiki(t.label)}var s=t.name,u=Util.slugify(s),l=jQuery(document.createElement("div")),c=jQuery(document.createElement("label")),d=jQuery(document.createElement("div")),h=void 0;switch(l.attr("id","setting-body-"+u).append(c).append(d).appendTo(e),c.attr({id:"setting-label-"+u,for:"setting-control-"+u}).wiki(t.label),null==settings[s]&&(settings[s]=t.default),t.type){case Setting.Types.Toggle:h=jQuery(document.createElement("button")),settings[s]?h.addClass("enabled").text(L10n.get("settingsOn")):h.text(L10n.get("settingsOff")),h.ariaClick(function(){settings[s]?(jQuery(this).removeClass("enabled").text(L10n.get("settingsOff")),settings[s]=!1):(jQuery(this).addClass("enabled").text(L10n.get("settingsOn")),settings[s]=!0),Setting.save(),t.hasOwnProperty("onChange")&&t.onChange.call({name:s,value:settings[s],default:t.default})});break;case Setting.Types.List:h=jQuery(document.createElement("select"));for(var f=0,p=t.list.length;f<p;++f)jQuery(document.createElement("option")).val(f).text(t.list[f]).appendTo(h);h.val(t.list.indexOf(settings[s])).attr("tabindex",0).on("change",function(){settings[s]=t.list[Number(this.value)],Setting.save(),t.hasOwnProperty("onChange")&&t.onChange.call({name:s,value:settings[s],default:t.default,list:t.list})})}h.attr("id","setting-control-"+u).appendTo(d)}),e.append('<ul class="buttons"><li><button id="settings-ok" class="ui-close">'+L10n.get(["settingsOk","ok"])+'</button></li><li><button id="settings-reset">'+L10n.get("settingsReset")+"</button></li></ul>").find("#settings-reset").ariaClick({one:!0},function(){jQuery(document).one(":dialogclose",function(){Setting.reset(),window.location.reload()}),Dialog.close()}),!0}function h(){try{jQuery(Dialog.setup(L10n.get("shareTitle"),"share list")).append(e("StoryShare"))}catch(e){return console.error(e),Alert.error("StoryShare",e.message),!1}return!0}return Object.freeze(Object.defineProperties({},{assembleLinkList:{value:e},alert:{value:t},jumpto:{value:r},restart:{value:a},saves:{value:n},settings:{value:i},share:{value:o},buildAutoload:{value:s},buildJumpto:{value:u},buildRestart:{value:l},buildSaves:{value:c},buildSettings:{value:d},buildShare:{value:h},stow:{value:function(){return UIBar.stow()}},unstow:{value:function(){return UIBar.unstow()}},setStoryElements:{value:function(){return UIBar.setStoryElements()}},isOpen:{value:function(){return Dialog.isOpen.apply(Dialog,arguments)}},body:{value:function(){return Dialog.body()}},setup:{value:function(){return Dialog.setup.apply(Dialog,arguments)}},addClickHandler:{value:function(){return Dialog.addClickHandler.apply(Dialog,arguments)}},open:{value:function(){return Dialog.open.apply(Dialog,arguments)}},close:{value:function(){return Dialog.close.apply(Dialog,arguments)}},resize:{value:function(){return Dialog.resize()}},buildDialogAutoload:{value:s},buildDialogJumpto:{value:u},buildDialogRestart:{value:l},buildDialogSaves:{value:c},buildDialogSettings:{value:d},buildDialogShare:{value:h},buildLinkListFromPassage:{value:e}}))}(),UIBar=function(){function e(){o||document.getElementById("ui-bar")||(!function(){var e=L10n.get("uiBarToggle"),t=L10n.get("uiBarBackward"),r=L10n.get("uiBarJumpto"),a=L10n.get("uiBarForward");jQuery(document.createDocumentFragment()).append('<div id="ui-bar"><div id="ui-bar-tray"><button id="ui-bar-toggle" tabindex="0" title="'+e+'" aria-label="'+e+'"></button><div id="ui-bar-history"><button id="history-backward" tabindex="0" title="'+t+'" aria-label="'+t+'"></button><button id="history-jumpto" tabindex="0" title="'+r+'" aria-label="'+r+'"></button><button id="history-forward" tabindex="0" title="'+a+'" aria-label="'+a+'"></button></div></div><div id="ui-bar-body"><header id="title" role="banner"><div id="story-banner"></div><h1 id="story-title"></h1><div id="story-subtitle"></div><div id="story-title-separator"></div><p id="story-author"></p></header><div id="story-caption"></div><nav id="menu" role="navigation"><ul id="menu-story"></ul><ul id="menu-core"><li id="menu-item-saves"><a tabindex="0">'+L10n.get("savesTitle")+'</a></li><li id="menu-item-settings"><a tabindex="0">'+L10n.get("settingsTitle")+'</a></li><li id="menu-item-restart"><a tabindex="0">'+L10n.get("restartTitle")+'</a></li><li id="menu-item-share"><a tabindex="0">'+L10n.get("shareTitle")+"</a></li></ul></nav></div></div>").insertBefore("#store-area")}(),jQuery(document).on(":historyupdate.ui-bar",function(e,t){return function(){e.prop("disabled",State.length<2),t.prop("disabled",State.length===State.size)}}(jQuery("#history-backward"),jQuery("#history-forward"))))}function t(){if(!o){var e=jQuery("#ui-bar");("boolean"==typeof Config.ui.stowBarInitially?Config.ui.stowBarInitially:jQuery(window).width()<=Config.ui.stowBarInitially)&&function(){var t=jQuery(e).add("#story");t.addClass("no-transition"),e.addClass("stowed"),setTimeout(function(){return t.removeClass("no-transition")},Engine.minDomActionDelay)}(),jQuery("#ui-bar-toggle").ariaClick({label:L10n.get("uiBarToggle")},function(){return e.toggleClass("stowed")}),Config.history.controls?(jQuery("#history-backward").prop("disabled",State.length<2).ariaClick({label:L10n.get("uiBarBackward")},function(){return Engine.backward()}),Story.lookup("tags","bookmark").length>0?jQuery("#history-jumpto").ariaClick({label:L10n.get("uiBarJumpto")},function(){return UI.jumpto()}):jQuery("#history-jumpto").remove(),jQuery("#history-forward").prop("disabled",State.length===State.size).ariaClick({label:L10n.get("uiBarForward")},function(){return Engine.forward()})):jQuery("#ui-bar-history").remove(),jQuery("#story-title").text(Story.title),Story.has("StoryCaption")||jQuery("#story-caption").remove(),Story.has("StoryMenu")||jQuery("#menu-story").remove(),Config.ui.updateStoryElements||i(),Dialog.addClickHandler("#menu-item-saves a",null,UI.buildSaves).text(L10n.get("savesTitle")),Setting.isEmpty()?jQuery("#menu-item-settings").remove():Dialog.addClickHandler("#menu-item-settings a",null,UI.buildSettings).text(L10n.get("settingsTitle")),Dialog.addClickHandler("#menu-item-restart a",null,UI.buildRestart).text(L10n.get("restartTitle")),Story.has("StoryShare")?Dialog.addClickHandler("#menu-item-share a",null,UI.buildShare).text(L10n.get("shareTitle")):jQuery("#menu-item-share").remove()}}function r(){o||(jQuery(document).off(".ui-bar"),jQuery("#ui-bar").remove(),jQuery(document.head).find("#style-ui-bar").remove(),Config.ui.updateStoryElements=!1,o=!0)}function a(e){if(!o){var t=jQuery("#ui-bar");e&&t.addClass("no-transition"),t.addClass("stowed"),e&&setTimeout(function(){return t.removeClass("no-transition")},Engine.minDomActionDelay)}}function n(e){if(!o){var t=jQuery("#ui-bar");e&&t.addClass("no-transition"),t.removeClass("stowed"),e&&setTimeout(function(){return t.removeClass("no-transition")},Engine.minDomActionDelay)}}function i(){if(!o){setPageElement("story-banner","StoryBanner"),setPageElement("story-subtitle","StorySubtitle"),setPageElement("story-author","StoryAuthor"),setPageElement("story-caption","StoryCaption");var e=document.getElementById("menu-story");if(null!==e&&(jQuery(e).empty(),Story.has("StoryMenu")))try{UI.assembleLinkList("StoryMenu",e)}catch(e){console.error(e),Alert.error("StoryMenu",e.message)}}}var o=!1;return Object.freeze(Object.defineProperties({},{init:{value:e},start:{value:t},destroy:{value:r},stow:{value:a},unstow:{value:n},setStoryElements:{value:i}}))}(),DebugBar=function(){function e(){var e=L10n.get("debugBarAddWatch"),t=L10n.get("debugBarWatchAll"),n=L10n.get("debugBarWatchNone"),o=L10n.get("debugBarWatchToggle"),d=L10n.get("debugBarViewsToggle"),h=jQuery(document.createDocumentFragment()).append('<div id="debug-bar"><div id="debug-bar-watch" aria-hidden="true" hidden="hidden"><div>'+L10n.get("debugBarNoWatches")+'</div>></div><div><button id="debug-bar-watch-toggle" tabindex="0" title="'+o+'" aria-label="'+o+'">'+L10n.get("debugBarLabelWatch")+'</button><label id="debug-bar-watch-label" for="debug-bar-watch-input">'+L10n.get("debugBarLabelAdd")+'</label><input id="debug-bar-watch-input" name="debug-bar-watch-input" type="text" list="debug-bar-watch-list" tabindex="0"><datalist id="debug-bar-watch-list" aria-hidden="true" hidden="hidden"></datalist><button id="debug-bar-watch-add" tabindex="0" title="'+e+'" aria-label="'+e+'"></button><button id="debug-bar-watch-all" tabindex="0" title="'+t+'" aria-label="'+t+'"></button><button id="debug-bar-watch-none" tabindex="0" title="'+n+'" aria-label="'+n+'"></button></div><div><button id="debug-bar-views-toggle" tabindex="0" title="'+d+'" aria-label="'+d+'">'+L10n.get("debugBarLabelViews")+'</button><label id="debug-bar-turn-label" for="debug-bar-turn-select">'+L10n.get("debugBarLabelTurn")+'</label><select id="debug-bar-turn-select" tabindex="0"></select></div></div>');g=jQuery(h.find("#debug-bar-watch").get(0)),m=jQuery(h.find("#debug-bar-watch-list").get(0)),v=jQuery(h.find("#debug-bar-turn-select").get(0));var f=jQuery(h.find("#debug-bar-watch-toggle").get(0)),p=jQuery(h.find("#debug-bar-watch-input").get(0)),y=jQuery(h.find("#debug-bar-watch-add").get(0)),b=jQuery(h.find("#debug-bar-watch-all").get(0)),w=jQuery(h.find("#debug-bar-watch-none").get(0)),k=jQuery(h.find("#debug-bar-views-toggle").get(0));h.appendTo("body"),f.ariaClick(function(){g.attr("hidden")?g.removeAttr("aria-hidden hidden"):g.attr({"aria-hidden":!0,hidden:"hidden"}),s()}),p.on(":addwatch",function(){r(this.value.trim()),this.value=""}).on("keypress",function(e){13===e.which&&(e.preventDefault(),p.trigger(":addwatch"))}),y.ariaClick(function(){return p.trigger(":addwatch")}),b.ariaClick(a),w.ariaClick(i),v.on("change",function(){Engine.goTo(Number(this.value))}),k.ariaClick(function(){DebugView.toggle(),s()}),jQuery(document).on(":historyupdate.debug-bar",c).on(":passageend.debug-bar",function(){u(),l()}).on(":enginerestart.debug-bar",function(){session.delete("debugState")})}function t(){o(),c(),u(),l()}function r(e){h.test(e)&&(p.pushUnique(e),p.sort(),u(),l(),s())}function a(){Object.keys(State.variables).map(function(e){return p.pushUnique("$"+e)}),Object.keys(State.temporary).map(function(e){return p.pushUnique("_"+e)}),p.sort(),u(),l(),s()}function n(e){p.delete(e),u(),l(),s()}function i(){for(var e=p.length-1;e>=0;--e)p.pop();u(),l(),s()}function o(){if(session.has("debugState")){var e=session.get("debugState");p.push.apply(p,_toConsumableArray(e.watchList)),e.watchEnabled?g.removeAttr("aria-hidden hidden"):g.attr({"aria-hidden":!0,hidden:"hidden"}),e.viewsEnabled?DebugView.enable():DebugView.disable()}}function s(){session.set("debugState",{watchList:p,watchEnabled:!g.attr("hidden"),viewsEnabled:DebugView.isEnabled()})}function u(){if(0===p.length)return void g.empty().append("<div>"+L10n.get("debugBarNoWatches")+"</div>");for(var e=L10n.get("debugBarDeleteWatch"),t=jQuery(document.createElement("table")),r=jQuery(document.createElement("tbody")),a=0,i=p.length;a<i;++a)!function(t,a){var i=p[t],o=i.slice(1),s="$"===i[0]?State.variables:State.temporary,u=jQuery(document.createElement("tr")),l=jQuery(document.createElement("button")),c=jQuery(document.createElement("code"));l.addClass("watch-delete").attr("data-name",i).ariaClick({one:!0,label:e},function(){return n(i)}),c.text(d(s[o])),jQuery(document.createElement("td")).append(l).appendTo(u),jQuery(document.createElement("td")).text(i).appendTo(u),jQuery(document.createElement("td")).append(c).appendTo(u),u.appendTo(r)}(a);t.append(r),g.empty().append(t)}function l(){var e=Object.keys(State.variables),t=Object.keys(State.temporary);if(0===e.length&&0===t.length)return void m.empty();var r=[].concat(_toConsumableArray(e.map(function(e){return"$"+e})),_toConsumableArray(t.map(function(e){return"_"+e}))).sort(),a=document.createDocumentFragment();r.delete(p);for(var n=0,i=r.length;n<i;++n)jQuery(document.createElement("option")).val(r[n]).appendTo(a);m.empty().append(a)}function c(){for(var e=State.size,t=State.expired.length,r=document.createDocumentFragment(),a=0;a<e;++a)jQuery(document.createElement("option")).val(a).text(t+a+1+". "+Util.escape(State.history[a].title)).appendTo(r);v.empty().prop("disabled",e<2).append(r).val(State.activeIndex)}function d(e){if(null===e)return"null";switch(void 0===e?"undefined":_typeof(e)){case"number":if(Number.isNaN(e))return"NaN";if(!Number.isFinite(e))return"Infinity";case"boolean":case"symbol":case"undefined":return String(e);case"string":return JSON.stringify(e);case"function":return"Function"}var t=Util.toStringTag(e);if("Date"===t)return"Date {"+e.toLocaleString()+"}";if("RegExp"===t)return"RegExp "+e.toString();var r=[];if(e instanceof Array||e instanceof Set){for(var a=e instanceof Array?e:Array.from(e),n=0,i=a.length;n<i;++n)r.push(a.hasOwnProperty(n)?d(a[n]):"<empty>");return Object.keys(a).filter(function(e){return!f.test(e)}).forEach(function(e){return r.push(d(e)+": "+d(a[e]))}),t+"("+a.length+") ["+r.join(", ")+"]"}return e instanceof Map?(e.forEach(function(e,t){return r.push(d(t)+" → "+d(e))}),t+"("+e.size+") {"+r.join(", ")+"}"):(Object.keys(e).forEach(function(t){return r.push(d(t)+": "+d(e[t]))}),t+" {"+r.join(", ")+"}")}var h=new RegExp("^"+Patterns.variable+"$"),f=/^\d+$/,p=[],g=null,m=null,v=null;return Object.freeze(Object.defineProperties({},{init:{value:e},start:{value:t},watch:{value:r},watchAll:{value:a},unwatch:{value:n},unwatchAll:{value:i}}))}(),LoadScreen=function(){function e(){jQuery(document).on("readystatechange.SugarCube",function(){o.size>0||("complete"===document.readyState?"loading"===jQuery(document.documentElement).attr("data-init")&&(Config.loadDelay>0?setTimeout(function(){0===o.size&&r()},Math.max(Engine.minDomActionDelay,Config.loadDelay)):r()):a())})}function t(){jQuery(document).off("readystatechange.SugarCube"),o.clear(),r()}function r(){jQuery(document.documentElement).removeAttr("data-init")}function a(){jQuery(document.documentElement).attr("data-init","loading")}function n(){return++s,o.add(s),a(),s}function i(e){if(null==e)throw new Error("LoadScreen.unlock called with a null or undefined ID");o.has(e)&&o.delete(e),0===o.size&&jQuery(document).trigger("readystatechange")}var o=new Set,s=0;return Object.freeze(Object.defineProperties({},{init:{value:e},clear:{value:t},hide:{value:r},show:{value:a},lock:{value:n},unlock:{value:i}}))}(),version=Object.freeze({title:"SugarCube",major:2,minor:23,patch:5,prerelease:null,build:8492,date:new Date("2018-02-10T17:06:53.678Z"),extensions:{},toString:function(){var e=this.prerelease?"-"+this.prerelease:"";return this.major+"."+this.minor+"."+this.patch+e+"+"+this.build},short:function(){var e=this.prerelease?"-"+this.prerelease:"";return this.title+" (v"+this.major+"."+this.minor+"."+this.patch+e+")"},long:function(){return this.title+" v"+this.toString()+" ("+this.date.toUTCString()+")"}}),TempState={},macros={},postdisplay={},postrender={},predisplay={},prehistory={},prerender={},session=null,settings={},setup={},storage=null,browser=Browser,config=Config,has=Has,History=State,state=State,tale=Story,TempVariables=State.temporary;window.SugarCube={},jQuery(function(){try{var e=LoadScreen.lock();LoadScreen.init(),document.normalize&&document.normalize(),Story.load(),storage=SimpleStore.create(Story.domId,!0),session=SimpleStore.create(Story.domId,!1),Dialog.init(),UIBar.init(),Engine.init(),Story.init(),L10n.init(),session.has("rcWarn")||"cookie"!==storage.name||(session.set("rcWarn",1),window.alert(L10n.get("warningNoWebStorage"))),Save.init(),Setting.init(),Macro.init(),Engine.start(),UIBar.start(),Config.debug&&(DebugBar.init(),DebugBar.start()),window.SugarCube={Browser:Browser,Config:Config,Dialog:Dialog,DebugView:DebugView,Engine:Engine,Has:Has,L10n:L10n,Macro:Macro,Passage:Passage,Save:Save,Scripting:Scripting,Setting:Setting,SimpleAudio:SimpleAudio,State:State,Story:Story,UI:UI,UIBar:UIBar,DebugBar:DebugBar,Util:Util,Wikifier:Wikifier,macros:macros,session:session,settings:settings,setup:setup,storage:storage,version:version},LoadScreen.unlock(e)}catch(e){return console.error(e),LoadScreen.clear(),Alert.fatal(null,e.message,e)}})}(window,window.document,jQuery);}
	</script>
</body>
</html>
